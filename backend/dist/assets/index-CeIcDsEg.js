import{r as n,j as e}from"./react-DmLYqgKm.js";import{c as lr}from"./react-dom-DPPwivfB.js";import{u as me,a as Je,L as st,O as Ps,b as $t,R as ur,c as le,B as dr}from"./react-router-C4BYJpcq.js";import{I as mr,a as Ut,b as ot,c as Zt,d as je,e as ct,f as hr,g as kt,h as it,i as Ls,j as fr,k as pr,l as gr,m as xr,n as vr,o as bt,p as Xt,q as $s,r as Me,s as Os,t as Ms,u as jr,v as Us,w as br,x as yr,y as Nr,z as kr,A as es,B as Sr,C as Tr,D as wr,E as Er,F as _s,G as _t,H as Rr,J as Bs,K as Cr,L as Ar,M as Ir,N as Fr,O as ts,P as ss,Q as lt,R as Pr,S as Gs,T as Ds,U as Jt,V as Lr,W as $r,X as Or,Y as ns,Z as Mr,_ as Ur,$ as _r,a0 as Br,a1 as Gr,a2 as Dr,a3 as Vr,a4 as Vs,a5 as Hr,a6 as qr,a7 as zr,a8 as Ye,a9 as Wr,aa as Kr,ab as Qr,ac as Jr,ad as Yr,ae as Hs,af as Xr,ag as Zr,ah as ea,ai as ta,aj as sa,ak as na,al as ra,am as aa,an as oa,ao as ca,ap as ia,aq as la,ar as ua,as as da,at as ma,au as ha}from"./@tabler-C6Dpwwh0.js";import{F as Ie}from"./react-window-Dlc0x0tK.js";import{v as yt}from"./uuid-C6aID195.js";import{Z as rs}from"./react-colorful-0uAH5Wqu.js";import{_ as vt}from"./lodash-BhRqD2di.js";import{p as fa}from"./music-metadata-CvBiwAZp.js";import{a as pa}from"./axios-xsH4HHeE.js";import{F as qs}from"./fuse.js-Ch1WBRTM.js";import"./content-type-kkloIWN6.js";import"./scheduler-SPyfQU6S.js";import"./cookie--_YQFYBD.js";import"./@babel-Cj2_JSWT.js";import"./memoize-one-CcMeOnPo.js";import"./strtok3-BXaumHbT.js";import"./peek-readable-BVp5v6zA.js";import"./file-type-BdA4k6lR.js";import"./token-types-D2R8hC8p.js";import"./ieee754-DcnkbHBT.js";import"./@tokenizer-Sx_RGPFW.js";import"./fflate-D0DoR3vL.js";import"./debug-Dqg9INeJ.js";import"./ms-CzQ2E3wO.js";import"./uint8array-extras-B1Dultle.js";import"./media-typer-Kaw9hxcp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&u(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function u(l){if(l.ep)return;l.ep=!0;const r=o(l);fetch(l.href,r)}})();const ga=()=>{const t=window.location.hostname,s=window.location.port;return t==="localhost"||t.startsWith("127.0.0.1")?`http://localhost:${s}`:`http://${t}:${s}`},N=ga(),zs=n.createContext(),xe=()=>n.useContext(zs),xa=({children:t})=>{const s=n.useRef(new Map),o=(l,r)=>(s.current.has(l)||s.current.set(l,new Set),s.current.get(l).add(r),()=>{var a;(a=s.current.get(l))==null||a.delete(r)}),u=(l,r)=>{s.current.has(l)&&s.current.get(l).forEach(a=>{a(r),console.log("called at",a)})};return e.jsx(zs.Provider,{value:{emit:u,subscribe:o},children:t})},va=()=>{const[t,s]=n.useState(!1),[o,u]=n.useState(!1),l=me(),r=n.useRef(null),{subscribe:a}=xe(),d=()=>{s(!t)},m=()=>{fetch(`${N}/auth/logout`,{method:"POST",credentials:"include"}).then(p=>{p.ok?l("/"):console.error("Logout failed")}).catch(p=>{console.error("Error:",p)})},h=()=>{l("/account")},c=()=>{l("/settings")};return n.useEffect(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{u(x)});const p=x=>{var v;if(r.current&&!r.current.contains(x.target)){if(((v=x.target.closest("svg"))==null?void 0:v.id)==="user-button")return;s(!1)}},f=a("action-bar-open",()=>{s(!1)});return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{f(),document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[]),e.jsxs("div",{className:"userDropdown",ref:r,children:[e.jsx(mr,{id:"user-button",className:"userImage buttonRound",onClick:d}),t&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"userAccount dropdownEntry",onClick:h,children:"Account"}),e.jsx("button",{className:"userSetting dropdownEntry",onClick:c,children:"Settings"}),o&&e.jsx("button",{className:"userSetting dropdownEntry",onClick:()=>{l("/admin-pannel")},children:"Admin pannel"}),e.jsx("button",{className:"userLogout dropdownEntry",onClick:m,children:"Logout"})]})]})},as=t=>{var s=function(a){return("00"+a).slice(-2)};const o=Math.floor(t/3600),u=Math.floor(t%3600/60),l=s(Math.floor(t%60)),r=o>0?`${o}:${u}:${l}`:`${u}:${l}`;return{hours:o,minutes:u,seconds:l,readable:r}},Yt=t=>{const s=Math.floor(t/1024),o=Math.floor(s/1024),u=Math.floor(o/1024),l=Math.floor(u/1024),r=l>0?`${Number(t/1024/1024/1024/1024).toFixed(2)}TB`:u>0?`${Number(t/1024/1024/1024).toFixed(2)}GB`:o>0?`${Number(t/1024/1024).toFixed(2)}MB`:`${Number(t/1024).toFixed(2)}KB`;return{kb:s,mb:o,gb:u,tb:l,readable:r}},Ws=(t,s,o)=>{s/=100,o/=100;let u=(1-Math.abs(2*o-1))*s,l=u*(1-Math.abs(t/60%2-1)),r=o-u/2,a=0,d=0,m=0;return 0<=t&&t<60?(a=u,d=l,m=0):60<=t&&t<120?(a=l,d=u,m=0):120<=t&&t<180?(a=0,d=u,m=l):180<=t&&t<240?(a=0,d=l,m=u):240<=t&&t<300?(a=l,d=0,m=u):300<=t&&t<360&&(a=u,d=0,m=l),a=Math.round((a+r)*255).toString(16),d=Math.round((d+r)*255).toString(16),m=Math.round((m+r)*255).toString(16),a.length==1&&(a="0"+a),d.length==1&&(d="0"+d),m.length==1&&(m="0"+m),"#"+a+d+m},ks=(t,s,o)=>(t=t.toString(16),s=s.toString(16),o=o.toString(16),t.length==1&&(t="0"+t),s.length==1&&(s="0"+s),o.length==1&&(o="0"+o),"#"+t+s+o),_e=t=>{let s=0,o=0,u=0;return t.length==4?(s="0x"+t[1]+t[1],o="0x"+t[2]+t[2],u="0x"+t[3]+t[3]):t.length==7&&(s="0x"+t[1]+t[2],o="0x"+t[3]+t[4],u="0x"+t[5]+t[6]),[parseInt(s),parseInt(o),parseInt(u)]},Qe=(t,s,o)=>t+(s-t)*o,ja=(t,s,o,u,l)=>Qe(u,l,(t-s)/(o-s)),De=(t,s)=>{var o=t??"";return o.length>s?o.substring(0,s-2)+"..":o},ba=(t="")=>{const s=["/","/register"];return new Promise(async o=>{const u=await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"}).then(async l=>l.ok?!0:(s.includes(t)||await fetch(`${N}/auth/logout`,{method:"POST",credentials:"include"}).then(r=>{r.ok?window.location.href="/":console.error("Logout failed")}),!1));o(u)})},Ue=(t,s="")=>async function(){await ba(s)&&t()},ya=t=>t.charAt(0).toUpperCase()+t.slice(1),Ss=([t,s,o])=>{const u=[t,s,o].map(l=>(l/=255,l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4)));return .2126*u[0]+.7152*u[1]+.0722*u[2]},Na=(t,s)=>{const o=Ss(t),u=Ss(s);return(Math.max(o,u)+.05)/(Math.min(o,u)+.05)},se=({col1:t="#f9c58d",col2:s="#f492f0",className:o,style:u={},id:l=""})=>e.jsxs("svg",{id:l,viewBox:"0 0 512 512",style:{...u},className:o,xmlns:"http://www.w3.org/2000/svg",fill:"#000000",children:[e.jsxs("defs",{children:[e.jsx("mask",{id:"mask_logo",fill:"black",children:e.jsx("path",{fill:"white",d:"M116.215 17.404c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm64.326 12.87l-23.488 92.062h63.965l27.49-27.49-67.967-64.573zm228.147 25.958c0 20.214-20.216 40.428-40.43 40.428 20.214 0 40.43 20.214 40.43 40.428 0-20.214 20.213-40.428 40.427-40.428-20.214 0-40.428-20.214-40.428-40.428zm-150.022 53.913l-23.18 23.18L283.043 311h29.066l-53.443-200.855zm75.232 2.365l16.123 32.281 45.188 33.148-4.393-53.533-56.918-11.896zm-18.033 4.181l-26.685 38.121 10 37.586 33.38-42.283-16.695-33.424zm-160.672 23.645L172.42 206.4l21.988 12.623L239.043 311h25.365l-45.68-170.664h-63.535zm189.797 23.088l-40.03 50.703L330.737 311h.026l64.08-111.004-49.852-36.572zm122.352 5.834c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm-374.22 12.375l11.308 76.129 48.834-6.356 19.322-24.154-79.465-45.62zm346.995 53.793l-52.547 13.172L351.547 311h25.77l19.16-19.48 43.64-56.094zm-255.21 5.244l-17.403 21.75 25.77 48.58h25.761l-34.129-70.33zm-33.84 29.174l-39.005 5.074L148.145 311h24.751l-21.83-41.156zm-91.37 11.396c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zM137 329v30h238v-30H137zm32 48v78h16v-78h-16zm34 0v78h106v-78H203zm124 0v78h16v-78h-16zm-164.758 96l-30.119 16h247.754l-30.12-16H162.243z"})}),e.jsxs("linearGradient",{id:"grad_logo",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:t}),e.jsx("stop",{offset:"100%",stopColor:s})]})]}),e.jsx("rect",{x:"0",y:"0",width:"512",height:"512",fill:"url(#grad_logo)",mask:"url(#mask_logo)"})]}),ut=({entry:t,style:s,onClick:o,className:u=""})=>e.jsxs("div",{className:`action-bar-entry ${u}`,style:s,onClick:()=>{o(t)},children:[t.icon(),e.jsxs("span",{style:{flex:"1"},children:[" ",t.name]}),t.tooltip?t.tooltip(t.type):null]}),Ks=n.createContext(),nt={SUCCESS:"success",ERROR:"error",INFO:"info",SALAD:"salad",QUEUE:"queue"},ka=({children:t})=>{const[s,o]=n.useState(null),[u,l]=n.useState(null),r=n.useRef(null),a=n.useRef([]),d=(h,c)=>{a.current.forEach(f=>clearTimeout(f)),a.current=[],l({message:h,state:c}),o(!0);const p=setTimeout(()=>{r.current&&(r.current.setAttribute("direction",""),r.current.offsetWidth,r.current.setAttribute("direction","hide"));const f=setTimeout(()=>{o(!1),l(null)},300);a.current.push(f)},2e3);a.current.push(p)};n.useEffect(()=>{u&&o(!0)},[u]),n.useEffect(()=>{!s||!r.current||r.current.setAttribute("direction","show")},[s]);const m=()=>{if(!s)return null;switch(u==null?void 0:u.state){case nt.SUCCESS:return e.jsx(ct,{className:"notification-icon"});case nt.ERROR:return e.jsx(je,{className:"notification-icon"});case nt.INFO:return e.jsx(Zt,{className:"notification-icon"});case nt.SALAD:return e.jsx(ot,{className:"notification-icon"});case nt.QUEUE:return e.jsx(Ut,{className:"notification-icon"});default:return null}};return e.jsxs(Ks.Provider,{value:{notifTypes:nt,addNotification:d},children:[t,u?e.jsx("div",{ref:r,className:"notification-parent",id:"notification-parent",children:e.jsxs("div",{className:"notification","is-open":u?"true":"false",children:[e.jsx(m,{}),e.jsx("span",{children:u.message})]})}):null]})},Fe=()=>n.useContext(Ks),Sa=({onClose:t,track:s})=>{const[o,u]=n.useState(!1),l=n.useRef(null),r=n.useRef(null),[a,d]=n.useState([]),[m,h]=n.useState(null),[c,p]=n.useState(""),{addNotification:f,notifTypes:x}=Fe(),v=P=>{if(P.preventDefault(),c==""&&!m){t(!1);return}fetch(`${N}/read-write/moveTrackToAlbum/${c?"true/"+c:"false/"+m.id}/${s.id}`).then(S=>S.json()).then(S=>{f(`Track ${s.title} moved to 
            ${c||m.name}.`,x.INFO),t(!0)})},b=P=>{h(null),p(P.target.value)},$=P=>{const{tooltip:S,...F}=P;k(),h(F),p("")};n.useEffect(()=>{const P=S=>{r.current&&!r.current.contains(S.target)&&k()};return document.addEventListener("mousedown",P),document.addEventListener("touchstart",P),()=>{document.removeEventListener("mousedown",P),document.removeEventListener("touchstart",P)}},[]);const k=()=>{u(!1),l.current.value="",d([])},E=()=>e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Move to album"})," "]}),M=P=>{const S=P.target.value;if(S===""||S.trim().length===0){d([]);return}console.log(`${N}/read-write/search/${S}/${["albums"]}`),fetch(`${N}/read-write/search/${S}/${["albums"]}`,{method:"GET",credentials:"include"}).then(F=>F.json()).then(F=>{d([...F.albums].map(I=>{const T=I.path,{trackPath:U,...K}=I;return{icon:()=>T?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/covers/${T}`,alt:I.name}):e.jsx(se,{className:"action-bar-entry-logo"}),tooltip:E,...K}}))})};return e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:null,children:[e.jsx("h2",{children:"Move track to another album"}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:v,children:[e.jsx("label",{htmlFor:"newAlbum",style:c?{}:{opacity:"0.5"},children:"New album name"}),e.jsx("input",{type:"text",style:c?{}:{opacity:"0.5"},id:"newAlbum",placeholder:"Enter album name",onChange:b}),e.jsx("label",{htmlFor:"existingAlbum",style:c?{opacity:"0.5"}:{},children:"Existing album"}),e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:r,style:c?{opacity:"0.5"}:{},children:e.jsxs("div",{className:"action-bar-research",style:{transform:"translateX(15px)"},id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(hr,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:M,placeholder:"Search the album you want to move the track to.",ref:l,onFocus:()=>{u(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Ie,{height:300,itemCount:a.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:P,style:S})=>e.jsx(ut,{entry:a[P],style:{...S,width:" calc(100% - 20px)",marginTop:"10px"},onClick:$},P)})})]})}),m?e.jsxs("div",{style:{height:"90px",alignItems:"center",display:"flex",gap:"10px"},children:[m!=null&&m.icon?m.icon():null,m.name]}):null,e.jsx("input",{type:"submit",value:"Submit"})]})]})})},Qs=()=>e.jsxs("div",{className:"three-points-loader",children:[e.jsx("div",{className:"point point1"}),e.jsx("div",{className:"point point2"}),e.jsx("div",{className:"point point3"})]}),ae=({onClick:t,text:s,icon:o,style:u,id:l=""})=>{const[r,a]=n.useState(!1),d=()=>{a(!0),t().then(()=>{a(!1)})},m=()=>r?e.jsx(Qs,{}):e.jsxs(e.Fragment,{children:[o,s]});return e.jsx("button",{className:"button-with-callback",id:l,style:{...u},onClick:d,children:e.jsx(m,{})})},Ta=({applyCanges:t,albumClass:s})=>{var S,F;const[o,u]=n.useState({visible:!1}),[l,r]=n.useState(null),[a,d]=n.useState("2000-00-00"),[m,h]=n.useState(null),[c,p]=n.useState(!1),{deleteAlbum:f}=oe(),{notifTypes:x,addNotification:v}=Fe();if(!s)return null;n.useEffect(()=>{s&&(r(s.coverURL),d(s.year))},[s]);const b=()=>{const I=document.getElementById("editAlbumInfos"),T=I.artistName.value.split(",").map(G=>G.trim()),U=I.genre.value.split(",").map(G=>G.trim()).map(G=>G.charAt(0).toUpperCase()+G.slice(1)).filter(G=>G!="");if(!(I.albumName.value!==s.name||s.artist.toString()!==T.toString()||s.year!==I.releaseDate.value||s.genre.toString()!==U.toString()||s.description!==I.description.value||m||c)){t(null);return}s.name=I.albumName.value,s.artist=T,s.year=I.releaseDate.value,s.genre=U,s.description=I.description.value;const{tracks:B,coverURL:w,...V}=s;console.log(V),t(V,m)},$=I=>{const T=I.target.files[0];T&&(s.ext=T.name.split(".").pop(),r(URL.createObjectURL(T)),h(T))},k=I=>{u({visible:!o.visible,...I})},E=I=>{console.log(I),!c&&I&&p(!0),u({visible:!1})},M=async()=>{v("Comming soon :)",x.INFO)},P=async()=>{f(!1,{name:s.name,id:s.id})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(se,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:$})]}),e.jsx("button",{className:"roundButton",onClick:()=>b(),children:"Apply"}),e.jsx(ae,{onClick:M,text:"Delete for me",icon:e.jsx(it,{}),style:{marginTop:"auto"}}),e.jsx(ae,{onClick:P,text:"Remove from library",icon:e.jsx(it,{})})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(S=s.artist)==null?void 0:S.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",value:a,onChange:I=>{d(I.target.value)}})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(F=s.genre)==null?void 0:F.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Ie,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:I,style:T})=>e.jsxs("div",{style:T,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[I].title}),e.jsx(Ls,{className:"trackIcon",onClick:()=>{k(s.tracks[I])}})]},I)})})]}),o.visible&&e.jsx(Sa,{onClose:E,track:{id:o.id,title:o.title}})]})})},Ts=({closeOverlay:t,applyCanges:s,editPlaylistClass:o})=>{const[u,l]=n.useState(null),[r,a]=n.useState(null),[d,m]=n.useState(o||{id:yt()}),[h,c]=n.useState([]),[p,f]=n.useState([]);n.useEffect(()=>{d&&l(d.coverURL),d.collaborators&&f(d.collaborators)},[d]);const x=()=>{const k=document.getElementById("editAlbumInfos");if(!(k.playlistName.value!==d.name||d.description!==k.description.value||r||d.collaborators.map(F=>!p.includes(F)).filter(F=>F))){s(null);return}d.name=k.playlistName.value,d.description=k.description.value,d.collaborators=p.map(F=>F.id);const{tracks:M,coverURL:P,...S}=d;console.log(S),s(S,r)},v=k=>{const E=k.target.files[0];E&&(d.ext=E.name.split(".").pop(),l(URL.createObjectURL(E)),a(E))};n.useEffect(()=>{fetch(`${N}/auth/collaborators`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{console.log(k),c(k)})},[]);const b=k=>{const E=k.target.value;p.includes(E)||E==="pickUsers"||(f(M=>[...M,h.find(P=>P.id==E)]),k.target.value="pickUsers")};n.useEffect(()=>{console.log(p)});const $=k=>{f(p.filter(E=>E.id!=k))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsx(je,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[u?e.jsx("img",{id:"coverPicture",src:u,style:{width:"100%"}}):e.jsx(se,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:v})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"playlistName",children:"Playlist name"}),e.jsx("input",{type:"text",id:"playlistName",placeholder:"Enter playlist name",defaultValue:d==null?void 0:d.name}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",style:{height:"80px",paddingTop:"10px",paddingBottom:"10px"},placeholder:"Enter description",defaultValue:d==null?void 0:d.description})]}),e.jsx("label",{htmlFor:"new-collab",children:"Add collaborators"}),e.jsxs("select",{onChange:b,children:[e.jsx("option",{value:"pickUsers",children:"Pick users"},"root"),h.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),e.jsx("label",{children:"Collaborators:"}),e.jsx("div",{children:p==null?void 0:p.map(k=>e.jsxs("div",{children:[e.jsx("span",{children:k==null?void 0:k.name}),e.jsx(fr,{className:"buttonRound",onClick:()=>{$(k.id)}})]},k==null?void 0:k.id))})]})]})})};function wa(){const{innerWidth:t,innerHeight:s}=window;return{width:t,height:s}}const Ea=({trackY:t,track:s,isFav:o})=>{const[u,l]=n.useState(wa()),{onClicTrackActionEntry:r,trackActionTypes:a}=oe(),[d,m]=n.useState(!1),h=n.useRef(null),[c,p]=n.useState(null),f=Je(),[x,v]=n.useState(()=>window.innerWidth<714);return n.useEffect(()=>{const b=$=>{h.current&&!h.current.contains($.target)&&r(a.NONE)};return document.addEventListener("mousedown",b),document.addEventListener("touchstart",b),m(f.pathname.includes("playlist")),()=>{document.removeEventListener("mousedown",b),document.removeEventListener("touchstart",b)}},[]),n.useEffect(()=>{const b=d?250:180;p(Math.min(t,u.height-b))},[d]),c&&e.jsxs("div",{className:"track-actions-div",ref:h,style:{height:"fit-content",top:c},children:[e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TOP_QUEUE,s)},children:[e.jsx("span",{children:"Front queue"})," ",e.jsx(pr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.END_QUEUE,s)},children:[e.jsx("span",{children:"Back queue"})," ",e.jsx(gr,{})]}),d&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.GOTO_ALBUM,s)},children:[e.jsx("span",{children:"View album"})," ",e.jsx(xr,{})]}),d&&!o&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_PLAYLIST,s)},children:[e.jsx("span",{children:"Delete from playlist"})," ",e.jsx(vr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TAGS,s)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(bt,{})]}),x&&s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_FAVORITES,s)},children:[e.jsx("span",{children:"Remove from favorite"})," ",e.jsx(Xt,{})]}):null,x&&!s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.ADD_TO_FAVORITES,s)},children:[e.jsx("span",{children:"Add to favorites"})," ",e.jsx($s,{})]}):null]})},gt={name:"Create a new tag",icon:()=>e.jsx(Os,{}),isAction:!0},Ra=({track:t,apply:s})=>{const o=n.useRef(null),[u,l]=n.useState(!1),[r,a]=n.useState([gt]),[d,m]=n.useState("#aabbcc"),[h,c]=n.useState(!1),p=n.useRef(null),f=n.useRef(null),[x,v]=n.useState([]),[b,$]=n.useState(null),[k,E]=n.useState(null),[M,P]=n.useState([]),S=n.useRef(),F=B=>{const w=B.target.value;if(E(w),w===""||w.trim().length===0){a([gt]);return}fetch(`${N}/read-write/search/${w}/tags`,{method:"GET",credentials:"include"}).then(V=>{if(V.ok)return V.json();throw new Error("Error fetching search results")}).then(V=>{var X;const G=(X=V.tags)==null?void 0:X.map(Y=>({...Y,icon:()=>e.jsx(bt,{color:Y.color}),isAction:!1})),H={name:`${gt.name}: ${w}`,icon:gt.icon,isAction:gt.isAction};G.splice(0,0,H),a(G)})},I=()=>{l(!1)},T=B=>{if(I(),B.isAction){$("new"),m(`${Ws(Math.random().toFixed(4)*360,100,70.8)}`);return}x.find(w=>w.id===B.id)||(P(w=>w.filter(V=>V!==B.id)),v(w=>[...w,B]))};n.useEffect(()=>{b==="new"&&(f.current.focus(),f.current.value=k||"",S.current.value="")},[b]),n.useEffect(()=>{const B=w=>{var V;if(p.current&&!p.current.contains(w.target)){if(((V=w.target.closest("svg"))==null?void 0:V.id)==="color-button")return;c(!1)}if(o.current&&!o.current.contains(w.target)){I();return}};return document.addEventListener("mousedown",B),document.addEventListener("touchstart",B),fetch(`${N}/read-write/trackTags/${t.id}`,{method:"GET"}).then(w=>w.json()).then(w=>{v(w)}),()=>{document.removeEventListener("mousedown",B),document.removeEventListener("touchstart",B)}},[]);const U=()=>{const B=f.current.value;B!==""&&b==="new"&&v(w=>[...w,{name:B,color:d,id:yt(),isNew:!0}]),$(null)},K=(B,w)=>{const V=x.filter(G=>!(G.isNew===B&&G.id===w));v(V),B||P(G=>[...G,w])};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",style:{height:"500px",flexDirection:"column"},children:[e.jsx(je,{className:"buttonRound closeOverlay",onClick:()=>{s(null)}}),e.jsxs("h3",{children:["Editing tags for track ",t.title]}),e.jsx("div",{className:"action-bar",style:{margin:"10px auto"},ref:o,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Me,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:F,placeholder:"Search some tags..",ref:S,onFocus:()=>{l(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${u?"block":"none"}`},children:e.jsx(Ie,{height:300,itemCount:r.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:B,style:w})=>e.jsx(ut,{entry:r[B],style:{...w,width:" calc(100% - 20px)",marginTop:"10px"},onClick:T},B)})})]})}),b?e.jsxs("div",{className:"edit-tag",children:[e.jsx(Os,{style:{paddingRight:"30px"}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:f}),e.jsx(Ms,{id:"color-button",color:d,onClick:()=>{c(!h)}}),h&&e.jsxs("div",{ref:p,className:"edit-tag-picker",children:[" ",e.jsx(rs,{color:d,onChange:m})]}),e.jsx(ct,{onClick:U})]}):null,e.jsx("div",{className:"track-tags-div",children:x.map((B,w)=>e.jsxs("div",{className:"small-tag",style:{backgroundColor:B.color},children:[e.jsx("span",{children:B.name})," ",e.jsx(je,{onClick:()=>{K(B.isNew,B.id)}})]},`${B.isNew}-${B.id}`))}),e.jsx("button",{style:{marginTop:"auto"},onClick:()=>{s({current:x,deleted:M},t.id)},children:"Apply"})]})})},Ca=()=>{const{closeTagWindow:t}=oe(),[s,o]=n.useState(0),[u,l]=n.useState([]),[r,a]=n.useState([]),[d,m]=n.useState(!1),[h,c]=n.useState("#aabbcc"),[p,f]=n.useState(null),x=n.useRef(null),v=n.useRef(null),{addNotification:b,notifTypes:$}=Fe(),[k,E]=n.useState(null);n.useEffect(()=>{M(),P()},[]);const M=()=>{fetch(`${N}/read-write/getAllUserTags`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{l(T)})},P=()=>{fetch(`${N}/read-write/getAllUserSalads`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{a(T)})},S=T=>{f(T),c(T.color)},F=()=>{const T={id:p.id,name:x.current.value,color:h},U=new FormData;U.append(s===0?"tag":"salad",JSON.stringify(T)),fetch(`${N}/read-write/${s===0?"applyTagModifications":"applySaladModifications"}`,{method:"POST",credentials:"include",body:U}).then(K=>K.json()).then(K=>{s===0?M():P(),b("Tag updated.",$.SUCCESS)}),f(null)},I=()=>{fetch(`${N}/read-write/delete/${k.type}/${k.id}`,{method:"DELETE",credentials:"include"}).then(T=>T.json()).then(T=>{s===0?M():P(),f(null),E(null),b("Tag deleted.",$.SUCCESS)})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"tag-edtior-container",children:[e.jsx(je,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"cooking-selection",style:{marginTop:"40px"},children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(ae,{text:"Edit tags",icon:e.jsx(jr,{}),onClick:async()=>{o(0)}}),e.jsx(ae,{text:"Edit salads",icon:e.jsx(ot,{}),onClick:async()=>{o(1)}})]}),e.jsxs("div",{className:"edit-tags-content",children:[e.jsx(Ie,{className:"albumTrackList",height:250,itemCount:s===0?u.length:r.length,itemSize:35,width:"100%",children:({index:T,style:U})=>e.jsxs("div",{style:U,className:"album-wrapping-track",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:s===0?u[T].color:r[T].color}}),e.jsx("span",{children:s===0?u[T].name:r[T].name}),e.jsx(Us,{className:"trackIcon",onClick:()=>{S(s===0?{...u[T],type:"tag"}:{...r[T],type:"salad"})}})]},T)}),p?e.jsxs("div",{className:"edit-tag",style:{left:"-20px",margin:"auto"},children:[e.jsx(je,{style:{cursor:"pointer"},onClick:()=>{f(null)}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:x,defaultValue:p.name}),e.jsx(Ms,{style:{cursor:"pointer"},id:"color-button",color:h,onClick:()=>{m(!d)}}),d&&e.jsxs("div",{ref:v,className:"edit-tag-picker",children:[" ",e.jsx(rs,{color:h,onChange:c})]}),e.jsx(ct,{onClick:F,style:{cursor:"pointer"}}),e.jsx(it,{style:{cursor:"pointer"},onClick:()=>{E(p)}})]}):null,k?e.jsxs("div",{className:"deletion-confirmation",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:k.color,width:"50px"}}),e.jsxs("p",{children:["Confirm deletion of the ",k.type," ",k.name,"?"]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{E(null)},children:e.jsx(br,{})}),e.jsx("button",{onClick:()=>{I()},children:e.jsx(ct,{})})]})]}):null]})]})]})})},Aa=({applyChanges:t,artist:s})=>{const[o,u]=n.useState(null),[l,r]=n.useState("2000-00-00"),[a,d]=n.useState(null);if(!s)return null;n.useEffect(()=>{s&&(u(s.picture),r(s.active_from))},[s]);const m=()=>{const c=document.getElementById("editArtistInfos"),p=s.active_from??"",f=c.activeFrom.value??"",x=s.name??"",v=c.artistName.value??"",b=s.bio??"",$=c.bio.value??"";if(!(x!=v||p!=f||b!=$||a)){t(null);return}s.name=c.artistName.value,s.active_from=c.activeFrom.value,s.bio=c.bio.value;const{picture:E,...M}=s;console.log(M,a),t(M,a)},h=c=>{const p=c.target.files[0];p&&(s.ext=p.name.split(".").pop(),u(URL.createObjectURL(p)),d(p))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(se,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:h})]}),e.jsx("button",{className:"roundButton",onClick:m,children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editArtistInfos",children:[e.jsx("label",{htmlFor:"artistName",children:"Artist name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("div",{className:"albumType",children:e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"activeFrom",children:"Active since"}),e.jsx("input",{type:"date",id:"activeFrom",value:l,onChange:c=>{r(c.target.value)}})]})}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",placeholder:"Enter biography",defaultValue:s.bio})]})]})]})})};var Pt=function(t,s){return t<s?-1:t>s?1:0},ws=function(t){return t.reduce(function(s,o){return s+o},0)},Ia=function(){function t(o){this.colors=o}var s=t.prototype;return s.palette=function(){return this.colors},s.map=function(o){return o},t}(),Fa=function(){function t(r,a,d){return(r<<10)+(a<<5)+d}function s(r){var a=[],d=!1;function m(){a.sort(r),d=!0}return{push:function(h){a.push(h),d=!1},peek:function(h){return d||m(),h===void 0&&(h=a.length-1),a[h]},pop:function(){return d||m(),a.pop()},size:function(){return a.length},map:function(h){return a.map(h)},debug:function(){return d||m(),a}}}function o(r,a,d,m,h,c,p){var f=this;f.r1=r,f.r2=a,f.g1=d,f.g2=m,f.b1=h,f.b2=c,f.histo=p}function u(){this.vboxes=new s(function(r,a){return Pt(r.vbox.count()*r.vbox.volume(),a.vbox.count()*a.vbox.volume())})}function l(r,a){if(a.count()){var d=a.r2-a.r1+1,m=a.g2-a.g1+1,h=Math.max.apply(null,[d,m,a.b2-a.b1+1]);if(a.count()==1)return[a.copy()];var c,p,f,x,v=0,b=[],$=[];if(h==d)for(c=a.r1;c<=a.r2;c++){for(x=0,p=a.g1;p<=a.g2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[t(c,p,f)]||0;b[c]=v+=x}else if(h==m)for(c=a.g1;c<=a.g2;c++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[t(p,c,f)]||0;b[c]=v+=x}else for(c=a.b1;c<=a.b2;c++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.g1;f<=a.g2;f++)x+=r[t(p,f,c)]||0;b[c]=v+=x}return b.forEach(function(k,E){$[E]=v-k}),function(k){var E,M,P,S,F,I=k+"1",T=k+"2",U=0;for(c=a[I];c<=a[T];c++)if(b[c]>v/2){for(P=a.copy(),S=a.copy(),F=(E=c-a[I])<=(M=a[T]-c)?Math.min(a[T]-1,~~(c+M/2)):Math.max(a[I],~~(c-1-E/2));!b[F];)F++;for(U=$[F];!U&&b[F-1];)U=$[--F];return P[T]=F,S[I]=P[T]+1,[P,S]}}(h==d?"r":h==m?"g":"b")}}return o.prototype={volume:function(r){var a=this;return a._volume&&!r||(a._volume=(a.r2-a.r1+1)*(a.g2-a.g1+1)*(a.b2-a.b1+1)),a._volume},count:function(r){var a=this,d=a.histo;if(!a._count_set||r){var m,h,c,p=0;for(m=a.r1;m<=a.r2;m++)for(h=a.g1;h<=a.g2;h++)for(c=a.b1;c<=a.b2;c++)p+=d[t(m,h,c)]||0;a._count=p,a._count_set=!0}return a._count},copy:function(){var r=this;return new o(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(r){var a=this,d=a.histo;if(!a._avg||r){var m,h,c,p,f=0,x=0,v=0,b=0;if(a.r1===a.r2&&a.g1===a.g2&&a.b1===a.b2)a._avg=[a.r1<<3,a.g1<<3,a.b1<<3];else{for(h=a.r1;h<=a.r2;h++)for(c=a.g1;c<=a.g2;c++)for(p=a.b1;p<=a.b2;p++)f+=m=d[t(h,c,p)]||0,x+=m*(h+.5)*8,v+=m*(c+.5)*8,b+=m*(p+.5)*8;a._avg=f?[~~(x/f),~~(v/f),~~(b/f)]:[~~(8*(a.r1+a.r2+1)/2),~~(8*(a.g1+a.g2+1)/2),~~(8*(a.b1+a.b2+1)/2)]}}return a._avg},contains:function(r){var a=this,d=r[0]>>3;return gval=r[1]>>3,bval=r[2]>>3,d>=a.r1&&d<=a.r2&&gval>=a.g1&&gval<=a.g2&&bval>=a.b1&&bval<=a.b2}},u.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var a=this.vboxes,d=0;d<a.size();d++)if(a.peek(d).vbox.contains(r))return a.peek(d).color;return this.nearest(r)},nearest:function(r){for(var a,d,m,h=this.vboxes,c=0;c<h.size();c++)((d=Math.sqrt(Math.pow(r[0]-h.peek(c).color[0],2)+Math.pow(r[1]-h.peek(c).color[1],2)+Math.pow(r[2]-h.peek(c).color[2],2)))<a||a===void 0)&&(a=d,m=h.peek(c).color);return m},forcebw:function(){var r=this.vboxes;r.sort(function(h,c){return Pt(ws(h.color),ws(c.color))});var a=r[0].color;a[0]<5&&a[1]<5&&a[2]<5&&(r[0].color=[0,0,0]);var d=r.length-1,m=r[d].color;m[0]>251&&m[1]>251&&m[2]>251&&(r[d].color=[255,255,255])}},{quantize:function(r,a){if(!Number.isInteger(a)||a<1||a>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!r.length||a<2||a>256||!r.length||a<2||a>256)return!1;for(var d=[],m=new Set,h=0;h<r.length;h++){var c=r[h],p=c.join(",");m.has(p)||(m.add(p),d.push(c))}if(d.length<=a)return new Ia(d);var f=function(E){var M,P=new Array(32768);return E.forEach(function(S){M=t(S[0]>>3,S[1]>>3,S[2]>>3),P[M]=(P[M]||0)+1}),P}(r);f.forEach(function(){});var x=function(E,M){var P,S,F,I=1e6,T=0,U=1e6,K=0,B=1e6,w=0;return E.forEach(function(V){(P=V[0]>>3)<I?I=P:P>T&&(T=P),(S=V[1]>>3)<U?U=S:S>K&&(K=S),(F=V[2]>>3)<B?B=F:F>w&&(w=F)}),new o(I,T,U,K,B,w,M)}(r,f),v=new s(function(E,M){return Pt(E.count(),M.count())});function b(E,M){for(var P,S=E.size(),F=0;F<1e3;){if(S>=M||F++>1e3)return;if((P=E.pop()).count()){var I=l(f,P),T=I[0],U=I[1];if(!T)return;E.push(T),U&&(E.push(U),S++)}else E.push(P),F++}}v.push(x),b(v,.75*a);for(var $=new s(function(E,M){return Pt(E.count()*E.volume(),M.count()*M.volume())});v.size();)$.push(v.pop());b($,a);for(var k=new u;$.size();)k.push($.pop());return k}}}().quantize,Js=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};Js.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var at=function(){};at.prototype.getColor=function(t,s){return s===void 0&&(s=10),this.getPalette(t,5,s)[0]},at.prototype.getPalette=function(t,s,o){var u=function(d){var m=d.colorCount,h=d.quality;if(m!==void 0&&Number.isInteger(m)){if(m===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");m=Math.max(m,2),m=Math.min(m,20)}else m=10;return(h===void 0||!Number.isInteger(h)||h<1)&&(h=10),{colorCount:m,quality:h}}({colorCount:s,quality:o}),l=new Js(t),r=function(d,m,h){for(var c,p,f,x,v,b=d,$=[],k=0;k<m;k+=h)p=b[0+(c=4*k)],f=b[c+1],x=b[c+2],((v=b[c+3])===void 0||v>=125)&&(p>250&&f>250&&x>250||$.push([p,f,x]));return $}(l.getImageData().data,l.width*l.height,u.quality),a=Fa(r,u.colorCount);return a?a.palette():null},at.prototype.getColorFromUrl=function(t,s,o){var u=this,l=document.createElement("img");l.addEventListener("load",function(){var r=u.getPalette(l,5,o);s(r[0],t)}),l.src=t},at.prototype.getImageData=function(t,s){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){if(this.status==200){var u=new Uint8Array(this.response);i=u.length;for(var l=new Array(i),r=0;r<u.length;r++)l[r]=String.fromCharCode(u[r]);var a=l.join(""),d=window.btoa(a);s("data:image/png;base64,"+d)}},o.send()},at.prototype.getColorAsync=function(t,s,o){var u=this;this.getImageData(t,function(l){var r=document.createElement("img");r.addEventListener("load",function(){var a=u.getPalette(r,5,o);s(a[0],this)}),r.src=l})};const jt=({iconHovered:t,iconDefault:s,onClick:o=null,className:u="",id:l=""})=>{const[r,a]=n.useState(!1);return e.jsx("div",{style:o?{background:"rgba(0,0,0,0)"}:{},className:u,id:l,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:o,children:r?e.jsx(t,{}):e.jsx(s,{})})},Ot=({context:t})=>{const{isPlaying:s,toggleTrackPaused:o,playNextSong:u,playPreviousSong:l}=oe(),r=m=>{m.stopPropagation(),o()},a=m=>{m.stopPropagation(),u()},d=m=>{m.stopPropagation(),l()};return e.jsxs("div",{className:"audio-controls","data-mobile-context":t.mobile,children:[!t.mobile||t.maximize?e.jsx(jt,{iconHovered:Nr,iconDefault:yr,onClick:d}):null,e.jsx(jt,{iconHovered:s?Sr:Tr,iconDefault:s?kr:es,onClick:r}),e.jsx(jt,{iconHovered:Er,iconDefault:wr,onClick:a})]})},Ys=n.memo(({index:t,style:s,data:o})=>{const{playQueue:u,cacheRef:l,jumpToQueueTrack:r,queuePointer:a}=o,d=u[t],[m,h]=n.useState(!!l.current[d]);let c=l.current[d];c||(c={title:"Loading...",cover:"loading"}),n.useEffect(()=>{m||(l.current[d]=c,fetch(`${N}/read-write/shortTrackInfos/${d}`,{credentials:"include"}).then(f=>f.json()).then(f=>{l.current[d]=f,h(!0)}))},[m,d]);const p={...s,width:"calc(100% - 15px)",height:"47.5px"};return e.jsxs("div",{className:"music-queue-entry",style:p,"is-passed":`${t<a}`,"is-selected":`${t===a}`,onClick:()=>r(t),children:[c.cover?e.jsx("img",{src:`${N}/covers/${c.cover}`,className:"track-image-small"}):e.jsx(se,{className:"track-image-small"}),e.jsx("p",{className:"track-title",children:c.title})]})},(t,s)=>t.data.playQueue[t.data.queuePointer]===s.data.playQueue[s.data.queuePointer]),Pa=50,La=0,Es=n.memo(({title:t,radio:s,artist:o,artistId:u,isMinimal:l,fn:r})=>{console.log("radio",s);const a=me(),[d,m]=n.useState(!0);return n.useEffect(()=>{m(!0);const h=setTimeout(()=>m(!1),500);return()=>clearTimeout(h)},[t]),e.jsxs("div",{className:"mobile-view-track-artist",style:{"--item-align":l?"left":"center"},children:[e.jsx("span",{id:"songTitle","data-from-minimal":l,"data-new":d,children:t}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{s||(r&&r(),a(`/artists/${u}`))},children:o})]})},(t,s)=>t.title===s.title&&t.artist===s.artist&&t.artistId===s.artistId&&t.radio===s.radio),Rs=5,$a=()=>{var q;const{currentTrackData:t,trackCoverUrl:s,setTrackMobileView:o,toggleTrackFavorite:u,playQueue:l,jumpToQueueTrack:r,queuePointer:a,playLibraryShuffle:d,isPlaying:m,getFFTAtCurrentTime:h,fftConfigRef:c,songRawPalette:p,recomputeColors:f,requestNewFullScreenImage:x}=oe(),{addNotification:v}=Fe(),b=n.useRef(new Map),$=n.useRef(null),[k,E]=n.useState(!1),[M,P]=n.useState((t==null?void 0:t.isFav)||!1),S=n.useRef(null),F=n.useRef(0),I=n.useRef(0),T=n.useRef(null),U=n.useRef(null),K=n.useRef(0),B=n.useRef(null),w=n.useRef(null),V=n.useRef(null),G=n.useRef(!1),H=n.useRef(null);n.useEffect(()=>{t&&P(t.isFav)},[t]),n.useEffect(()=>{s&&(console.log("request"),x().then(L=>{console.log("received",L),H.current.src=URL.createObjectURL(L.blob),H.current.addEventListener("load",ve)}))},[s]);const X=async()=>{t&&u(t.id,!M,P)},Y=L=>{if(L-K.current<1e3/30||!(B.current&&w.current&&V.current)){U.current=requestAnimationFrame(Y);return}K.current=L;const ee=h();let fe=ee.subarray(Math.floor(ee.length*.3),Math.floor(ee.length*.6));const re=Math.max(1,fe.length/Rs),C=new Array(Rs).fill(0);for(let y=0;y<fe.length;y++)C[Math.floor(y/re)]+=Number(ee[y])/100;for(let y=0;y<C.length;y++)C[y]=Math.min(100,Math.max(C[y],0));const W=3;B.current.style.setProperty("--strength-1",`${C[1]/W}%`),B.current.style.setProperty("--strength-2",`${C[2]/W}%`),w.current.style.setProperty("--strength-1",`${C[3]/W}%`),w.current.style.setProperty("--strength-2",`${C[4]/W}%`),V.current.style.setProperty("--strength-1",`${C[0]/W}%`),U.current=requestAnimationFrame(Y)},ne=()=>{S.current.setAttribute("data-shift-back","true"),S.current.style.translate=`0px ${window.screen.height*.8}px`,S.current.setAttribute("data-fade-out","true"),console.log("clearing from close"),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{o(!1),S.current.setAttribute("data-fade-out","true"),S.current.setAttribute("data-shift-back","false"),T.current=null},200)},ie=L=>{F.current=L.touches[0].clientY,I.current=0,T.current&&(console.log("clearing from touch start"),clearTimeout(T.current),T.current=null),S.current.setAttribute("data-shift-back","false")},pe=L=>{F.current&&S.current&&(L.preventDefault(),!(I.current<-40)&&(I.current=L.touches[0].clientY-F.current,S.current.style.translate=`0px ${I.current}px`))},ue=L=>{(I.current||0)<90?(S.current.setAttribute("data-shift-back","true"),S.current.style.translate="0px 0px",console.log("clearing from touch end"),T.current=setTimeout(()=>{S.current.setAttribute("data-shift-back","false"),T.current=null},300)):ne()},ge=L=>{L.stopPropagation(),L.preventDefault()};n.useEffect(()=>{if(!c.current){cancelAnimationFrame(U.current),console.log("No FFT data to display, releasing anim frame.");return}U.current=requestAnimationFrame(Y),console.log("FFT found, requested animation frame.")},[c.current]),n.useEffect(()=>{var L;console.log("New paellette",p.current),((L=p.current)==null?void 0:L.length)>0&&(B.current.style.setProperty("--c-1",`rgb(${p.current[1].join(",")})`),B.current.style.setProperty("--c-2",`rgb(${p.current[2].join(",")})`),w.current.style.setProperty("--c-1",`rgb(${p.current[3].join(",")})`),w.current.style.setProperty("--c-2",`rgb(${p.current[4].join(",")})`),V.current.style.setProperty("--c-1",`rgb(${p.current[0].join(",")})`))},[p.current]),n.useEffect(()=>{var fe,re;const L=window.matchMedia("(min-width: 714px)"),ee=C=>{G.current=C.matches,U.current=requestAnimationFrame(Y),console.log("Canvas hidden?",G.current)};return ee(L),(fe=H.current)!=null&&fe.complete&&((re=H.current)!=null&&re.src)&&f(H),L.addEventListener("change",ee),()=>{L.removeEventListener("change",ee)}},[]);const ve=()=>{console.log("recomputing"),f(H,()=>{}),H.current.removeEventListener("load",ve)};return e.jsx("div",{id:"track-mobile-view",ref:S,onTouchStart:ie,onTouchMove:pe,onTouchEnd:ue,children:e.jsxs("div",{id:"track-mobile-view-content","data-minimize":k,children:[e.jsx("div",{className:"grad",id:"grad1",ref:B}),e.jsx("div",{className:"grad",id:"grad2",ref:w}),e.jsx("div",{className:"grad",id:"grad3",ref:V}),e.jsxs("div",{id:"floating-audio-state","data-minimize":k,children:[e.jsx("div",{id:"track-mobile-down",onTouchEnd:ne,children:e.jsx("div",{})}),(t==null?void 0:t.type)=="radio"?t.coverUrl==""?e.jsx(se,{className:"trackImage","data-playing":m}):e.jsx("img",{ref:H,crossOrigin:"anonymous","data-playing":m,className:"trackImage"}):s.split("/").pop()==="null"?e.jsx(se,{className:"trackImage","data-playing":m}):e.jsx("img",{ref:H,className:"trackImage",crossOrigin:"anonymous","data-playing":m}),t?e.jsx(Es,{title:t.title,artist:t.artist,artistId:t.artistId,radio:t.type==="radio",isMinimal:!0,fn:ne}):null]}),k?l.length>0?e.jsx("div",{id:"music-queue",ref:$,onTouchMove:ge,children:e.jsx(Ie,{height:((q=$.current)==null?void 0:q.offsetHeight)||La,itemCount:l.length,itemSize:Pa,width:"100%",itemData:{playQueue:l,cacheRef:b,jumpToQueueTrack:r,queuePointer:a},children:Ys})}):e.jsx("p",{id:"no-items-in-queue",children:"No items in the queue"}):null,e.jsxs("div",{id:"fixed-audio-state",children:[t?e.jsx(Es,{title:t.title,artist:t.artist,artistId:t.artistId,radio:t.type==="radio",isMinimal:!1,fn:ne}):null,e.jsx(Zs,{}),e.jsx(Ot,{context:{mobile:!0,maximize:!0}}),e.jsxs("div",{className:"track-list-header",children:[l.length>0?e.jsx(ae,{text:"",icon:M?e.jsx(_s,{}):e.jsx(_t,{}),onClick:X}):e.jsx(ae,{text:"",icon:e.jsx(Rr,{}),onClick:d}),e.jsx(ae,{text:"",icon:e.jsx(Bs,{}),onClick:async()=>{E(!k)}})]})]})]})})},Xs=n.createContext(void 0),Oe={TOP_QUEUE:"top_queue",END_QUEUE:"end_queue",TAGS:"tags",GOTO_ALBUM:"goto_album",REMOVE_FROM_PLAYLIST:"remove_from_playlist",ADD_TO_FAVORITES:"add_to_favs",REMOVE_FROM_FAVORITES:"remove_from_favs",NONE:"none"},Oa=()=>{const t=Je(),s=n.useRef({pointer:0,history:new Array(6).fill(null)});return n.useEffect(()=>{const{pointer:o,history:u}=s.current,l=(o-1+u.length)%u.length;u[l]!==t.pathname&&(u[o]=t.pathname,s.current.pointer=(o+1)%u.length)},[t]),s.current},Ma=({children:t})=>{const[s,o]=n.useState(""),[u,l]=n.useState(!1),[r,a]=n.useState({}),[d,m]=n.useState(0),h=n.useRef(null),c=n.useRef(null),p=n.useRef(null),[f,x]=n.useState([]),[v,b]=n.useState("null"),$=g=>`${g}`!="null"?`${N}/read-write/music/${g}`:null,[k,E]=n.useState(-1),M=n.useRef(f),P=n.useRef(k),[S,F]=n.useState(null),[I,T]=n.useState(null),{emit:U,subscribe:K}=xe(),B=n.useRef(null),[w,V]=n.useState(null),G=n.useRef(null),{addNotification:H,notifTypes:X}=Fe(),Y=me(),[ne,ie]=n.useState(null),[pe,ue]=n.useState(null),[ge,ve]=n.useState(null),q=n.useRef("A"),L=n.useRef(null),[ee,fe]=n.useState(5),[re,C]=n.useState(!1),[W,y]=n.useState(()=>{const g=parseFloat(localStorage.getItem("volume"));return isNaN(g)?1:Math.min(1,Math.max(0,g))}),[O,_]=n.useState(!1),[D,te]=n.useState(!1),de=n.useRef(null),be=n.useRef(null),z=n.useRef(null),ye=n.useRef(null),Xe=n.useRef(0),Ve=n.useRef(null),he=n.useRef(null),Tt=n.useRef(0),mt=n.useRef(null),wt=n.useRef(0),Gt=n.useRef(0),He=5,Et=n.useRef(""),us=n.useRef(null),ds=n.useRef(0),ht=n.useRef({lastAudioTime:0,lastPerformanceNow:0}),Ze=n.useRef(null),on=.1,ft=n.useRef(!1),Dt=Je(),et=n.useRef(""),cn=n.useRef([]),pt=n.useRef({track:"",pairs:[]}),ms=n.useRef(null),Vt=Oa(),[Rt,hs]=n.useState(!1),Ht=n.useRef(null),qt=n.useRef(null),fs=n.useRef([]),ln=()=>{var g,j,R,A,Q,Z,ce,Ne;c.current=new Audio,c.current.setAttribute("source","A"),c.current.addEventListener("error",ke=>{if(c.current.src.includes("spoof"))return;const Se=c.current.error;if(Se&&(console.warn("Audio error occurred: code",Se.code),Se.code===4&&s)){const qe=`${N}/radio/spoof/${encodeURIComponent(c.current.src)}`;c.current.src=qe,H("Audio stream not reachable from browser. Streaming from backend..",X.INFO),l(!0),c.current.play();const ze=new EventSource(`${N}/radio/trackStream/${encodeURIComponent(c.current.src)}`);ze.onmessage=Ee=>{console.log(Ee);const Re=JSON.parse(Ee.data);console.log("Now playing:",Re.metadata.StreamTitle);const $e=Re.metadata.adw_ad=="true"?`Advertisment - ${(Number(Re.metadata.durationMilliseconds)/1e3).toFixed(1)}s`:Re.metadata.StreamTitle;a(We=>({...We,title:$e}))},ze.addEventListener("error",Ee=>{console.warn("Metadata stream error",Ee)})}}),c.current.addEventListener("canplay",()=>{console.log("Stream is playable!")}),p.current=new Audio,p.current.setAttribute("source","B");for(const ke of[c,p])ke.current.crossOrigin="anonymous",ke.current.playsInline=!0,ke.current.setAttribute("webkit-playsinline",""),ke.current.volume=parseFloat(localStorage.getItem("volume"))*.75||.5;(g=c.current)==null||g.addEventListener("timeupdate",At),(j=p.current)==null||j.addEventListener("timeupdate",At),(R=c.current)==null||R.addEventListener("playing",Ct),(A=p.current)==null||A.addEventListener("playing",Ct),(Q=c.current)==null||Q.addEventListener("play",tt),(Z=c.current)==null||Z.addEventListener("pause",gs),(ce=p.current)==null||ce.addEventListener("play",tt),(Ne=p.current)==null||Ne.addEventListener("pause",gs),zt(),console.log("Audio graph setted up")},un=()=>{var g,j,R,A,Q,Z,ce,Ne,ke,Se,qe,ze,Ee,Re,$e,We;console.log("Audio graph destructed"),(g=c.current)==null||g.pause(),c.current=null,(j=p.current)==null||j.pause(),p.current=null,(R=c.current)==null||R.removeEventListener("timeupdate",Pe),(A=c.current)==null||A.removeEventListener("ended",Le),(Q=c.current)==null||Q.removeEventListener("error"),(Z=c.current)==null||Z.removeEventListener("canplay"),(ce=p.current)==null||ce.removeEventListener("timeupdate",Pe),(Ne=p.current)==null||Ne.removeEventListener("ended",Le),(ke=c.current)==null||ke.removeEventListener("timeupdate",At),(Se=p.current)==null||Se.removeEventListener("timeupdate",At),(qe=c.current)==null||qe.removeEventListener("playing",Ct),(ze=p.current)==null||ze.removeEventListener("playing",Ct),(Ee=c.current)==null||Ee.removeEventListener("play",tt),(Re=c.current)==null||Re.removeEventListener("pause",tt),($e=p.current)==null||$e.removeEventListener("play",tt),(We=p.current)==null||We.removeEventListener("pause",tt)},zt=()=>{var g,j;(g=c.current)==null||g.pause(),c.current.src=null,c.current.currentTime=0,(j=p.current)==null||j.pause(),p.current.src=null,p.current.currentTime=0,h.current=null,q.current="A",c.current.removeEventListener("timeupdate",Pe),c.current.removeEventListener("ended",Le),p.current.removeEventListener("timeupdate",Pe),p.current.removeEventListener("ended",Le)},Ct=()=>{he.current&&(console.log("Record start playing",h.current.currentTime),ht.current.lastAudioTime=h.current.currentTime,ht.current.lastPerformanceNow=performance.now())},ps=()=>{const g=h.current;!g||g.paused||Math.abs(g.currentTime-bs())>on&&js()},dn=()=>(setTimeout(ps,200),setInterval(ps,5e3)),tt=()=>{he.current&&(js(),Ze.current&&clearInterval(Ze.current),Ze.current=dn())},gs=()=>{Ze.current&&(clearInterval(Ze.current),Ze.current=null)},At=()=>{if(!he.current||!h.current)return;const g=h.current.currentTime;if(Math.abs(g-ds.current)>1){const j=Math.round(1/he.current.interval),R=He*j,A=Math.floor(g*j);console.log("Seeking chunk",A,R,j,He),Tt.current=0,Gt.current=A,vs(Et.current,A,A+R)}else hn(Et.current,g);ds.current=g};n.useEffect(()=>{r&&r.type!=="radio"&&It()},[r]);const It=()=>{const g=f.length<=k+1;L.current&&clearTimeout(L.current),!(g||!h.current)&&(console.log("Transition rescheduled, timesout in ",r.rawDuration,h.current.currentTime,ee,r.rawDuration-h.current.currentTime-ee),L.current=setTimeout(()=>{q.current=q.current==="A"?"B":"A",xs(k+1)},Math.min(r.rawDuration-h.current.currentTime-ee)*1e3,0))},xs=async g=>{const j=f.length<=g;if(E(g),h.current=q.current==="A"?c.current:p.current,f[g].startsWith("radio-")){let A={};if(f[g].startsWith("radio-id")){const Z=f[g].split("radio-id:")[1];A=await fetch(`${N}/radio/${Z}`).then(ce=>ce.json()),console.log(A),Ve.current=null,a({type:"radio",artist:A.name,...A,duration:"0-",uuid:Z})}else{A.url=f[g].split("radio-url:")[1],console.log(Ve.current);const{name:Z,...ce}=Ve.current,Ne={artist:Z,...ce};a({type:"radio",...Ne,duration:"0-"})}h.current.src=A.url;const Q=new EventSource(`${N}/radio/trackStream/${encodeURIComponent(A.url)}`);Q.onmessage=Z=>{console.log(Z);const ce=JSON.parse(Z.data);console.log("Now playing:",ce.metadata.StreamTitle),a(Ne=>({...Ne,title:ce.metadata.StreamTitle}))},o(""),Q.addEventListener("error",Z=>{console.warn("Metadata stream error",Z)}),ys(),p.current.removeEventListener("timeupdate",Pe),p.current.removeEventListener("ended",Le),l(!0),h.current.play();return}Ve.current=null;const R=f[g];if(await fetch(`${N}/read-write/trackInfos/${R}`,{method:"GET"}).then(A=>A.json()).then(A=>{A.duration=as(A.rawDuration),a(A)}),h.current.currentTime=0,await fetch(`${N}/read-write/fftConfig/${R}`,{method:"GET",credentials:"include"}).then(async A=>{if(Tt.current=0,Gt.current=0,wt.current=0,!A.ok){he.current=null;return}const Q=await A.json();he.current=JSON.parse(Q),console.log(he.current);const Z=he.current.fftSize*1,ce=He/he.current.interval;mt.current=new Int16Array(ce*Z),console.log("New buffer!")}),h.current.src!==$(R))h.current.src=$(R);else{m(0);return}h.current.play(),clearTimeout(z.current),o(R),Et.current=R,l(!0),En(R),console.log("Fading in",h.current),q.current==="A"?(j?Ft(p,null):(Ft(p,c),c.current.addEventListener("timeupdate",Pe),c.current.addEventListener("ended",Le)),p.current.removeEventListener("timeupdate",Pe),p.current.removeEventListener("ended",Le)):q.current==="B"&&(j?Ft(c,null):(Ft(c,p),p.current.addEventListener("timeupdate",Pe),p.current.addEventListener("ended",Le)),c.current.removeEventListener("timeupdate",Pe),c.current.removeEventListener("ended",Le))},vs=async(g,j,R)=>{if(!he.current)return mt.current=null,null;const A=he.current.fftSize*1*2,Q=A*j,Z=A*R,ce=await fetch(`${N}/read-write/fft/${g}`,{headers:{Range:`bytes=${Q}-${Z-1}`}});if(!ce.ok&&ce.status!==206){console.error("Failed to stream FFT data");return}wt.current=Math.floor(R);const Ne=await ce.arrayBuffer(),ke=new Int16Array(Ne),Se=he.current.fftSize*1,qe=ke.length/Se,ze=he.current.interval,Ee=He/ze;let Re=Tt.current;for(let $e=0;$e<qe;$e++){const We=$e*Se,ir=(Re+$e)%Ee;mt.current.set(ke.subarray(We,We+Se),ir*Se)}Tt.current=(Re+qe)%Ee},js=()=>{ht.current.lastAudioTime=h.current.currentTime,ht.current.lastPerformanceNow=performance.now()},mn=()=>{const{lastAudioTime:g,lastPerformanceNow:j}=ht.current,R=(performance.now()-j)/1e3;return g+R},bs=()=>h.current.paused?h.current.currentTime:mn(),hn=(g,j)=>{const R=Math.round(1/he.current.interval),A=Math.floor(j*R),Q=Math.floor(wt.current)-A,Z=R*He;Z-Q<1||vs(g,Math.floor(wt.current),Z+A)},fn=()=>{const g=Math.round(1/he.current.interval),R=Math.floor(bs()*g)-Gt.current,A=He*g;return R%A},pn=()=>{if(!he.current||!mt.current)return null;const g=he.current.fftSize*1,j=fn();if(j===null)return null;const A=Math.floor(He/he.current.interval)*g,Q=j*g,Z=Q+g;return Z>A?null:mt.current.slice(Q,Z)},ys=()=>{z!=null&&z.current&&clearInterval(z.current)};n.useEffect(()=>{console.log("Changed inteval ref:",z.current)},[z.current]);const Ft=(g,j)=>{z.current&&clearInterval(z.current);const R=150;let A=0;console.log("Init fadeout for:",j.current),z.current=setInterval(()=>{const Q=Math.min(1,Math.max(0,A*R/(ee*1e3)));j.current.volume=Q*Xe.current,g.current&&(g.current.volume=(1-Q)*Xe.current),Q>=1&&(clearInterval(z.current),z.current=null,j.current&&(g.current.pause(),g.current.src=null)),A++},R)},Pe=()=>{var g;return m((g=h.current)==null?void 0:g.currentTime)},Le=()=>{f.length>0&&f.length<=k+1&&Wt()};n.useEffect(()=>{!re||k===-1||f.length===0||(zt(),console.log("init Autoplay",f,k,re,c.current,p.current),xs(k),C(!1))},[f,k,re]),n.useEffect(()=>{P.current=k},[k]),n.useEffect(()=>{M.current=f},[f]);const gn=()=>{var g,j;if(!h.current&&M.current.length>0){E(0),C(!0);return}if(u)(g=h.current)==null||g.pause(),l(!1),clearTimeout(L.current),clearInterval(z.current);else{if(l(!0),k===-1&&f.length!==0){E(0);return}(j=h.current)==null||j.play(),It()}},xn=(g,j=!1)=>{fetch(`${N}/read-write/nextSongs/${ne.type}/${ne.id}/${j}`,{method:"GET",credentials:"include"}).then(R=>R.json()).then(R=>{x(R),console.log(R),E(R.findIndex(A=>A===g)),C(!0)})},vn=g=>{x([g]),E(0),C(!0)},jn=()=>{if(h.current.currentTime>5||k===0){h.current.currentTime=0,It();return}E(k-1),C(!0)},bn=(g,j,R=!1)=>{C(!1),fetch(`${N}/read-write/nextSongs/${j}/${g}/${R}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(A),E(0),C(!0)})},yn=(g,j,R=!1)=>{C(!1),fetch(`${N}/read-write/nextSongs/${j}/${g}/${R}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(Q=>[...Q,...A]),H("Queued!",X.QUEUE)})},Nn=(g,j,R=!1)=>{console.log(`${N}/read-write/nextSongs/${j}/${g}/${R}`),fetch(`${N}/read-write/nextSongs/${j}/${g}/${R}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(vt.shuffle(A)),C(!0),E(0)})},kn=(g=!1)=>{const j=g?M.current:f,R=g?P.current:k;j.length<=R+1&&(Wt(),console.log("stop")),E(R+1),C(!0)},Wt=()=>{zt(),m(0),l(!1),a(null),C(!1),E(-1),b("null"),x([]),o(""),Et.current="",console.log("No more songs in the queue"),clearInterval(z.current),clearTimeout(L.current),ys()},Sn=g=>{if(g<0||g>100)return;const j=g/100*h.current.duration;h.current.currentTime=j,m(j),It()},Tn=g=>{h.current.currentTime+g>h.current.duration?h.current.currentTime=h.current.duration:h.current.currentTime+g<0?h.current.currentTime=0:h.current.currentTime+=g,m(h.current.currentTime)},wn=g=>{g<0||g>=f.length||(C(!0),E(g))},En=g=>{fetch(`${N}/read-write/trackCover/${g}`,{method:"GET"}).then(j=>j.json()).then(j=>{b(`${N}/covers/${j}`)})},Rn=()=>{Wt(),x([]),E(-1)},Kt=()=>{fetch(`${N}/config/user/FFT`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{us.current=g})};n.useEffect(()=>{y(parseFloat(localStorage.getItem("volume"))||.5),ln(),Dt.pathname==="/full-screen"&&(et.current="",ft.current=!0),Kt();const g=K("login",Kt);return()=>{un(),g()}},[]);const Cn=async g=>{const j=await fetch(`${N}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!j.ok)throw new Error("Network response was not ok");const A=(await j.json()).map(Q=>Q.id);x(Q=>[...Q,...A])},An=async g=>{const j=await fetch(`${N}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!j.ok)throw new Error("Network response was not ok");const A=(await j.json()).map(Q=>Q.id);x(vt.shuffle(A)),C(!0),E(0)},In=async()=>{fetch(`${N}/read-write/all-songs`,{method:"GET"}).then(g=>g.json()).then(g=>{x(vt.shuffle(g)),C(!0),E(0),H("Playing the library in shuffle",X.INFO)})},Fn=g=>{console.log("Editing album",g),fetch(`${N}/read-write/album/${g}`,{method:"GET",credentials:"include"}).then(j=>j.json()).then(j=>{const{albumInfos:R,genres:A,tracks:Q,artists:Z}=j;F({id:g,coverURL:`${N}/covers/${R.cover}`,tracks:Q,type:"album",name:R.title,artist:Z.map(ce=>ce.name),year:R.release_date,description:R.description,genre:A.map(ce=>ce.genreName)})})},Pn=g=>{fetch(`${N}/read-write/playlist/${g}/true`,{method:"GET",credentials:"include"}).then(j=>j.json()).then(j=>{const{playlistInfos:R,collaborators:A}=j;F({id:R.id,type:"playlist",coverURL:`${N}/covers/${R.cover}`,name:R.title,description:R.description,collaborators:A})})};n.useEffect(()=>{const g=Math.min(1,Math.max(0,W));z.current||Ln(g.toFixed(4)*.75),Xe.current=g.toFixed(4)*.75,localStorage.setItem("volume",g)},[W]);const Ln=g=>{ye.current&&clearInterval(ye.current);let j=0;const R=16,A=c.current.volume;ye.current=setInterval(()=>{const Q=Qe(A,g,j*R/300);c.current.volume=Q,p.current.volume=Q,(g-A>0?Q>=g:Q<=g)&&(clearInterval(ye.current),ye.current=null),j++},R)},$n=(g,j=null)=>{if(!g){console.log("No changes made"),T(null);return}const R=new FormData;R.append("artist",JSON.stringify(g)),j&&R.append("coverArtist",j),fetch(`${N}/read-write/editContainer/artist`,{method:"POST",credentials:"include",body:R}).then(()=>{T(null),B.current()})},On=g=>{fetch(`${N}/read-write/artist/${g}/true`,{method:"GET",credentials:"include"}).then(j=>j.json()).then(j=>{T({id:j.id,picture:`${N}/covers/artists/${j.picture}`,name:j.name,bio:j.bio,active_from:j.active_from})})},Ns=(g,j=null)=>{if(!g){console.log("No changes made"),F(null);return}const R=new FormData;R.append(`${g.type}`,JSON.stringify(g)),j&&R.append("cover",j),fetch(`${N}/read-write/editContainer/${g.type}`,{method:"POST",credentials:"include",body:R}).then(()=>{F(null),B.current()})},Mn=async(g,j)=>{const R=g?"/forMe":"";(await fetch(`${N}/read-write/delete/album/${j.id}${R}`,{method:"DELETE",credentials:"include"}).then(Q=>Q.json())).success&&(H(`Album ${j.name} deleted.`,X.SUCCESS),F(null),Y("/home"))},Un=async()=>{_(!0)},_n=(g,j)=>{console.log("sending playlist",g);const R=new FormData;R.append("playlist",JSON.stringify(g)),j&&(R.append("cover",j),console.log(j)),fetch(`${N}/read-write/newPlaylist`,{method:"POST",credentials:"include",body:R}).then(()=>{_(!1),de.current()})},Bn=g=>{E(0),x([g]),C(!0)},Gn=()=>{_(!1)},Dn=(g,j,R,A)=>{V({track:j,position:g}),G.current&&G.current(),G.current=R,be.current=A},Vn=()=>{V(null),G.current&&G.current()},Hn=(g,j,R=null)=>{switch(Vn(),g){case Oe.NONE:return;case Oe.TOP_QUEUE:zn(j);break;case Oe.END_QUEUE:Wn(j);break;case Oe.GOTO_ALBUM:qn(j);break;case Oe.REMOVE_FROM_PLAYLIST:Kn(j);break;case Oe.TAGS:ue(j),H("Avaliable soon :)",X.INFO);break;case Oe.ADD_TO_FAVORITES:console.log(j),Qt(j.id,!0,be.current);break;case Oe.REMOVE_FROM_FAVORITES:Qt(j.id,!0,be.current);break}},qn=g=>{fetch(`${N}/read-write/trackAlbumId/${g.id}`,{method:"GET"}).then(j=>j.json()).then(j=>{Y(`albums/${j}`)})},zn=g=>{const j=f;j.splice(k+1,0,g.id),x(j),H(`${g.title} playing next.`,X.SUCCESS)},Wn=g=>{const j=f;j.push(g.id),x(j),H(`${g.title} playing at the end.`,X.INFO)},Kn=g=>{fetch(`${N}/read-write/deleteTrackFromPlaylist/${ne.id}/${g.id}`,{method:"DELETE",credentials:"include"}).then(j=>j.json()).then(j=>{B.current(),H(`${g.title} removed.`,X.SUCCESS)})},Qn=(g,j)=>{B.current=j,ie(g)},Jn=(g,j)=>{if(ue(null),!g)return;const R=new FormData;R.append("current",JSON.stringify(g.current)),R.append("deleted",JSON.stringify(g.deleted)),fetch(`${N}/read-write/changeTrackTags/${j}`,{method:"POST",credentials:"include",body:R}).then(A=>A.json()).then(A=>{H("Tags upated!",X.SUCCESS)})},Yn=async(g=[],j)=>{g.length!==0&&(x(g),E(j||0),C(!0))},Xn=()=>{te(!0)},Zn=()=>{te(!1)},er=()=>{ft.current=!ft.current,ft.current&&(et.current=Dt.pathname),console.log(et.current),Y(ft.current?"/full-screen":et.current&&et.current!=="/full-screen"?et.current:"/home")},tr=()=>new Promise(g=>{fetch(`${N}/read-write/getSongMetaDataCover/${s}`,{method:"GET",credentials:"include"}).then(j=>j.blob()).then(j=>{ms.current={track:s,blob:j},g({track:s,blob:j})})}),sr=g=>{h.current&&(h.current.currentTime+=(g?1:-1)*10)},nr=()=>{const{history:g,pointer:j}=Vt;if(g.every(Z=>Z===null)){Y("/home");return}let R=(j-2+g.length)%g.length,A=g[R],Q=0;for(;(!A||A==="/full-screen")&&Q<g.length||A===Dt.pathname;)R=(R-1+g.length)%g.length,A=g[R],Q++;Vt.pointer=R,Y(A||"/home")},rr=()=>{(r==null?void 0:r.type)==="radio"&&fetch(`${N}/radio/addToFavs/${r.uuid}`,{method:"POST",credentials:"include"}).then(async g=>({json:await g.json(),ok:g.ok})).then(g=>{H(g.json.message,X.INFO),console.log(g),g.ok&&U("refetch-known-radios")}).catch(g=>{H("An error occured, you may check server logs."+g.code,X.ERROR)})},ar=(g,j)=>{var Q,Z;if(((Q=pt.current)==null?void 0:Q.track)===s&&((Z=pt.current)==null?void 0:Z.pairs.length)>0){j();return}const A=new at().getPalette(g.current,10);fs.current=A,or(A),console.log("recomputed"),console.log(pt.current),j()},or=g=>{const j=[];for(let R=0;R<g.length;R++)for(let A=R+1;A<g.length;A++)j.push({c1:g[R],c2:g[A],contrast:Na(g[R],g[A])});pt.current={track:s,pairs:j.sort((R,A)=>R.contrast-A.contrast)}},cr=()=>{window.screen.width<714&&hs(!0)};n.useEffect(()=>{Ht.current&&qt.current&&(Ht.current.style.display=Rt?"none":"flex",qt.current.style.display=Rt?"none":"flex")},[Rt]);const Qt=async(g,j,R)=>{fetch(`${N}/read-write/toggleFavorite/${g}/${j}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{R(A),console.log(r.id,g),r.id===g&&(r.isFav=A)})};return e.jsxs(Xs.Provider,{value:{songRawPalette:fs,currentDisplayedPage:qt,mobileMusicPlayRef:Ht,toggleTrackFavorite:Qt,setTrackMobileView:hs,openTrackMobileView:cr,recomputeColors:ar,songPalette:pt,skipAudioSeconds:sr,toggleCurrentRadioToFavorites:rr,externalRadioInfos:Ve,playRadio:Bn,navigateBack:nr,history:Vt,colorOverride:cn,requestNewFullScreenImage:tr,fullScreenImage:ms.current,toggleFullScreenView:er,fetchFFTUserSettings:Kt,FFTUserSetingsRef:us,fftConfigRef:he,getFFTAtCurrentTime:pn,deleteAlbum:Mn,editArtist:On,playContainer:bn,closeTagWindow:Zn,openTagWindow:Xn,saladContext:ge,setSaladContext:ve,playAudioSalad:Yn,linkNewContainer:Qn,trackActionTypes:Oe,onClicTrackActionEntry:Hn,openTrackActions:Dn,getNextSongsFromAlbum:xn,currentTrackData:r,currentTime:d,isPlaying:u,toggleTrackPaused:gn,playNextSong:kn,trackCoverUrl:v,playPreviousSong:jn,playingTrack:s,jumpTrackSeconds:Tn,jumpToPercent:Sn,addContainerToQueue:yn,playContainerSuffle:Nn,playQueue:f,queuePointer:k,jumpToQueueTrack:wn,deleteQueue:Rn,addArtistToQueue:Cn,shuffleArtistToQueue:An,playTrackNoQueue:vn,playLibraryShuffle:In,setVolume:y,volume:W,editAlbum:Fn,editPlaylist:Pn,createNewPlaylist:Un,globalAudioRef:h,setPlaylistAddedCallback:g=>{de.current=g}},children:[t,S?S.type==="album"?e.jsx(Ta,{applyCanges:Ns,albumClass:S}):S.type==="playlist"?e.jsx(Ts,{editPlaylistClass:S,applyCanges:Ns}):null:null,I&&e.jsx(Aa,{applyChanges:$n,artist:I}),O&&e.jsx(Ts,{closeOverlay:Gn,applyCanges:_n}),w?e.jsx(Ea,{isFav:(ne==null?void 0:ne.favPlaylist)||!1,trackY:w.position.y,track:w.track}):null,pe&&e.jsx(Ra,{apply:Jn,track:pe}),D&&e.jsx(Ca,{}),Rt&&e.jsx($a,{})]})},oe=()=>{const t=n.useContext(Xs);if(t===void 0)throw new Error("useAudioPlayer must be used within an AudioPlayerProvider");return t},dt=n.memo(({percent:t,text:s=null,showPercent:o=!1,isMarquee:u=!1,fillColor:l="#fffdff",style:r={},initialising:a=!1,initialisingColor:d="white",onClickPercentage:m=null,minWidth:h=0})=>{const c=n.useRef(null),p=f=>{if(a||!m)return;const x=f.currentTarget,v=x.getBoundingClientRect().x,b=f.clientX;m((b-v)/x.clientWidth*100)};return n.useEffect(()=>{c.current&&c.current.style.setProperty("--progress",`${t}%`)},[t]),e.jsxs("div",{className:"progressBar",style:{...r,minWidth:h},onClick:p,children:[e.jsx("div",{className:"progressFill",ref:c,style:{background:l,...r}}),a&&e.jsx("div",{className:"progressFill",init:"init",style:{backgroundColor:d,opacity:.5,...r}}),o&&e.jsx("span",{className:"progressPercent",children:t+"%"}),s&&e.jsx("span",{className:"progressPercent",style:{margin:"auto"},children:s})]})},(t,s)=>t.text===s.text&&t.initialising===s.initialising&&t.percent===s.percent),Zs=({})=>{const{currentTrackData:t,currentTime:s,jumpToPercent:o}=oe();return!t||Object.keys(t).length===0?null:e.jsx("div",{className:"songProgress",children:e.jsxs("div",{children:[e.jsx("span",{id:"time-elapsed",children:as(s).readable}),e.jsx(dt,{percent:s/t.rawDuration*100,showPercent:!1,fillColor:"var(--violet-web-color)",style:{height:"10px"},onClickPercentage:o}),e.jsx("span",{id:"time-remaining",children:t.duration.readable})]})})},Ua=n.memo(({id:t,isActive:s,setActive:o,contextName:u})=>e.jsx("div",{className:"index",id:`${u}-index_${t}`,onClick:()=>o(t),"data-active":s?"active":"","data-clickable":!!o}),(t,s)=>t.id===s.id&&t.isActive===s.isActive&&t.contextName===s.contextName),os=({context:t,active:s,setActive:o})=>e.jsx("div",{className:`activeIndex-container ${t.name}`,children:Array.from({length:t.length},(u,l)=>e.jsx(Ua,{id:l,isActive:s===l,setActive:o,contextName:t.name},l))}),en=n.memo(function({currentActive:s,onClick:o,data:u}){const[l,r]=n.useState(s);n.useEffect(()=>{r(s)},[s]);const a=d=>{r(d),o==null||o(d)};return e.jsx("div",{className:"job-view-div",children:u.map((d,m)=>e.jsx("div",{className:"cornered-button","data-active":l===m,onClick:()=>{a(m)},children:d},m))})}),_a=({fromFile:t,setFromFile:s,tracksSelected:o,initMetadataFetching:u})=>{const[l,r]=n.useState(!1),[a,d]=n.useState(""),m=c=>{r(!0),c.target.files&&(console.log("New tracks"),o(Array.from(c.target.files)),c.target.files=null)},h=c=>{d(c.target.value)};return e.jsxs("div",{className:"addMusicSource",children:[e.jsxs("div",{className:"add-audio-source-selection",children:[e.jsx("p",{children:"Select the source: "}),e.jsx(en,{currentActive:t?0:1,onClick:c=>{s(c==0)},data:["From file","From URL"]})]}),t?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Select files from a local storage."}),e.jsxs("div",{className:"add-music-input",children:[e.jsxs("label",{htmlFor:"files",className:"file-select",children:[e.jsx(Cr,{}),e.jsx("span",{children:"Select file"})]}),e.jsx("input",{id:"files",multiple:!0,type:"file",accept:"audio/*",onChange:m})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Link to a radio steam."}),e.jsxs("div",{className:"add-music-input",children:[e.jsx("input",{type:"text",placeholder:"Enter URL",onChange:h}),e.jsx(ae,{onClick:async()=>{u(a)},text:"Resolve",icon:e.jsx(Ar,{})})]})]}),l&&e.jsx("p",{children:"Hold a sec'.. The metadata fetch is about to beggin."})]})},Nt=({text:t,progressBar:s={useProgressBar:!1}})=>e.jsxs("div",{className:"loading-container",children:[e.jsx("h3",{children:t}),s.useProgressBar?e.jsx(dt,{percent:s.percent,showPercent:s.showPercent,isMarquee:s.isMarquee,fillColor:s.fillColor,style:{height:"25px"}}):e.jsx("p",{children:"Loading..."})]}),Ba=({addNewMusic:t})=>e.jsx("div",{className:"album-card",context:"add",children:e.jsx(Ir,{strokeWidth:.7,className:"album-card-cover",onClick:t})}),Ga=({album:t,deleteAlbum:s,editAlbum:o})=>e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(it,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t.uuid)}),e.jsx(Us,{className:"album-card-overview-button",use:"edit",onClick:()=>o(t.uuid)}),e.jsxs("div",{className:"album-card-overview-button",use:"song-count",children:[e.jsx(Fr,{className:"song-count-icon"}),e.jsx("span",{children:t.tracks.length})]}),e.jsx("img",{src:t.coverURL,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:De(t.name,25)}),e.jsx("p",{className:"album-artist",children:De(t.artist.join(","),25)||"No artist"})]}),Da=({radio:t,deleteRadio:s})=>(console.log(t),e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(it,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t[0])}),e.jsx("img",{src:t[1].favicon==""?null:t[1].favicon,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:De(t[1].name,25)})]})),Va=({albums:t,radios:s,deleteRadio:o,addNewMusic:u,deleteAlbum:l,editAlbum:r,publish:a})=>{const d=t.map((c,p)=>e.jsx(Ga,{album:c,deleteAlbum:l,editAlbum:r},`alb-${p}`)),m=[...s].map((c,p)=>e.jsx(Da,{radio:c,deleteRadio:o},`rad-${p}`)),h=[...d,...m];return console.log("rerun"),h.push(e.jsx(Ba,{addNewMusic:u},-1)),e.jsxs("div",{className:"albums-overview",children:[e.jsx("div",{className:"album-overview-container",children:h.reverse()}),(t.length>0||s.size>0)&&e.jsx("button",{className:"roundButton",id:"publish-to-library",onClick:a,children:"Publish to library"})]})},Ha=({track:t,onClose:s})=>{const{albums:o,moveTrackToNewAlbum:u,moveTrackToAlbum:l,editingAlbum:r,setEditingAlbum:a}=Ka(),[d,m]=n.useState(""),[h,c]=n.useState(!1),p=n.useRef(null),f=v=>{v.preventDefault(),!d&&v.target.existingAlbum.value?l(t,v.target.existingAlbum.value):d!==""&&u(t,d),h&&a(null),s()},x=v=>{m(v.target.value)};return n.useEffect(()=>{o.find(({uuid:b})=>b===r).tracks.length===1?c(!0):c(!1);const v=b=>{var $;if(p.current&&!p.current.contains(b.target)){if((($=b.target.closest("svg"))==null?void 0:$.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",v),document.addEventListener("touchstart",v),()=>{document.removeEventListener("mousedown",v),document.removeEventListener("touchstart",v)}},[]),e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:p,children:[e.jsx("h2",{children:"Move track to another album"}),h&&e.jsx("p",{className:"last-track-notify",children:"Last track of the album, if you move it, the current album will be deleted."}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:f,children:[e.jsx("label",{htmlFor:"newAlbum",children:"New album name"}),e.jsx("input",{type:"text",id:"newAlbum",placeholder:"Enter album name",onChange:x}),e.jsx("label",{htmlFor:"existingAlbum",children:"Existing album"}),e.jsx("select",{id:"existingAlbum",onChange:()=>m(""),children:o.map((v,b)=>v.uuid===r?null:e.jsx("option",{value:v.uuid,children:v.name},b))}),e.jsx("input",{type:"submit",value:"Submit"})]})]})})},qa=({setEditUid:t,albumClass:s})=>{var c,p;const[o,u]=n.useState({visible:!1,track:null}),[l,r]=n.useState(null),a=n.useRef(null);if(!s)return null;n.useEffect(()=>{s&&r(s.coverURL)},[s]);const d=()=>{const f=a.current;s.name=f.albumName.value,s.artist=f.artistName.value.split(",").map(v=>v.trim()),s.year=f.releaseDate.value;const x=f.genre.value.split(",").map(v=>v.trim()).map(v=>v.charAt(0).toUpperCase()+v.slice(1));s.genre=x.filter(v=>v!=""),s.description=f.description.value,t(null)},m=f=>{const x=f.target.files[0];x&&r(s.setCoverFromFile(x))},h=f=>{u({visible:!o.visible,track:f})};return e.jsxs("div",{className:"albumWrapping",children:[e.jsxs("div",{className:"albumCover",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(se,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:m})]}),e.jsx("button",{className:"roundButton go-back",onClick:()=>d(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",ref:a,children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(c=s.artist)==null?void 0:c.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",defaultValue:s.year})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(p=s.genre)==null?void 0:p.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Ie,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:f,style:x})=>e.jsxs("div",{style:x,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[f].title}),e.jsx(Ls,{className:"trackIcon",onClick:()=>{h(s.tracks[f])}})]},f)})})]}),o.visible&&e.jsx(Ha,{onClose:()=>{u({visible:!1})},track:o.track})]})};class Cs{constructor(s,o,u,l,r){this.name=s,this.artist=o,this.year=u,this.tracks=[],this.setCover(l),this.uuid=r}setCover(s){!s||this.coverURL||(this.coverData=s.data,this.coverMime=s.format,this.coverURL=URL.createObjectURL(new Blob([this.coverData],{type:this.coverMime})),this.ext=this.coverMime.split("/")[1],this.sourceIsBinary=!0)}setCoverFromFile(s){return this.coverURL=URL.createObjectURL(s),this.coverFile=s,console.log("Setting cover from file: ",s),this.ext=s.type.split("/")[1],this.coverURL}addTrack(s){s&&(this.tracks.push(s),s.album=this)}removeTrack(s){s&&(this.tracks=this.tracks.filter(o=>o.id!==s.id),s.album=null)}getPuredData(){return{name:this.name,artists:this.artist,year:this.year,uuid:this.uuid,ext:this.ext}}getPuredCover(){if(!this.sourceIsBinary)return this.coverFile?(console.log("Using file reference for cover: "+album.coverFile),this.coverFile):null;if(console.log("Using binary reference for cover: ",this.uuid),!this.coverData||this.coverData.length===0)return console.log("returned no cover at",this.uuid),null;const s=new Uint8Array(this.coverData),o=new Blob([s],{type:this.coverMime});return new File([o],`${this.uuid}.${this.coverMime.split("/").pop()}`,{type:this.coverMime})}}class za{constructor(s){this.id=yt(),this.file=s,this.album=null,this.albumName="",this.artists=[],this.title=s.name,this.no=1,this.duration=0,this.year=2003,this.picture=null}setPicture(s){this.picture=s}setAdditionalData(s="",o="",u=1,l=0,r=2e3,a=[]){this.title=o,this.no=u,this.duration=l,this.year=r,this.artists=a,this.albumName=s}setAlbum(s){this.album=s}getUrl(){return URL.createObjectURL(this.file)}getArtists(){return this.artists?this.artists.map(s=>s.trim()):["Unknown artist"]}getPuredTrackMeta(){return{albumUuid:this.album.uuid,duration:this.duration,no:this.no,year:this.year,title:this.title,id:this.id}}}const tn=n.createContext(),Wa=({closeOverlay:t,uploadPercent:s,uploadProgress:o,uploadFinished:u,isMinimize:l,setMinimized:r})=>{const[a,d]=n.useState(!0),[m,h]=n.useState(0),[c,p]=n.useState(0),[f,x]=n.useState(0),[v,b]=n.useState([]),[$,k]=n.useState(!1),[E,M]=n.useState(null),[P,S]=n.useState(0),[F,I]=n.useState(0),[T,U]=n.useState(""),{addNotification:K,notifTypes:B}=Fe(),[w,V]=n.useState(new Map),G=n.useRef([]),H=n.useRef([]),{emit:X}=xe(),Y=n.useRef(null),ne=async y=>{if(y.length===0)return;x(y.length);const O=y.map(_=>new za(_));Y.current=O,ie()},ie=async()=>{const y=await ge(),O=y.length>0?Y.current.filter(_=>!y.includes(_.id)):Y.current;console.log("Valid new tracks",O),G.current=[...G.current,...O],Y.current=null,ue()},pe=()=>{H.current=H.current.filter(y=>y.tracks.length>0),k(!0),b(H.current)};n.useEffect(()=>{console.log("New albums ",v),!$&&(p(0),h(2))},[v]);const ue=()=>{function y(O){return H.current.find(_=>_.name===O)}for(const O of G.current){const _=y(O.albumName);if(_)_.addTrack(O);else{const D=yt(),te=new Cs(O.albumName,O.getArtists(),O.year,O.picture,D);H.current.push(te),te.addTrack(O)}}b(H.current)},ge=async(y="")=>{if(!a){if(!y)return;console.log("Fetching meta at source",y);const _=await fetch(`${N}/radio/metadata/${encodeURIComponent(y)}`,{method:"GET"}).then(de=>de.json());if(_)K("Radio found! "+_[0].name,B.INFO);else{K("No radio found..",B.ERROR);return}const D=_[0];console.log(D);const te=w;te.set(D.stationuuid,{url:D.url_resolved,favicon:D.favicon,name:D.name}),V(te),h(2);return}h(1);const O=[];return await Promise.all(Y.current.map(async _=>{var te,de,be;const D=await fa(_.file).catch(z=>{console.error("error at",file,z),K(`Track ${_.title} seems corrupted, retry without it.`,B.ERROR)});if(!D){O.push(_.id);return}_.setAdditionalData(D.common.album||D.common.title,D.common.title||_.file.name,((te=D.common.track)==null?void 0:te.no)||0,D.format.duration||0,D.common.year,D.common.artists.map(z=>z.split(",")).flat(1).map(z=>z.trim())),_.setPicture((be=(de=D.common)==null?void 0:de.picture)==null?void 0:be[0]),p(z=>z+1)})),O},ve=y=>{const O=new Map([...w].filter(([_,D])=>_!=y));V(O)},q=y=>{G.current=G.current.filter(O=>O.album.uuid!==y),console.log("Deleted album, remaining tracks",G.current),H.current=H.current.filter(O=>O.uuid!==y),k(!1),b(H.current)},L=y=>{M(y)};n.useEffect(()=>{if(E===null||v.length===0){h(2);return}h(3)},[E]);const ee=(y,O)=>{const _=yt();console.log("Moving track: "+y.id+NaN+E+" to album: "+_),y.album.removeTrack(y);const D=new Cs(O,y.getArtists(),y.year,y.picture,O);H.current.push(D),D.addTrack(y),pe(),K(`Track ${y.title.substring(0,60)} got moved to album ${O}.`,B.INFO)},fe=(y,O)=>{console.log("Moving track: "+y.id+NaN+E+" to album: "+O),y.album.removeTrack(y);const _=H.current.find(D=>D.uuid===O);_.addTrack(y),pe(),K(`Track ${y.title.substring(0,60)} got moved to album ${_.name}.`,B.INFO)},re=async()=>{if(console.log("Publishing tracks: ",G.current),console.log("Publishing radios: ",w),w.keys().forEach(async y=>{const O=new FormData;console.log(w.get(y)),O.append("radioData",JSON.stringify({uuid:y,...w.get(y)}));const _=await fetch(`${N}/radio/newRadio`,{method:"POST",credentials:"include",body:O}).then(D=>D.json());console.log(_)}),G.current.length>0){h(4);for(const _ of H.current){let D=new FormData;D.append("album",JSON.stringify(_.getPuredData()));const te=_.getPuredCover();te&&D.append("cover",te);const de=await fetch(`${N}/read-write/upload`,{method:"POST",body:D,credentials:"include"});if(!de.ok)throw console.error("Error uploading albums:",de.statusText),new Error("Error uploading albums");D=null,console.log("Album uploaded: "+_.name)}H.current.forEach(_=>{_.coverURL&&(URL.revokeObjectURL(_.coverURL),_.coverURL=null)});let y=G.current.reduce((_,D)=>_+D.file.size,0);S((y/1024/1024).toFixed(1));let O=0;for(const _ of G.current){let D=new FormData;D.append("trackMeta",JSON.stringify(_.getPuredTrackMeta())),D.append("music",_.file),U(_.title),o({done:O,total:G.current.length}),await pa({method:"POST",data:D,withCredentials:!0,url:"/upload",baseURL:`${N}/read-write`,onUploadProgress:te=>{const{total:de,loaded:be}=te,z=de/1e6,ye=be/1e6;s(ye/z);const Xe=ye/z*100;I(Xe.toFixed(2))}}).catch(te=>{console.error("Error uploading track:",te)}).finally(()=>{O++}),D=null}}console.log("Upload finished"),u(),setTimeout(()=>{H.current=null,G.current=null,p(0),b([]);const y=w;y.clear(),V(y),h(0),M(null),I(0),console.log("Closing overlay"),X("musicUploaded"),t()},750)},C=()=>{if(m!==4){t();return}r(!0)},W=()=>{switch(m){case 0:return e.jsx(_a,{fromFile:a,setFromFile:d,tracksSelected:ne,initMetadataFetching:ge});case 1:return e.jsx(Nt,{text:`Fetching metadatas.. ${f?c+"/"+f:"-/-"}`});case 2:return e.jsx(Va,{albums:v,addNewMusic:()=>h(0),deleteAlbum:q,editAlbum:L,publish:re,radios:w,deleteRadio:ve});case 3:return e.jsx(qa,{setEditUid:M,albumClass:v.find(y=>y.uuid===E)});case 4:return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Nt,{text:`Publishing ${T} ${P}Mb..`,progressBar:{useProgressBar:!0,showPercent:!0,isMarquee:!1,percent:Number(F),fillColor:"var(--cool-green)"}}),e.jsx("p",{children:"You can close this overlay, the upload will continue. :)"})]});default:return e.jsx("div",{className:"addMusicSource",children:e.jsx("p",{children:"Not implemented yet"})})}};return e.jsx("div",{className:"addMusicRoot",children:e.jsx("div",{className:"addMusicContainer",style:l?{display:"none"}:{},children:e.jsxs(tn.Provider,{value:{albums:v,moveTrackToNewAlbum:ee,editingAlbum:E,moveTrackToAlbum:fe,setEditingAlbum:M},children:[e.jsx(je,{className:"buttonRound closeOverlay",onClick:C}),e.jsx("h2",{children:"Add Music"}),e.jsx(os,{context:{name:"AddMusic",length:5},active:m,setActive:h}),e.jsx(W,{})]})})})},Ka=()=>n.useContext(tn),Qa=50,Ja=({hideComponent:t})=>{const{playQueue:s,deleteQueue:o,jumpToQueueTrack:u,queuePointer:l}=oe(),r=n.useRef(null),{subscribe:a}=xe(),d=n.useRef(new Map);n.useEffect(()=>{const h=p=>{var f;if(r.current&&!r.current.contains(p.target)){if(((f=p.target.closest("svg"))==null?void 0:f.id)==="playlist-button")return;t()}},c=a("action-bar-open",()=>{t()});return document.addEventListener("mousedown",h),document.addEventListener("touchstart",h),()=>{c(),document.removeEventListener("mousedown",h),document.removeEventListener("touchstart",h)}},[]);const m=h=>{h.stopPropagation(),h.preventDefault()};return e.jsxs("div",{className:"music-queue",ref:r,onTouchMove:m,children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Music Queue"}),s.length>0&&e.jsx(it,{className:"buttonRound",id:"queue-trash",onClick:o})]}),s.length>0?e.jsx(Ie,{height:"auto",itemCount:s.length,itemSize:Qa,width:"100%",itemData:{playQueue:s,cacheRef:d,jumpToQueueTrack:u,queuePointer:l},children:Ys}):e.jsx("p",{children:"No items in the queue"})]})},Ya=n.memo(({payload:t})=>{const[s,o]=n.useState(!1);return e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Open a song's dropdown"}),e.jsxs("div",{id:"tuto-0-cooking-container",children:[e.jsx(se,{className:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-cooking-songs-container",children:[e.jsxs("div",{className:"tuto-cooking-0-song-skeleton","data-target":!0,children:[e.jsx(ts,{id:"tuto-cooking-dots",onClick:()=>{o(!s)}}),s&&e.jsxs("div",{id:"tuto-0-cooking-dropdown",children:[e.jsxs("div",{className:"tuto-cooking-0-action-skeleton track-action-entry","data-target":"true",onClick:()=>{t(1)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(bt,{})]}),e.jsx("div",{className:"tuto-cooking-0-action-skeleton"})]})]}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"})]})]})]})}),Xa=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Here you can remove and add tags:"}),e.jsxs("div",{id:"tuto-tags-1",children:[e.jsxs("div",{className:"tuto-search-skeleton",children:[e.jsx(Me,{}),e.jsx("span",{id:"animated-write-span",children:"140BPM, roses, gaming, 2010s"}),e.jsx("div",{className:"blinking-cursor"})]}),e.jsxs("div",{id:"tuto-tags",children:[e.jsxs("div",{className:"small-tag",children:["Evening",e.jsx(je,{})]}),e.jsxs("div",{className:"small-tag",children:["Chill",e.jsx(je,{})]}),e.jsxs("div",{className:"small-tag",children:["Friends",e.jsx(je,{})]}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:"Got it!"})]})]})]})),Za=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Cooking lets you play all the tracks mataching the tags:"}),e.jsx("div",{id:"tuto-tags-salad",children:e.jsxs("div",{id:"tuto-tags",children:[e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#a79cf5"}})]})}),e.jsxs("div",{id:"tuto-song-list",children:[e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}})}),e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})}),e.jsxs("div",{className:"tuto-tag-song-skeleton",children:[e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})]})]}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]})),eo=[Ya,Xa,Za],to=n.memo(()=>{const{onTutoialFinished:t}=St(),[s,o]=n.useState(0),u=eo[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{t(we.COOKING)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Manage tags and cook salads"}),e.jsx(os,{context:{name:"tutorial",length:3},active:s,setActive:o}),e.jsx(u,{payload:r[s]})]})}),so=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Pick an album:"}),e.jsxs("div",{id:"tuto-genre-albums-container",children:[e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(se,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]}),e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(se,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]})]})]})),no=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Edit the desired album:"}),e.jsxs("div",{id:"tuto-genre-0-lib",children:[e.jsx(se,{id:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsxs("div",{id:"tuto-genre-0-header",children:[e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:e.jsx(ss,{})})]}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"})]})]})]})),ro=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Change the genre:"}),e.jsxs("div",{id:"tuto-genre-1-lib",children:[e.jsxs("div",{id:"tuto-genre-1-logo-btn",children:[e.jsx(se,{id:"tuto-genre-logo"}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton","data-target":!0,children:e.jsx("span",{children:"Genre"})}),e.jsxs("div",{className:"tuto-genre-1-input-skeleton tuto-target","data-target":!0,children:[e.jsx("span",{id:"animated-write-span",children:"Rock, Breakcore, Soundtrack, .."}),e.jsx("div",{className:"blinking-cursor"})]})]})]})]})),ao=[so,no,ro],oo=n.memo(()=>{const{onTutoialFinished:t}=St(),[s,o]=n.useState(0),u=ao[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{t(we.GENRES)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Add genre to albums"}),e.jsx(os,{context:{name:"tutorial",length:3},active:s,setActive:o}),e.jsx(u,{payload:r[s]})]})}),we={GENRES:"genres",COOKING:"cooking"},cs=new Map;cs.set(we.GENRES,oo);cs.set(we.COOKING,to);const sn=({tutorialKey:t=we.GENRES})=>{const s=cs.get(t)??(()=>e.jsx("div",{children:"Not found"}));return e.jsx("div",{className:"page-overlay-blur",children:e.jsx(s,{})})},nn=n.createContext(),J={SEARCH:"search",OPEN_ACTION_BAR:"open_action_bar",CLOSE_ACTION_BAR:"close_action_bar",PLAY_SONG:"play_song",OPEN_ALBUM:"open_album",OPEN_ARTIST:"open_artist",PLAY_LIBRARY_RANDOM:"play_library_random",TOGGLE_PLAY_PAUSE:"toggle_play_pause",OPEN_SETTINGS:"open_settings",VOLUME_UP:"volume_up",VOLUME_DOWN:"volume_down",OPEN_GENRE:"open_genre",TOGGLE_FULL_SCREEN:"toggle_full_screen",SKIP_PLUS:"skip_plus",SKIP_MINUS:"skip_minus"},Be=[{name:"Search",code:J.SEARCH,description:"Search for a song, an album, a genra, an artist",key:"k",modifier:"ctrl",keywords:["search","find","look for","seek","search for","find for","look for for","seek for"],icon:()=>e.jsx(Me,{className:"action-bar-current-logo"})},{name:"open action bar",code:J.OPEN_ACTION_BAR,description:"Give a command",key:" ",modifier:"ctrl",keywords:[]},{name:"Play the library in shuffle",code:J.PLAY_LIBRARY_RANDOM,description:"",key:"r",modifier:"ctrl",keywords:["play","shuffle","random","library","all","all songs","all albums","all artists"],icon:()=>e.jsx(lt,{className:"action-bar-current-logo"})},{name:"Toggle Play pause",code:J.TOGGLE_PLAY_PAUSE,description:"",key:" ",modifier:"",icon:()=>e.jsx(lt,{className:"action-bar-current-logo"})},{name:"Open settings",code:J.OPEN_SETTINGS,description:"",key:"p",modifier:"ctrl",keywords:["settings","configuration","config","preferences","options"],icon:()=>e.jsx(Pr,{className:"action-bar-current-logo"})},{name:"Volume up",code:J.VOLUME_UP,description:"",key:"ArrowUp",modifier:"",keywords:[],icon:()=>{}},{name:"Volume down",code:J.VOLUME_DOWN,description:"",key:"ArrowDown",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:J.SKIP_PLUS,description:"",key:"ArrowRight",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:J.SKIP_MINUS,description:"",key:"ArrowLeft",modifier:"",keywords:[],icon:()=>{}},{name:"Toggle color theme",code:J.TOGGLE_THEME,description:"Toggles the app dark or light theme.",key:"t",modifier:"ctrl",keywords:["dark","light","color","theme","color-theme","toggle"],icon:()=>e.jsx(Gs,{className:"action-bar-current-logo"})},{name:"Toggle full screen",code:J.TOGGLE_FULL_SCREEN,description:"Toggles the full screen mode.",key:"",modifier:"",keywords:["bars","wallpaper","full-screen","fft","spectrum","toggle"],icon:()=>e.jsx(Ds,{className:"action-bar-current-logo"})}],co=new qs(Be,{keys:["keywords"],threshold:.3}),Te={DARK:"dark",LIGHT:"light"},io=({children:t})=>{const s=n.useRef([]),[o,u]=n.useState(!1),l=n.useRef(o),[r,a]=n.useState(null),[d,m]=n.useState(!1),[h,c]=n.useState(null),[p,f]=n.useState([]),[x,v]=n.useState(null),{playTrackNoQueue:b,playLibraryShuffle:$,toggleTrackPaused:k,setVolume:E,volume:M,toggleFullScreenView:P,skipAudioSeconds:S}=oe(),F=n.useRef(M),I=me(),T=Je(),U=n.useRef(null),K=n.useRef(null),{addNotification:B,notifTypes:w}=Fe(),[V,G]=n.useState(()=>{const y=localStorage.getItem("CML_theme");return y?y===Te.LIGHT?(document.documentElement.classList.remove("dark"),Te.LIGHT):(document.documentElement.classList.add("dark"),Te.DARK):(localStorage.setItem("CML_theme",Te.LIGHT),Te.LIGHT)}),{emit:H,subscribe:X}=xe();n.useEffect(()=>{window.addEventListener("keydown",ne),ge();const y=O=>{U.current&&!U.current.contains(O.target)&&C()};return document.addEventListener("mousedown",y),document.addEventListener("touchstart",y),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("touchstart",y),window.removeEventListener("keydown",ne),s.current=[]}},[]);const Y=y=>{const O=localStorage.getItem("CML_FinishedTutorials"),_=O?JSON.parse(O):{state:{}};_.state[y]=!0,localStorage.setItem("CML_FinishedTutorials",JSON.stringify(_)),H(`safe-finished-tutorial-${y}`)},ne=y=>{if(y.key=="Escape"&&l.current){C();return}if(y.key=="Escape"&&T.pathname==="/full-screen"){P();return}if(y.key=="Control"||h||!(y.ctrlKey||y.altKey||y.metaKey)&&(document.activeElement.nodeName==="INPUT"||document.activeElement.nodeName==="TEXTAREA"))return;const O=Be.find(_=>y.key===_.key?!_.modifier||_.modifier===""?!0:{ctrl:y.ctrlKey,shift:y.shiftKey,alt:y.altKey,meta:y.metaKey}[_.modifier]:!1);O&&(c(O),s.current.forEach(_=>{_.code===O.code&&(_.callback(y),y.preventDefault())}))},ie=(y,O)=>{const _={callback:y,code:O};s.current.push(_)},pe=n.useRef(k);pe.current=k;const ue=()=>{Ue(()=>{u(!0),a(null),f(ve()),K.current="command",c(Be[1])},T.pathname)()};n.useEffect(()=>{F.current=M,B(`Volume : ${(M*100).toFixed(0)} %`,w.INFO)},[M]);const ge=()=>{ie(()=>{if(K.current==="command"){C();return}ue()},J.OPEN_ACTION_BAR),ie(()=>{C()},J.CLOSE_ACTION_BAR),ie(()=>{if(K.current==="search"){C();return}u(!0),a(J.SEARCH),K.current="search"},J.SEARCH),ie(()=>{pe.current()},J.TOGGLE_PLAY_PAUSE),ie(()=>{I("/settings")},J.OPEN_SETTINGS),ie(()=>{E(Math.min(Math.max(F.current+.1,0),1))},J.VOLUME_UP),ie(()=>{E(Math.min(Math.max(F.current-.1,0),1))},J.VOLUME_DOWN),ie(()=>{S(!0)},J.SKIP_PLUS),ie(()=>{S(!1)},J.SKIP_MINUS)};n.useEffect(()=>{o&&document.getElementById("actionbar-searchbar").focus(),l.current=o},[o]),n.useEffect(()=>{switch(r){case J.SEARCH:m(!0),v(()=>e.jsx("div",{className:"action-bar-logo-container",children:e.jsx(Me,{className:"action-bar-current-logo"})}));break;default:m(!0),v(null)}},[r]);const ve=()=>[Be[0],Be[2],Be[4]],q=y=>{var D;const O=y.target.value;if(O===""){f(ve());return}if(r===J.SEARCH){ee(O);return}const _=(D=co.search(O))==null?void 0:D.map(te=>te.item).filter(te=>{var de;return((de=te.keywords)==null?void 0:de.length)>0});f(_)},L=y=>{switch(y){case"track":return e.jsx(es,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View album"})," ",e.jsx(Jt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View artist"})," ",e.jsx(Jt,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View genre"})," ",e.jsx(Jt,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},ee=async y=>{y===""||y.trim().length===0||fetch(`${N}/read-write/search/${y}`,{method:"GET",credentials:"include"}).then(O=>{if(O.ok)return O.json();throw new Error("Error fetching search results")}).then(O=>{const _=[...O.tracks.map(D=>({type:"track",...D})),...O.albums.map(D=>({type:"album",...D})),...O.artists.map(D=>({type:"artist",...D})),...O.genres.map(D=>({type:"genre",...D}))].map(D=>{const te=D.path,de=D.id,{trackPath:be,...z}=D;return{icon:()=>te?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${D.type==="artist"?"artist":"covers"}/${te}`,alt:D.name}):e.jsx(se,{className:"action-bar-entry-logo"}),tooltip:L,code:D.type==="artist"?J.OPEN_ARTIST:D.type==="album"?J.OPEN_ALBUM:D.type==="genre"?J.OPEN_GENRE:J.PLAY_SONG,fileName:te,trackName:de,...z}});f(_)})},fe=y=>{switch(y.code){case J.SEARCH:u(!0),a(J.SEARCH),c(Be[0]),K.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),f([]);break;case J.CLOSE_ACTION_BAR:C();break;case J.PLAY_SONG:console.log("Playing song",y),b(y.trackName),C();break;case J.OPEN_ALBUM:C(),I(`/albums/${y.id}`);break;case J.OPEN_ARTIST:C(),I(`/artists/${y.id}`);break;case J.OPEN_GENRE:console.log("Opening genre",y),C(),I(`/genres/${y.id}`);break;case J.PLAY_LIBRARY_RANDOM:$(),C();break;case J.OPEN_SETTINGS:C(),I("/settings");break;case J.TOGGLE_THEME:re(),C();break;case J.TOGGLE_FULL_SCREEN:P(),C();break}},re=()=>{V===Te.DARK?(document.documentElement.classList.remove("dark"),localStorage.setItem("CML_theme",Te.LIGHT)):(document.documentElement.classList.add("dark"),localStorage.setItem("CML_theme",Te.DARK)),G(V===Te.DARK?Te.LIGHT:Te.DARK)},C=()=>{u(!1),a(null),K.current=null,f([])},W=()=>{u(!0),a(J.SEARCH),c(Be[0]),K.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),f([])};return n.useEffect(()=>{o&&H("action-bar-open")},[o]),e.jsx(nn.Provider,{value:{commandCodes:J,openCommandBar:ue,openSearchBar:W,colorTheme:V,toggleColorTheme:re,onTutoialFinished:Y},children:e.jsxs("div",{className:"action-bar-app-parent",children:[t,o&&e.jsx("div",{className:"global-action-bar",children:e.jsx("div",{className:"action-bar",ref:U,children:e.jsxs("div",{className:"action-bar-research",children:[x||null,e.jsx("input",{type:"text",id:"actionbar-searchbar",className:"searchbar",onChange:q,placeholder:`${h.description}`}),e.jsx("div",{className:"action-bar-results",children:e.jsx(Ie,{height:300,itemCount:p.length,itemSize:50,width:"calc(100% - 0px)",children:({index:y,style:O})=>e.jsx(ut,{entry:p[y],onClick:fe,className:"from-global-bar"},y)})})]})})})]})})},St=()=>{const t=n.useContext(nn);if(!t)throw new Error("useGlobalActionBar must be used within a GlobalActionBar provider");return t},lo=({onClosed:t,hideComponent:s})=>{const{setVolume:o,volume:u}=oe(),l=n.useRef(null),{subscribe:r}=xe();return n.useEffect(()=>{const a=m=>{var h;if(l.current&&!l.current.contains(m.target)){if(((h=m.target.closest("svg"))==null?void 0:h.id)==="volume-button")return;s()}},d=r("action-bar-open",()=>{s()});return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),()=>{d(),document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[]),e.jsx("div",{ref:l,className:"volume-bar",children:e.jsx(dt,{onClickPercentage:a=>{console.log("change volume"),o(a/100)},style:{height:"10px"},fillColor:"rgb(118, 173, 206)",percent:u*100})})},uo=({percent:t,size:s=120,strokeWidth:o=10,useText:u=!0,style:l,color:r="rgb(130, 119, 196)"})=>{const a=(s-o)/2,d=2*Math.PI*a,m=d*(1-t);return e.jsxs("div",{className:"radial-container",style:{width:s,height:s,...l},children:[e.jsxs("svg",{width:s,height:s,children:[e.jsx("circle",{className:"radial-bg",stroke:"#e6e6e6",strokeWidth:o,fill:"none",cx:s/2,cy:s/2,r:a}),e.jsx("circle",{className:"radial-progress",stroke:r,strokeWidth:o,fill:"none",cx:s/2,cy:s/2,r:a,strokeDasharray:d,strokeDashoffset:m})]}),e.jsx("div",{className:"radial-label",children:u&&e.jsxs("span",{children:[Math.round(t),"%"]})})]})},mo=({fps:t=45})=>{const s=n.useRef(),o=n.useRef(null),{getFFTAtCurrentTime:u,fftConfigRef:l,globalAudioRef:r,FFTUserSetingsRef:a,fetchFFTUserSettings:d,colorOverride:m,currentTrackData:h}=oe(),c=n.useRef(0),p=n.useRef(!1),f=x=>{var b;if((h==null?void 0:h.type)=="radio"||p.current){cancelAnimationFrame(s.current);return}if(!o.current){s.current=requestAnimationFrame(f);return}const v=o.current.getContext("2d");if(v&&a.current){if(x-c.current<1e3/t){s.current=requestAnimationFrame(f);return}c.current=x;const $=5;v.clearRect(0,0,o.current.width,o.current.height);const k=u();if(!k){s.current=requestAnimationFrame(f);return}let E=k.subarray(Math.floor(k.length*.3),Math.floor(k.length*.6));const M=Math.max(1,E.length/$),P=new Array($);P.fill(0);for(let I=0;I<E.length;I++)P[Math.floor(I/M)]+=Number(k[I]);let S=o.current.width/$-5,F=0;v.strokeStyle="#ffffff",v.fillStyle="#ffffff";for(let I=0;I<P.length;I++){const T=ja(Math.log2(P[I])*($/5),5,25,0,1),U=Math.max(10,Math.min(80*T*((b=r.current)==null?void 0:b.volume),o.current.height-10));v.beginPath(),v.roundRect(2+F,(o.current.height-U)/2,S,U,7),v.fill(),v.stroke(),F+=S+5}}s.current=requestAnimationFrame(f)};return n.useEffect(()=>{if(!l.current){cancelAnimationFrame(s.current),console.log("No FFT data to display, releasing anim frame.");return}s.current=requestAnimationFrame(f),console.log("FFT found, requested animation frame.")},[l.current]),n.useEffect(()=>{const x=window.matchMedia("(max-width: 714px)"),v=b=>{p.current=b.matches,s.current=requestAnimationFrame(f),console.log("Canvas hidden?",p.current)};return v(x),x.addEventListener("change",v),()=>{x.removeEventListener("change",v)}},[]),e.jsx("canvas",{ref:o,id:"fft-canvas-small",className:"in-song-header",width:50,height:50})},Mt=({useText:t=!1,style:s={},className:o=""})=>{const u=n.useRef(null),{colorTheme:l,toggleColorTheme:r}=St();return n.useEffect(()=>{u.current.setAttribute("data-color-theme",l)},[l]),e.jsxs("div",{style:s,className:`color-theme-btn ${o}`,children:[e.jsx(Gs,{id:"color-theme-svg",ref:u,className:"buttonRound",onClick:r}),t&&e.jsx("span",{children:ya(l.toString())})]})},Bt=()=>{const[t,s]=n.useState(!1),[o,u]=n.useState(!1),[l,r]=n.useState(!1),[a,d]=n.useState(!1),[m,h]=n.useState(!1),[c,p]=n.useState({col1:"#000",col2:"#000"}),{currentTrackData:f,trackCoverUrl:x,volume:v,toggleFullScreenView:b,toggleCurrentRadioToFavorites:$,openTrackMobileView:k,mobileMusicPlayRef:E}=oe(),{openSearchBar:M}=St(),[P,S]=n.useState(!1),[F,I]=n.useState(null),[T,U]=n.useState(null),K=me(),{subscribe:B}=xe();n.useRef(null);const[w,V]=n.useState(Je().pathname==="/admin-pannel"),G=()=>{r(!0)};n.useEffect(()=>{const ue=B("openAddMusic",G);return()=>{ue()}},[]);const H=()=>{r(!1),U(null),I(null)};function X(){d(!a)}function Y(){h(!m)}n.useEffect(()=>{const ue=[{col1:"#ffa585",col2:"#ffeda0"},{col1:"#9bf8f4",col2:"#6f7bf7"}];p(ue[Math.floor(Math.random()*ue.length)])},[]);const ne=()=>{},ie=()=>{if(!F){l?(H(),console.log("deactivate")):(G(),console.log("activate"));return}S(document.getElementsByClassName("addMusicContainer")[0]==null),console.log("toggle")},pe=ue=>{ue.stopPropagation(),b()};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header__logo",onClick:()=>K("/home"),children:[e.jsx(se,{col1:c.col1,col2:c.col2}),e.jsx("h1",{children:"CML"})]}),e.jsx(Ot,{context:{mobile:!1}}),e.jsxs("div",{className:"musicPlayer",ref:E,onClick:k,children:[e.jsxs("div",{className:"playPauseContainer",children:[(f==null?void 0:f.type)=="radio"?f.coverUrl==""?e.jsx(se,{className:"trackImage"}):e.jsx("img",{src:f.coverUrl,className:"trackImage"}):x.split("/").pop()==="null"?e.jsx(se,{className:"trackImage"}):e.jsx("img",{src:x,className:"trackImage"}),e.jsx("div",{className:"playPauseButtons",onClick:pe,children:e.jsx(Ds,{style:{padding:"0px"}})})]}),!f||Object.keys(f).length===0?null:e.jsxs("div",{className:"trackinfos-parent",children:[e.jsxs("div",{className:"trackinfo-desktop",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{(f==null?void 0:f.type)!="radio"&&K(`/artists/${f.artistId}`)},children:f.artist}),e.jsx(Zs,{})]}),(f==null?void 0:f.type)==="radio"?e.jsx(jt,{id:"add-radio-fav",iconHovered:_s,iconDefault:_t,onClick:$}):e.jsx(mo,{}),e.jsxs("div",{className:"trackinfo-mobile",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx(Ot,{context:{mobile:!0}})]})]})]}),e.jsxs("div",{className:"mobile-gost",children:[e.jsx(Bs,{id:"playlist-button",className:"buttonRound",onClick:()=>X()}),a&&e.jsx(Ja,{hideComponent:()=>d(!1)}),v<=1e-5?e.jsx(Lr,{className:"buttonRound",onClick:()=>Y()}):v<.5?e.jsx($r,{className:"buttonRound",onClick:()=>Y()}):e.jsx(Or,{id:"volume-button",className:"buttonRound",onClick:()=>Y()}),m&&e.jsx(lo,{hideComponent:()=>h(!1)}),e.jsx(Mt,{})]}),e.jsxs("div",{className:"headerRight",children:[e.jsx(Mt,{className:"desktop-ghost"}),!w&&e.jsxs("div",{className:"serach-button-div",onClick:M,children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"K"})}),e.jsx(Me,{})]}),e.jsxs("div",{style:{position:"relative",padding:"5px",display:"flex",justifyContent:"center"},className:"upload-music-header",children:[T&&e.jsx(uo,{percent:T,size:44,useText:!1,style:{position:"absolute",transform:"translate(-1px, -5.5px)"}}),e.jsx(ns,{style:{zIndex:"10",position:"relative"},className:"addMusicButton buttonRound",onClick:ie}),F&&e.jsxs("span",{style:{position:"absolute",bottom:"-30px",padding:"2px 7px",borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 0.7)",textAlign:"center"},children:[F.done,"/",F.total]})]}),e.jsx(va,{})]}),l&&e.jsx(Wa,{uploadPercent:U,uploadFinished:ne,uploadProgress:I,isMinimize:P,setMinimized:S,closeOverlay:H})]})},ho=()=>{const[t,s]=n.useState(null),[o,u]=n.useState(null),[l,r]=n.useState(null),[a,d]=n.useState(null);n.useEffect(()=>{const c=setInterval(m,5e3);return m(),()=>clearInterval(c)},[]);const m=()=>{try{fetch(`${N}/isResponding`).then(c=>{c.status===200?(a===!1&&h(),d(!0)):d(!1)}).catch(c=>{console.error("Fetch failed (e.g., CORS error):",c),d(!1)})}catch(c){console.error("Unexpected error:",c),d(!1)}},h=()=>{fetch(`${N}/read-write/stats`,{method:"GET"}).then(c=>c.json()).then(c=>{s(c)}).catch(c=>console.error("Error fetching stats:",c)),fetch(`${N}/read-write/serverStats`,{method:"GET"}).then(c=>c.json()).then(c=>{u(Yt(c.coversByteUsage+c.tracksByteUsage).readable),r({perent:(1-c.free/c.size)*100,total:Yt(c.size).readable,free:Yt(c.free).readable})}).catch(c=>console.error("Error fetching server stats:",c))};return n.useEffect(()=>{h()},[]),e.jsxs("div",{className:"stat-short",children:[e.jsxs("div",{className:"stat-short-category",children:[e.jsxs("p",{children:["Library size: ",o]}),e.jsxs("p",{children:["Free ",l==null?void 0:l.free," of ",l==null?void 0:l.total]}),e.jsx(dt,{percent:(l==null?void 0:l.perent)||0,total:l==null?void 0:l.total,style:{height:"10px"},fillColor:"var(--chill-purple)",initialising:!o})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"5px"},children:[e.jsx("div",{className:"server-status-sprite",style:{width:"10px",height:"10px",borderRadius:"10px",backgroundColor:a?"lightgreen":"red"}}),e.jsxs("p",{children:["Server is ",a?"online":"offline"]})]})]})},fo=()=>{const{openCommandBar:t}=St();return e.jsxs("div",{className:"sidebar",children:[e.jsxs("nav",{children:[e.jsxs(st,{id:"nav-recent",to:"/home",children:[e.jsx(Mr,{}),"Recent"]}),e.jsxs(st,{to:"/playlists",children:[e.jsx(Ur,{}),"Playlists"]}),e.jsxs(st,{to:"/artists",children:[e.jsx(_r,{}),"Artists"]}),e.jsxs(st,{to:"/genres",children:[e.jsx(Br,{}),"Genres"]}),e.jsxs(st,{to:"/cooking",children:[e.jsx(ot,{}),"Cooking"]}),e.jsxs(st,{to:"/radio",children:[e.jsx(Gr,{}),"Radio"]})]}),e.jsx(ho,{}),e.jsxs("div",{className:"serach-button-div",onClick:t,style:{margin:"auto",marginBottom:"20px"},children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"SPACE"})}),e.jsx(Dr,{})]})]})},po=()=>{const t=me();return e.jsxs("div",{id:"mobile-shortcut",children:[e.jsx(Vr,{onClick:()=>{t("/home")}}),e.jsx(Vs,{onClick:()=>{t("/radio")}}),e.jsx(Me,{onClick:()=>{t("/search")}})]})},go=()=>{const t=me(),[s,o]=n.useState(!1),{currentDisplayedPage:u}=oe();if(n.useEffect(()=>{(async()=>{if((await(await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"})).json()).success){o(!1);return}t("/")})()},[t]),s)return e.jsx(Nt,{});const r=Je().pathname,a=["/home"];return e.jsxs("div",{className:"app-container",children:[e.jsx(Bt,{}),e.jsxs("div",{className:"content-container",ref:u,page:a.includes(r)?r:"inside",children:[e.jsx(fo,{}),e.jsxs("div",{className:"content",children:[e.jsx(Ps,{})," "]}),e.jsx(po,{})]})]})},is=({album:t,hideArtist:s=!1})=>{const o=me(),[u,l]=n.useState([]),r=a=>{o(`/albums/${a}`)};return n.useEffect(()=>{t.artists&&l(JSON.parse(t.artists).map(a=>a.name))},[t]),e.jsxs("div",{className:"album-card",onClick:()=>r(t.id),children:[t.cover?e.jsx("img",{src:`${N}/covers/${t.cover}`,alt:`${De(t.title,25)} cover`,className:"album-card-cover"}):e.jsx(se,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:De(t.title,40)}),!s&&e.jsx("p",{className:"album-artist",children:De(u.toString().replace(/,/g,", "),25)||"No artist"})]})},ls=()=>{const{emit:t}=xe(),s=()=>{t("openAddMusic")};return e.jsxs("div",{className:"add-music-shortcut",children:[e.jsx("h2",{children:"Welcome to the Crystal Music Library !"}),e.jsxs("button",{onClick:s,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"15px",margin:"auto"},children:[e.jsx(ns,{}),e.jsx("h3",{style:{margin:"2px"},children:"Add music"})]})]})},xo=({})=>{const[t,s]=n.useState([]),[o,u]=n.useState(!1),{subscribe:l}=xe(),r=()=>{fetch(`${N}/read-write/albums`,{method:"GET",credentials:"include"}).then(d=>{if(d.status!==200){console.error("Error fetching albums");return}return d.json()}).then(d=>{s(d),u(!0)})};n.useEffect(()=>{Ue(()=>{r()})();const m=l("musicUploaded",r);return()=>{m()}},[]);const a=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});return e.jsx("div",{className:"home album-displayer","data-no-tracks":(t==null?void 0:t.length)==0&&o?"true":"false",children:o?(t==null?void 0:t.length)!==0?t.map(d=>e.jsx(is,{album:d},d.id)):e.jsx(ls,{}):e.jsx(a,{})})},vo=()=>e.jsx("p",{children:" Your albums"}),Ce={FETCHING:"fetching",SUCCESS:"success",REJECTED:"rejected",NONE:"none"},jo=()=>{const t=n.useRef(Ce.NONE),[s,o]=n.useState(Ce.NONE),u=me(),{emit:l}=xe(),r=async m=>{if(m.preventDefault(),!m.target.email.value||!m.target.password.value){alert("Please fill in all fields");return}const h=new FormData(m.target),c=await fetch(`${N}/auth/login`,{method:"POST",credentials:"include",body:h}),p=await c.json();c.ok?(localStorage.setItem("username",p.username),t.current=Ce.SUCCESS):t.current=Ce.REJECTED,d()},a=()=>{switch(s){case Ce.FETCHING:return e.jsx(Qs,{});case Ce.SUCCESS:return e.jsxs("div",{className:"loginFeedback",sucess:"true",children:[e.jsx(ct,{className:"successIcon"}),e.jsx("span",{children:"Logged in"})]});case Ce.REJECTED:return e.jsxs("div",{className:"loginFeedback",sucess:"false",children:[e.jsx(je,{className:"failIcon"}),e.jsx("span",{children:"Wrong credentials"})]});default:return null}},d=()=>{switch(o(t.current),t.current){case Ce.REJECTED:setTimeout(()=>{o(Ce.NONE)},1e3);break;case Ce.SUCCESS:setTimeout(()=>{l("login"),u("/home")},1e3);break}};return e.jsxs("div",{className:"authDiv",children:[e.jsx(Mt,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(se,{}),e.jsx("h2",{children:"Login"}),e.jsx("p",{children:"We were not able to connect you, please login."}),e.jsxs("form",{onSubmit:r,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"password"}),e.jsx("button",{type:"submit",children:"Login "}),e.jsx("p",{children:"Don't have an account?"}),e.jsx("button",{onClick:()=>{u("/register")},children:"Register"})]}),e.jsx(a,{})]})},bo=[_e("#f8be99"),_e("#f495e9"),_e("#bbfbdf"),_e("#c4d3f8"),_e("#edc9f9"),_e("#909ef8"),_e("#96ebf4")],Lt=60,xt=_e("#242424"),rn=()=>{const[t,s]=n.useState([xt,xt]),o=n.useRef([]),u=n.useRef([xt,xt]),l=n.useRef(bo),r=n.useRef(0),a=n.useRef(0);n.useEffect(()=>(a.current=setInterval(m,1e3/Lt),()=>{clearInterval(a.current)}),[]);const d=()=>{const h=vt.sample(l.current);return l.current.filter(c=>c.join(",")!=h.join(",")),h},m=()=>{r.current%Lt===0&&(o.current[0]&&o.current[0]!==xt&&l.current.push(...o.current),o.current=u.current,u.current=[d(),d()]),s(o.current.map((h,c)=>u.current[c].map((p,f)=>parseInt(Qe(h[f],p,r.current%Lt/Lt))))),r.current+=1};return e.jsx("div",{id:"background-img",style:{"--col1":ks(...t[0]),"--col2":ks(...t[1])}})},rt=Object.freeze({LOGIN:"login",REGISTER:"register",ANY_USER:"any_user",VERIF_TOKEN:"verif_token"}),yo=()=>{const t=me(),[s,o]=n.useState([]),[u,l]=n.useState(null),[r,a]=n.useState(!0);return n.useRef(null),n.useEffect(()=>{(async()=>{l(rt.ANY_USER);const h=await(await fetch(`${N}/auth/any-user`,{method:"GET"})).json();if(console.log("Parsed users",h),o(h),console.log(h),h===0){a(!1),l(rt.REGISTER);return}l(rt.VERIF_TOKEN);const p=await(await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"})).json();if(a(!1),p.success){console.log("Token is valid"),t("/home");return}l(rt.LOGIN)})()},[t]),u===rt.REGISTER&&!r&&t("/register"),e.jsxs(e.Fragment,{children:[e.jsx(rn,{}),!r&&u===rt.LOGIN?e.jsx(jo,{}):null]})},an=({index:t,track:s,playIconId:o,isSalad:u=null,onClick:l,showCover:r=!1})=>{const{title:a,track_number:d,rawDuration:m}=s,{playingTrack:h,openTrackActions:c,toggleTrackFavorite:p}=oe(),f=s.id,[x,v]=n.useState("null"),[b,$]=n.useState(!1),[k,E]=n.useState(!1),M=()=>{if(u){u(t);return}l(s.id)},P=()=>{switch(o){case 0:return e.jsx(zr,{className:"track-number",playing:"piano","data-show-cover":r});case 1:return e.jsx(qr,{className:"track-number",playing:"vinyl","data-show-cover":r});case 2:return e.jsx(Vs,{className:"track-number",playing:"piano","data-show-cover":r});case"salad":return e.jsx(ot,{className:"track-number",playing:"piano","data-show-cover":r})}};n.useEffect(()=>{$(s.is_favorite===1),r&&fetch(`${N}/read-write/trackCover/${s.id}`,{method:"GET"}).then(U=>U.json()).then(U=>{v(`${N}/covers/${U}`)})},[]);const S=U=>{U.stopPropagation(),p(s.id,!b,$)},F=()=>{E(!1)},I=U=>{U.stopPropagation(),E(!0),c({x:U.clientX,y:U.clientY},s,F,T)},T=U=>{$(U)};return e.jsxs("div",{className:"track-view","action-bar":k?"open":"",onClick:M,children:[b&&e.jsx(_t,{className:"track-favorite"}),e.jsx(jt,{className:"track-toggle-favorite",iconHovered:b?Xt:Hr,iconDefault:b?Xt:$s,onClick:S}),r?x.split("/").pop()==="null"?null:e.jsx("img",{src:x,className:"track-mini-thumbnail"}):null,h===f?P():r?null:e.jsx("p",{className:"track-number",children:d}),e.jsx("p",{className:"track-name",style:{"--margin":r?"45px":"35px"},children:a}),e.jsx(ts,{className:"track-actions-dots",onClick:I}),e.jsx("p",{className:"track-length",children:as(m).readable})]})},As=({isPlaylist:t=!1})=>{const[s,o]=n.useState(null),[u,l]=n.useState([]),[r,a]=n.useState([]),[d,m]=n.useState([]),[h,c]=n.useState(0),{addContainerToQueue:p,playContainerSuffle:f,editAlbum:x,editPlaylist:v,linkNewContainer:b,getNextSongsFromAlbum:$,navigateBack:k}=oe(),E=n.useRef(null),M=me(),[P,S]=n.useState([]),F=t?$t().playlistId:$t().albumId,[I,T]=n.useState(null),U=n.useRef(null),{notifTypes:K,addNotification:B}=Fe(),[w,V]=n.useState(!1),[G,H]=n.useState(!1),[X,Y]=n.useState(!1);n.useEffect(()=>{ne()},[F,G]),n.useEffect(()=>{b({id:F,type:t?"playlist":"album",favPlaylist:w},ne)},[w]);const ne=()=>{fetch(`${N}/read-write/${t?"playlist":"album"}/${F}`,{method:"GET",credentials:"include"}).then(C=>{if(!C.ok)throw new Error("Network response was not ok");return C.json()}).then(C=>{c(Math.floor(Math.random()*3));const W=C.tracks.filter(O=>(!X&&O.is_favorite===1&&Y(!0),G?O.is_favorite===1:!0));if(t){o(C.playlistInfos),l(W),m([C.owner,...C.collaborators]),V(C.isFavPlaylist);return}o(C.albumInfos);let y=0;for(let O=0;O<W.length;O++){const _=W[O];_.disc>y&&(W.splice(O,0,{disc:_.disc,type:"disc"}),y=_.disc)}l(W),a(C.genres),m(C.artists),V(!1)})},ie=async()=>await p(F,t?"playlist":"album",G),pe=async()=>{f(F,t?"playlist":"album",G)},ue=()=>{if(t){v(F);return}x(F)},ge={TRACK:"track",ALBUM:"album",ARTIST:"artist",PLAYLIST:"playlist",GENRE:"genre"},ve=C=>{switch(C){case"track":return e.jsx(ns,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add album"})," ",e.jsx(kt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add artist's discography"})," ",e.jsx(Yr,{className:"action-bar-entry-tooltip-logo"})]});case"playlist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire playlist"})," ",e.jsx(Jr,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire genre"})," ",e.jsx(Qr,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},q=C=>{const W=C.target.value;if(W===""||W.trim().length===0){S([]);return}console.log(`${N}/read-write/search/${W}`),fetch(`${N}/read-write/search/${W}`,{method:"GET",credentials:"include"}).then(y=>{if(y.ok)return y.json();throw new Error("Error fetching search results")}).then(y=>{var _,D,te,de,be;const O=[...(_=y.tracks)==null?void 0:_.map(z=>({type:"track",...z})),...(D=y.albums)==null?void 0:D.map(z=>({type:"album",...z})),...(te=y.artists)==null?void 0:te.map(z=>({type:"artist",...z})),...(de=y.genres)==null?void 0:de.map(z=>({type:"genre",...z})),...(be=y.playlists)==null?void 0:be.map(z=>({type:"playlist",...z})).filter(({id:z})=>z!==F)].map(z=>{const ye=z.path,{trackPath:Xe,...Ve}=z;return{icon:()=>ye?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${z.type==="artist"?"artist":"covers"}/${ye}`,alt:z.name}):e.jsx(se,{className:"action-bar-entry-logo"}),tooltip:ve,code:z.type==="artist"?ge.ARTIST:z.type==="album"?ge.ALBUM:z.type==="genre"?ge.GENRE:z.type==="playlist"?ge.PLAYLIST:ge.TRACK,fileName:ye,...Ve}});console.log(O),S(O)})},L=C=>{I||setTimeout(()=>{requestAnimationFrame(()=>{var W;(W=U.current)==null||W.focus()})},0)},ee=C=>{const W=new FormData;W.append("addRequest",JSON.stringify({playlistId:F,endpoint:C.code,entryId:C.id,addAllToFavorite:w||!1})),fetch(`${N}/read-write/addToPlaylist`,{method:"POST",credentials:"include",body:W}).then(y=>y.json()).then(y=>{ne(),fe(),B("Added to playlist",K.INFO)})};n.useEffect(()=>{const C=W=>{E.current&&!E.current.contains(W.target)&&fe()};return document.addEventListener("mousedown",C),document.addEventListener("touchstart",C),()=>{document.removeEventListener("mousedown",C),document.removeEventListener("touchstart",C)}},[]);const fe=()=>{T(!1),U.current.value="",S([])},re=C=>{$(C,G)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:k,children:e.jsx(Ye,{})}),(s==null?void 0:s.cover)&&e.jsx("img",{src:`${N}/covers/${s.cover}`,className:"background-image",alt:"background"}),s&&u?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:s.title}),e.jsx("div",{className:"album-artists",children:d?d.map(C=>e.jsx("span",{className:"artist-name",onClick:()=>{M(`/${t?"users":"artists"}/${C.id}`)},children:C.name},C.id)):e.jsxs("span",{className:"artist-name",children:["Unknown ",t?"Members":"Artist"]})}),e.jsxs("div",{className:"album-content",children:[e.jsx("div",{className:"album-cover-genres",children:e.jsxs("div",{className:"album-cover-wrapper",children:[s.cover?e.jsx("img",{src:`${N}/covers/${s.cover}`,alt:`${s.title} cover`,className:"cover-image"}):e.jsx(se,{className:"cover-image"}),e.jsx("div",{className:"genres-album-div",children:r.map((C,W)=>e.jsx("span",{className:"genre-album",onClick:()=>{M(`/genres/${C.genreId}`)},children:C.genreName},W))}),s.description&&e.jsx("p",{children:s.description})]})}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(ae,{text:"Add to queue",icon:e.jsx(Ut,{}),onClick:ie}),e.jsx(ae,{text:"Random",icon:e.jsx(lt,{}),onClick:pe}),!w&&e.jsx("button",{className:"button-with-callback",onClick:ue,children:e.jsx(ss,{})}),!w&&X&&e.jsx("button",{className:"button-with-callback","data-is-active":G,onClick:()=>{H(!G)},children:e.jsx(Wr,{})}),s.lossless===1&&e.jsxs("div",{className:"lossless",children:[e.jsx("span",{children:"Lossless"})," ",e.jsx(Kr,{})]})]}),t&&e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:E,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",onClick:L,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Me,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:q,placeholder:"Search for tracks, artists, genres, playlists to add.",ref:U,onFocus:()=>{T(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${I?"block":"none"}`},children:e.jsx(Ie,{height:300,itemCount:P.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:C,style:W})=>e.jsx(ut,{entry:P[C],style:{...W,width:" calc(100% - 20px)",marginTop:"10px"},onClick:ee},C)})})]})}),u.map((C,W)=>(C==null?void 0:C.type)==="disc"?e.jsx("span",{children:`Disc ${C.disc}`},`disc-${W}`):e.jsx(an,{track:C,onClick:re,playIconId:h,showCover:t},C.id))]})]})]}):e.jsx(Nt,{text:"Loading album"})]})},No=({artist:t})=>{const s=me(),o=u=>{s(`/artists/${u}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>o(t.id),children:[t.picture?e.jsx("img",{src:`${N}/covers/artists/${t.picture}`,alt:`${t.name} cover`,className:"artist-card-cover"}):e.jsx(se,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},ko=()=>{const[t,s]=n.useState([]),{subscribe:o}=xe(),u=()=>{fetch(`${N}/read-write/artists`,{method:"GET",credentials:"include"}).then(l=>{if(l.status!==200){console.error("Error fetching artists");return}return l.json()}).then(l=>{s(l)})};return n.useEffect(()=>{Ue(()=>{u()})();const r=o("musicUploaded",u);return()=>{r()}},[]),e.jsx("div",{className:`home ${(t==null?void 0:t.length)!==0?"album-displayer":""}`,children:(t==null?void 0:t.length)!==0?t.map(l=>e.jsx(No,{artist:l},l.id)):e.jsx(ls,{})})},So=()=>{const[t,s]=n.useState(null),[o,u]=n.useState([]),{addArtistToQueue:l,shuffleArtistToQueue:r,editArtist:a,linkNewContainer:d,navigateBack:m}=oe(),h=$t().artistId;n.useEffect(()=>{c(),d({id:h,type:"artist"},c)},[h]);const c=()=>{fetch(`${N}/read-write/artist/${h}`,{method:"GET",credentials:"include"}).then(x=>{if(!x.ok)throw new Error("Network response was not ok");return x.json()}).then(x=>{s(x.artistInfos),u(x.albums),console.log(x.artistInfos)})},p=async()=>await l(h),f=async()=>{r(h,!1)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:m,children:e.jsx(Ye,{})}),t&&o?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"album-content",children:[t.picture?e.jsx("img",{src:`${N}/covers/artists/${t.picture}`,alt:`${t.name} cover`,className:"cover-image"}):e.jsx(se,{className:"cover-image"}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(ae,{text:"Add to queue",icon:e.jsx(Ut,{}),onClick:p}),e.jsx(ae,{text:"Random",icon:e.jsx(lt,{}),onClick:f}),e.jsx(ae,{icon:e.jsx(ss,{}),onClick:async()=>{a(t.id)}})]}),e.jsx("div",{className:"album-displayer",children:o.map(x=>e.jsx(is,{album:x,hideArtist:!0},x.id))})]})]})]}):e.jsx(Nt,{text:"Loading artist"})]})},To=()=>{const t=me(),s=()=>{t("/home")};return e.jsxs("div",{className:"not-found",children:[e.jsx("h1",{children:"Where did you land..?"}),e.jsx("p",{children:"The adress you gave is not defined, but you can go back to library:"}),e.jsx("button",{className:"btn",onClick:s,children:"Go back to library"})]})},wo=()=>{const[t,s]=n.useState("");n.useEffect(()=>{s(localStorage.getItem("username"))},[]);const o=me();return e.jsxs("div",{className:"account-page",children:[e.jsx(Bt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Ye,{})}),e.jsxs("div",{className:"account-container",children:[e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:t}),e.jsx("p",{children:"Account information will be displayed here."})]}),e.jsx(se,{})]})]})]})},Eo=({active:t,setActive:s})=>e.jsx("div",{className:"toggle-button","data-is-active":t,onClick:o=>{o.stopPropagation(),s(!t)},children:e.jsx("div",{className:"toggle-button-active","data-is-active":t})}),Ge=({stateChanged:t,min:s=0,max:o=0,ref:u})=>{const l=s===o&&o===0,r=d=>{const m=d.target.value;t(m)},a=d=>{console.log("blur");let m=parseFloat(d.target.value);isNaN(m)&&(m=s),l||(m=Math.min(o,Math.max(s,m))),d.target.value=m,t(m)};return l?e.jsx("input",{ref:u,type:"number",onBlur:a,onChange:r}):e.jsx("input",{min:s,ref:u,max:o,type:"number",onBlur:a,onChange:r})},Ro=()=>{var v;const t=n.useRef(null),s=n.useRef(null),o=n.useRef(null),u=n.useRef(null),l=n.useRef(null),{FFTUserSetingsRef:r,fftConfigRef:a}=oe(),d=b=>{r.current.bars=Math.floor(b),f()},m=b=>{r.current.cutoff=parseFloat(b),f()},h=b=>{r.current.scale=parseFloat(b),f()},c=b=>{r.current.contrast=parseFloat(b),f()},p=b=>{r.current.FPS=parseFloat(b),f()},f=()=>{const b=new FormData;b.append("FFT",JSON.stringify(r.current)),fetch(`${N}/config/user/send/FFT`,{method:"POST",credentials:"include",body:b})},x=async()=>{await fetch(`${N}/config/user/FFT`,{method:"GET",credentials:"include"}).then(b=>b.json()).then(b=>{r.current=b,t.current.value=r.current.bars,u.current.value=r.current.contrast,s.current.value=r.current.scale,l.current.value=r.current.cutoff,o.current.value=r.current.FPS})};return n.useEffect(()=>{x()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Number of bars"}),e.jsx(Ge,{ref:t,stateChanged:d,min:1,max:(v=a.current)==null?void 0:v.fftSize})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"FPS (High number may cause strong battery usage)"}),e.jsx(Ge,{ref:o,stateChanged:p})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Scale"}),e.jsx(Ge,{ref:s,stateChanged:h})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Contrast"}),e.jsx(Ge,{ref:u,stateChanged:c})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Cutoff"}),e.jsx(Ge,{ref:l,stateChanged:m})]})]})},Co={FFT:Ro},Ao=({entryName:t,entryIcon:s,linkedSettingKey:o})=>{const[u,l]=n.useState(!1),r=n.useMemo(()=>Co[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":u,onClick:a=>{a.stopPropagation(),l(!u)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:r&&u&&e.jsx(r,{})})]})},Io=()=>{const[t,s]=n.useState(!1);n.useEffect(()=>{Ue(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(l=>l.json()).then(l=>{s(l)})})()},[]);const o=me();return e.jsxs("div",{className:"account-page",children:[e.jsx(Bt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Ye,{})}),e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:"Settings page"}),e.jsx("p",{children:"A shinny list of fancy settings."}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Ao,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Hs,{})})})]})]})]})},Fo=({user:t,totalStorage:s})=>{const[o,u]=n.useState(0);return n.useEffect(()=>{fetch(`${N}/read-write/user-data-usage/${t.id}`,{method:"GET",credentials:"include"}).then(l=>l.json()).then(l=>{u(l)}).catch(l=>{console.error("Error fetching user storage data: ",l)})},[]),e.jsxs("div",{className:"user-account-infos-entry",children:[e.jsx("p",{children:t.username}),e.jsx("p",{children:t.email}),e.jsx("p",{children:t.role}),e.jsx(dt,{percent:Number(o/s*100).toFixed(2),fillColor:"var(--cool-green)",showPercent:!0,style:{maxWidth:"200px"}})]})},Ke={PENDING:"pending",RUNNING:"running",PAUSED:"paused",INACTIVE:"inactive"},Is=({jobName:t,description:s,jobKey:o,payload:u={},doneTotalView:l=null})=>{const[r,a]=n.useState(!1),[d,m]=n.useState(!0),[h,c]=n.useState(0),[p,f]=n.useState(!1),[x,v]=n.useState(null),b=n.useRef(null),$=(T=!0,U="",K=0)=>{var B=T;fetch(`${N}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{f(!1);let V=1e3;switch(w.status){case Ke.PENDING:f(!0),a(!0),m(!1),V=500;break;case Ke.INACTIVE:if(U===Ke.RUNNING||U===Ke.PENDING){setTimeout(()=>{a(!1),c(0),v(null),$(!1,w.status)},2e3),c(100),v({done:K,total:K,working:0}),B=!1,console.log("Stop fast fetch job");return}a(!1);break;case Ke.PAUSED:m(!0),a(!0),V=500;break;case Ke.RUNNING:m(!1),a(!0),V=10;break}b.current&&(clearTimeout(b.current),b.current=null),B&&(b.current=setTimeout(()=>{var G;if(w.progress){const H=w.progress.done/w.progress.total*100;c(H),v(w.progress)}else v(null);$(!0,w.status,((G=w.progress)==null?void 0:G.total)??0)},V))})},k=()=>{fetch(`${N}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{$(T.status===Ke.RUNNING)})},E=()=>{const T=new FormData;T.append("payload",JSON.stringify(u)),fetch(`${N}/jobs/run/${o}`,{method:"POST",credentials:"include",body:T}).then(U=>U.json()).then(U=>{$(!0)})},M=()=>{fetch(`${N}/jobs/pause/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{$(!1)})},P=()=>{fetch(`${N}/jobs/resume/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{$(!0)})},S=()=>{fetch(`${N}/jobs/stop/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{$(!1)})};n.useEffect(()=>(k(),()=>{b.current&&(console.log("Trying clearTimout"),clearTimeout(b.current),b.current=null)}),[]);const F=async()=>{if(r){d?P():M(),m(!d);return}E()},I=async()=>{S(),c(0)};return e.jsxs("div",{className:"backend-job",children:[e.jsx("h3",{children:t}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"baseline",flexWrap:"wrap"},children:[e.jsx(ae,{text:r?d?"Resume":"Pause":"Run",icon:r?d?e.jsx(Xr,{}):e.jsx(Zr,{}):e.jsx(ea,{}),onClick:F}),e.jsx(ae,{text:"Stop",icon:e.jsx(ta,{}),onClick:I}),e.jsx(dt,{style:{height:"25px",filter:`grayscale(${d&&r?.8:0})`},minWidth:"200px",percent:h,showPercent:!1,text:x?l.current?`${x.done}/${x.total}`:`Working: ${x.working} | Left : ${x.total-x.done}`:null,fillColor:"linear-gradient(90deg, rgb(187, 251, 223) 0%, rgb(198, 203, 253) 50%, rgb(239, 201, 249) 100%)",initialising:p,initialisingColor:"violet"})]}),e.jsx("p",{children:s}),e.jsx("div",{className:"job-status","data-running":d?"false":"true","data-status":r?p?"init":d?"stop":"run":"inactive",children:e.jsx("span",{children:r?p?"Initlialising":d?"Paused":"Running":"Inactive"})})]})},Po=()=>{const t=n.useRef(null),s=n.useRef(null),o=n.useRef(null),u=n.useRef(null),[l,r]=n.useState(!1),a=p=>{t.current.samples=Math.floor(p),h()},d=p=>{t.current.samplingInterval=1/Math.floor(p),h()},m=p=>{t.current.parallelCompute=Math.floor(p),h()},h=()=>{const p=new FormData;p.append("FFT",JSON.stringify(t.current)),fetch(`${N}/config/send/FFT`,{method:"POST",credentials:"include",body:p})},c=async()=>{await fetch(`${N}/config/FFT`,{method:"GET",credentials:"include"}).then(p=>p.json()).then(p=>{t.current=p}),r(t.current.useServerFFT),o.current.value=t.current.samples,s.current.value=Math.floor(1/t.current.samplingInterval),u.current.value=t.current.parallelCompute};return n.useEffect(()=>{c()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line",children:[e.jsx("span",{children:"Activate audio spectra computation"}),e.jsx(Eo,{defaultValue:t.current,active:l,setActive:p=>{r(p),t.current&&(t.current.useServerFFT=p,h())}})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame definiton (power of 2)"}),e.jsx(Ge,{ref:o,stateChanged:a,max:4096,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame per second"}),e.jsx(Ge,{ref:s,stateChanged:d,max:120,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Number of parallel analyzed songs"}),e.jsx(Ge,{ref:u,stateChanged:m,max:10,min:1})]})]})},Lo={FFT:Po},$o=({entryName:t,entryIcon:s,linkedSettingKey:o})=>{const[u,l]=n.useState(!1),r=n.useMemo(()=>Lo[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":u,onClick:a=>{a.stopPropagation(),l(!u)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:r&&u&&e.jsx(r,{})})]})},Oo=()=>{const t=()=>localStorage.getItem("job-progress-view")?localStorage.getItem("job-progress-view")==="true":!0,[s,o]=n.useState(!1),[u,l]=n.useState([]),[r,a]=n.useState(0),d=n.useRef(t()),m=me();n.useEffect(()=>{Ue(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{o(x)})})()},[]),n.useEffect(()=>{s.error||fetch(`${N}/auth/init-admin-pannel`,{method:"POST",credentials:"include"}).then(f=>f.json()).then(f=>{l(f.users),a(f.totalStorage)})},[s]);const h=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You are not an admin."})]}),c=f=>{const x=f===0;d.current=x,localStorage.setItem("job-progress-view",x)},p=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Admin pannel"}),e.jsx("p",{children:"Only for the true admins."}),e.jsxs("div",{className:"admin-category",children:[e.jsx(sa,{}),e.jsx("h2",{children:"Users' storage usage"})]}),e.jsx("div",{className:"all-users-list",children:u.map(f=>e.jsx(Fo,{user:f,totalStorage:r},f.id))}),e.jsxs("div",{className:"admin-category",children:[e.jsx(na,{}),e.jsx("h2",{children:"Backend processes"}),e.jsx(en,{data:["Done/Total","Working/Remaining"],currentActive:t()?0:1,onClick:c})]}),e.jsxs("div",{className:"job-grid",children:[e.jsx(Is,{jobKey:"JOB_CD",jobName:"Recompute tracks number and CDs",description:"Reextract the metadatas of the songs to remap them to the correct CD or track number. Analyses lossless.",doneTotalView:d}),e.jsx(Is,{jobKey:"JOB_FFT",jobName:"Compute audio spectras",description:"Runs a fast Fourier transform on each audio files to extract the audio spectrum. The result is writen into .bin files. For a .flac audio of 41kHz, we expect 3Mb spectrum file.",payload:{completeLibrary:!0},doneTotalView:d})]}),e.jsxs("div",{className:"admin-category",children:[e.jsx(ra,{}),e.jsx("h2",{children:"Configuration"})]}),e.jsx("div",{className:"admin-settings-list",children:e.jsx($o,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Hs,{})})})]});return e.jsxs("div",{className:"account-page",children:[e.jsx(Bt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>m("/home"),children:e.jsx(Ye,{})}),e.jsx("div",{className:"account-info",children:s?e.jsx(p,{}):e.jsx(h,{})})]})]})},Mo=()=>{const[t,s]=n.useState(!0),o=me(),u=async r=>{if(r.preventDefault(),!r.target.email.value||!r.target.password.value||!r.target.repeat_password.value||!r.target.name.value){alert("Please fill in all fields");return}if(r.target.password.value!==r.target.repeat_password.value){alert("Passwords do not match");return}const a=new FormData(r.target),d=await fetch(`${N}/auth/register`,{method:"POST",credentials:"include",body:a}),m=await d.json();d.ok?(alert("User registered successfully"),o("/home")):alert(m.error)};n.useEffect(()=>{fetch(`${N}/auth/any-user`,{method:"GET"}).then(r=>r.json()).then(r=>{s(r===0)})},[]);const l=()=>e.jsxs("div",{style:{marginBottom:"30px",display:"flex",flexDirection:"row",alignItems:"center",margin:"auto",gap:"20px"},children:[e.jsx("p",{style:{textWrap:"nowrap"},children:"Already an account?"}),e.jsx("button",{style:{width:"100%"},onClick:r=>{r.stopPropagation(),o("/")},children:"Login"})]});return e.jsxs("div",{className:"authDiv",children:[e.jsx(Mt,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(rn,{}),e.jsx(se,{}),e.jsx("h2",{children:"Register"}),e.jsx("p",{children:t?`Welcome to the Crystal Music Library! Since you are the first 
            to show up here, we would like you to create the admin account.`:"Please fill the form to register as a new user."}),!t&&e.jsx(l,{}),e.jsxs("form",{onSubmit:u,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"new-password"}),e.jsx("label",{htmlFor:"repeat_password",children:"Confirm Password"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",name:"repeat_password",autoComplete:"password"}),e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",autoComplete:"name"}),e.jsx("button",{type:"submit",children:"Register"})]})]})},Uo=()=>{const[t,s]=n.useState(null),{genreId:o}=$t(),{addContainerToQueue:u,playContainerSuffle:l,playContainer:r,navigateBack:a}=oe();n.useEffect(()=>{fetch(`${N}/read-write/genre/${o}`,{method:"GET",credentials:"include"}).then(c=>{if(!c.ok)throw new Error("Network response was not ok");return c.json()}).then(c=>{s(c),console.log(c)})},[]);const d=async()=>{r(o,"genre")},m=async()=>{u(o,"genre")},h=async()=>{l(o,"genre")};return e.jsxs("div",{className:"genre-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:a,children:e.jsx(Ye,{})}),t?e.jsxs("div",{className:"genre-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(ae,{text:"Play",icon:e.jsx(es,{}),onClick:d}),e.jsx(ae,{text:"Random",icon:e.jsx(lt,{}),onClick:h}),e.jsx(ae,{text:"Add to queue",icon:e.jsx(Ut,{}),onClick:m})]}),e.jsx("div",{className:"genre-albums album-displayer",children:t.albums.map(c=>e.jsx(is,{album:c},c.id))})]}):e.jsx("p",{children:"Loading..."})]})},_o=({genre:t})=>{const s=me(),[o,u]=n.useState([]),[l,r]=n.useState([]),a=n.useRef([]),d=n.useRef(l),m=n.useRef([]),h=f=>{var v;if(console.log("changed on",f),!((v=d.current)!=null&&v.length)==0)return;const x=document.getElementById(`genre-${t.id}-img-${f}`);x==null||x.setAttribute("data-hidden","true"),setTimeout(()=>{x&&(x.src=`${N}/covers/${d==null?void 0:d.current[f]}`),x==null||x.removeAttribute("data-hidden")},500)};n.useEffect(()=>(c(u),p(),[2e3,2500,3e3].forEach((x,v)=>{setTimeout(()=>h(v),x);const b=setInterval(()=>h(v),7e3);m.current.push(b)}),()=>{a.current.forEach(clearTimeout),a.current=[],m.current.forEach(clearInterval),m.current=[],d.current=[]}),[]);const c=f=>{fetch(`${N}/read-write/trackCoversGenre/${t.id}`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{f(x)})};n.useEffect(()=>{d.current=l},[l]);const p=()=>{c(r),setTimeout(p,5500)};return e.jsxs("div",{className:`genre-card ${t==null?void 0:t.puredName}`,onClick:()=>{s(`/genres/${t.id}`)},children:[e.jsx("div",{className:"card-pivot-origin",children:o.map((f,x)=>e.jsx("div",{className:"img-pivot",style:{"--start-delay":`${3*(2-x)}`,"--start-angle":`${2-x}`,"--speed":"0.7","--scale":.4},children:e.jsx("img",{id:`genre-${t.id}-img-${x}`,className:"genre-img-cover",style:{"--scale":.7},src:`${N}/covers/${f}`})},x))}),e.jsx("div",{className:"genre-name",children:e.jsx("p",{children:t.name})})]})},Bo=[{name:"rock"},{name:"hiphop"},{name:"jazz"},{name:"edm"},{name:"house"},{name:"techno"},{name:"trance"},{name:"dubstep"},{name:"reggae"},{name:"ska"},{name:"country"},{name:"folk"},{name:"acoustic"},{name:"singer"},{name:"songwriter"},{name:"latin"},{name:"salsa"},{name:"reggaeton"},{name:"afrobeat"},{name:"jpop"},{name:"jpop"},{name:"lofi"},{name:"electronic"},{name:"indie"},{name:"alternative"},{name:"punk"},{name:"metal"},{name:"opera"},{name:"classical"},{name:"funk"},{name:"blues"},{name:"soul"},{name:"rnb"},{name:"chillhop"},{name:"ambiant"},{name:"soundtrack"},{name:"art-rock"},{name:"pop-rock"},{name:"breakcore"},{name:"worldwide"},{name:"rnb-soul"},{name:"hard-rock"},{name:"shoegaze"},{name:"indie-rock"},{name:"traditional"},{name:"anime"},{name:"pop"}],Go=new qs(Bo,{keys:["name"],threshold:.4}),Do=t=>{const s=t.replace(/[^a-zA-Z ]/g," "),o=Go.search(s);return"genre-"+(o.length>0?o[0].item.name:"default")},Vo=({})=>{var a,d;const{subscribe:t}=xe(),[s,o]=n.useState([]),[u,l]=n.useState(()=>{const m=localStorage.getItem("CML_FinishedTutorials");return m&&JSON.parse(m).state[we.GENRES]||!1}),r=()=>{fetch(`${N}/read-write/genres`,{method:"GET",credentials:"include"}).then(m=>m.json()).then(m=>{m.genres=m.genres.map(h=>({...h,puredName:Do(h.name)})),o(m)})};return n.useEffect(()=>{const m=t(`safe-finished-tutorial-${we.GENRES}`,()=>{l(!0)}),h=t("musicUploaded",r);return Ue(()=>{r()})(),()=>{h(),m()}},[]),e.jsx(e.Fragment,{children:((a=s==null?void 0:s.genres)==null?void 0:a.length)!==0?e.jsx("div",{className:"home genre-displayer",children:(d=s==null?void 0:s.genres)==null?void 0:d.map(m=>e.jsx(_o,{genre:m},m.id))}):(s==null?void 0:s.trackNum)>0?u?e.jsxs("div",{className:"info-line",id:"text-no-genre",children:[e.jsx("span",{children:"No genres found in the library."}),e.jsx(Zt,{className:"info-button",onClick:()=>{l(!1)}})]}):e.jsx(sn,{tutorialKey:we.GENRES}):e.jsx(ls,{})})},Ho=({playlist:t})=>{const s=me(),o=u=>{s(`/playlists/${u}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>o(t.id),children:[t.cover?e.jsx("img",{src:`${N}/covers/${t.cover}`,alt:`${t.name} cover`,className:"artist-card-cover"}):e.jsx(se,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},qo=()=>{const[t,s]=n.useState([]),{createNewPlaylist:o,setPlaylistAddedCallback:u}=oe(),l=()=>{fetch(`${N}/read-write/playlists`,{method:"GET",credentials:"include"}).then(r=>r.json()).then(r=>s(r))};return n.useEffect(()=>{Ue(()=>{l(),u(l)})()},[]),e.jsxs("div",{children:[e.jsx(ae,{className:"buttonRound",id:"new-playlist",onClick:o,icon:e.jsx(aa,{}),text:"Create a new playlist"}),e.jsx("div",{className:"album-displayer",children:t.map(r=>e.jsx(Ho,{playlist:r},r.id))})]})},zo=()=>{const t=n.useRef(null),s=n.useRef(null),[o,u]=n.useState(!1),[l,r]=n.useState([]),{playAudioSalad:a,setSaladContext:d,saladContext:m,openTagWindow:h}=oe(),[c,p]=n.useState([]),[f,x]=n.useState([]),{addNotification:v,notifTypes:b}=Fe(),[$,k]=n.useState([]),[E,M]=n.useState(!1),[P,S]=n.useState(!1),F=n.useRef(null),I=n.useRef(null),[T,U]=n.useState("#aabbcc"),[K,B]=n.useState(!0),{subscribe:w}=xe(),[V,G]=n.useState(()=>{const q=localStorage.getItem("CML_FinishedTutorials");return q&&JSON.parse(q).state[we.COOKING]||!1});n.useEffect(()=>{const q=re=>{t.current&&!t.current.contains(re.target)&&X()},L=()=>{G(!0)};let ee=w(`safe-finished-tutorial-${we.COOKING}`,L);return Ue(()=>{c.length===0&&p(m||[]),fetch(`${N}/read-write/mostUsedTags`,{method:"GET",credentials:"include"}).then(re=>re.json()).then(re=>{const C=re.map(W=>({...W,type:W.total,typeElem:"tag",icon:()=>e.jsx(bt,{color:W.color}),tooltip:y=>e.jsx("span",{children:y})}));x(C),r(C)}),document.addEventListener("mousedown",q),document.addEventListener("touchstart",q)})(),()=>{ee(),document.removeEventListener("mousedown",q),document.removeEventListener("touchstart",q)}},[]);const H=q=>{const L=q.target.value;if(L===""||L.trim().length===0){r(f);return}fetch(`${N}/read-write/search/${L}/tags,salads`,{method:"GET",credentials:"include"}).then(ee=>{if(ee.ok)return ee.json();throw new Error("Error fetching search results")}).then(ee=>{var re,C;const fe=[...(re=ee.tags)==null?void 0:re.map(W=>({...W,typeElem:"tag",icon:()=>e.jsx(bt,{color:W.color})})),...(C=ee.salads)==null?void 0:C.map(W=>({...W,typeElem:"salad",icon:()=>e.jsx(ot,{color:W.color})}))];console.log(fe),r(fe)})},X=()=>{u(!1)},Y=q=>{p(L=>L.filter(ee=>ee.id!==q))},ne=q=>{X(),console.log(q),!c.find(L=>L.id===q.id)&&p(L=>[...L,q])},ie=async()=>{a($.map(q=>q.id)),d(c)};n.useEffect(()=>{if(d(c),c.length===0){k([]),B(!0);return}B(c.findIndex(L=>L.typeElem==="salad")===-1);const q=new FormData;q.append("tags",JSON.stringify(c.filter(L=>L.typeElem==="tag").map(L=>L.id))),q.append("salads",JSON.stringify(c.filter(L=>L.typeElem==="salad").map(L=>L.id))),fetch(`${N}/read-write/getSalad`,{method:"POST",body:q}).then(L=>L.json()).then(L=>JSON.parse(L)).then(L=>{k(vt.shuffle(L)),console.log("New tracks received",L),L.length>0?v("Salad received! Enjoy..",b.SALAD):v("This salad is empty.. No tracks found.",b.SALAD)})},[c]);const pe=async()=>{c.length!==0&&(M(!0),U(`${Ws(Math.random().toFixed(4)*360,100,70.8)}`))},ue=()=>{if(!I.current.value||(M(!1),c.find(L=>L.typeElem==="salad")))return;const q=new FormData;q.append("salad",JSON.stringify({name:I.current.value,color:T,tags:c.map(L=>L.id)})),fetch(`${N}/read-write/newSalad`,{method:"POST",credentials:"include",body:q}).then(L=>L.json()).then(L=>{v("Salad saved!",b.SUCCESS),p([L])})},ge=q=>{a($.map(L=>L.id),q)},ve=()=>{u(!0),s.current.value};return e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"info-button",id:"cooking-info",onClick:()=>{G(!1)}}),V?e.jsxs("div",{className:"cooking-div",children:[e.jsx("h2",{children:"Here select some tags and play the music!"}),e.jsxs("div",{className:"cooking-header",children:[e.jsx("div",{className:"action-bar",style:{margin:"auto"},ref:t,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",style:{zIndex:"2"},children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Me,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:H,placeholder:"Search some tags or salads..",ref:s,onFocus:ve}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Ie,{height:300,itemCount:l.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:q,style:L})=>e.jsx(ut,{entry:l[q],style:{...L,width:" calc(100% - 20px)",marginTop:"10px"},onClick:ne},q)})})]})}),e.jsx("button",{className:"open-tags-edit",onClick:h,children:e.jsx(oa,{})})]}),e.jsxs("div",{className:"cooking-selection",children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(ae,{text:"Play salad",icon:e.jsx(ca,{}),onClick:ie}),K&&e.jsx(ae,{text:"Save salad",icon:e.jsx(ia,{}),onClick:pe})]}),e.jsx("div",{className:"cooking-tags",style:{marginBottom:"30px"},children:c.map(q=>e.jsxs("div",{className:"small-tag","data-prefix":q.typeElem==="salad",style:{backgroundColor:q.color},children:[q.typeElem==="salad"&&e.jsx(ot,{"data-prefix":"true"}),e.jsx("span",{children:q.name}),e.jsx(je,{onClick:()=>{Y(q.id)}})]},q.id))}),e.jsx("div",{className:"track-list",children:$.map((q,L)=>e.jsx(an,{index:L,isSalad:ge,track:q,playIconId:"salad",showCover:!0},q.id))})]}),E?e.jsxs("div",{className:"edit-tag",style:{left:"calc(50% - 170px)",margin:"auto"},children:[e.jsx(je,{style:{cursor:"pointer"},onClick:()=>{M(!1)}}),e.jsx("input",{type:"text",placeholder:"Name your new salad.",ref:I}),e.jsx(la,{style:{cursor:"pointer"},id:"color-button",color:T,onClick:()=>{S(!P)}}),P&&e.jsxs("div",{ref:F,className:"edit-tag-picker",children:[" ",e.jsx(rs,{color:T,onChange:U})]}),e.jsx(ct,{onClick:ue,style:{cursor:"pointer"}})]}):null]}):e.jsx(sn,{tutorialKey:we.COOKING})]})},Fs=({radio:t})=>{const{playRadio:s,externalRadioInfos:o}=oe();return e.jsxs("div",{className:"album-card",onClick:()=>{t.id?o.current=null:o.current=t,s(t.id?`radio-id:${t.id}`:`radio-url:${t.url}`)},children:[t.coverUrl?e.jsx("img",{src:`${N}/radio/favicon-proxy?url=${encodeURIComponent(t.coverUrl)}`,alt:`${De(t.name,25)} cover`,className:"album-card-cover"}):e.jsx(se,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:De(t.name,40)})]})},Wo=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]}),Ko=()=>{const[t,s]=n.useState(!1),[o,u]=n.useState([]),[l,r]=n.useState([]),{subscribe:a}=xe(),{addNotification:d,notifTypes:m}=Fe();n.useEffect(()=>{const x=a("refetch-known-radios",h);return Ue(()=>{h()})(),()=>{x()}},[]);const h=async()=>{const x=await fetch(`${N}/radio/radios`,{method:"GET",credentials:"include"}).then(b=>b.json());s(!0);const v=(x==null?void 0:x.length)>0?x.map(b=>({...b,uuid:b.id})):[];u(v)},c=async()=>{d("Comming soon! :)",m.INFO)},p=async()=>{const v=(await fetch(`${N}/radio/stations`).then(b=>b.json()).then(b=>JSON.parse(b))).map(b=>({coverUrl:b.favicon,name:b.name,url:b.url_resolved,uuid:b.stationuuid}));r(v)},f=async()=>{window.open("https://www.radio-browser.info/tags","_blank").focus()};return e.jsxs("div",{className:"home",id:"radio-page",children:[e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(_t,{}),e.jsx("h3",{children:"Favorite radios"})]}),e.jsx("div",{className:"album-displayer",id:"fav-radios","data-flat":"true","data-no-tracks":(o==null?void 0:o.length)==0&&t?"true":"false",children:t?(o==null?void 0:o.length)>0?o.map(x=>e.jsx(Fs,{radio:x},x.id)):null:e.jsx(Wo,{})}),e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(ua,{}),e.jsx("h3",{style:{marginRight:"20px"},children:"Discover"})]}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(ae,{text:"Filters",icon:e.jsx(da,{}),onClick:c}),e.jsx(ae,{text:"Random",icon:e.jsx(lt,{}),onClick:p}),e.jsx(ae,{text:"External search",icon:e.jsx(ma,{}),onClick:f})]}),e.jsx("div",{className:"album-displayer",children:(l==null?void 0:l.length)!==0?l.map((x,v)=>e.jsx(Fs,{radio:x},v)):null})]})},Qo=()=>{const t=n.useRef(),s=n.useRef(null),{getFFTAtCurrentTime:o,fftConfigRef:u,globalAudioRef:l,FFTUserSetingsRef:r,fetchFFTUserSettings:a,colorOverride:d,currentTrackData:m}=oe(),h=n.useRef(0),c=p=>{var x,v;if((m==null?void 0:m.type)=="radio"){cancelAnimationFrame(t.current);return}if(!s.current){t.current=requestAnimationFrame(c);return}const f=s.current.getContext("2d");if(f&&r.current&&d.current){if(p-h.current<1e3/r.current.FPS){t.current=requestAnimationFrame(c);return}h.current=p;const b=r.current.bars;f.clearRect(0,0,s.current.width,s.current.height);const $=o();if(!$){t.current=requestAnimationFrame(c);return}u.current.sampleRate/$.length;const k=Math.max(1,$.length/b),E=new Array(b);E.fill(0);for(let S=0;S<$.length;S++)E[Math.floor(S/k)]+=Number($[S]);let M=s.current.width/b-1,P=0;for(let S=0;S<E.length;S++){const F=r.current.scale*Math.log2(E[S])*(b/5)*((x=l.current)==null?void 0:x.volume);if(((v=d.current)==null?void 0:v.length)>0){const I=Math.min(1,Math.max(0,F/r.current.scale/r.current.contrast/300));f.fillStyle=`rgb(
						${Qe(d.current[0][0],d.current[1][0],I)} 
						${Qe(d.current[0][1],d.current[1][1],I)}
						${Qe(d.current[0][2],d.current[1][2],I)}
						)`}else f.fillStyle=`rgb(${F/r.current.scale/r.current.contrast} 137 255)`;f.fillRect(P,s.current.height-F,M,F),P+=M+1}}t.current=requestAnimationFrame(c)};return n.useEffect(()=>{if(!u.current){cancelAnimationFrame(t.current),console.log("No FFT data to display, releasing anim frame.");return}t.current=requestAnimationFrame(c),console.log("FFT found, requested animation frame.")},[u.current]),n.useEffect(()=>(t.current=requestAnimationFrame(c),()=>{cancelAnimationFrame(t.current)}),[]),e.jsx("canvas",{ref:s,id:"fft-canvas",width:1900,height:1e3})},Jo=()=>{const{playingTrack:t}=oe();return e.jsxs("div",{className:"content-with-fft",children:[e.jsx(Ps,{})," ",t?e.jsx(Qo,{}):null]})},Yo=()=>{const{fullScreenImage:t,currentTrackData:s,requestNewFullScreenImage:o,playingTrack:u,toggleFullScreenView:l,colorOverride:r,recomputeColors:a,songPalette:d}=oe(),m=n.useRef(null),h=n.useRef(null),c=n.useRef(null),p=n.useRef(null),f=n.useRef(null),x=n.useRef(!1),v=n.useRef(0),b=3,$=n.useRef(0),[k,E]=n.useState(!1);n.useRef([]);const M=n.useRef(0),P=n.useRef(0),S=n.useRef(0),F=w=>{x.current?(m.current.src=URL.createObjectURL(w),h.current.src=URL.createObjectURL(w),f.current=m.current):(c.current.src=URL.createObjectURL(w),p.current.src=URL.createObjectURL(w),f.current=c.current),f.current.addEventListener("load",U)};n.useEffect(()=>{if(m.current&&h.current){if((s==null?void 0:s.type)=="radio"){if(s.coverUrl){const w=`${N}/radio/favicon-proxy?url=${encodeURIComponent(s.coverUrl)}`;x.current?(m.current.src=w,h.current.src=w,f.current=m.current):(c.current.src=w,p.current.src=w,f.current=c.current)}return}u&&((t==null?void 0:t.track)!==u?(x.current=!x.current,o().then(w=>{F(w.blob)})):F(t.blob))}},[s,u]);const I=(w,V)=>{w?(m.current.setAttribute("data-hidden",V),h.current.setAttribute("data-hidden",V)):(c.current.setAttribute("data-hidden",V),p.current.setAttribute("data-hidden",V))},T=()=>{m.current.removeEventListener("load",U),K()},U=()=>{var w;(w=f.current)!=null&&w.src&&(I(x.current,!1),I(!x.current,!0),clearTimeout(M.current),M.current=setTimeout(()=>{x.current?c.current&&(c.current.src=null,p.current.src=null):m.current&&(m.current.src=null,h.current.src=null)},1100),a(f,T))},K=()=>{const w=d.current.pairs.length||0;if(w===0)return;const V=d.current.pairs[w-1-S.current%w],G=[V.c1,V.c2];S.current+=1,clearTimeout(P.current),r.current.length===0?r.current=G:B(G,0)},B=(w,V)=>{r.current=r.current.map((G,H)=>G.map((X,Y)=>parseInt(Qe(X,w[H][Y],.1)))),!(V>150)&&(P.current=setTimeout(()=>{B(w,V+1)},1e3/60))};return n.useEffect(()=>{var H,X;const w=()=>{v.current=0,E(!1)},V=()=>{v.current++,v.current>=b?+E(!0):E(!1)},G=["mousemove","keydown","mousedown","touchstart","scroll"];return G.forEach(Y=>{window.addEventListener(Y,w)}),$.current=setInterval(V,1e3),(H=f.current)!=null&&H.complete&&((X=f.current)!=null&&X.src)&&a(m,T),()=>{G.forEach(Y=>{window.removeEventListener(Y,w)}),clearInterval($.current),clearTimeout(P.current),r.current=[]}},[]),e.jsxs("div",{id:"full-screen-page",children:[e.jsxs("div",{className:"full-screen-header",children:[e.jsx("button",{className:"roundButton full-screen-back go-back","data-inactive":k,onClick:l,children:e.jsx(Ye,{})}),e.jsx("button",{className:"roundButton full-screen-back","data-inactive":k,onClick:K,children:e.jsx(ha,{})})]}),e.jsx("div",{"data-inactive":k,className:"full-screen-audio-ctrl",children:e.jsx(Ot,{context:""})}),(u||(s==null?void 0:s.type)=="radio")&&e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:h,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:m,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"})}),e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:p,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:c,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"})})]})]})};function Xo(t=[]){const s=Je();n.useEffect(()=>{t.includes(s.pathname)?(document.documentElement.classList.add("scroll-enabled"),document.body.classList.add("scroll-enabled")):(document.documentElement.classList.remove("scroll-enabled"),document.body.classList.remove("scroll-enabled"))},[s,t])}const Ae={TRACK:"track",PLAYLIST:"playlist",ALBUM:"album",GENRE:"genre",ARTIST:"artist"},Zo=()=>{const t=n.useRef(null),[s,o]=n.useState(!1),[u,l]=n.useState([]),{openTrackActions:r,playTrackNoQueue:a}=oe(),d=me(),m=f=>{const x=f.target.value;if(x===""||x.trim().length===0){l([]);return}console.log(`${N}/read-write/search/${x}`),fetch(`${N}/read-write/search/${x}`,{method:"GET",credentials:"include"}).then(v=>{if(v.ok)return v.json();throw new Error("Error fetching search results")}).then(v=>{var $,k,E,M,P;const b=[...($=v.tracks)==null?void 0:$.map(S=>({type:"track",...S})),...(k=v.albums)==null?void 0:k.map(S=>({type:"album",...S})),...(E=v.artists)==null?void 0:E.map(S=>({type:"artist",...S})),...(M=v.genres)==null?void 0:M.map(S=>({type:"genre",...S})),...(P=v.playlists)==null?void 0:P.map(S=>({type:"playlist",...S}))].map(S=>{const F=S.path,{trackPath:I,...T}=S,U=S.type==="artist"?Ae.ARTIST:S.type==="album"?Ae.ALBUM:S.type==="genre"?Ae.GENRE:S.type==="playlist"?Ae.PLAYLIST:Ae.TRACK;return{icon:()=>F?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${S.type==="artist"?"artist":"covers"}/${F}`,alt:S.name}):e.jsx(se,{className:"action-bar-entry-logo"}),tooltip:()=>e.jsx(ts,{onClick:K=>{h(K,{code:U,id:S.id})}}),code:U,fileName:F,...T}});console.log(b),l(b)})},h=(f,x)=>{r({x:f.clientX,y:f.clientY},x,()=>{},()=>{})},c=f=>{s||setTimeout(()=>{requestAnimationFrame(()=>{var x;(x=t.current)==null||x.focus()})},0)},p=f=>{switch(f.code){case Ae.TRACK:a(f.id);break;case Ae.ALBUM:d(`/albums/${f.id}`);break;case Ae.ARTIST:d(`/artists/${f.id}`);break;case Ae.GENRE:d(`/genres/${f.id}`);break;case Ae.PLAYLIST:d(`/playlists/${f.id}`);break}};return e.jsx("div",{className:"action-bar",id:"researchbar",children:e.jsxs("div",{className:"action-bar-research",onClick:c,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Me,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:m,placeholder:"Search for tracks, artists, genres, playlists..",ref:t,onFocus:()=>{o(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${s?"block":"none"}`},children:u.map((f,x)=>e.jsx(ut,{entry:f,className:"from-search-bar",onClick:p},x))})]})})},ec=()=>(Xo(["/","/register","/settings","/admin-pannel"]),e.jsx(xa,{children:e.jsx(ka,{children:e.jsxs(Ma,{children:[" ",e.jsx(io,{children:e.jsxs(ur,{children:[e.jsx(le,{path:"/",element:e.jsx(yo,{})}),e.jsx(le,{path:"register",element:e.jsx(Mo,{})}),e.jsx(le,{element:e.jsx(Jo,{}),children:e.jsx(le,{path:"full-screen",element:e.jsx(Yo,{})})}),e.jsxs(le,{element:e.jsx(go,{}),children:[e.jsx(le,{path:"home",element:e.jsx(xo,{})}),e.jsx(le,{path:"albums",element:e.jsx(vo,{})}),e.jsx(le,{path:"albums/:albumId",element:e.jsx(As,{})}),e.jsx(le,{path:"artists",element:e.jsx(ko,{})}),e.jsx(le,{path:"artists/:artistId",element:e.jsx(So,{})}),e.jsx(le,{path:"genres",element:e.jsx(Vo,{})}),e.jsx(le,{path:"genres/:genreId",element:e.jsx(Uo,{})}),e.jsx(le,{path:"playlists",element:e.jsx(qo,{})}),e.jsx(le,{path:"playlists/:playlistId",element:e.jsx(As,{isPlaylist:!0})}),e.jsx(le,{path:"cooking",element:e.jsx(zo,{})}),e.jsx(le,{path:"radio",element:e.jsx(Ko,{})}),e.jsx(le,{path:"search",element:e.jsx(Zo,{})})]}),e.jsx(le,{path:"account",element:e.jsx(wo,{})}),e.jsx(le,{path:"settings",element:e.jsx(Io,{})}),e.jsx(le,{path:"admin-pannel",element:e.jsx(Oo,{})}),e.jsx(le,{path:"*",element:e.jsx(To,{})})]})})]})})}));lr.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(dr,{children:e.jsx(ec,{})})}));
