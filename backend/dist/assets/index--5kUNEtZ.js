import{r as n,j as e}from"./react-DmLYqgKm.js";import{c as ur}from"./react-dom-DPPwivfB.js";import{u as he,a as Ve,L as tt,O as Ps,b as Lt,R as dr,c as de,B as mr}from"./react-router-qw1pt6K9.js";import{I as hr,a as Mt,b as at,c as es,d as ye,e as ot,f as fr,g as Nt,h as ct,i as Ls,j as pr,k as gr,l as xr,m as vr,n as jr,o as jt,p as Zt,q as $s,r as Ue,s as Os,t as Ms,u as yr,v as Us,w as br,x as Nr,y as kr,z as Sr,A as ts,B as Tr,C as wr,D as Er,E as Rr,F as _s,G as Ut,H as Cr,J as Bs,K as Ar,L as Ir,M as Fr,N as Pr,O as ss,P as ns,Q as it,R as Lr,S as Gs,T as Ds,U as Qt,V as $r,W as Or,X as Mr,Y as rs,Z as Ur,_ as _r,$ as Br,a0 as Gr,a1 as Dr,a2 as Vr,a3 as Hr,a4 as Vs,a5 as qr,a6 as zr,a7 as Wr,a8 as Ye,a9 as Kr,aa as Qr,ab as Jr,ac as Yr,ad as Xr,ae as Hs,af as Zr,ag as ea,ah as ta,ai as sa,aj as na,ak as ra,al as aa,am as oa,an as ca,ao as ia,ap as la,aq as ua,ar as da,as as ma,at as ha,au as fa}from"./@tabler-C6Dpwwh0.js";import{F as Fe}from"./react-window-Dlc0x0tK.js";import{v as yt}from"./uuid-C6aID195.js";import{Z as as}from"./react-colorful-0uAH5Wqu.js";import{_ as xt}from"./lodash-e2SigP7W.js";import{p as pa}from"./music-metadata-CvBiwAZp.js";import{a as ga}from"./axios-C0Zqfgkc.js";import{F as qs}from"./fuse.js-Ch1WBRTM.js";import"./content-type-kkloIWN6.js";import"./scheduler-SPyfQU6S.js";import"./@babel-Cj2_JSWT.js";import"./memoize-one-CcMeOnPo.js";import"./strtok3-BXaumHbT.js";import"./peek-readable-BVp5v6zA.js";import"./file-type-BdA4k6lR.js";import"./token-types-D2R8hC8p.js";import"./ieee754-DcnkbHBT.js";import"./@tokenizer-Sx_RGPFW.js";import"./fflate-D0DoR3vL.js";import"./debug-Dqg9INeJ.js";import"./ms-CzQ2E3wO.js";import"./uint8array-extras-B1Dultle.js";import"./media-typer-Kaw9hxcp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))m(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&m(a)}).observe(document,{childList:!0,subtree:!0});function o(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function m(c){if(c.ep)return;c.ep=!0;const r=o(c);fetch(c.href,r)}})();const xa=()=>{const t=window.location.hostname,s=window.location.port;return t==="localhost"||t.startsWith("127.0.0.1")?`http://localhost:${s}`:`http://${t}:${s}`},S=xa(),zs=n.createContext(),ve=()=>n.useContext(zs),va=({children:t})=>{const s=n.useRef(new Map),o=(c,r)=>(s.current.has(c)||s.current.set(c,new Set),s.current.get(c).add(r),()=>{var a;(a=s.current.get(c))==null||a.delete(r)}),m=(c,r)=>{s.current.has(c)&&s.current.get(c).forEach(a=>{a(r),console.log("called at",a)})};return e.jsx(zs.Provider,{value:{emit:m,subscribe:o},children:t})},ja=()=>{const[t,s]=n.useState(!1),[o,m]=n.useState(!1),c=he(),r=n.useRef(null),{subscribe:a}=ve(),d=()=>{s(!t)},u=()=>{fetch(`${S}/auth/logout`,{method:"POST",credentials:"include"}).then(p=>{p.ok?c("/"):console.error("Logout failed")}).catch(p=>{console.error("Error:",p)})},h=()=>{c("/account")},l=()=>{c("/settings")};return n.useEffect(()=>{fetch(`${S}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{m(x)});const p=x=>{var v;if(r.current&&!r.current.contains(x.target)){if(((v=x.target.closest("svg"))==null?void 0:v.id)==="user-button")return;s(!1)}},f=a("action-bar-open",()=>{s(!1)});return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{f(),document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[]),e.jsxs("div",{className:"userDropdown",ref:r,children:[e.jsx(hr,{id:"user-button",className:"userImage buttonRound",onClick:d}),t&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"userAccount dropdownEntry",onClick:h,children:"Account"}),e.jsx("button",{className:"userSetting dropdownEntry",onClick:l,children:"Settings"}),o&&e.jsx("button",{className:"userSetting dropdownEntry",onClick:()=>{c("/admin-pannel")},children:"Admin pannel"}),e.jsx("button",{className:"userLogout dropdownEntry",onClick:u,children:"Logout"})]})]})},os=t=>{var s=function(a){return("00"+a).slice(-2)};const o=Math.floor(t/3600),m=Math.floor(t%3600/60),c=s(Math.floor(t%60)),r=o>0?`${o}:${m}:${c}`:`${m}:${c}`;return{hours:o,minutes:m,seconds:c,readable:r}},Jt=t=>{const s=Math.floor(t/1024),o=Math.floor(s/1024),m=Math.floor(o/1024),c=Math.floor(m/1024),r=c>0?`${Number(t/1024/1024/1024/1024).toFixed(2)}TB`:m>0?`${Number(t/1024/1024/1024).toFixed(2)}GB`:o>0?`${Number(t/1024/1024).toFixed(2)}MB`:`${Number(t/1024).toFixed(2)}KB`;return{kb:s,mb:o,gb:m,tb:c,readable:r}},Ws=(t,s,o)=>{s/=100,o/=100;let m=(1-Math.abs(2*o-1))*s,c=m*(1-Math.abs(t/60%2-1)),r=o-m/2,a=0,d=0,u=0;return 0<=t&&t<60?(a=m,d=c,u=0):60<=t&&t<120?(a=c,d=m,u=0):120<=t&&t<180?(a=0,d=m,u=c):180<=t&&t<240?(a=0,d=c,u=m):240<=t&&t<300?(a=c,d=0,u=m):300<=t&&t<360&&(a=m,d=0,u=c),a=Math.round((a+r)*255).toString(16),d=Math.round((d+r)*255).toString(16),u=Math.round((u+r)*255).toString(16),a.length==1&&(a="0"+a),d.length==1&&(d="0"+d),u.length==1&&(u="0"+u),"#"+a+d+u},Ss=(t,s,o)=>(t=t.toString(16),s=s.toString(16),o=o.toString(16),t.length==1&&(t="0"+t),s.length==1&&(s="0"+s),o.length==1&&(o="0"+o),"#"+t+s+o),Be=t=>{let s=0,o=0,m=0;return t.length==4?(s="0x"+t[1]+t[1],o="0x"+t[2]+t[2],m="0x"+t[3]+t[3]):t.length==7&&(s="0x"+t[1]+t[2],o="0x"+t[3]+t[4],m="0x"+t[5]+t[6]),[parseInt(s),parseInt(o),parseInt(m)]},Qe=(t,s,o)=>t+(s-t)*o,ya=(t,s,o,m,c)=>Qe(m,c,(t-s)/(o-s)),Je=(t,s)=>{var o=t??"";return o.length>s?o.substring(0,s-2)+"..":o},ba=(t="")=>{const s=["/","/register"];return new Promise(async o=>{const m=await fetch(`${S}/auth/verifyToken`,{method:"POST",credentials:"include"}).then(async c=>c.ok?!0:(s.includes(t)||await fetch(`${S}/auth/logout`,{method:"POST",credentials:"include"}).then(r=>{r.ok?window.location.href="/":console.error("Logout failed")}),!1));o(m)})},_e=(t,s="")=>async function(){await ba(s)&&t()},Na=t=>t.charAt(0).toUpperCase()+t.slice(1),Ts=([t,s,o])=>{const m=[t,s,o].map(c=>(c/=255,c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4)));return .2126*m[0]+.7152*m[1]+.0722*m[2]},ka=(t,s)=>{const o=Ts(t),m=Ts(s);return(Math.max(o,m)+.05)/(Math.min(o,m)+.05)},ne=({col1:t="#f9c58d",col2:s="#f492f0",className:o,style:m={},id:c=""})=>e.jsxs("svg",{id:c,viewBox:"0 0 512 512",style:{...m},className:o,xmlns:"http://www.w3.org/2000/svg",fill:"#000000",children:[e.jsxs("defs",{children:[e.jsx("mask",{id:"mask_logo",fill:"black",children:e.jsx("path",{fill:"white",d:"M116.215 17.404c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm64.326 12.87l-23.488 92.062h63.965l27.49-27.49-67.967-64.573zm228.147 25.958c0 20.214-20.216 40.428-40.43 40.428 20.214 0 40.43 20.214 40.43 40.428 0-20.214 20.213-40.428 40.427-40.428-20.214 0-40.428-20.214-40.428-40.428zm-150.022 53.913l-23.18 23.18L283.043 311h29.066l-53.443-200.855zm75.232 2.365l16.123 32.281 45.188 33.148-4.393-53.533-56.918-11.896zm-18.033 4.181l-26.685 38.121 10 37.586 33.38-42.283-16.695-33.424zm-160.672 23.645L172.42 206.4l21.988 12.623L239.043 311h25.365l-45.68-170.664h-63.535zm189.797 23.088l-40.03 50.703L330.737 311h.026l64.08-111.004-49.852-36.572zm122.352 5.834c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm-374.22 12.375l11.308 76.129 48.834-6.356 19.322-24.154-79.465-45.62zm346.995 53.793l-52.547 13.172L351.547 311h25.77l19.16-19.48 43.64-56.094zm-255.21 5.244l-17.403 21.75 25.77 48.58h25.761l-34.129-70.33zm-33.84 29.174l-39.005 5.074L148.145 311h24.751l-21.83-41.156zm-91.37 11.396c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zM137 329v30h238v-30H137zm32 48v78h16v-78h-16zm34 0v78h106v-78H203zm124 0v78h16v-78h-16zm-164.758 96l-30.119 16h247.754l-30.12-16H162.243z"})}),e.jsxs("linearGradient",{id:"grad_logo",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:t}),e.jsx("stop",{offset:"100%",stopColor:s})]})]}),e.jsx("rect",{x:"0",y:"0",width:"512",height:"512",fill:"url(#grad_logo)",mask:"url(#mask_logo)"})]}),lt=({entry:t,style:s,onClick:o,className:m=""})=>e.jsxs("div",{className:`action-bar-entry ${m}`,style:s,onClick:()=>{o(t)},children:[t.icon(),e.jsxs("span",{style:{flex:"1"},children:[" ",t.name]}),t.tooltip?t.tooltip(t.type):null]}),Ks=n.createContext(),st={SUCCESS:"success",ERROR:"error",INFO:"info",SALAD:"salad",QUEUE:"queue"},Sa=({children:t})=>{const[s,o]=n.useState(null),[m,c]=n.useState(null),r=n.useRef(null),a=n.useRef([]),d=(h,l)=>{a.current.forEach(f=>clearTimeout(f)),a.current=[],c({message:h,state:l}),o(!0);const p=setTimeout(()=>{r.current&&(r.current.setAttribute("direction",""),r.current.offsetWidth,r.current.setAttribute("direction","hide"));const f=setTimeout(()=>{o(!1),c(null)},300);a.current.push(f)},2e3);a.current.push(p)};n.useEffect(()=>{m&&o(!0)},[m]),n.useEffect(()=>{!s||!r.current||r.current.setAttribute("direction","show")},[s]);const u=()=>{if(!s)return null;switch(m==null?void 0:m.state){case st.SUCCESS:return e.jsx(ot,{className:"notification-icon"});case st.ERROR:return e.jsx(ye,{className:"notification-icon"});case st.INFO:return e.jsx(es,{className:"notification-icon"});case st.SALAD:return e.jsx(at,{className:"notification-icon"});case st.QUEUE:return e.jsx(Mt,{className:"notification-icon"});default:return null}};return e.jsxs(Ks.Provider,{value:{notifTypes:st,addNotification:d},children:[t,m?e.jsx("div",{ref:r,className:"notification-parent",id:"notification-parent",children:e.jsxs("div",{className:"notification","is-open":m?"true":"false",children:[e.jsx(u,{}),e.jsx("span",{children:m.message})]})}):null]})},Pe=()=>n.useContext(Ks),Ta=({onClose:t,track:s})=>{const[o,m]=n.useState(!1),c=n.useRef(null),r=n.useRef(null),[a,d]=n.useState([]),[u,h]=n.useState(null),[l,p]=n.useState(""),{addNotification:f,notifTypes:x}=Pe(),v=R=>{if(R.preventDefault(),l==""&&!u){t(!1);return}fetch(`${S}/read-write/moveTrackToAlbum/${l?"true/"+l:"false/"+u.id}/${s.id}`).then(b=>b.json()).then(b=>{f(`Track ${s.title} moved to 
            ${l||u.name}.`,x.INFO),t(!0)})},j=R=>{h(null),p(R.target.value)},A=R=>{const{tooltip:b,...P}=R;N(),h(P),p("")};n.useEffect(()=>{const R=b=>{r.current&&!r.current.contains(b.target)&&N()};return document.addEventListener("mousedown",R),document.addEventListener("touchstart",R),()=>{document.removeEventListener("mousedown",R),document.removeEventListener("touchstart",R)}},[]);const N=()=>{m(!1),c.current.value="",d([])},L=()=>e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Move to album"})," "]}),$=R=>{const b=R.target.value;if(b===""||b.trim().length===0){d([]);return}console.log(`${S}/read-write/search/${b}/${["albums"]}`),fetch(`${S}/read-write/search/${b}/${["albums"]}`,{method:"GET",credentials:"include"}).then(P=>P.json()).then(P=>{d([...P.albums].map(C=>{const k=C.path,{trackPath:M,...W}=C;return{icon:()=>k?e.jsx("img",{className:"action-bar-entry-logo",src:`${S}/covers/${k}`,alt:C.name}):e.jsx(ne,{className:"action-bar-entry-logo"}),tooltip:L,...W}}))})};return e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:null,children:[e.jsx("h2",{children:"Move track to another album"}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:v,children:[e.jsx("label",{htmlFor:"newAlbum",style:l?{}:{opacity:"0.5"},children:"New album name"}),e.jsx("input",{type:"text",style:l?{}:{opacity:"0.5"},id:"newAlbum",placeholder:"Enter album name",onChange:j}),e.jsx("label",{htmlFor:"existingAlbum",style:l?{opacity:"0.5"}:{},children:"Existing album"}),e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:r,style:l?{opacity:"0.5"}:{},children:e.jsxs("div",{className:"action-bar-research",style:{transform:"translateX(15px)"},id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(fr,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:$,placeholder:"Search the album you want to move the track to.",ref:c,onFocus:()=>{m(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Fe,{height:300,itemCount:a.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:R,style:b})=>e.jsx(lt,{entry:a[R],style:{...b,width:" calc(100% - 20px)",marginTop:"10px"},onClick:A},R)})})]})}),u?e.jsxs("div",{style:{height:"90px",alignItems:"center",display:"flex",gap:"10px"},children:[u!=null&&u.icon?u.icon():null,u.name]}):null,e.jsx("input",{type:"submit",value:"Submit"})]})]})})},Qs=()=>e.jsxs("div",{className:"three-points-loader",children:[e.jsx("div",{className:"point point1"}),e.jsx("div",{className:"point point2"}),e.jsx("div",{className:"point point3"})]}),ie=({onClick:t,text:s,icon:o,style:m,id:c=""})=>{const[r,a]=n.useState(!1),d=()=>{a(!0),t().then(()=>{a(!1)})},u=()=>r?e.jsx(Qs,{}):e.jsxs(e.Fragment,{children:[o,s]});return e.jsx("button",{className:"button-with-callback",id:c,style:{...m},onClick:d,children:e.jsx(u,{})})},wa=({applyCanges:t,albumClass:s})=>{var b,P;const[o,m]=n.useState({visible:!1}),[c,r]=n.useState(null),[a,d]=n.useState("2000-00-00"),[u,h]=n.useState(null),[l,p]=n.useState(!1),{deleteAlbum:f}=ce(),{notifTypes:x,addNotification:v}=Pe();if(!s)return null;n.useEffect(()=>{s&&(r(s.coverURL),d(s.year))},[s]);const j=()=>{const C=document.getElementById("editAlbumInfos"),k=C.artistName.value.split(",").map(U=>U.trim()),M=C.genre.value.split(",").map(U=>U.trim()).map(U=>U.charAt(0).toUpperCase()+U.slice(1)).filter(U=>U!="");if(!(C.albumName.value!==s.name||s.artist.toString()!==k.toString()||s.year!==C.releaseDate.value||s.genre.toString()!==M.toString()||s.description!==C.description.value||u||l)){t(null);return}s.name=C.albumName.value,s.artist=k,s.year=C.releaseDate.value,s.genre=M,s.description=C.description.value;const{tracks:B,coverURL:T,...D}=s;console.log(D),t(D,u)},A=C=>{const k=C.target.files[0];k&&(s.ext=k.name.split(".").pop(),r(URL.createObjectURL(k)),h(k))},N=C=>{m({visible:!o.visible,...C})},L=C=>{console.log(C),!l&&C&&p(!0),m({visible:!1})},$=async()=>{v("Comming soon :)",x.INFO)},R=async()=>{f(!1,{name:s.name,id:s.id})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[c?e.jsx("img",{id:"coverPicture",src:c,style:{width:"100%"}}):e.jsx(ne,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(Nt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:A})]}),e.jsx("button",{className:"roundButton",onClick:()=>j(),children:"Apply"}),e.jsx(ie,{onClick:$,text:"Delete for me",icon:e.jsx(ct,{}),style:{marginTop:"auto"}}),e.jsx(ie,{onClick:R,text:"Remove from library",icon:e.jsx(ct,{})})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(b=s.artist)==null?void 0:b.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",value:a,onChange:C=>{d(C.target.value)}})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(P=s.genre)==null?void 0:P.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Fe,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:C,style:k})=>e.jsxs("div",{style:k,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[C].title}),e.jsx(Ls,{className:"trackIcon",onClick:()=>{N(s.tracks[C])}})]},C)})})]}),o.visible&&e.jsx(Ta,{onClose:L,track:{id:o.id,title:o.title}})]})})},ws=({closeOverlay:t,applyCanges:s,editPlaylistClass:o})=>{const[m,c]=n.useState(null),[r,a]=n.useState(null),[d,u]=n.useState(o||{id:yt()}),[h,l]=n.useState([]),[p,f]=n.useState([]);n.useEffect(()=>{d&&c(d.coverUR),d.collaborators&&f(d.collaborators)},[d]);const x=()=>{const N=document.getElementById("editAlbumInfos");if(!(N.playlistName.value!==d.name||d.description!==N.description.value||r||d.collaborators.map(P=>!p.includes(P)).filter(P=>P))){s(null);return}d.name=N.playlistName.value,d.description=N.description.value,d.collaborators=p.map(P=>P.id);const{tracks:$,coverURL:R,...b}=d;console.log(b),s(b,r)},v=N=>{const L=N.target.files[0];L&&(d.ext=L.name.split(".").pop(),c(URL.createObjectURL(L)),a(L))};n.useEffect(()=>{fetch(`${S}/auth/collaborators`,{method:"GET",credentials:"include"}).then(N=>N.json()).then(N=>{console.log(N),l(N)})},[]);const j=N=>{const L=N.target.value;p.includes(L)||L==="pickUsers"||(f($=>[...$,h.find(R=>R.id==L)]),N.target.value="pickUsers")};n.useEffect(()=>{console.log(p)});const A=N=>{f(p.filter(L=>L.id!=N))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsx(ye,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[m?e.jsx("img",{id:"coverPicture",src:m,style:{width:"100%"}}):e.jsx(ne,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(Nt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:v})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"playlistName",children:"Playlist name"}),e.jsx("input",{type:"text",id:"playlistName",placeholder:"Enter playlist name",defaultValue:d.name?d.name:""}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",style:{height:"80px",paddingTop:"10px",paddingBottom:"10px"},placeholder:"Enter description",defaultValue:d==null?void 0:d.description})]}),e.jsx("label",{htmlFor:"new-collab",children:"Add collaborators"}),e.jsxs("select",{onChange:j,children:[e.jsx("option",{value:"pickUsers",children:"Pick users"},"root"),h.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]}),e.jsx("label",{children:"Collaborators:"}),e.jsx("div",{children:p==null?void 0:p.map(N=>e.jsxs("div",{children:[e.jsx("span",{children:N==null?void 0:N.name}),e.jsx(pr,{className:"buttonRound",onClick:()=>{A(N.id)}})]},N==null?void 0:N.id))})]})]})})};function Ea(){const{innerWidth:t,innerHeight:s}=window;return{width:t,height:s}}const Ra=({trackY:t,track:s,isFav:o})=>{const[m,c]=n.useState(Ea()),{onClicTrackActionEntry:r,trackActionTypes:a}=ce(),[d,u]=n.useState(!1),h=n.useRef(null),[l,p]=n.useState(null),f=Ve(),[x,v]=n.useState(()=>window.innerWidth<820);return n.useEffect(()=>{const j=A=>{h.current&&!h.current.contains(A.target)&&r(a.NONE)};return document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),u(f.pathname.includes("playlist")),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j)}},[]),n.useEffect(()=>{const j=d?250:180;p(Math.min(t,m.height-j))},[d]),l&&e.jsxs("div",{className:"track-actions-div",ref:h,style:{height:"fit-content",top:l},children:[e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TOP_QUEUE,s)},children:[e.jsx("span",{children:"Front queue"})," ",e.jsx(gr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.END_QUEUE,s)},children:[e.jsx("span",{children:"Back queue"})," ",e.jsx(xr,{})]}),d&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.GOTO_ALBUM,s)},children:[e.jsx("span",{children:"View album"})," ",e.jsx(vr,{})]}),d&&!o&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_PLAYLIST,s)},children:[e.jsx("span",{children:"Delete from playlist"})," ",e.jsx(jr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TAGS,s)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(jt,{})]}),x&&s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_FAVORITES,s)},children:[e.jsx("span",{children:"Remove from favorite"})," ",e.jsx(Zt,{})]}):null,x&&!s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.ADD_TO_FAVORITES,s)},children:[e.jsx("span",{children:"Add to favorites"})," ",e.jsx($s,{})]}):null]})},pt={name:"Create a new tag",icon:()=>e.jsx(Os,{}),isAction:!0},Ca=({track:t,apply:s})=>{const o=n.useRef(null),[m,c]=n.useState(!1),[r,a]=n.useState([pt]),[d,u]=n.useState("#aabbcc"),[h,l]=n.useState(!1),p=n.useRef(null),f=n.useRef(null),[x,v]=n.useState([]),[j,A]=n.useState(null),[N,L]=n.useState(null),[$,R]=n.useState([]),b=n.useRef(),P=B=>{const T=B.target.value;if(L(T),T===""||T.trim().length===0){a([pt]);return}fetch(`${S}/read-write/search/${T}/tags`,{method:"GET",credentials:"include"}).then(D=>{if(D.ok)return D.json();throw new Error("Error fetching search results")}).then(D=>{var re;const U=(re=D.tags)==null?void 0:re.map(X=>({...X,icon:()=>e.jsx(jt,{color:X.color}),isAction:!1})),V={name:`${pt.name}: ${T}`,icon:pt.icon,isAction:pt.isAction};U.splice(0,0,V),a(U)})},C=()=>{c(!1)},k=B=>{if(C(),B.isAction){A("new"),u(`${Ws(Math.random().toFixed(4)*360,100,70.8)}`);return}x.find(T=>T.id===B.id)||(R(T=>T.filter(D=>D!==B.id)),v(T=>[...T,B]))};n.useEffect(()=>{j==="new"&&(f.current.focus(),f.current.value=N||"",b.current.value="")},[j]),n.useEffect(()=>{const B=T=>{var D;if(p.current&&!p.current.contains(T.target)){if(((D=T.target.closest("svg"))==null?void 0:D.id)==="color-button")return;l(!1)}if(o.current&&!o.current.contains(T.target)){C();return}};return document.addEventListener("mousedown",B),document.addEventListener("touchstart",B),fetch(`${S}/read-write/trackTags/${t.id}`,{method:"GET"}).then(T=>T.json()).then(T=>{v(T)}),()=>{document.removeEventListener("mousedown",B),document.removeEventListener("touchstart",B)}},[]);const M=()=>{const B=f.current.value;B!==""&&j==="new"&&v(T=>[...T,{name:B,color:d,id:yt(),isNew:!0}]),A(null)},W=(B,T)=>{const D=x.filter(U=>!(U.isNew===B&&U.id===T));v(D),B||R(U=>[...U,T])};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",style:{height:"500px",flexDirection:"column"},children:[e.jsx(ye,{className:"buttonRound closeOverlay",onClick:()=>{s(null)}}),e.jsxs("h3",{children:["Editing tags for track ",t.title]}),e.jsx("div",{className:"action-bar",style:{margin:"10px auto"},ref:o,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Ue,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:P,placeholder:"Search some tags..",ref:b,onFocus:()=>{c(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${m?"block":"none"}`},children:e.jsx(Fe,{height:300,itemCount:r.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:B,style:T})=>e.jsx(lt,{entry:r[B],style:{...T,width:" calc(100% - 20px)",marginTop:"10px"},onClick:k},B)})})]})}),j?e.jsxs("div",{className:"edit-tag",children:[e.jsx(Os,{style:{paddingRight:"30px"}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:f}),e.jsx(Ms,{id:"color-button",color:d,onClick:()=>{l(!h)}}),h&&e.jsxs("div",{ref:p,className:"edit-tag-picker",children:[" ",e.jsx(as,{color:d,onChange:u})]}),e.jsx(ot,{onClick:M})]}):null,e.jsx("div",{className:"track-tags-div",children:x.map((B,T)=>e.jsxs("div",{className:"small-tag",style:{backgroundColor:B.color},children:[e.jsx("span",{children:B.name})," ",e.jsx(ye,{onClick:()=>{W(B.isNew,B.id)}})]},`${B.isNew}-${B.id}`))}),e.jsx("button",{style:{marginTop:"auto"},onClick:()=>{s({current:x,deleted:$},t.id)},children:"Apply"})]})})},Aa=()=>{const{closeTagWindow:t}=ce(),[s,o]=n.useState(0),[m,c]=n.useState([]),[r,a]=n.useState([]),[d,u]=n.useState(!1),[h,l]=n.useState("#aabbcc"),[p,f]=n.useState(null),x=n.useRef(null),v=n.useRef(null),{addNotification:j,notifTypes:A}=Pe(),[N,L]=n.useState(null);n.useEffect(()=>{$(),R()},[]);const $=()=>{fetch(`${S}/read-write/getAllUserTags`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{c(k)})},R=()=>{fetch(`${S}/read-write/getAllUserSalads`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{a(k)})},b=k=>{f(k),l(k.color)},P=()=>{const k={id:p.id,name:x.current.value,color:h},M=new FormData;M.append(s===0?"tag":"salad",JSON.stringify(k)),fetch(`${S}/read-write/${s===0?"applyTagModifications":"applySaladModifications"}`,{method:"POST",credentials:"include",body:M}).then(W=>W.json()).then(W=>{s===0?$():R(),j("Tag updated.",A.SUCCESS)}),f(null)},C=()=>{fetch(`${S}/read-write/delete/${N.type}/${N.id}`,{method:"DELETE",credentials:"include"}).then(k=>k.json()).then(k=>{s===0?$():R(),f(null),L(null),j("Tag deleted.",A.SUCCESS)})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"tag-edtior-container",children:[e.jsx(ye,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"cooking-selection",style:{marginTop:"40px"},children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(ie,{text:"Edit tags",icon:e.jsx(yr,{}),onClick:async()=>{o(0)}}),e.jsx(ie,{text:"Edit salads",icon:e.jsx(at,{}),onClick:async()=>{o(1)}})]}),e.jsxs("div",{className:"edit-tags-content",children:[e.jsx(Fe,{className:"albumTrackList",height:250,itemCount:s===0?m.length:r.length,itemSize:35,width:"100%",children:({index:k,style:M})=>e.jsxs("div",{style:M,className:"album-wrapping-track",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:s===0?m[k].color:r[k].color}}),e.jsx("span",{children:s===0?m[k].name:r[k].name}),e.jsx(Us,{className:"trackIcon",onClick:()=>{b(s===0?{...m[k],type:"tag"}:{...r[k],type:"salad"})}})]},k)}),p?e.jsxs("div",{className:"edit-tag",style:{left:"-20px",margin:"auto"},children:[e.jsx(ye,{style:{cursor:"pointer"},onClick:()=>{f(null)}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:x,defaultValue:p.name}),e.jsx(Ms,{style:{cursor:"pointer"},id:"color-button",color:h,onClick:()=>{u(!d)}}),d&&e.jsxs("div",{ref:v,className:"edit-tag-picker",children:[" ",e.jsx(as,{color:h,onChange:l})]}),e.jsx(ot,{onClick:P,style:{cursor:"pointer"}}),e.jsx(ct,{style:{cursor:"pointer"},onClick:()=>{L(p)}})]}):null,N?e.jsxs("div",{className:"deletion-confirmation",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:N.color,width:"50px"}}),e.jsxs("p",{children:["Confirm deletion of the ",N.type," ",N.name,"?"]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{L(null)},children:e.jsx(br,{})}),e.jsx("button",{onClick:()=>{C()},children:e.jsx(ot,{})})]})]}):null]})]})]})})},Ia=({applyChanges:t,artist:s})=>{const[o,m]=n.useState(null),[c,r]=n.useState("2000-00-00"),[a,d]=n.useState(null);if(!s)return null;n.useEffect(()=>{s&&(m(s.picture),r(s.active_from))},[s]);const u=()=>{const l=document.getElementById("editArtistInfos"),p=s.active_from??"",f=l.activeFrom.value??"",x=s.name??"",v=l.artistName.value??"",j=s.bio??"",A=l.bio.value??"";if(!(x!=v||p!=f||j!=A||a)){t(null);return}s.name=l.artistName.value,s.active_from=l.activeFrom.value,s.bio=l.bio.value;const{picture:L,...$}=s;console.log($,a),t($,a)},h=l=>{const p=l.target.files[0];p&&(s.ext=p.name.split(".").pop(),m(URL.createObjectURL(p)),d(p))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(ne,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(Nt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:h})]}),e.jsx("button",{className:"roundButton",onClick:u,children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editArtistInfos",children:[e.jsx("label",{htmlFor:"artistName",children:"Artist name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("div",{className:"albumType",children:e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"activeFrom",children:"Active since"}),e.jsx("input",{type:"date",id:"activeFrom",value:c,onChange:l=>{r(l.target.value)}})]})}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",placeholder:"Enter biography",defaultValue:s.bio})]})]})]})})};var Ft=function(t,s){return t<s?-1:t>s?1:0},Es=function(t){return t.reduce(function(s,o){return s+o},0)},Fa=function(){function t(o){this.colors=o}var s=t.prototype;return s.palette=function(){return this.colors},s.map=function(o){return o},t}(),Pa=function(){function t(r,a,d){return(r<<10)+(a<<5)+d}function s(r){var a=[],d=!1;function u(){a.sort(r),d=!0}return{push:function(h){a.push(h),d=!1},peek:function(h){return d||u(),h===void 0&&(h=a.length-1),a[h]},pop:function(){return d||u(),a.pop()},size:function(){return a.length},map:function(h){return a.map(h)},debug:function(){return d||u(),a}}}function o(r,a,d,u,h,l,p){var f=this;f.r1=r,f.r2=a,f.g1=d,f.g2=u,f.b1=h,f.b2=l,f.histo=p}function m(){this.vboxes=new s(function(r,a){return Ft(r.vbox.count()*r.vbox.volume(),a.vbox.count()*a.vbox.volume())})}function c(r,a){if(a.count()){var d=a.r2-a.r1+1,u=a.g2-a.g1+1,h=Math.max.apply(null,[d,u,a.b2-a.b1+1]);if(a.count()==1)return[a.copy()];var l,p,f,x,v=0,j=[],A=[];if(h==d)for(l=a.r1;l<=a.r2;l++){for(x=0,p=a.g1;p<=a.g2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[t(l,p,f)]||0;j[l]=v+=x}else if(h==u)for(l=a.g1;l<=a.g2;l++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[t(p,l,f)]||0;j[l]=v+=x}else for(l=a.b1;l<=a.b2;l++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.g1;f<=a.g2;f++)x+=r[t(p,f,l)]||0;j[l]=v+=x}return j.forEach(function(N,L){A[L]=v-N}),function(N){var L,$,R,b,P,C=N+"1",k=N+"2",M=0;for(l=a[C];l<=a[k];l++)if(j[l]>v/2){for(R=a.copy(),b=a.copy(),P=(L=l-a[C])<=($=a[k]-l)?Math.min(a[k]-1,~~(l+$/2)):Math.max(a[C],~~(l-1-L/2));!j[P];)P++;for(M=A[P];!M&&j[P-1];)M=A[--P];return R[k]=P,b[C]=R[k]+1,[R,b]}}(h==d?"r":h==u?"g":"b")}}return o.prototype={volume:function(r){var a=this;return a._volume&&!r||(a._volume=(a.r2-a.r1+1)*(a.g2-a.g1+1)*(a.b2-a.b1+1)),a._volume},count:function(r){var a=this,d=a.histo;if(!a._count_set||r){var u,h,l,p=0;for(u=a.r1;u<=a.r2;u++)for(h=a.g1;h<=a.g2;h++)for(l=a.b1;l<=a.b2;l++)p+=d[t(u,h,l)]||0;a._count=p,a._count_set=!0}return a._count},copy:function(){var r=this;return new o(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(r){var a=this,d=a.histo;if(!a._avg||r){var u,h,l,p,f=0,x=0,v=0,j=0;if(a.r1===a.r2&&a.g1===a.g2&&a.b1===a.b2)a._avg=[a.r1<<3,a.g1<<3,a.b1<<3];else{for(h=a.r1;h<=a.r2;h++)for(l=a.g1;l<=a.g2;l++)for(p=a.b1;p<=a.b2;p++)f+=u=d[t(h,l,p)]||0,x+=u*(h+.5)*8,v+=u*(l+.5)*8,j+=u*(p+.5)*8;a._avg=f?[~~(x/f),~~(v/f),~~(j/f)]:[~~(8*(a.r1+a.r2+1)/2),~~(8*(a.g1+a.g2+1)/2),~~(8*(a.b1+a.b2+1)/2)]}}return a._avg},contains:function(r){var a=this,d=r[0]>>3;return gval=r[1]>>3,bval=r[2]>>3,d>=a.r1&&d<=a.r2&&gval>=a.g1&&gval<=a.g2&&bval>=a.b1&&bval<=a.b2}},m.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var a=this.vboxes,d=0;d<a.size();d++)if(a.peek(d).vbox.contains(r))return a.peek(d).color;return this.nearest(r)},nearest:function(r){for(var a,d,u,h=this.vboxes,l=0;l<h.size();l++)((d=Math.sqrt(Math.pow(r[0]-h.peek(l).color[0],2)+Math.pow(r[1]-h.peek(l).color[1],2)+Math.pow(r[2]-h.peek(l).color[2],2)))<a||a===void 0)&&(a=d,u=h.peek(l).color);return u},forcebw:function(){var r=this.vboxes;r.sort(function(h,l){return Ft(Es(h.color),Es(l.color))});var a=r[0].color;a[0]<5&&a[1]<5&&a[2]<5&&(r[0].color=[0,0,0]);var d=r.length-1,u=r[d].color;u[0]>251&&u[1]>251&&u[2]>251&&(r[d].color=[255,255,255])}},{quantize:function(r,a){if(!Number.isInteger(a)||a<1||a>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!r.length||a<2||a>256||!r.length||a<2||a>256)return!1;for(var d=[],u=new Set,h=0;h<r.length;h++){var l=r[h],p=l.join(",");u.has(p)||(u.add(p),d.push(l))}if(d.length<=a)return new Fa(d);var f=function(L){var $,R=new Array(32768);return L.forEach(function(b){$=t(b[0]>>3,b[1]>>3,b[2]>>3),R[$]=(R[$]||0)+1}),R}(r);f.forEach(function(){});var x=function(L,$){var R,b,P,C=1e6,k=0,M=1e6,W=0,B=1e6,T=0;return L.forEach(function(D){(R=D[0]>>3)<C?C=R:R>k&&(k=R),(b=D[1]>>3)<M?M=b:b>W&&(W=b),(P=D[2]>>3)<B?B=P:P>T&&(T=P)}),new o(C,k,M,W,B,T,$)}(r,f),v=new s(function(L,$){return Ft(L.count(),$.count())});function j(L,$){for(var R,b=L.size(),P=0;P<1e3;){if(b>=$||P++>1e3)return;if((R=L.pop()).count()){var C=c(f,R),k=C[0],M=C[1];if(!k)return;L.push(k),M&&(L.push(M),b++)}else L.push(R),P++}}v.push(x),j(v,.75*a);for(var A=new s(function(L,$){return Ft(L.count()*L.volume(),$.count()*$.volume())});v.size();)A.push(v.pop());j(A,a);for(var N=new m;A.size();)N.push(A.pop());return N}}}().quantize,Js=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};Js.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var rt=function(){};rt.prototype.getColor=function(t,s){return s===void 0&&(s=10),this.getPalette(t,5,s)[0]},rt.prototype.getPalette=function(t,s,o){var m=function(d){var u=d.colorCount,h=d.quality;if(u!==void 0&&Number.isInteger(u)){if(u===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");u=Math.max(u,2),u=Math.min(u,20)}else u=10;return(h===void 0||!Number.isInteger(h)||h<1)&&(h=10),{colorCount:u,quality:h}}({colorCount:s,quality:o}),c=new Js(t),r=function(d,u,h){for(var l,p,f,x,v,j=d,A=[],N=0;N<u;N+=h)p=j[0+(l=4*N)],f=j[l+1],x=j[l+2],((v=j[l+3])===void 0||v>=125)&&(p>250&&f>250&&x>250||A.push([p,f,x]));return A}(c.getImageData().data,c.width*c.height,m.quality),a=Pa(r,m.colorCount);return a?a.palette():null},rt.prototype.getColorFromUrl=function(t,s,o){var m=this,c=document.createElement("img");c.addEventListener("load",function(){var r=m.getPalette(c,5,o);s(r[0],t)}),c.src=t},rt.prototype.getImageData=function(t,s){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){if(this.status==200){var m=new Uint8Array(this.response);i=m.length;for(var c=new Array(i),r=0;r<m.length;r++)c[r]=String.fromCharCode(m[r]);var a=c.join(""),d=window.btoa(a);s("data:image/png;base64,"+d)}},o.send()},rt.prototype.getColorAsync=function(t,s,o){var m=this;this.getImageData(t,function(c){var r=document.createElement("img");r.addEventListener("load",function(){var a=m.getPalette(r,5,o);s(a[0],this)}),r.src=c})};const vt=({iconHovered:t,iconDefault:s,onClick:o=null,className:m="",id:c=""})=>{const[r,a]=n.useState(!1);return e.jsx("div",{style:o?{background:"rgba(0,0,0,0)"}:{},className:m,id:c,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:o,children:r?e.jsx(t,{}):e.jsx(s,{})})},$t=({context:t})=>{const{isPlaying:s,toggleTrackPaused:o,playNextSong:m,playPreviousSong:c}=ce(),r=u=>{u.stopPropagation(),o()},a=u=>{u.stopPropagation(),m()},d=u=>{u.stopPropagation(),c()};return e.jsxs("div",{className:"audio-controls","data-mobile-context":t.mobile,"data-preserv-width":t.preserv,children:[!t.mobile||t.maximize?e.jsx(vt,{iconHovered:kr,iconDefault:Nr,onClick:d}):null,e.jsx(vt,{iconHovered:s?Tr:wr,iconDefault:s?Sr:ts,onClick:r}),!(t.radio&&t.mobile)&&e.jsx(vt,{iconHovered:Rr,iconDefault:Er,onClick:a})]})},Ys=n.memo(({index:t,style:s,data:o})=>{const{playQueue:m,cacheRef:c,jumpToQueueTrack:r,queuePointer:a}=o,d=m[t],[u,h]=n.useState(!!c.current[d]);let l=c.current[d];l||(l={title:"Loading...",cover:"loading"}),n.useEffect(()=>{u||(c.current[d]=l,fetch(`${S}/read-write/shortTrackInfos/${d}`,{credentials:"include"}).then(f=>f.json()).then(f=>{c.current[d]=f,h(!0)}))},[u,d]);const p={...s,width:"calc(100% - 15px)",height:"47.5px"};return e.jsxs("div",{className:"music-queue-entry",style:p,"is-passed":`${t<a}`,"is-selected":`${t===a}`,onClick:()=>r(t),children:[l.cover?e.jsx("img",{src:`${S}/covers/${l.cover}`,className:"track-image-small"}):e.jsx(ne,{className:"track-image-small"}),e.jsx("span",{className:"track-title",children:l.title})]})},(t,s)=>t.data.playQueue[t.data.queuePointer]===s.data.playQueue[s.data.queuePointer]),La=50,$a=0,Rs=n.memo(({title:t,radio:s,artist:o,artistId:m,isMinimal:c,fn:r})=>{const a=he(),[d,u]=n.useState(!0);return n.useEffect(()=>{u(!0);const h=setTimeout(()=>u(!1),500);return()=>clearTimeout(h)},[t]),e.jsxs("div",{className:"mobile-view-track-artist",style:{"--item-align":c?"left":"center"},children:[e.jsx("span",{id:"songTitle","data-from-minimal":c,"data-new":d,children:t}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{s||(r&&r(),a(`/artists/${m}`))},children:o})]})},(t,s)=>t.title===s.title&&t.artist===s.artist&&t.artistId===s.artistId&&t.radio===s.radio),Cs=5,Oa=()=>{var H;const{currentTrackData:t,trackCoverUrl:s,setTrackMobileView:o,toggleTrackFavorite:m,playQueue:c,jumpToQueueTrack:r,queuePointer:a,playLibraryShuffle:d,isPlaying:u,getFFTAtCurrentTime:h,fftConfigRef:l,songRawPalette:p,recomputeColors:f,requestNewFullScreenImage:x}=ce(),{addNotification:v}=Pe(),j=n.useRef(new Map),A=n.useRef(null),[N,L]=n.useState(!1),[$,R]=n.useState((t==null?void 0:t.isFav)||!1),b=n.useRef(null),P=n.useRef(0),C=n.useRef(0),k=n.useRef(null),M=n.useRef(null),W=n.useRef(0),B=n.useRef(null),T=n.useRef(null),D=n.useRef(null),U=n.useRef(!1),V=n.useRef(null);n.useEffect(()=>{t&&R(t.isFav)},[t]),n.useEffect(()=>{s&&(console.log("request"),x().then(O=>{console.log("received",O),V.current.src=URL.createObjectURL(O.blob),V.current.addEventListener("load",fe)}))},[s]);const re=async()=>{t&&m(t.id,!$,R)},X=O=>{if(O-W.current<1e3/30||!(B.current&&T.current&&D.current)){M.current=requestAnimationFrame(X);return}W.current=O;const oe=h();let me=oe.subarray(Math.floor(oe.length*.3),Math.floor(oe.length*.6));const ee=Math.max(1,me.length/Cs),_=new Array(Cs).fill(0);for(let F=0;F<me.length;F++)_[Math.floor(F/ee)]+=Number(oe[F])/100;for(let F=0;F<_.length;F++)_[F]=Math.min(100,Math.max(_[F],0));const z=3;B.current.style.setProperty("--strength-1",`${_[1]/z}%`),B.current.style.setProperty("--strength-2",`${_[2]/z}%`),T.current.style.setProperty("--strength-1",`${_[3]/z}%`),T.current.style.setProperty("--strength-2",`${_[4]/z}%`),D.current.style.setProperty("--strength-1",`${_[0]/z}%`),M.current=requestAnimationFrame(X)},pe=()=>{b.current.setAttribute("data-shift-back","true"),b.current.style.translate=`0px ${window.screen.height*.8}px`,b.current.setAttribute("data-fade-out","true"),console.log("clearing from close"),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{o(!1),b.current.setAttribute("data-fade-out","true"),b.current.setAttribute("data-shift-back","false"),k.current=null},200)},je=O=>{P.current=O.touches[0].clientY,C.current=0,k.current&&(console.log("clearing from touch start"),clearTimeout(k.current),k.current=null),b.current.setAttribute("data-shift-back","false")},xe=O=>{P.current&&b.current&&(O.preventDefault(),!(C.current<-40)&&(C.current=O.touches[0].clientY-P.current,b.current.style.translate=`0px ${C.current}px`))},ae=O=>{(C.current||0)<90?(b.current.setAttribute("data-shift-back","true"),b.current.style.translate="0px 0px",console.log("clearing from touch end"),k.current=setTimeout(()=>{b.current.setAttribute("data-shift-back","false"),k.current=null},300)):pe()},ge=O=>{O.stopPropagation(),O.preventDefault()};n.useEffect(()=>{if(!l.current){cancelAnimationFrame(M.current),console.log("No FFT data to display, releasing anim frame.");return}M.current=requestAnimationFrame(X),console.log("FFT found, requested animation frame.")},[l.current]),n.useEffect(()=>{var O;console.log("New paellette",p.current),((O=p.current)==null?void 0:O.length)>0&&(B.current.style.setProperty("--c-1",`rgb(${p.current[1].join(",")})`),B.current.style.setProperty("--c-2",`rgb(${p.current[2].join(",")})`),T.current.style.setProperty("--c-1",`rgb(${p.current[3].join(",")})`),T.current.style.setProperty("--c-2",`rgb(${p.current[4].join(",")})`),D.current.style.setProperty("--c-1",`rgb(${p.current[0].join(",")})`))},[p.current]),n.useEffect(()=>{var me,ee;const O=window.matchMedia("(min-width: 820px)"),oe=_=>{U.current=_.matches,M.current=requestAnimationFrame(X),console.log("Canvas hidden?",U.current)};return oe(O),(me=V.current)!=null&&me.complete&&((ee=V.current)!=null&&ee.src)&&f(V),O.addEventListener("change",oe),()=>{O.removeEventListener("change",oe)}},[]);const fe=()=>{console.log("recomputing"),f(V,()=>{}),V.current.removeEventListener("load",fe)};return e.jsx("div",{id:"track-mobile-view",ref:b,onTouchStart:je,onTouchMove:xe,onTouchEnd:ae,children:e.jsxs("div",{id:"track-mobile-view-content","data-minimize":N,children:[e.jsx("div",{className:"grad",id:"grad1",ref:B}),e.jsx("div",{className:"grad",id:"grad2",ref:T}),e.jsx("div",{className:"grad",id:"grad3",ref:D}),e.jsxs("div",{id:"floating-audio-state","data-minimize":N,children:[e.jsx("div",{id:"track-mobile-down",onTouchEnd:pe,children:e.jsx("div",{})}),(t==null?void 0:t.type)=="radio"?t.coverUrl==""?e.jsx(ne,{className:"trackImage","data-playing":u}):e.jsx("img",{ref:V,crossOrigin:"anonymous",src:t.coverUrl,"data-playing":u,className:"trackImage"}):s.split("/").pop()==="null"?e.jsx(ne,{className:"trackImage","data-playing":u}):e.jsx("img",{ref:V,className:"trackImage",crossOrigin:"anonymous","data-playing":u}),t?e.jsx(Rs,{title:t.title,artist:t.artist,artistId:t.artistId,radio:t.type==="radio",isMinimal:!0,fn:pe}):null]}),N?c.length>0?e.jsx("div",{id:"music-queue",ref:A,onTouchMove:ge,children:e.jsx(Fe,{height:((H=A.current)==null?void 0:H.offsetHeight)||$a,itemCount:c.length,itemSize:La,width:"100%",itemData:{playQueue:c,cacheRef:j,jumpToQueueTrack:r,queuePointer:a},children:Ys})}):e.jsx("p",{id:"no-items-in-queue",children:"No items in the queue"}):null,e.jsxs("div",{id:"fixed-audio-state",children:[t?e.jsx(Rs,{title:t.title,artist:t.artist,artistId:t.artistId,radio:t.type==="radio",isMinimal:!1,fn:pe}):null,e.jsx(Zs,{}),e.jsx($t,{context:{mobile:!0,maximize:!0}}),e.jsxs("div",{className:"track-list-header",children:[c.length>0?e.jsx(ie,{text:"",icon:$?e.jsx(_s,{}):e.jsx(Ut,{}),onClick:re}):e.jsx(ie,{text:"",icon:e.jsx(Cr,{}),onClick:d}),e.jsx(ie,{text:"",icon:e.jsx(Bs,{}),onClick:async()=>{L(!N)}})]})]})]})})},Xs=n.createContext(void 0),Me={TOP_QUEUE:"top_queue",END_QUEUE:"end_queue",TAGS:"tags",GOTO_ALBUM:"goto_album",REMOVE_FROM_PLAYLIST:"remove_from_playlist",ADD_TO_FAVORITES:"add_to_favs",REMOVE_FROM_FAVORITES:"remove_from_favs",NONE:"none"},Ma=()=>{const t=Ve(),s=n.useRef({pointer:0,history:new Array(6).fill(null)});return n.useEffect(()=>{const{pointer:o,history:m}=s.current,c=(o-1+m.length)%m.length;m[c]!==t.pathname&&(m[o]=t.pathname,s.current.pointer=(o+1)%m.length)},[t]),s.current},Ua=({children:t})=>{const[s,o]=n.useState(""),[m,c]=n.useState(!1),[r,a]=n.useState({}),d=n.useRef(0),u=n.useRef(null),h=n.useRef(null),l=n.useRef(null),[p,f]=n.useState([]),[x,v]=n.useState("null"),j=g=>`${g}`!="null"?`${S}/read-write/music/${g}`:null,[A,N]=n.useState(-1),L=n.useRef(p),$=n.useRef(A),[R,b]=n.useState(null),[P,C]=n.useState(null),{emit:k,subscribe:M}=ve(),W=n.useRef(null),[B,T]=n.useState(null),D=n.useRef(null),{addNotification:U,notifTypes:V}=Pe(),re=he(),[X,pe]=n.useState(null),[je,xe]=n.useState(null),[ae,ge]=n.useState(null),fe=n.useRef("A"),H=n.useRef(null),[O,oe]=n.useState(5),[me,ee]=n.useState(!1),[_,z]=n.useState(()=>{const g=parseFloat(localStorage.getItem("volume"));return isNaN(g)?1:Math.min(1,Math.max(0,g))}),[F,q]=n.useState(!1),[w,G]=n.useState(!1),Y=n.useRef(null),Z=n.useRef(null),te=n.useRef(null),Q=n.useRef(null),be=n.useRef(0),Ee=n.useRef(null),ue=n.useRef(null),St=n.useRef(0),dt=n.useRef(null),Tt=n.useRef(0),Bt=n.useRef(0),He=5,wt=n.useRef(""),ds=n.useRef(null),ms=n.useRef(0),mt=n.useRef({lastAudioTime:0,lastPerformanceNow:0}),Xe=n.useRef(null),on=.1,ht=n.useRef(!1),Gt=Ve(),Ze=n.useRef(""),cn=n.useRef([]),ft=n.useRef({track:"",pairs:[]}),hs=n.useRef(null),Dt=Ma(),[Et,fs]=n.useState(!1),Vt=n.useRef(null),Ht=n.useRef(null),ps=n.useRef([]),ln=()=>{var g,y,E,I,K,se,le,Ne;h.current=new Audio,h.current.setAttribute("source","A"),h.current.addEventListener("error",ke=>{if(h.current.src.includes("spoof"))return;const Se=h.current.error;if(Se&&(console.warn("Audio error occurred: code",Se.code),Se.code===4&&s)){const qe=`${S}/radio/spoof/${encodeURIComponent(h.current.src)}`;h.current.src=qe,U("Audio stream not reachable from browser. Streaming from backend..",V.INFO),c(!0),h.current.play();const ze=new EventSource(`${S}/radio/trackStream/${encodeURIComponent(h.current.src)}`);ze.onmessage=Re=>{console.log(Re);const Ce=JSON.parse(Re.data);console.log("Now playing:",Ce.metadata.StreamTitle);const Oe=Ce.metadata.adw_ad=="true"?`Advertisment - ${(Number(Ce.metadata.durationMilliseconds)/1e3).toFixed(1)}s`:Ce.metadata.StreamTitle;a(We=>({...We,title:Oe}))},ze.addEventListener("error",Re=>{console.warn("Metadata stream error",Re)})}}),h.current.addEventListener("canplay",()=>{console.log("Stream is playable!")}),l.current=new Audio,l.current.setAttribute("source","B");for(const ke of[h,l])ke.current.crossOrigin="anonymous",ke.current.playsInline=!0,ke.current.setAttribute("webkit-playsinline",""),ke.current.volume=parseFloat(localStorage.getItem("volume"))*.75||.5;(g=h.current)==null||g.addEventListener("timeupdate",Ct),(y=l.current)==null||y.addEventListener("timeupdate",Ct),(E=h.current)==null||E.addEventListener("playing",Rt),(I=l.current)==null||I.addEventListener("playing",Rt),(K=h.current)==null||K.addEventListener("play",et),(se=h.current)==null||se.addEventListener("pause",xs),(le=l.current)==null||le.addEventListener("play",et),(Ne=l.current)==null||Ne.addEventListener("pause",xs),qt(),console.log("Audio graph setted up")},un=()=>{var g,y,E,I,K,se,le,Ne,ke,Se,qe,ze,Re,Ce,Oe,We;console.log("Audio graph destructed"),(g=h.current)==null||g.pause(),h.current=null,(y=l.current)==null||y.pause(),l.current=null,(E=h.current)==null||E.removeEventListener("timeupdate",Le),(I=h.current)==null||I.removeEventListener("ended",$e),(K=h.current)==null||K.removeEventListener("error"),(se=h.current)==null||se.removeEventListener("canplay"),(le=l.current)==null||le.removeEventListener("timeupdate",Le),(Ne=l.current)==null||Ne.removeEventListener("ended",$e),(ke=h.current)==null||ke.removeEventListener("timeupdate",Ct),(Se=l.current)==null||Se.removeEventListener("timeupdate",Ct),(qe=h.current)==null||qe.removeEventListener("playing",Rt),(ze=l.current)==null||ze.removeEventListener("playing",Rt),(Re=h.current)==null||Re.removeEventListener("play",et),(Ce=h.current)==null||Ce.removeEventListener("pause",et),(Oe=l.current)==null||Oe.removeEventListener("play",et),(We=l.current)==null||We.removeEventListener("pause",et)},qt=()=>{var g,y;(g=h.current)==null||g.pause(),h.current.src=null,h.current.currentTime=0,(y=l.current)==null||y.pause(),l.current.src=null,l.current.currentTime=0,u.current=null,fe.current="A",h.current.removeEventListener("timeupdate",Le),h.current.removeEventListener("ended",$e),l.current.removeEventListener("timeupdate",Le),l.current.removeEventListener("ended",$e)},Rt=()=>{ue.current&&(console.log("Record start playing",u.current.currentTime),mt.current.lastAudioTime=u.current.currentTime,mt.current.lastPerformanceNow=performance.now())},gs=()=>{const g=u.current;!g||g.paused||Math.abs(g.currentTime-bs())>on&&ys()},dn=()=>(setTimeout(gs,200),setInterval(gs,5e3)),et=()=>{ue.current&&(ys(),Xe.current&&clearInterval(Xe.current),Xe.current=dn())},xs=()=>{Xe.current&&(clearInterval(Xe.current),Xe.current=null)},Ct=()=>{if(!ue.current||!u.current)return;const g=u.current.currentTime;if(Math.abs(g-ms.current)>1){k("on-seek-song",g);const y=Math.round(1/ue.current.interval),E=He*y,I=Math.floor(g*y);console.log("Seeking chunk",I,E,y,He),St.current=0,Bt.current=I,js(wt.current,I,I+E)}else hn(wt.current,g);ms.current=g};n.useEffect(()=>{r&&r.type!=="radio"&&At()},[r]);const At=()=>{const g=p.length<=A+1;H.current&&clearTimeout(H.current),!(g||!u.current)&&(console.log("Transition rescheduled, timesout in ",r.rawDuration,u.current.currentTime,O,r.rawDuration-u.current.currentTime-O),H.current=setTimeout(()=>{fe.current=fe.current==="A"?"B":"A",vs(A+1)},Math.min(r.rawDuration-u.current.currentTime-O)*1e3,0))},vs=async g=>{const y=p.length<=g;if(N(g),u.current=fe.current==="A"?h.current:l.current,p[g].startsWith("radio-")){let I={};if(p[g].startsWith("radio-id")){const se=p[g].split("radio-id:")[1];I=await fetch(`${S}/radio/${se}`).then(le=>le.json()),console.log(I),Ee.current=null,a({type:"radio",artist:I.name,...I,duration:"0-",uuid:se})}else{I.url=p[g].split("radio-url:")[1],console.log(Ee.current);const{name:se,...le}=Ee.current,Ne={artist:se,...le};a({type:"radio",...Ne,duration:"0-"})}u.current.src=I.url;const K=new EventSource(`${S}/radio/trackStream/${encodeURIComponent(I.url)}`);K.onmessage=se=>{console.log(se);const le=JSON.parse(se.data);console.log("Now playing:",le.metadata.StreamTitle),a(Ne=>({...Ne,title:le.metadata.StreamTitle}))},o(""),K.addEventListener("error",se=>{console.warn("Metadata stream error",se)}),Ns(),l.current.removeEventListener("timeupdate",Le),l.current.removeEventListener("ended",$e),c(!0),u.current.play();return}Ee.current=null;const E=p[g];if(await fetch(`${S}/read-write/trackInfos/${E}`,{method:"GET"}).then(I=>I.json()).then(I=>{I.duration=os(I.rawDuration),a(I)}),u.current.currentTime=0,await fetch(`${S}/read-write/fftConfig/${E}`,{method:"GET",credentials:"include"}).then(async I=>{if(St.current=0,Bt.current=0,Tt.current=0,!I.ok){ue.current=null;return}const K=await I.json();ue.current=JSON.parse(K),console.log(ue.current);const se=ue.current.fftSize*1,le=He/ue.current.interval;dt.current=new Int16Array(le*se),console.log("New buffer!")}),u.current.src!==j(E))u.current.src=j(E);else{d.current=0;return}u.current.play(),clearTimeout(te.current),o(E),wt.current=E,c(!0),En(E),console.log("Fading in",u.current),fe.current==="A"?(y?It(l,null):(It(l,h),h.current.addEventListener("timeupdate",Le),h.current.addEventListener("ended",$e)),l.current.removeEventListener("timeupdate",Le),l.current.removeEventListener("ended",$e)):fe.current==="B"&&(y?It(h,null):(It(h,l),l.current.addEventListener("timeupdate",Le),l.current.addEventListener("ended",$e)),h.current.removeEventListener("timeupdate",Le),h.current.removeEventListener("ended",$e))},js=async(g,y,E)=>{if(!ue.current)return dt.current=null,null;const I=ue.current.fftSize*1*2,K=I*y,se=I*E,le=await fetch(`${S}/read-write/fft/${g}`,{headers:{Range:`bytes=${K}-${se-1}`}});if(!le.ok&&le.status!==206){console.error("Failed to stream FFT data");return}Tt.current=Math.floor(E);const Ne=await le.arrayBuffer(),ke=new Int16Array(Ne),Se=ue.current.fftSize*1,qe=ke.length/Se,ze=ue.current.interval,Re=He/ze;let Ce=St.current;for(let Oe=0;Oe<qe;Oe++){const We=Oe*Se,lr=(Ce+Oe)%Re;dt.current.set(ke.subarray(We,We+Se),lr*Se)}St.current=(Ce+qe)%Re},ys=()=>{mt.current.lastAudioTime=u.current.currentTime,mt.current.lastPerformanceNow=performance.now()},mn=()=>{const{lastAudioTime:g,lastPerformanceNow:y}=mt.current,E=(performance.now()-y)/1e3;return g+E},bs=()=>u.current.paused?u.current.currentTime:mn(),hn=(g,y)=>{const E=Math.round(1/ue.current.interval),I=Math.floor(y*E),K=Math.floor(Tt.current)-I,se=E*He;se-K<1||js(g,Math.floor(Tt.current),se+I)},fn=()=>{const g=Math.round(1/ue.current.interval),E=Math.floor(bs()*g)-Bt.current,I=He*g;return E%I},pn=()=>{if(!ue.current||!dt.current)return null;const g=ue.current.fftSize*1,y=fn();if(y===null)return null;const I=Math.floor(He/ue.current.interval)*g,K=y*g,se=K+g;return se>I?null:dt.current.slice(K,se)},Ns=()=>{te!=null&&te.current&&clearInterval(te.current)};n.useEffect(()=>{console.log("Changed inteval ref:",te.current)},[te.current]);const It=(g,y)=>{te.current&&clearInterval(te.current);const E=150;let I=0;console.log("Init fadeout for:",y.current),te.current=setInterval(()=>{const K=Math.min(1,Math.max(0,I*E/(O*1e3)));y.current.volume=K*be.current,g.current&&(g.current.volume=(1-K)*be.current),K>=1&&(clearInterval(te.current),te.current=null,y.current&&(g.current.pause(),g.current.src=null)),I++},E)},Le=()=>{var g;d.current=(g=u.current)==null?void 0:g.currentTime},$e=()=>{p.length>0&&p.length<=A+1&&zt()};n.useEffect(()=>{!me||A===-1||p.length===0||(qt(),console.log("init Autoplay",p,A,me,h.current,l.current),vs(A),ee(!1))},[p,A,me]),n.useEffect(()=>{$.current=A},[A]),n.useEffect(()=>{L.current=p},[p]);const gn=()=>{var g,y;if(!u.current&&L.current.length>0){N(0),ee(!0);return}if(m)(g=u.current)==null||g.pause(),c(!1),clearTimeout(H.current),clearInterval(te.current);else{if(c(!0),A===-1&&p.length!==0){N(0);return}(y=u.current)==null||y.play(),At()}},xn=(g,y=!1)=>{fetch(`${S}/read-write/nextSongs/${X.type}/${X.id}/${y}`,{method:"GET",credentials:"include"}).then(E=>E.json()).then(E=>{f(E),console.log(E),N(E.findIndex(I=>I===g)),ee(!0)})},vn=g=>{f([g]),N(0),ee(!0)},jn=()=>{if(u.current.currentTime>5||A===0){u.current.currentTime=0,At();return}N(A-1),ee(!0)},yn=(g,y,E=!1)=>{ee(!1),fetch(`${S}/read-write/nextSongs/${y}/${g}/${E}`,{method:"GET",credentials:"include"}).then(I=>I.json()).then(I=>{f(I),N(0),ee(!0)})},bn=(g,y,E=!1)=>{ee(!1),fetch(`${S}/read-write/nextSongs/${y}/${g}/${E}`,{method:"GET",credentials:"include"}).then(I=>I.json()).then(I=>{f(K=>[...K,...I]),U("Queued!",V.QUEUE)})},Nn=(g,y,E=!1)=>{console.log(`${S}/read-write/nextSongs/${y}/${g}/${E}`),fetch(`${S}/read-write/nextSongs/${y}/${g}/${E}`,{method:"GET",credentials:"include"}).then(I=>I.json()).then(I=>{f(xt.shuffle(I)),ee(!0),N(0)})},kn=(g=!1)=>{const y=g?L.current:p,E=g?$.current:A;y.length<=E+1&&(zt(),console.log("stop")),N(E+1),ee(!0)},zt=()=>{qt(),d.current=0,c(!1),a(null),ee(!1),N(-1),v("null"),f([]),o(""),wt.current="",console.log("No more songs in the queue"),clearInterval(te.current),clearTimeout(H.current),Ns()},Sn=g=>{if(g<0||g>100)return;const y=g/100*u.current.duration;u.current.currentTime=y,d.current=y,At()},Tn=g=>{u.current.currentTime+g>u.current.duration?u.current.currentTime=u.current.duration:u.current.currentTime+g<0?u.current.currentTime=0:u.current.currentTime+=g,d.current=u.current.currentTime},wn=g=>{g<0||g>=p.length||(ee(!0),N(g))},En=g=>{fetch(`${S}/read-write/trackCover/${g}`,{method:"GET"}).then(y=>y.json()).then(y=>{v(`${S}/covers/${y}`)})},Rn=()=>{zt(),f([]),N(-1)},Wt=()=>{fetch(`${S}/config/user/FFT`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{ds.current=g})};n.useEffect(()=>{z(parseFloat(localStorage.getItem("volume"))||.5),ln(),Gt.pathname==="/full-screen"&&(Ze.current="",ht.current=!0),Wt();const g=M("login",Wt);return()=>{un(),g()}},[]);const Cn=async g=>{const y=await fetch(`${S}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!y.ok)throw new Error("Network response was not ok");const I=(await y.json()).map(K=>K.id);f(K=>[...K,...I])},An=async g=>{const y=await fetch(`${S}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!y.ok)throw new Error("Network response was not ok");const I=(await y.json()).map(K=>K.id);f(xt.shuffle(I)),ee(!0),N(0)},In=async()=>{fetch(`${S}/read-write/all-songs`,{method:"GET"}).then(g=>g.json()).then(g=>{f(xt.shuffle(g)),ee(!0),N(0),U("Playing the library in shuffle",V.INFO)})},Fn=g=>{console.log("Editing album",g),fetch(`${S}/read-write/album/${g}`,{method:"GET",credentials:"include"}).then(y=>y.json()).then(y=>{const{albumInfos:E,genres:I,tracks:K,artists:se}=y;b({id:g,coverURL:`${S}/covers/${E.cover}`,tracks:K,type:"album",name:E.title,artist:se.map(le=>le.name),year:E.release_date,description:E.description,genre:I.map(le=>le.genreName)})})},Pn=g=>{fetch(`${S}/read-write/playlist/${g}/true`,{method:"GET",credentials:"include"}).then(y=>y.json()).then(y=>{const{playlistInfos:E,collaborators:I}=y;b({id:E.id,type:"playlist",coverURL:E.cover?`${S}/covers/${E.cover}`:null,name:E.title,description:E.description,collaborators:I})})};n.useEffect(()=>{const g=Math.min(1,Math.max(0,_));te.current||Ln(g.toFixed(4)*.75),be.current=g.toFixed(4)*.75,localStorage.setItem("volume",g)},[_]);const Ln=g=>{Q.current&&clearInterval(Q.current);let y=0;const E=16,I=h.current.volume;Q.current=setInterval(()=>{const K=Qe(I,g,y*E/300);h.current.volume=K,l.current.volume=K,(g-I>0?K>=g:K<=g)&&(clearInterval(Q.current),Q.current=null),y++},E)},$n=(g,y=null)=>{if(!g){console.log("No changes made"),C(null);return}const E=new FormData;E.append("artist",JSON.stringify(g)),y&&E.append("coverArtist",y),fetch(`${S}/read-write/editContainer/artist`,{method:"POST",credentials:"include",body:E}).then(()=>{C(null),W.current()})},On=g=>{fetch(`${S}/read-write/artist/${g}/true`,{method:"GET",credentials:"include"}).then(y=>y.json()).then(y=>{C({id:y.id,picture:`${S}/covers/artists/${y.picture}`,name:y.name,bio:y.bio,active_from:y.active_from})})},ks=(g,y=null)=>{if(!g){console.log("No changes made"),b(null);return}const E=new FormData;E.append(`${g.type}`,JSON.stringify(g)),y&&E.append("cover",y),fetch(`${S}/read-write/editContainer/${g.type}`,{method:"POST",credentials:"include",body:E}).then(()=>{b(null),W.current()})},Mn=async(g,y)=>{const E=g?"/forMe":"";(await fetch(`${S}/read-write/delete/album/${y.id}${E}`,{method:"DELETE",credentials:"include"}).then(K=>K.json())).success&&(U(`Album ${y.name} deleted.`,V.SUCCESS),b(null),re("/home"))},Un=async()=>{q(!0)},_n=(g,y)=>{console.log("sending playlist",g);const E=new FormData;E.append("playlist",JSON.stringify(g)),y&&(E.append("cover",y),console.log(y)),fetch(`${S}/read-write/newPlaylist`,{method:"POST",credentials:"include",body:E}).then(()=>{q(!1),Y.current()})},Bn=g=>{N(0),f([g]),ee(!0)},Gn=()=>{q(!1)},Dn=()=>{b(null)},Vn=(g,y,E,I)=>{T({track:y,position:g}),D.current&&D.current(),D.current=E,Z.current=I},Hn=()=>{T(null),D.current&&D.current()},qn=(g,y,E=null)=>{switch(Hn(),g){case Me.NONE:return;case Me.TOP_QUEUE:Wn(y);break;case Me.END_QUEUE:Kn(y);break;case Me.GOTO_ALBUM:zn(y);break;case Me.REMOVE_FROM_PLAYLIST:Qn(y);break;case Me.TAGS:xe(y),U("Avaliable soon :)",V.INFO);break;case Me.ADD_TO_FAVORITES:console.log(y),Kt(y.id,!0,Z.current);break;case Me.REMOVE_FROM_FAVORITES:Kt(y.id,!0,Z.current);break}},zn=g=>{fetch(`${S}/read-write/trackAlbumId/${g.id}`,{method:"GET"}).then(y=>y.json()).then(y=>{re(`albums/${y}`)})},Wn=g=>{const y=p;y.splice(A+1,0,g.id),f(y),U(`${g.title} playing next.`,V.SUCCESS)},Kn=g=>{const y=p;y.push(g.id),f(y),U(`${g.title} playing at the end.`,V.INFO)},Qn=g=>{fetch(`${S}/read-write/deleteTrackFromPlaylist/${X.id}/${g.id}`,{method:"DELETE",credentials:"include"}).then(y=>y.json()).then(y=>{W.current(),U(`${g.title} removed.`,V.SUCCESS)})},Jn=(g,y)=>{W.current=y,pe(g)},Yn=(g,y)=>{if(xe(null),!g)return;const E=new FormData;E.append("current",JSON.stringify(g.current)),E.append("deleted",JSON.stringify(g.deleted)),fetch(`${S}/read-write/changeTrackTags/${y}`,{method:"POST",credentials:"include",body:E}).then(I=>I.json()).then(I=>{U("Tags upated!",V.SUCCESS)})},Xn=async(g=[],y)=>{g.length!==0&&(f(g),N(y||0),ee(!0))},Zn=()=>{G(!0)},er=()=>{G(!1)},tr=()=>{ht.current=!ht.current,ht.current&&(Ze.current=Gt.pathname),console.log(Ze.current),re(ht.current?"/full-screen":Ze.current&&Ze.current!=="/full-screen"?Ze.current:"/home")},sr=()=>new Promise(g=>{fetch(`${S}/read-write/getSongMetaDataCover/${s}`,{method:"GET",credentials:"include"}).then(y=>y.blob()).then(y=>{hs.current={track:s,blob:y},g({track:s,blob:y})})}),nr=g=>{u.current&&(u.current.currentTime+=(g?1:-1)*10)},rr=()=>{const{history:g,pointer:y}=Dt;if(g.every(se=>se===null)){re("/home");return}let E=(y-2+g.length)%g.length,I=g[E],K=0;for(;(!I||I==="/full-screen")&&K<g.length||I===Gt.pathname;)E=(E-1+g.length)%g.length,I=g[E],K++;Dt.pointer=E,re(I||"/home")},ar=()=>{(r==null?void 0:r.type)==="radio"&&fetch(`${S}/radio/addToFavs/${r.uuid}`,{method:"POST",credentials:"include"}).then(async g=>({json:await g.json(),ok:g.ok})).then(g=>{U(g.json.message,V.INFO),console.log(g),g.ok&&k("refetch-known-radios")}).catch(g=>{U("An error occured, you may check server logs."+g.code,V.ERROR)})},or=(g,y)=>{var K,se;if(((K=ft.current)==null?void 0:K.track)===s&&((se=ft.current)==null?void 0:se.pairs.length)>0){y();return}const I=new rt().getPalette(g.current,10);ps.current=I,cr(I),console.log("recomputed"),console.log(ft.current),y()},cr=g=>{const y=[];for(let E=0;E<g.length;E++)for(let I=E+1;I<g.length;I++)y.push({c1:g[E],c2:g[I],contrast:ka(g[E],g[I])});ft.current={track:s,pairs:y.sort((E,I)=>E.contrast-I.contrast)}},ir=()=>{window.screen.width<820&&fs(!0)};n.useEffect(()=>{Vt.current&&Ht.current&&(Vt.current.style.display=Et?"none":"flex",Ht.current.style.display=Et?"none":"flex")},[Et]);const Kt=async(g,y,E)=>{fetch(`${S}/read-write/toggleFavorite/${g}/${y}`,{method:"GET",credentials:"include"}).then(I=>I.json()).then(I=>{E(I),console.log(r.id,g),r.id===g&&(r.isFav=I)})};return e.jsxs(Xs.Provider,{value:{songRawPalette:ps,currentDisplayedPage:Ht,mobileMusicPlayRef:Vt,toggleTrackFavorite:Kt,setTrackMobileView:fs,openTrackMobileView:ir,recomputeColors:or,songPalette:ft,skipAudioSeconds:nr,toggleCurrentRadioToFavorites:ar,externalRadioInfos:Ee,playRadio:Bn,navigateBack:rr,history:Dt,colorOverride:cn,requestNewFullScreenImage:sr,fullScreenImage:hs.current,toggleFullScreenView:tr,fetchFFTUserSettings:Wt,FFTUserSetingsRef:ds,fftConfigRef:ue,getFFTAtCurrentTime:pn,deleteAlbum:Mn,editArtist:On,playContainer:yn,closeTagWindow:er,openTagWindow:Zn,saladContext:ae,setSaladContext:ge,playAudioSalad:Xn,linkNewContainer:Jn,trackActionTypes:Me,onClicTrackActionEntry:qn,openTrackActions:Vn,getNextSongsFromAlbum:xn,currentTrackData:r,currentTimeRef:d,isPlaying:m,toggleTrackPaused:gn,playNextSong:kn,trackCoverUrl:x,playPreviousSong:jn,playingTrack:s,jumpTrackSeconds:Tn,jumpToPercent:Sn,addContainerToQueue:bn,playContainerSuffle:Nn,playQueue:p,queuePointer:A,jumpToQueueTrack:wn,deleteQueue:Rn,addArtistToQueue:Cn,shuffleArtistToQueue:An,playTrackNoQueue:vn,playLibraryShuffle:In,setVolume:z,volume:_,editAlbum:Fn,editPlaylist:Pn,createNewPlaylist:Un,globalAudioRef:u,setPlaylistAddedCallback:g=>{Y.current=g}},children:[t,R?R.type==="album"?e.jsx(wa,{applyCanges:ks,albumClass:R}):R.type==="playlist"?e.jsx(ws,{closeOverlay:Dn,editPlaylistClass:R,applyCanges:ks}):null:null,P&&e.jsx(Ia,{applyChanges:$n,artist:P}),F&&e.jsx(ws,{closeOverlay:Gn,applyCanges:_n}),B?e.jsx(Ra,{isFav:(X==null?void 0:X.favPlaylist)||!1,trackY:B.position.y,track:B.track}):null,je&&e.jsx(Ca,{apply:Yn,track:je}),w&&e.jsx(Aa,{}),Et&&e.jsx(Oa,{})]})},ce=()=>{const t=n.useContext(Xs);if(t===void 0)throw new Error("useAudioPlayer must be used within an AudioPlayerProvider");return t},ut=n.memo(({percent:t,text:s=null,showPercent:o=!1,isMarquee:m=!1,fillColor:c="#fffdff",style:r={},initialising:a=!1,initialisingColor:d="white",onClickPercentage:u=null,minWidth:h=0})=>{const l=n.useRef(null),p=f=>{if(a||!u)return;const x=f.currentTarget,v=x.getBoundingClientRect().x,j=f.clientX;u((j-v)/x.clientWidth*100)};return n.useEffect(()=>{l.current&&l.current.style.setProperty("--progress",`${t}%`)},[t]),e.jsxs("div",{className:"progressBar",style:{...r,minWidth:h},onClick:p,children:[e.jsx("div",{className:"progressFill",ref:l,style:{background:c,...r}}),a&&e.jsx("div",{className:"progressFill",init:"init",style:{backgroundColor:d,opacity:.5,...r}}),o&&e.jsx("span",{className:"progressPercent",children:t+"%"}),s&&e.jsx("span",{className:"progressPercent",style:{margin:"auto"},children:s})]})},(t,s)=>t.text===s.text&&t.initialising===s.initialising&&t.percent===s.percent),Zs=({})=>{const{currentTrackData:t,currentTimeRef:s,jumpToPercent:o}=ce(),[m,c]=n.useState(0);return!t||Object.keys(t).length===0?null:(n.useEffect(()=>{const r=setInterval(()=>{c(s.current)},100);return()=>clearInterval(r)},[]),e.jsx("div",{className:"songProgress",children:e.jsxs("div",{children:[e.jsx("span",{id:"time-elapsed",children:os(m).readable}),e.jsx(ut,{percent:m/t.rawDuration*100,showPercent:!1,fillColor:"var(--violet-web-color)",style:{height:"10px"},onClickPercentage:o}),e.jsx("span",{id:"time-remaining",children:t.duration.readable})]})}))},_a=n.memo(({id:t,isActive:s,setActive:o,contextName:m})=>e.jsx("div",{className:"index",id:`${m}-index_${t}`,onClick:()=>o(t),"data-active":s?"active":"","data-clickable":!!o}),(t,s)=>t.id===s.id&&t.isActive===s.isActive&&t.contextName===s.contextName),cs=({context:t,active:s,setActive:o})=>e.jsx("div",{className:`activeIndex-container ${t.name}`,children:Array.from({length:t.length},(m,c)=>e.jsx(_a,{id:c,isActive:s===c,setActive:o,contextName:t.name},c))}),en=n.memo(function({currentActive:s,onClick:o,data:m}){const[c,r]=n.useState(s);n.useEffect(()=>{r(s)},[s]);const a=d=>{r(d),o==null||o(d)};return e.jsx("div",{className:"job-view-div",children:m.map((d,u)=>e.jsx("div",{className:"cornered-button","data-active":c===u,onClick:()=>{a(u)},children:d},u))})}),Ba=({fromFile:t,setFromFile:s,tracksSelected:o,initMetadataFetching:m})=>{const[c,r]=n.useState(!1),[a,d]=n.useState(""),u=l=>{r(!0),l.target.files&&(console.log("New tracks"),o(Array.from(l.target.files)),l.target.files=null)},h=l=>{d(l.target.value)};return e.jsxs("div",{className:"addMusicSource",children:[e.jsxs("div",{className:"add-audio-source-selection",children:[e.jsx("p",{children:"Select the source: "}),e.jsx(en,{currentActive:t?0:1,onClick:l=>{s(l==0)},data:["From file","From URL"]})]}),t?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Select files from a local storage."}),e.jsxs("div",{className:"add-music-input",children:[e.jsxs("label",{htmlFor:"files",className:"file-select",children:[e.jsx(Ar,{}),e.jsx("span",{children:"Select file"})]}),e.jsx("input",{id:"files",multiple:!0,type:"file",accept:"audio/*",onChange:u})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Link to a radio steam."}),e.jsxs("div",{className:"add-music-input",children:[e.jsx("input",{type:"text",placeholder:"Enter URL",onChange:h}),e.jsx(ie,{onClick:async()=>{m(a)},text:"Resolve",icon:e.jsx(Ir,{})})]})]}),c&&e.jsx("p",{children:"Hold a sec'.. The metadata fetch is about to beggin."})]})},bt=({text:t,progressBar:s={useProgressBar:!1}})=>e.jsxs("div",{className:"loading-container",children:[e.jsx("h3",{children:t}),s.useProgressBar?e.jsx(ut,{percent:s.percent,showPercent:s.showPercent,isMarquee:s.isMarquee,fillColor:s.fillColor,style:{height:"25px"}}):e.jsx("p",{children:"Loading..."})]}),Ga=({addNewMusic:t})=>e.jsx("div",{className:"album-card",context:"add",children:e.jsx(Fr,{strokeWidth:.7,className:"album-card-cover",onClick:t})}),Da=({album:t,deleteAlbum:s,editAlbum:o})=>e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(ct,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t.uuid)}),e.jsx(Us,{className:"album-card-overview-button",use:"edit",onClick:()=>o(t.uuid)}),e.jsxs("div",{className:"album-card-overview-button",use:"song-count",children:[e.jsx(Pr,{className:"song-count-icon"}),e.jsx("span",{children:t.tracks.length})]}),e.jsx("img",{src:t.coverURL,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Je(t.name,25)}),e.jsx("p",{className:"album-artist",children:Je(t.artist.join(","),25)||"No artist"})]}),Va=({radio:t,deleteRadio:s})=>(console.log(t),e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(ct,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t[0])}),e.jsx("img",{src:t[1].favicon==""?null:t[1].favicon,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Je(t[1].name,25)})]})),Ha=({albums:t,radios:s,deleteRadio:o,addNewMusic:m,deleteAlbum:c,editAlbum:r,publish:a})=>{const d=t.map((l,p)=>e.jsx(Da,{album:l,deleteAlbum:c,editAlbum:r},`alb-${p}`)),u=[...s].map((l,p)=>e.jsx(Va,{radio:l,deleteRadio:o},`rad-${p}`)),h=[...d,...u];return console.log("rerun"),h.push(e.jsx(Ga,{addNewMusic:m},-1)),e.jsxs("div",{className:"albums-overview",children:[e.jsx("div",{className:"album-overview-container",children:h.reverse()}),(t.length>0||s.size>0)&&e.jsx("button",{className:"roundButton",id:"publish-to-library",onClick:a,children:"Publish to library"})]})},qa=({track:t,onClose:s})=>{const{albums:o,moveTrackToNewAlbum:m,moveTrackToAlbum:c,editingAlbum:r,setEditingAlbum:a}=Qa(),[d,u]=n.useState(""),[h,l]=n.useState(!1),p=n.useRef(null),f=v=>{v.preventDefault(),!d&&v.target.existingAlbum.value?c(t,v.target.existingAlbum.value):d!==""&&m(t,d),h&&a(null),s()},x=v=>{u(v.target.value)};return n.useEffect(()=>{o.find(({uuid:j})=>j===r).tracks.length===1?l(!0):l(!1);const v=j=>{var A;if(p.current&&!p.current.contains(j.target)){if(((A=j.target.closest("svg"))==null?void 0:A.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",v),document.addEventListener("touchstart",v),()=>{document.removeEventListener("mousedown",v),document.removeEventListener("touchstart",v)}},[]),e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:p,children:[e.jsx("h2",{children:"Move track to another album"}),h&&e.jsx("p",{className:"last-track-notify",children:"Last track of the album, if you move it, the current album will be deleted."}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:f,children:[e.jsx("label",{htmlFor:"newAlbum",children:"New album name"}),e.jsx("input",{type:"text",id:"newAlbum",placeholder:"Enter album name",onChange:x}),e.jsx("label",{htmlFor:"existingAlbum",children:"Existing album"}),e.jsx("select",{id:"existingAlbum",onChange:()=>u(""),children:o.map((v,j)=>v.uuid===r?null:e.jsx("option",{value:v.uuid,children:v.name},j))}),e.jsx("input",{type:"submit",value:"Submit"})]})]})})},za=({setEditUid:t,albumClass:s})=>{var l,p;const[o,m]=n.useState({visible:!1,track:null}),[c,r]=n.useState(null),a=n.useRef(null);if(!s)return null;n.useEffect(()=>{s&&r(s.coverURL)},[s]);const d=()=>{const f=a.current;s.name=f.albumName.value,s.artist=f.artistName.value.split(",").map(v=>v.trim()),s.year=f.releaseDate.value;const x=f.genre.value.split(",").map(v=>v.trim()).map(v=>v.charAt(0).toUpperCase()+v.slice(1));s.genre=x.filter(v=>v!=""),s.description=f.description.value,t(null)},u=f=>{const x=f.target.files[0];x&&r(s.setCoverFromFile(x))},h=f=>{m({visible:!o.visible,track:f})};return e.jsxs("div",{className:"albumWrapping",children:[e.jsxs("div",{className:"albumCover",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[c?e.jsx("img",{id:"coverPicture",src:c,style:{width:"100%"}}):e.jsx(ne,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(Nt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:u})]}),e.jsx("button",{className:"roundButton go-back",onClick:()=>d(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",ref:a,children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(l=s.artist)==null?void 0:l.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",defaultValue:s.year})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(p=s.genre)==null?void 0:p.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Fe,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:f,style:x})=>e.jsxs("div",{style:x,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[f].title}),e.jsx(Ls,{className:"trackIcon",onClick:()=>{h(s.tracks[f])}})]},f)})})]}),o.visible&&e.jsx(qa,{onClose:()=>{m({visible:!1})},track:o.track})]})};class As{constructor(s,o,m,c,r){this.name=s,this.artist=o,this.year=m,this.tracks=[],this.setCover(c),this.uuid=r}setCover(s){!s||this.coverURL||(this.coverData=s.data,this.coverMime=s.format,this.coverURL=URL.createObjectURL(new Blob([this.coverData],{type:this.coverMime})),this.ext=this.coverMime.split("/")[1],this.sourceIsBinary=!0)}setCoverFromFile(s){return this.coverURL=URL.createObjectURL(s),this.coverFile=s,console.log("Setting cover from file: ",s),this.ext=s.type.split("/")[1],this.coverURL}addTrack(s){s&&(this.tracks.push(s),s.album=this)}removeTrack(s){s&&(this.tracks=this.tracks.filter(o=>o.id!==s.id),s.album=null)}getPuredData(){return{name:this.name,artists:this.artist,year:this.year,uuid:this.uuid,ext:this.ext}}getPuredCover(){if(!this.sourceIsBinary)return this.coverFile?(console.log("Using file reference for cover: "+album.coverFile),this.coverFile):null;if(console.log("Using binary reference for cover: ",this.uuid),!this.coverData||this.coverData.length===0)return console.log("returned no cover at",this.uuid),null;const s=new Uint8Array(this.coverData),o=new Blob([s],{type:this.coverMime});return new File([o],`${this.uuid}.${this.coverMime.split("/").pop()}`,{type:this.coverMime})}}class Wa{constructor(s){this.id=yt(),this.file=s,this.album=null,this.albumName="",this.artists=[],this.title=s.name,this.no=1,this.duration=0,this.year=2003,this.picture=null}setPicture(s){this.picture=s}setAdditionalData(s="",o="",m=1,c=0,r=2e3,a=[]){this.title=o,this.no=m,this.duration=c,this.year=r,this.artists=a,this.albumName=s}setAlbum(s){this.album=s}getUrl(){return URL.createObjectURL(this.file)}getArtists(){return this.artists?this.artists.map(s=>s.trim()):["Unknown artist"]}getPuredTrackMeta(){return{albumUuid:this.album.uuid,duration:this.duration,no:this.no,year:this.year,title:this.title,id:this.id}}}const tn=n.createContext(),Ka=({closeOverlay:t,uploadPercent:s,uploadProgress:o,uploadFinished:m,isMinimize:c,setMinimized:r})=>{const[a,d]=n.useState(!0),[u,h]=n.useState(0),[l,p]=n.useState(0),[f,x]=n.useState(0),[v,j]=n.useState([]),[A,N]=n.useState(!1),[L,$]=n.useState(null),[R,b]=n.useState(0),[P,C]=n.useState(0),[k,M]=n.useState(""),{addNotification:W,notifTypes:B}=Pe(),[T,D]=n.useState(new Map),U=n.useRef([]),V=n.useRef([]),{emit:re}=ve(),X=n.useRef(null),pe=async F=>{if(F.length===0)return;x(F.length);const q=F.map(w=>new Wa(w));X.current=q,je()},je=async()=>{const F=await ge(),q=F.length>0?X.current.filter(w=>!F.includes(w.id)):X.current;console.log("Valid new tracks",q),U.current=[...U.current,...q],X.current=null,ae()},xe=()=>{V.current=V.current.filter(F=>F.tracks.length>0),N(!0),j(V.current)};n.useEffect(()=>{console.log("New albums ",v),!A&&(p(0),h(2))},[v]);const ae=()=>{function F(q){return V.current.find(w=>w.name===q)}for(const q of U.current){const w=F(q.albumName);if(w)w.addTrack(q);else{const G=yt(),Y=new As(q.albumName,q.getArtists(),q.year,q.picture,G);V.current.push(Y),Y.addTrack(q)}}j(V.current)},ge=async(F="")=>{if(!a){if(!F)return;console.log("Fetching meta at source",F);const w=await fetch(`${S}/radio/metadata/${encodeURIComponent(F)}`,{method:"GET"}).then(Z=>Z.json());if(w)W("Radio found! "+w[0].name,B.INFO);else{W("No radio found..",B.ERROR);return}const G=w[0];console.log(G);const Y=T;Y.set(G.stationuuid,{url:G.url_resolved,favicon:G.favicon,name:G.name}),D(Y),h(2);return}h(1);const q=[];return await Promise.all(X.current.map(async w=>{var Y,Z,te;const G=await pa(w.file).catch(Q=>{console.error("error at",file,Q),W(`Track ${w.title} seems corrupted, retry without it.`,B.ERROR)});if(!G){q.push(w.id);return}w.setAdditionalData(G.common.album||G.common.title,G.common.title||w.file.name,((Y=G.common.track)==null?void 0:Y.no)||0,G.format.duration||0,G.common.year,G.common.artists.map(Q=>Q.split(",")).flat(1).map(Q=>Q.trim())),w.setPicture((te=(Z=G.common)==null?void 0:Z.picture)==null?void 0:te[0]),p(Q=>Q+1)})),q},fe=F=>{const q=new Map([...T].filter(([w,G])=>w!=F));D(q)},H=F=>{U.current=U.current.filter(q=>q.album.uuid!==F),console.log("Deleted album, remaining tracks",U.current),V.current=V.current.filter(q=>q.uuid!==F),N(!1),j(V.current)},O=F=>{$(F)};n.useEffect(()=>{if(L===null||v.length===0){h(2);return}h(3)},[L]);const oe=(F,q)=>{const w=yt();console.log("Moving track: "+F.id+NaN+L+" to album: "+w),F.album.removeTrack(F);const G=new As(q,F.getArtists(),F.year,F.picture,q);V.current.push(G),G.addTrack(F),xe(),W(`Track ${F.title.substring(0,60)} got moved to album ${q}.`,B.INFO)},me=(F,q)=>{console.log("Moving track: "+F.id+NaN+L+" to album: "+q),F.album.removeTrack(F);const w=V.current.find(G=>G.uuid===q);w.addTrack(F),xe(),W(`Track ${F.title.substring(0,60)} got moved to album ${w.name}.`,B.INFO)},ee=async()=>{if(console.log("Publishing tracks: ",U.current),console.log("Publishing radios: ",T),T.keys().forEach(async F=>{const q=new FormData;console.log(T.get(F)),q.append("radioData",JSON.stringify({uuid:F,...T.get(F)}));const w=await fetch(`${S}/radio/newRadio`,{method:"POST",credentials:"include",body:q}).then(G=>G.json());console.log(w)}),U.current.length>0){h(4);for(const w of V.current){let G=new FormData;G.append("album",JSON.stringify(w.getPuredData()));const Y=w.getPuredCover();Y&&G.append("cover",Y);const Z=await fetch(`${S}/read-write/upload`,{method:"POST",body:G,credentials:"include"});if(!Z.ok)throw console.error("Error uploading albums:",Z.statusText),new Error("Error uploading albums");G=null,console.log("Album uploaded: "+w.name)}V.current.forEach(w=>{w.coverURL&&(URL.revokeObjectURL(w.coverURL),w.coverURL=null)});let F=U.current.reduce((w,G)=>w+G.file.size,0);b((F/1024/1024).toFixed(1));let q=0;for(const w of U.current){let G=new FormData;G.append("trackMeta",JSON.stringify(w.getPuredTrackMeta())),G.append("music",w.file),M(w.title),o({done:q,total:U.current.length}),await ga({method:"POST",data:G,withCredentials:!0,url:"/upload",baseURL:`${S}/read-write`,onUploadProgress:Y=>{const{total:Z,loaded:te}=Y,Q=Z/1e6,be=te/1e6;s(be/Q);const Ee=be/Q*100;C(Ee.toFixed(2))}}).catch(Y=>{console.error("Error uploading track:",Y)}).finally(()=>{q++}),G=null}}console.log("Upload finished"),m(),setTimeout(()=>{V.current=null,U.current=null,p(0),j([]);const F=T;F.clear(),D(F),h(0),$(null),C(0),re("musicUploaded")},750)},_=()=>{if(u!==4){t();return}r(!0)},z=()=>{switch(u){case 0:return e.jsx(Ba,{fromFile:a,setFromFile:d,tracksSelected:pe,initMetadataFetching:ge});case 1:return e.jsx(bt,{text:`Fetching metadatas.. ${f?l+"/"+f:"-/-"}`});case 2:return e.jsx(Ha,{albums:v,addNewMusic:()=>h(0),deleteAlbum:H,editAlbum:O,publish:ee,radios:T,deleteRadio:fe});case 3:return e.jsx(za,{setEditUid:$,albumClass:v.find(F=>F.uuid===L)});case 4:return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(bt,{text:`Publishing ${k} ${R}Mb..`,progressBar:{useProgressBar:!0,showPercent:!0,isMarquee:!1,percent:Number(P),fillColor:"var(--cool-green)"}}),e.jsx("p",{children:"You can close this overlay, the upload will continue. :)"})]});default:return e.jsx("div",{className:"addMusicSource",children:e.jsx("p",{children:"Not implemented yet"})})}};return e.jsx("div",{className:"addMusicRoot","data-minimized":c,children:e.jsx("div",{className:"addMusicContainer",children:e.jsxs(tn.Provider,{value:{albums:v,moveTrackToNewAlbum:oe,editingAlbum:L,moveTrackToAlbum:me,setEditingAlbum:$},children:[e.jsx(ye,{className:"buttonRound closeOverlay",onClick:_}),e.jsx("h2",{children:"Add Music"}),e.jsx(cs,{context:{name:"AddMusic",length:5},active:u,setActive:h}),e.jsx(z,{})]})})})},Qa=()=>n.useContext(tn),Ja=50,Ya=({hideComponent:t})=>{const{playQueue:s,deleteQueue:o,jumpToQueueTrack:m,queuePointer:c}=ce(),r=n.useRef(null),{subscribe:a}=ve(),d=n.useRef(new Map),[u,h]=n.useState(0);n.useEffect(()=>{const p=x=>{var v;if(r.current&&!r.current.contains(x.target)){if(((v=x.target.closest("svg"))==null?void 0:v.id)==="playlist-button")return;t()}},f=a("action-bar-open",()=>{t()});return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{f(),document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[]),n.useEffect(()=>{var p;h(((p=r.current)==null?void 0:p.offsetHeight)||0)},[r.current]);const l=p=>{p.stopPropagation(),p.preventDefault()};return e.jsxs("div",{className:"music-queue",ref:r,onTouchMove:l,children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Music Queue"}),s.length>0&&e.jsx(ct,{className:"buttonRound",id:"queue-trash",onClick:o})]}),s.length>0?e.jsx(Fe,{height:u,itemCount:s.length,itemSize:Ja,width:"100%",itemData:{playQueue:s,cacheRef:d,jumpToQueueTrack:m,queuePointer:c},children:Ys}):e.jsx("p",{children:"No items in the queue"})]})},Xa=n.memo(({payload:t})=>{const[s,o]=n.useState(!1);return e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Open a song's dropdown"}),e.jsxs("div",{id:"tuto-0-cooking-container",children:[e.jsx(ne,{className:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-cooking-songs-container",children:[e.jsxs("div",{className:"tuto-cooking-0-song-skeleton","data-target":!0,children:[e.jsx(ss,{id:"tuto-cooking-dots",onClick:()=>{o(!s)}}),s&&e.jsxs("div",{id:"tuto-0-cooking-dropdown",children:[e.jsxs("div",{className:"tuto-cooking-0-action-skeleton track-action-entry","data-target":"true",onClick:()=>{t(1)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(jt,{})]}),e.jsx("div",{className:"tuto-cooking-0-action-skeleton"})]})]}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"})]})]})]})}),Za=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Here you can remove and add tags:"}),e.jsxs("div",{id:"tuto-tags-1",children:[e.jsxs("div",{className:"tuto-search-skeleton",children:[e.jsx(Ue,{}),e.jsx("span",{id:"animated-write-span",children:"140BPM, roses, gaming, 2010s"}),e.jsx("div",{className:"blinking-cursor"})]}),e.jsxs("div",{id:"tuto-tags",children:[e.jsxs("div",{className:"small-tag",children:["Evening",e.jsx(ye,{})]}),e.jsxs("div",{className:"small-tag",children:["Chill",e.jsx(ye,{})]}),e.jsxs("div",{className:"small-tag",children:["Friends",e.jsx(ye,{})]}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:"Got it!"})]})]})]})),eo=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Cooking lets you play all the tracks mataching the tags:"}),e.jsx("div",{id:"tuto-tags-salad",children:e.jsxs("div",{id:"tuto-tags",children:[e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#a79cf5"}})]})}),e.jsxs("div",{id:"tuto-song-list",children:[e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}})}),e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})}),e.jsxs("div",{className:"tuto-tag-song-skeleton",children:[e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})]})]}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]})),to=[Xa,Za,eo],so=n.memo(()=>{const{onTutoialFinished:t}=kt(),[s,o]=n.useState(0),m=to[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{t(we.COOKING)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Manage tags and cook salads"}),e.jsx(cs,{context:{name:"tutorial",length:3},active:s,setActive:o}),e.jsx(m,{payload:r[s]})]})}),no=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Pick an album:"}),e.jsxs("div",{id:"tuto-genre-albums-container",children:[e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(ne,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]}),e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(ne,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]})]})]})),ro=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Edit the desired album:"}),e.jsxs("div",{id:"tuto-genre-0-lib",children:[e.jsx(ne,{id:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsxs("div",{id:"tuto-genre-0-header",children:[e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:e.jsx(ns,{})})]}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"})]})]})]})),ao=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Change the genre:"}),e.jsxs("div",{id:"tuto-genre-1-lib",children:[e.jsxs("div",{id:"tuto-genre-1-logo-btn",children:[e.jsx(ne,{id:"tuto-genre-logo"}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton","data-target":!0,children:e.jsx("span",{children:"Genre"})}),e.jsxs("div",{className:"tuto-genre-1-input-skeleton tuto-target","data-target":!0,children:[e.jsx("span",{id:"animated-write-span",children:"Rock, Breakcore, Soundtrack, .."}),e.jsx("div",{className:"blinking-cursor"})]})]})]})]})),oo=[no,ro,ao],co=n.memo(()=>{const{onTutoialFinished:t}=kt(),[s,o]=n.useState(0),m=oo[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{t(we.GENRES)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Add genre to albums"}),e.jsx(cs,{context:{name:"tutorial",length:3},active:s,setActive:o}),e.jsx(m,{payload:r[s]})]})}),we={GENRES:"genres",COOKING:"cooking"},is=new Map;is.set(we.GENRES,co);is.set(we.COOKING,so);const sn=({tutorialKey:t=we.GENRES})=>{const s=is.get(t)??(()=>e.jsx("div",{children:"Not found"}));return e.jsx("div",{className:"page-overlay-blur",children:e.jsx(s,{})})},nn=n.createContext(),J={SEARCH:"search",OPEN_ACTION_BAR:"open_action_bar",CLOSE_ACTION_BAR:"close_action_bar",PLAY_SONG:"play_song",OPEN_ALBUM:"open_album",OPEN_ARTIST:"open_artist",PLAY_LIBRARY_RANDOM:"play_library_random",TOGGLE_PLAY_PAUSE:"toggle_play_pause",OPEN_SETTINGS:"open_settings",VOLUME_UP:"volume_up",VOLUME_DOWN:"volume_down",OPEN_GENRE:"open_genre",TOGGLE_FULL_SCREEN:"toggle_full_screen",SKIP_PLUS:"skip_plus",SKIP_MINUS:"skip_minus"},Ge=[{name:"Search",code:J.SEARCH,description:"Search for a song, an album, a genra, an artist",key:"k",modifier:"ctrl",keywords:["search","find","look for","seek","search for","find for","look for for","seek for"],icon:()=>e.jsx(Ue,{className:"action-bar-current-logo"})},{name:"open action bar",code:J.OPEN_ACTION_BAR,description:"Give a command",key:" ",modifier:"ctrl",keywords:[]},{name:"Play the library in shuffle",code:J.PLAY_LIBRARY_RANDOM,description:"",key:"r",modifier:"ctrl",keywords:["play","shuffle","random","library","all","all songs","all albums","all artists"],icon:()=>e.jsx(it,{className:"action-bar-current-logo"})},{name:"Toggle Play pause",code:J.TOGGLE_PLAY_PAUSE,description:"",key:" ",modifier:"",icon:()=>e.jsx(it,{className:"action-bar-current-logo"})},{name:"Open settings",code:J.OPEN_SETTINGS,description:"",key:"p",modifier:"ctrl",keywords:["settings","configuration","config","preferences","options"],icon:()=>e.jsx(Lr,{className:"action-bar-current-logo"})},{name:"Volume up",code:J.VOLUME_UP,description:"",key:"ArrowUp",modifier:"",keywords:[],icon:()=>{}},{name:"Volume down",code:J.VOLUME_DOWN,description:"",key:"ArrowDown",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:J.SKIP_PLUS,description:"",key:"ArrowRight",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:J.SKIP_MINUS,description:"",key:"ArrowLeft",modifier:"",keywords:[],icon:()=>{}},{name:"Toggle color theme",code:J.TOGGLE_THEME,description:"Toggles the app dark or light theme.",key:"t",modifier:"ctrl",keywords:["dark","light","color","theme","color-theme","toggle"],icon:()=>e.jsx(Gs,{className:"action-bar-current-logo"})},{name:"Toggle full screen",code:J.TOGGLE_FULL_SCREEN,description:"Toggles the full screen mode.",key:"",modifier:"",keywords:["bars","wallpaper","full-screen","fft","spectrum","toggle"],icon:()=>e.jsx(Ds,{className:"action-bar-current-logo"})}],io=new qs(Ge,{keys:["keywords"],threshold:.3}),Te={DARK:"dark",LIGHT:"light"},lo=({children:t})=>{const s=n.useRef([]),[o,m]=n.useState(!1),c=n.useRef(o),[r,a]=n.useState(null),[d,u]=n.useState(!1),[h,l]=n.useState(null),[p,f]=n.useState(""),[x,v]=n.useState([]),[j,A]=n.useState(null),{playTrackNoQueue:N,playLibraryShuffle:L,toggleTrackPaused:$,setVolume:R,volume:b,toggleFullScreenView:P,skipAudioSeconds:C}=ce(),k=n.useRef(b),M=he(),W=Ve(),B=n.useRef(null),T=n.useRef(null),{addNotification:D,notifTypes:U}=Pe(),[V,re]=n.useState(()=>{const w=localStorage.getItem("CML_theme");return w?w===Te.LIGHT?(document.documentElement.classList.remove("dark"),Te.LIGHT):(document.documentElement.classList.add("dark"),Te.DARK):(localStorage.setItem("CML_theme",Te.LIGHT),Te.LIGHT)}),{emit:X,subscribe:pe}=ve();n.useEffect(()=>{window.addEventListener("keydown",xe),H();const w=G=>{B.current&&!B.current.contains(G.target)&&F()};return document.addEventListener("mousedown",w),document.addEventListener("touchstart",w),()=>{document.removeEventListener("mousedown",w),document.removeEventListener("touchstart",w),window.removeEventListener("keydown",xe),s.current=[]}},[]),n.useEffect(()=>{var w;h&&f(((w=h.description)==null?void 0:w.toString())||"")},[h]);const je=w=>{const G=localStorage.getItem("CML_FinishedTutorials"),Y=G?JSON.parse(G):{state:{}};Y.state[w]=!0,localStorage.setItem("CML_FinishedTutorials",JSON.stringify(Y)),X(`safe-finished-tutorial-${w}`)},xe=w=>{if(w.key=="Escape"&&c.current){F();return}if(w.key=="Escape"&&W.pathname==="/full-screen"){P();return}if(w.key=="Control"||h||!(w.ctrlKey||w.altKey||w.metaKey)&&(document.activeElement.nodeName==="INPUT"||document.activeElement.nodeName==="TEXTAREA"))return;const G=Ge.find(Y=>w.key===Y.key?!Y.modifier||Y.modifier===""?!0:{ctrl:w.ctrlKey,shift:w.shiftKey,alt:w.altKey,meta:w.metaKey}[Y.modifier]:!1);G&&(l(G),s.current.forEach(Y=>{Y.code===G.code&&(Y.callback(w),w.preventDefault())}))},ae=(w,G)=>{const Y={callback:w,code:G};s.current.push(Y)},ge=n.useRef($);ge.current=$;const fe=()=>{_e(()=>{m(!0),a(null),v(O()),T.current="command",l(Ge[1])},W.pathname)()};n.useEffect(()=>{k.current=b,D(`Volume : ${(b*100).toFixed(0)} %`,U.INFO)},[b]);const H=()=>{ae(()=>{if(T.current==="command"){F();return}fe()},J.OPEN_ACTION_BAR),ae(()=>{F()},J.CLOSE_ACTION_BAR),ae(()=>{if(T.current==="search"){F();return}m(!0),a(J.SEARCH),T.current="search"},J.SEARCH),ae(()=>{ge.current()},J.TOGGLE_PLAY_PAUSE),ae(()=>{M("/settings")},J.OPEN_SETTINGS),ae(()=>{R(Math.min(Math.max(k.current+.1,0),1))},J.VOLUME_UP),ae(()=>{R(Math.min(Math.max(k.current-.1,0),1))},J.VOLUME_DOWN),ae(()=>{C(!0)},J.SKIP_PLUS),ae(()=>{C(!1)},J.SKIP_MINUS)};n.useEffect(()=>{o&&document.getElementById("actionbar-searchbar").focus(),c.current=o},[o]),n.useEffect(()=>{switch(r){case J.SEARCH:u(!0),A(()=>e.jsx("div",{className:"action-bar-logo-container",children:e.jsx(Ue,{className:"action-bar-current-logo"})}));break;default:u(!0),A(null)}},[r]);const O=()=>[Ge[0],Ge[2],Ge[4]],oe=w=>{var Z;const G=w.target.value;if(G===""){v(O());return}if(r===J.SEARCH){ee(G);return}const Y=(Z=io.search(G))==null?void 0:Z.map(te=>te.item).filter(te=>{var Q;return((Q=te.keywords)==null?void 0:Q.length)>0});v(Y)},me=w=>{switch(w){case"track":return e.jsx(ts,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View album"})," ",e.jsx(Qt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View artist"})," ",e.jsx(Qt,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View genre"})," ",e.jsx(Qt,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},ee=async w=>{w===""||w.trim().length===0||fetch(`${S}/read-write/search/${w}`,{method:"GET",credentials:"include"}).then(G=>{if(G.ok)return G.json();throw new Error("Error fetching search results")}).then(G=>{const Y=[...G.tracks.map(Z=>({type:"track",...Z})),...G.albums.map(Z=>({type:"album",...Z})),...G.artists.map(Z=>({type:"artist",...Z})),...G.genres.map(Z=>({type:"genre",...Z}))].map(Z=>{const te=Z.path,Q=Z.id,{trackPath:be,...Ee}=Z;return{icon:()=>te?e.jsx("img",{className:"action-bar-entry-logo",src:`${S}/${Z.type==="artist"?"artist":"covers"}/${te}`,alt:Z.name}):e.jsx(ne,{className:"action-bar-entry-logo"}),tooltip:me,code:Z.type==="artist"?J.OPEN_ARTIST:Z.type==="album"?J.OPEN_ALBUM:Z.type==="genre"?J.OPEN_GENRE:J.PLAY_SONG,fileName:te,trackName:Q,...Ee}});v(Y)})},_=w=>{switch(w.code){case J.SEARCH:m(!0),a(J.SEARCH),l(Ge[0]),T.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),v([]);break;case J.CLOSE_ACTION_BAR:F();break;case J.PLAY_SONG:console.log("Playing song",w),N(w.trackName),F();break;case J.OPEN_ALBUM:F(),M(`/albums/${w.id}`);break;case J.OPEN_ARTIST:F(),M(`/artists/${w.id}`);break;case J.OPEN_GENRE:console.log("Opening genre",w),F(),M(`/genres/${w.id}`);break;case J.PLAY_LIBRARY_RANDOM:L(),F();break;case J.OPEN_SETTINGS:F(),M("/settings");break;case J.TOGGLE_THEME:z(),F();break;case J.TOGGLE_FULL_SCREEN:P(),F();break}},z=()=>{V===Te.DARK?(document.documentElement.classList.remove("dark"),localStorage.setItem("CML_theme",Te.LIGHT)):(document.documentElement.classList.add("dark"),localStorage.setItem("CML_theme",Te.DARK)),re(V===Te.DARK?Te.LIGHT:Te.DARK)},F=()=>{m(!1),a(null),T.current=null,v([])},q=()=>{m(!0),a(J.SEARCH),l(Ge[0]),T.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),v([])};return n.useEffect(()=>{o&&X("action-bar-open")},[o]),e.jsx(nn.Provider,{value:{commandCodes:J,openCommandBar:fe,openSearchBar:q,colorTheme:V,toggleColorTheme:z,onTutoialFinished:je},children:e.jsxs("div",{className:"action-bar-app-parent",children:[t,o&&e.jsx("div",{className:"global-action-bar",children:e.jsx("div",{className:"action-bar",ref:B,"data-search-mode":r===J.SEARCH,children:e.jsxs("div",{className:"action-bar-research",children:[j||null,e.jsx("input",{type:"text",id:"actionbar-searchbar",className:"searchbar",onChange:oe,placeholder:p}),e.jsx("div",{className:"action-bar-results",children:e.jsx(Fe,{height:300,itemCount:x.length,itemSize:50,width:"calc(100% - 0px)",children:({index:w,style:G})=>e.jsx(lt,{entry:x[w],style:G,onClick:_,className:"from-global-bar"},w)})})]})})})]})})},kt=()=>{const t=n.useContext(nn);if(!t)throw new Error("useGlobalActionBar must be used within a GlobalActionBar provider");return t},uo=({onClosed:t,hideComponent:s})=>{const{setVolume:o,volume:m}=ce(),c=n.useRef(null),{subscribe:r}=ve();return n.useEffect(()=>{const a=u=>{var h;if(c.current&&!c.current.contains(u.target)){if(((h=u.target.closest("svg"))==null?void 0:h.id)==="volume-button")return;s()}},d=r("action-bar-open",()=>{s()});return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),()=>{d(),document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[]),e.jsx("div",{ref:c,className:"volume-bar",children:e.jsx(ut,{onClickPercentage:a=>{console.log("change volume"),o(a/100)},style:{height:"10px"},fillColor:"rgb(118, 173, 206)",percent:m*100})})},mo=({percent:t,size:s=120,strokeWidth:o=10,useText:m=!0,style:c,color:r="rgb(130, 119, 196)"})=>{const a=(s-o)/2,d=2*Math.PI*a,u=d*(1-t);return e.jsxs("div",{className:"radial-container",style:{width:s,height:s,...c},children:[e.jsxs("svg",{width:s,height:s,children:[e.jsx("circle",{className:"radial-bg",stroke:"#e6e6e6",strokeWidth:o,fill:"none",cx:s/2,cy:s/2,r:a}),e.jsx("circle",{className:"radial-progress",stroke:r,strokeWidth:o,fill:"none",cx:s/2,cy:s/2,r:a,strokeDasharray:d,strokeDashoffset:u})]}),e.jsx("div",{className:"radial-label",children:m&&e.jsxs("span",{children:[Math.round(t),"%"]})})]})},ho=({fps:t=45})=>{const s=n.useRef(),o=n.useRef(null),{getFFTAtCurrentTime:m,fftConfigRef:c,globalAudioRef:r,FFTUserSetingsRef:a,fetchFFTUserSettings:d,colorOverride:u,currentTrackData:h}=ce(),l=n.useRef(0),p=n.useRef(!1),f=x=>{var j;if((h==null?void 0:h.type)=="radio"||p.current){cancelAnimationFrame(s.current);return}if(!o.current){s.current=requestAnimationFrame(f);return}const v=o.current.getContext("2d");if(v&&a.current){if(x-l.current<1e3/t){s.current=requestAnimationFrame(f);return}l.current=x;const A=5;v.clearRect(0,0,o.current.width,o.current.height);const N=m();if(!N){s.current=requestAnimationFrame(f);return}let L=N.subarray(Math.floor(N.length*.3),Math.floor(N.length*.6));const $=Math.max(1,L.length/A),R=new Array(A);R.fill(0);for(let C=0;C<L.length;C++)R[Math.floor(C/$)]+=Number(N[C]);let b=o.current.width/A-5,P=0;v.strokeStyle="#ffffff",v.fillStyle="#ffffff";for(let C=0;C<R.length;C++){const k=ya(Math.log2(R[C])*(A/5),5,25,0,1),M=Math.max(10,Math.min(80*k*((j=r.current)==null?void 0:j.volume),o.current.height-10));v.beginPath(),v.roundRect(2+P,(o.current.height-M)/2,b,M,7),v.fill(),v.stroke(),P+=b+5}}s.current=requestAnimationFrame(f)};return n.useEffect(()=>{if(!c.current){cancelAnimationFrame(s.current),console.log("No FFT data to display, releasing anim frame.");return}s.current=requestAnimationFrame(f),console.log("FFT found, requested animation frame.")},[c.current]),n.useEffect(()=>{const x=window.matchMedia("(max-width: 820px)"),v=j=>{p.current=j.matches,s.current=requestAnimationFrame(f),console.log("Canvas hidden?",p.current)};return v(x),x.addEventListener("change",v),()=>{x.removeEventListener("change",v)}},[]),e.jsx("canvas",{ref:o,id:"fft-canvas-small",className:"in-song-header",width:50,height:50})},Ot=({useText:t=!1,style:s={},className:o=""})=>{const m=n.useRef(null),{colorTheme:c,toggleColorTheme:r}=kt();return n.useEffect(()=>{m.current.setAttribute("data-color-theme",c)},[c]),e.jsxs("div",{style:s,className:`color-theme-btn ${o}`,children:[e.jsx(Gs,{id:"color-theme-svg",ref:m,className:"buttonRound",onClick:r}),t&&e.jsx("span",{children:Na(c.toString())})]})},_t=()=>{const[t,s]=n.useState(!1),[o,m]=n.useState(!1),[c,r]=n.useState(!1),[a,d]=n.useState(!1),[u,h]=n.useState(!1),[l,p]=n.useState({col1:"#000",col2:"#000"}),{currentTrackData:f,trackCoverUrl:x,volume:v,toggleFullScreenView:j,toggleCurrentRadioToFavorites:A,openTrackMobileView:N,mobileMusicPlayRef:L}=ce(),{openSearchBar:$}=kt(),[R,b]=n.useState(!1),[P,C]=n.useState(null),[k,M]=n.useState(null),W=he(),{subscribe:B}=ve();n.useRef(null);const[T,D]=n.useState(Ve().pathname==="/admin-pannel"),U=()=>{r(!0)};n.useEffect(()=>{const ae=B("openAddMusic",U);return()=>{ae()}},[]);const V=()=>{r(!1),M(null),C(null)};function re(){d(!a)}function X(){h(!u)}n.useEffect(()=>{const ae=[{col1:"#ffa585",col2:"#ffeda0"},{col1:"#9bf8f4",col2:"#6f7bf7"}];p(ae[Math.floor(Math.random()*ae.length)])},[]);const pe=()=>{b(!1),V()},je=()=>{if(!P){c?(V(),console.log("deactivate")):(U(),console.log("activate"));return}b(document.getElementsByClassName("addMusicContainer")[0]==null),console.log("toggle")},xe=ae=>{ae.stopPropagation(),j()};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header__logo",onClick:()=>W("/home"),children:[e.jsx(ne,{col1:l.col1,col2:l.col2}),e.jsx("h1",{children:"CML"})]}),e.jsx($t,{context:{mobile:!1}}),e.jsxs("div",{className:"musicPlayer",ref:L,onClick:N,children:[e.jsxs("div",{className:"playPauseContainer",children:[(f==null?void 0:f.type)=="radio"?f.coverUrl==""?e.jsx(ne,{className:"trackImage"}):e.jsx("img",{src:f.coverUrl,className:"trackImage"}):x.split("/").pop()==="null"?e.jsx(ne,{className:"trackImage"}):e.jsx("img",{src:x,className:"trackImage"}),e.jsx("div",{className:"playPauseButtons",onClick:xe,children:e.jsx(Ds,{style:{padding:"0px"}})})]}),!f||Object.keys(f).length===0?null:e.jsxs("div",{className:"trackinfos-parent",children:[e.jsxs("div",{className:"trackinfo-desktop",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{(f==null?void 0:f.type)!="radio"&&W(`/artists/${f.artistId}`)},children:f.artist}),e.jsx(Zs,{})]}),(f==null?void 0:f.type)==="radio"?e.jsx(vt,{id:"add-radio-fav",iconHovered:_s,iconDefault:Ut,onClick:A}):e.jsx(ho,{}),e.jsxs("div",{className:"trackinfo-mobile",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx($t,{context:{mobile:!0,radio:(f==null?void 0:f.type)==="radio",preserv:!0}})]})]})]}),e.jsxs("div",{className:"mobile-gost",children:[e.jsx(Bs,{id:"playlist-button",className:"buttonRound",onClick:()=>re()}),a&&e.jsx(Ya,{hideComponent:()=>d(!1)}),v<=1e-5?e.jsx($r,{className:"buttonRound",onClick:()=>X()}):v<.5?e.jsx(Or,{className:"buttonRound",onClick:()=>X()}):e.jsx(Mr,{id:"volume-button",className:"buttonRound",onClick:()=>X()}),u&&e.jsx(uo,{hideComponent:()=>h(!1)}),e.jsx(Ot,{})]}),e.jsxs("div",{className:"headerRight",children:[e.jsx(Ot,{className:"desktop-ghost"}),!T&&e.jsxs("div",{className:"serach-button-div",onClick:$,children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"K"})}),e.jsx(Ue,{})]}),e.jsxs("div",{style:{position:"relative",padding:"5px",display:"flex",justifyContent:"center"},className:"upload-music-header",children:[k&&e.jsx(mo,{percent:k,size:44,useText:!1,style:{position:"absolute",transform:"translate(-1px, -5.5px)"}}),e.jsx(rs,{style:{zIndex:"10",position:"relative"},className:"addMusicButton buttonRound",onClick:je}),P&&e.jsxs("span",{id:"upload-progress-tiny",children:[P.done,"/",P.total]})]}),e.jsx(ja,{})]}),c&&e.jsx(Ka,{uploadPercent:M,uploadFinished:pe,uploadProgress:C,isMinimize:R,setMinimized:b,closeOverlay:V})]})},fo=()=>{const[t,s]=n.useState(null),[o,m]=n.useState(null),[c,r]=n.useState(null),[a,d]=n.useState(null);n.useEffect(()=>{const l=setInterval(u,5e3);return u(),()=>clearInterval(l)},[]);const u=()=>{try{fetch(`${S}/isResponding`).then(l=>{l.status===200?(a===!1&&h(),d(!0)):d(!1)}).catch(l=>{console.error("Fetch failed (e.g., CORS error):",l),d(!1)})}catch(l){console.error("Unexpected error:",l),d(!1)}},h=()=>{fetch(`${S}/read-write/stats`,{method:"GET"}).then(l=>l.json()).then(l=>{s(l)}).catch(l=>console.error("Error fetching stats:",l)),fetch(`${S}/read-write/serverStats`,{method:"GET"}).then(l=>l.json()).then(l=>{m(Jt(l.coversByteUsage+l.tracksByteUsage).readable),r({perent:(1-l.free/l.size)*100,total:Jt(l.size).readable,free:Jt(l.free).readable})}).catch(l=>console.error("Error fetching server stats:",l))};return n.useEffect(()=>{h()},[]),e.jsxs("div",{className:"stat-short",children:[e.jsxs("div",{className:"stat-short-category",children:[e.jsxs("p",{children:["Library size: ",o]}),e.jsxs("p",{children:["Free ",c==null?void 0:c.free," of ",c==null?void 0:c.total]}),e.jsx(ut,{percent:(c==null?void 0:c.perent)||0,total:c==null?void 0:c.total,style:{height:"10px"},fillColor:"var(--chill-purple)",initialising:!o})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"5px"},children:[e.jsx("div",{className:"server-status-sprite",style:{width:"10px",height:"10px",borderRadius:"10px",backgroundColor:a?"lightgreen":"red"}}),e.jsxs("p",{children:["Server is ",a?"online":"offline"]})]})]})},po=()=>{const{openCommandBar:t}=kt();return e.jsxs("div",{className:"sidebar",children:[e.jsxs("nav",{children:[e.jsxs(tt,{id:"nav-recent",to:"/home",children:[e.jsx(Ur,{}),"Recent"]}),e.jsxs(tt,{to:"/playlists",children:[e.jsx(_r,{}),"Playlists"]}),e.jsxs(tt,{to:"/artists",children:[e.jsx(Br,{}),"Artists"]}),e.jsxs(tt,{to:"/genres",children:[e.jsx(Gr,{}),"Genres"]}),e.jsxs(tt,{to:"/cooking",children:[e.jsx(at,{}),"Cooking"]}),e.jsxs(tt,{to:"/radio",children:[e.jsx(Dr,{}),"Radio"]})]}),e.jsx(fo,{}),e.jsxs("div",{className:"serach-button-div",onClick:t,style:{margin:"auto",marginBottom:"20px"},children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"SPACE"})}),e.jsx(Vr,{})]})]})},Yt=n.memo(({path:t,display:s,Icon:o})=>{const m=he(),c=Ve();return e.jsxs("div",{className:"mobile-shortcut-entry","data-active":c.pathname===t,onClick:()=>{m(t)},children:[e.jsx(o,{}),e.jsx("span",{children:s})]})}),go=()=>e.jsxs("div",{id:"mobile-shortcut",children:[e.jsx(Yt,{path:"/home",display:"Home",Icon:Hr}),e.jsx(Yt,{path:"/radio",display:"Radio",Icon:Vs}),e.jsx(Yt,{path:"/Search",display:"Search",Icon:Ue})]}),xo=()=>{const t=he(),[s,o]=n.useState(!1),{currentDisplayedPage:m}=ce();if(n.useEffect(()=>{(async()=>{if((await(await fetch(`${S}/auth/verifyToken`,{method:"POST",credentials:"include"})).json()).success){o(!1);return}t("/")})()},[t]),s)return e.jsx(bt,{});const r=Ve().pathname,a=["/home"];return e.jsxs("div",{className:"app-container",children:[e.jsx(_t,{}),e.jsxs("div",{className:"content-container",ref:m,page:a.includes(r)?r:"inside",children:[e.jsx(po,{}),e.jsxs("div",{className:"content",children:[e.jsx(Ps,{})," "]}),e.jsx(go,{})]})]})},ls=({album:t,hideArtist:s=!1})=>{const o=he(),[m,c]=n.useState([]),[r,a]=n.useState(!1),d=n.useRef(null),u=h=>{o(`/albums/${h}`)};return n.useEffect(()=>{t.artists&&c(JSON.parse(t.artists).map(h=>h.name))},[t]),e.jsxs("div",{className:"album-card",onClick:()=>u(t.id),children:[t.cover?e.jsxs("div",{className:"",children:[!r&&e.jsx("div",{className:"skeleton-loader-album"}),e.jsx("img",{className:"album-card-cover",ref:d,src:`${S}/covers/${t.cover}`,onLoad:()=>a(!0),alt:t.title,style:{display:r?"block":"none"}})]}):e.jsx(ne,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Je(t.title,40)}),!s&&e.jsx("p",{className:"album-artist",children:Je(m.toString().replace(/,/g,", "),25)||"No artist"})]})},us=()=>{const{emit:t}=ve(),s=()=>{t("openAddMusic")};return e.jsxs("div",{className:"add-music-shortcut",children:[e.jsx("h2",{children:"Welcome to the Crystal Music Library !"}),e.jsxs("button",{onClick:s,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"15px",margin:"auto"},children:[e.jsx(rs,{}),e.jsx("h3",{style:{margin:"2px"},children:"Add music"})]})]})},vo=({})=>{const[t,s]=n.useState([]),[o,m]=n.useState(!1),{subscribe:c}=ve(),r=()=>{fetch(`${S}/read-write/albums`,{method:"GET",credentials:"include"}).then(d=>{if(d.status!==200){console.error("Error fetching albums");return}return d.json()}).then(d=>{s(d),m(!0)})};n.useEffect(()=>{_e(()=>{r()})();const u=c("musicUploaded",r);return()=>{u()}},[]);const a=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});return e.jsx("div",{className:"home album-displayer","data-no-tracks":(t==null?void 0:t.length)==0&&o?"true":"false",children:o?(t==null?void 0:t.length)!==0?t.map(d=>e.jsx(ls,{album:d},d.id)):e.jsx(us,{}):e.jsx(a,{})})},jo=()=>e.jsx("p",{children:" Your albums"}),Ae={FETCHING:"fetching",SUCCESS:"success",REJECTED:"rejected",NONE:"none"},yo=()=>{const t=n.useRef(Ae.NONE),[s,o]=n.useState(Ae.NONE),m=he(),{emit:c}=ve(),r=async u=>{if(u.preventDefault(),!u.target.email.value||!u.target.password.value){alert("Please fill in all fields");return}const h=new FormData(u.target),l=await fetch(`${S}/auth/login`,{method:"POST",credentials:"include",body:h}),p=await l.json();l.ok?(localStorage.setItem("username",p.username),t.current=Ae.SUCCESS):t.current=Ae.REJECTED,d()},a=()=>{switch(s){case Ae.FETCHING:return e.jsx(Qs,{});case Ae.SUCCESS:return e.jsxs("div",{className:"loginFeedback",sucess:"true",children:[e.jsx(ot,{className:"successIcon"}),e.jsx("span",{children:"Logged in"})]});case Ae.REJECTED:return e.jsxs("div",{className:"loginFeedback",sucess:"false",children:[e.jsx(ye,{className:"failIcon"}),e.jsx("span",{children:"Wrong credentials"})]});default:return null}},d=()=>{switch(o(t.current),t.current){case Ae.REJECTED:setTimeout(()=>{o(Ae.NONE)},1e3);break;case Ae.SUCCESS:setTimeout(()=>{c("login"),m("/home")},1e3);break}};return e.jsxs("div",{className:"authDiv",children:[e.jsx(Ot,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(ne,{}),e.jsx("h2",{children:"Login"}),e.jsx("p",{children:"We were not able to connect you, please login."}),e.jsxs("form",{onSubmit:r,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"password"}),e.jsx("button",{type:"submit",children:"Login "}),e.jsx("p",{children:"Don't have an account?"}),e.jsx("button",{onClick:()=>{m("/register")},children:"Register"})]}),e.jsx(a,{})]})},bo=[Be("#f8be99"),Be("#f495e9"),Be("#bbfbdf"),Be("#c4d3f8"),Be("#edc9f9"),Be("#909ef8"),Be("#96ebf4")],Pt=60,gt=Be("#242424"),rn=()=>{const[t,s]=n.useState([gt,gt]),o=n.useRef([]),m=n.useRef([gt,gt]),c=n.useRef(bo),r=n.useRef(0),a=n.useRef(0);n.useEffect(()=>(a.current=setInterval(u,1e3/Pt),()=>{clearInterval(a.current)}),[]);const d=()=>{const h=xt.sample(c.current);return c.current.filter(l=>l.join(",")!=h.join(",")),h},u=()=>{r.current%Pt===0&&(o.current[0]&&o.current[0]!==gt&&c.current.push(...o.current),o.current=m.current,m.current=[d(),d()]),s(o.current.map((h,l)=>m.current[l].map((p,f)=>parseInt(Qe(h[f],p,r.current%Pt/Pt))))),r.current+=1};return e.jsx("div",{id:"background-img",style:{"--col1":Ss(...t[0]),"--col2":Ss(...t[1])}})},nt=Object.freeze({LOGIN:"login",REGISTER:"register",ANY_USER:"any_user",VERIF_TOKEN:"verif_token"}),No=()=>{const t=he(),[s,o]=n.useState([]),[m,c]=n.useState(null),[r,a]=n.useState(!0);return n.useRef(null),n.useEffect(()=>{(async()=>{c(nt.ANY_USER);const h=await(await fetch(`${S}/auth/any-user`,{method:"GET"})).json();if(console.log("Parsed users",h),o(h),console.log(h),h===0){a(!1),c(nt.REGISTER);return}c(nt.VERIF_TOKEN);const p=await(await fetch(`${S}/auth/verifyToken`,{method:"POST",credentials:"include"})).json();if(a(!1),p.success){console.log("Token is valid"),t("/home");return}c(nt.LOGIN)})()},[t]),m===nt.REGISTER&&!r&&t("/register"),e.jsxs(e.Fragment,{children:[e.jsx(rn,{}),!r&&m===nt.LOGIN?e.jsx(yo,{}):null]})},an=({index:t,track:s,playIconId:o,isSalad:m=null,onClick:c,showCover:r=!1})=>{const{title:a,track_number:d,rawDuration:u}=s,{playingTrack:h,openTrackActions:l,toggleTrackFavorite:p}=ce(),f=s.id,[x,v]=n.useState("null"),[j,A]=n.useState(!1),[N,L]=n.useState(!1),$=()=>{if(m){m(t);return}c(s.id)},R=()=>{switch(o){case 0:return e.jsx(Wr,{className:"track-number",playing:"piano","data-show-cover":r});case 1:return e.jsx(zr,{className:"track-number",playing:"vinyl","data-show-cover":r});case 2:return e.jsx(Vs,{className:"track-number",playing:"piano","data-show-cover":r});case"salad":return e.jsx(at,{className:"track-number",playing:"piano","data-show-cover":r})}};n.useEffect(()=>{A(s.is_favorite===1),r&&fetch(`${S}/read-write/trackCover/${s.id}`,{method:"GET"}).then(M=>M.json()).then(M=>{v(`${S}/covers/${M}`)})},[]);const b=M=>{M.stopPropagation(),p(s.id,!j,A)},P=()=>{L(!1)},C=M=>{M.stopPropagation(),L(!0),l({x:M.clientX,y:M.clientY},s,P,k)},k=M=>{A(M)};return e.jsxs("div",{className:"track-view","action-bar":N?"open":"",onClick:$,children:[j&&e.jsx(Ut,{className:"track-favorite"}),e.jsx(vt,{className:"track-toggle-favorite",iconHovered:j?Zt:qr,iconDefault:j?Zt:$s,onClick:b}),r?x.split("/").pop()==="null"?null:e.jsx("img",{src:x,className:"track-mini-thumbnail"}):null,h===f?R():r?null:e.jsx("p",{className:"track-number",children:d}),e.jsx("p",{className:"track-name",style:{"--margin":r?"45px":"35px"},children:a}),e.jsx(ss,{className:"track-actions-dots",onClick:C}),e.jsx("p",{className:"track-length",children:os(u).readable})]})},Is=({isPlaylist:t=!1})=>{const[s,o]=n.useState(null),[m,c]=n.useState([]),[r,a]=n.useState([]),[d,u]=n.useState([]),[h,l]=n.useState(0),{addContainerToQueue:p,playContainerSuffle:f,editAlbum:x,editPlaylist:v,linkNewContainer:j,getNextSongsFromAlbum:A,navigateBack:N}=ce(),L=n.useRef(null),$=he(),[R,b]=n.useState([]),P=t?Lt().playlistId:Lt().albumId,[C,k]=n.useState(null),M=n.useRef(null),{notifTypes:W,addNotification:B}=Pe(),[T,D]=n.useState(!1),[U,V]=n.useState(!1),[re,X]=n.useState(!1);n.useEffect(()=>{pe()},[P,U]),n.useEffect(()=>{j({id:P,type:t?"playlist":"album",favPlaylist:T},pe)},[T]);const pe=()=>{fetch(`${S}/read-write/${t?"playlist":"album"}/${P}`,{method:"GET",credentials:"include"}).then(_=>{if(!_.ok)throw new Error("Network response was not ok");return _.json()}).then(_=>{l(Math.floor(Math.random()*3));const z=_.tracks.filter(q=>(!re&&q.is_favorite===1&&X(!0),U?q.is_favorite===1:!0));if(t){o(_.playlistInfos),c(z),u([_.owner,..._.collaborators]),D(_.isFavPlaylist);return}o(_.albumInfos);let F=0;for(let q=0;q<z.length;q++){const w=z[q];w.disc>F&&(z.splice(q,0,{disc:w.disc,type:"disc"}),F=w.disc)}c(z),a(_.genres),u(_.artists),D(!1)})},je=async()=>await p(P,t?"playlist":"album",U),xe=async()=>{f(P,t?"playlist":"album",U)},ae=()=>{if(t){v(P);return}x(P)},ge={TRACK:"track",ALBUM:"album",ARTIST:"artist",PLAYLIST:"playlist",GENRE:"genre"},fe=_=>{switch(_){case"track":return e.jsx(rs,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add album"})," ",e.jsx(Nt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add artist's discography"})," ",e.jsx(Xr,{className:"action-bar-entry-tooltip-logo"})]});case"playlist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire playlist"})," ",e.jsx(Yr,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire genre"})," ",e.jsx(Jr,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},H=_=>{const z=_.target.value;if(z===""||z.trim().length===0){b([]);return}console.log(`${S}/read-write/search/${z}`),fetch(`${S}/read-write/search/${z}`,{method:"GET",credentials:"include"}).then(F=>{if(F.ok)return F.json();throw new Error("Error fetching search results")}).then(F=>{var w,G,Y,Z,te;const q=[...(w=F.tracks)==null?void 0:w.map(Q=>({type:"track",...Q})),...(G=F.albums)==null?void 0:G.map(Q=>({type:"album",...Q})),...(Y=F.artists)==null?void 0:Y.map(Q=>({type:"artist",...Q})),...(Z=F.genres)==null?void 0:Z.map(Q=>({type:"genre",...Q})),...(te=F.playlists)==null?void 0:te.map(Q=>({type:"playlist",...Q})).filter(({id:Q})=>Q!==P)].map(Q=>{const be=Q.path,{trackPath:Ee,...ue}=Q;return{icon:()=>be?e.jsx("img",{className:"action-bar-entry-logo",src:`${S}/${Q.type==="artist"?"artist":"covers"}/${be}`,alt:Q.name}):e.jsx(ne,{className:"action-bar-entry-logo"}),tooltip:fe,code:Q.type==="artist"?ge.ARTIST:Q.type==="album"?ge.ALBUM:Q.type==="genre"?ge.GENRE:Q.type==="playlist"?ge.PLAYLIST:ge.TRACK,fileName:be,...ue}});console.log(q),b(q)})},O=_=>{C||setTimeout(()=>{requestAnimationFrame(()=>{var z;(z=M.current)==null||z.focus()})},0)},oe=_=>{const z=new FormData;z.append("addRequest",JSON.stringify({playlistId:P,endpoint:_.code,entryId:_.id,addAllToFavorite:T||!1})),fetch(`${S}/read-write/addToPlaylist`,{method:"POST",credentials:"include",body:z}).then(F=>F.json()).then(F=>{pe(),me(),B("Added to playlist",W.INFO)})};n.useEffect(()=>{const _=z=>{L.current&&!L.current.contains(z.target)&&me()};return document.addEventListener("mousedown",_),document.addEventListener("touchstart",_),()=>{document.removeEventListener("mousedown",_),document.removeEventListener("touchstart",_)}},[]);const me=()=>{k(!1),M.current.value="",b([])},ee=_=>{A(_,U)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:N,children:e.jsx(Ye,{})}),(s==null?void 0:s.cover)&&e.jsx("img",{src:`${S}/covers/${s.cover}`,className:"background-image",alt:"background"}),s&&m?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:s.title}),e.jsx("div",{className:"album-artists",children:d?d.map(_=>e.jsx("span",{className:"artist-name",onClick:()=>{$(`/${t?"users":"artists"}/${_.id}`)},children:_.name},_.id)):e.jsxs("span",{className:"artist-name",children:["Unknown ",t?"Members":"Artist"]})}),e.jsxs("div",{className:"album-content",children:[e.jsx("div",{className:"album-cover-genres",children:e.jsxs("div",{className:"album-cover-wrapper",children:[s.cover?e.jsx("img",{src:`${S}/covers/${s.cover}`,alt:`${s.title} cover`,className:"cover-image"}):e.jsx(ne,{className:"cover-image"}),e.jsx("div",{className:"genres-album-div",children:r.map((_,z)=>e.jsx("span",{className:"genre-album",onClick:()=>{$(`/genres/${_.genreId}`)},children:_.genreName},z))}),s.description&&e.jsx("p",{children:s.description})]})}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(ie,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:je}),e.jsx(ie,{text:"Random",icon:e.jsx(it,{}),onClick:xe}),!T&&e.jsx("button",{className:"button-with-callback",onClick:ae,children:e.jsx(ns,{})}),!T&&re&&e.jsx("button",{className:"button-with-callback","data-is-active":U,onClick:()=>{V(!U)},children:e.jsx(Kr,{})}),s.lossless===1&&e.jsxs("div",{className:"lossless",children:[e.jsx("span",{children:"Lossless"})," ",e.jsx(Qr,{})]})]}),t&&e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:L,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",onClick:O,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Ue,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:H,placeholder:"Search for tracks, artists, genres, playlists to add.",ref:M,onFocus:()=>{k(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${C?"block":"none"}`},children:e.jsx(Fe,{height:300,itemCount:R.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:_,style:z})=>e.jsx(lt,{entry:R[_],style:{...z,width:" calc(100% - 20px)",marginTop:"10px"},onClick:oe},_)})})]})}),m.map((_,z)=>(_==null?void 0:_.type)==="disc"?e.jsx("span",{children:`Disc ${_.disc}`},`disc-${z}`):e.jsx(an,{track:_,onClick:ee,playIconId:h,showCover:t},_.id))]})]})]}):e.jsx(bt,{text:"Loading album"})]})},ko=({artist:t})=>{const s=he(),[o,m]=n.useState(!1),c=r=>{s(`/artists/${r}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>c(t.id),children:[t.picture?e.jsxs(e.Fragment,{children:[!o&&e.jsx("div",{className:"skeleton-loader-album"}),e.jsx("img",{src:`${S}/covers/artists/${t.picture}`,alt:`${t.name} cover`,onLoad:()=>m(!0),className:"artist-card-cover"})]}):e.jsx(ne,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},So=()=>{const[t,s]=n.useState([]),{subscribe:o}=ve(),m=()=>{fetch(`${S}/read-write/artists`,{method:"GET",credentials:"include"}).then(c=>{if(c.status!==200){console.error("Error fetching artists");return}return c.json()}).then(c=>{s(c)})};return n.useEffect(()=>{_e(()=>{m()})();const r=o("musicUploaded",m);return()=>{r()}},[]),e.jsx("div",{className:`home ${(t==null?void 0:t.length)!==0?"album-displayer":""}`,children:(t==null?void 0:t.length)!==0?t.map(c=>e.jsx(ko,{artist:c},c.id)):e.jsx(us,{})})},To=()=>{const[t,s]=n.useState(null),[o,m]=n.useState([]),{addArtistToQueue:c,shuffleArtistToQueue:r,editArtist:a,linkNewContainer:d,navigateBack:u}=ce(),h=Lt().artistId;n.useEffect(()=>{l(),d({id:h,type:"artist"},l)},[h]);const l=()=>{fetch(`${S}/read-write/artist/${h}`,{method:"GET",credentials:"include"}).then(x=>{if(!x.ok)throw new Error("Network response was not ok");return x.json()}).then(x=>{s(x.artistInfos),m(x.albums),console.log(x.artistInfos)})},p=async()=>await c(h),f=async()=>{r(h,!1)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:u,children:e.jsx(Ye,{})}),t&&o?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"album-content",children:[t.picture?e.jsx("img",{src:`${S}/covers/artists/${t.picture}`,alt:`${t.name} cover`,className:"cover-image"}):e.jsx(ne,{className:"cover-image"}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(ie,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:p}),e.jsx(ie,{text:"Random",icon:e.jsx(it,{}),onClick:f}),e.jsx(ie,{icon:e.jsx(ns,{}),onClick:async()=>{a(t.id)}})]}),e.jsx("div",{className:"album-displayer",children:o.map(x=>e.jsx(ls,{album:x,hideArtist:!0},x.id))})]})]})]}):e.jsx(bt,{text:"Loading artist"})]})},wo=()=>{const t=he(),s=()=>{t("/home")};return e.jsxs("div",{className:"not-found",children:[e.jsx("h1",{children:"Where did you land..?"}),e.jsx("p",{children:"The adress you gave is not defined, but you can go back to library:"}),e.jsx("button",{className:"btn",onClick:s,children:"Go back to library"})]})},Eo=()=>{const[t,s]=n.useState("");n.useEffect(()=>{s(localStorage.getItem("username"))},[]);const o=he();return e.jsxs("div",{className:"account-page",children:[e.jsx(_t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Ye,{})}),e.jsxs("div",{className:"account-container",children:[e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:t}),e.jsx("p",{children:"Account information will be displayed here."})]}),e.jsx(ne,{})]})]})]})},Ro=({active:t,setActive:s})=>e.jsx("div",{className:"toggle-button","data-is-active":t,onClick:o=>{o.stopPropagation(),s(!t)},children:e.jsx("div",{className:"toggle-button-active","data-is-active":t})}),De=({stateChanged:t,min:s=0,max:o=0,ref:m})=>{const c=s===o&&o===0,r=d=>{const u=d.target.value;t(u)},a=d=>{console.log("blur");let u=parseFloat(d.target.value);isNaN(u)&&(u=s),c||(u=Math.min(o,Math.max(s,u))),d.target.value=u,t(u)};return c?e.jsx("input",{ref:m,type:"number",onBlur:a,onChange:r}):e.jsx("input",{min:s,ref:m,max:o,type:"number",onBlur:a,onChange:r})},Co=()=>{var v;const t=n.useRef(null),s=n.useRef(null),o=n.useRef(null),m=n.useRef(null),c=n.useRef(null),{FFTUserSetingsRef:r,fftConfigRef:a}=ce(),d=j=>{r.current.bars=Math.floor(j),f()},u=j=>{r.current.cutoff=parseFloat(j),f()},h=j=>{r.current.scale=parseFloat(j),f()},l=j=>{r.current.contrast=parseFloat(j),f()},p=j=>{r.current.FPS=parseFloat(j),f()},f=()=>{const j=new FormData;j.append("FFT",JSON.stringify(r.current)),fetch(`${S}/config/user/send/FFT`,{method:"POST",credentials:"include",body:j})},x=async()=>{await fetch(`${S}/config/user/FFT`,{method:"GET",credentials:"include"}).then(j=>j.json()).then(j=>{r.current=j,t.current.value=r.current.bars,m.current.value=r.current.contrast,s.current.value=r.current.scale,c.current.value=r.current.cutoff,o.current.value=r.current.FPS})};return n.useEffect(()=>{x()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Number of bars"}),e.jsx(De,{ref:t,stateChanged:d,min:1,max:(v=a.current)==null?void 0:v.fftSize})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"FPS (High number may cause strong battery usage)"}),e.jsx(De,{ref:o,stateChanged:p})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Scale"}),e.jsx(De,{ref:s,stateChanged:h})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Contrast"}),e.jsx(De,{ref:m,stateChanged:l})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Cutoff"}),e.jsx(De,{ref:c,stateChanged:u})]})]})},Ao={FFT:Co},Io=({entryName:t,entryIcon:s,linkedSettingKey:o})=>{const[m,c]=n.useState(!1),r=n.useMemo(()=>Ao[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":m,onClick:a=>{a.stopPropagation(),c(!m)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:r&&m&&e.jsx(r,{})})]})},Fo=()=>{const[t,s]=n.useState(!1);n.useEffect(()=>{_e(()=>{fetch(`${S}/auth/is-admin`,{method:"POST",credentials:"include"}).then(c=>c.json()).then(c=>{s(c)})})()},[]);const o=he();return e.jsxs("div",{className:"account-page",children:[e.jsx(_t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Ye,{})}),e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:"Settings page"}),e.jsx("p",{children:"A shinny list of fancy settings."}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Io,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Hs,{})})})]})]})]})},Po=({user:t,totalStorage:s})=>{const[o,m]=n.useState(0);return n.useEffect(()=>{fetch(`${S}/read-write/user-data-usage/${t.id}`,{method:"GET",credentials:"include"}).then(c=>c.json()).then(c=>{m(c)}).catch(c=>{console.error("Error fetching user storage data: ",c)})},[]),e.jsxs("div",{className:"user-account-infos-entry",children:[e.jsx("p",{children:t.username}),e.jsx("p",{children:t.email}),e.jsx("p",{children:t.role}),e.jsx(ut,{percent:Number(o/s*100).toFixed(2),fillColor:"var(--cool-green)",showPercent:!0,style:{maxWidth:"200px"}})]})},Ke={PENDING:"pending",RUNNING:"running",PAUSED:"paused",INACTIVE:"inactive"},Xt=({jobName:t,description:s,jobKey:o,payload:m={},doneTotalView:c=null})=>{const[r,a]=n.useState(!1),[d,u]=n.useState(!0),[h,l]=n.useState(0),[p,f]=n.useState(!1),[x,v]=n.useState(null),j=n.useRef(null),A=(k=!0,M="",W=0)=>{var B=k;fetch(`${S}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{f(!1);let D=1e3;switch(T.status){case Ke.PENDING:f(!0),a(!0),u(!1),D=500;break;case Ke.INACTIVE:if(M===Ke.RUNNING||M===Ke.PENDING){setTimeout(()=>{a(!1),l(0),v(null),A(!1,T.status)},2e3),l(100),v({done:W,total:W,working:0}),B=!1,console.log("Stop fast fetch job");return}a(!1);break;case Ke.PAUSED:u(!0),a(!0),D=500;break;case Ke.RUNNING:u(!1),a(!0),D=10;break}j.current&&(clearTimeout(j.current),j.current=null),B&&(j.current=setTimeout(()=>{var U;if(T.progress){const V=T.progress.done/T.progress.total*100;l(V),v(T.progress)}else v(null);A(!0,T.status,((U=T.progress)==null?void 0:U.total)??0)},D))})},N=()=>{fetch(`${S}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{A(k.status===Ke.RUNNING)})},L=()=>{const k=new FormData;k.append("payload",JSON.stringify(m)),fetch(`${S}/jobs/run/${o}`,{method:"POST",credentials:"include",body:k}).then(M=>M.json()).then(M=>{A(!0)})},$=()=>{fetch(`${S}/jobs/pause/${o}`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{A(!1)})},R=()=>{fetch(`${S}/jobs/resume/${o}`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{A(!0)})},b=()=>{fetch(`${S}/jobs/stop/${o}`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{A(!1)})};n.useEffect(()=>(N(),()=>{j.current&&(console.log("Trying clearTimout"),clearTimeout(j.current),j.current=null)}),[]);const P=async()=>{if(r){d?R():$(),u(!d);return}L()},C=async()=>{b(),l(0)};return e.jsxs("div",{className:"backend-job",children:[e.jsx("h3",{children:t}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"baseline",flexWrap:"wrap"},children:[e.jsx(ie,{text:r?d?"Resume":"Pause":"Run",icon:r?d?e.jsx(Zr,{}):e.jsx(ea,{}):e.jsx(ta,{}),onClick:P}),e.jsx(ie,{text:"Stop",icon:e.jsx(sa,{}),onClick:C}),e.jsx(ut,{style:{height:"25px",filter:`grayscale(${d&&r?.8:0})`},minWidth:"200px",percent:h,showPercent:!1,text:x?c.current?`${x.done}/${x.total}`:`Working: ${x.working} | Left : ${x.total-x.done}`:null,fillColor:"linear-gradient(90deg, rgb(187, 251, 223) 0%, rgb(198, 203, 253) 50%, rgb(239, 201, 249) 100%)",initialising:p,initialisingColor:"violet"})]}),e.jsx("p",{children:s}),e.jsx("div",{className:"job-status","data-running":d?"false":"true","data-status":r?p?"init":d?"stop":"run":"inactive",children:e.jsx("span",{children:r?p?"Initlialising":d?"Paused":"Running":"Inactive"})})]})},Lo=()=>{const t=n.useRef(null),s=n.useRef(null),o=n.useRef(null),m=n.useRef(null),[c,r]=n.useState(!1),a=p=>{t.current.samples=Math.floor(p),h()},d=p=>{t.current.samplingInterval=1/Math.floor(p),h()},u=p=>{t.current.parallelCompute=Math.floor(p),h()},h=()=>{const p=new FormData;p.append("FFT",JSON.stringify(t.current)),fetch(`${S}/config/send/FFT`,{method:"POST",credentials:"include",body:p})},l=async()=>{await fetch(`${S}/config/FFT`,{method:"GET",credentials:"include"}).then(p=>p.json()).then(p=>{t.current=p}),r(t.current.useServerFFT),o.current.value=t.current.samples,s.current.value=Math.floor(1/t.current.samplingInterval),m.current.value=t.current.parallelCompute};return n.useEffect(()=>{l()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line",children:[e.jsx("span",{children:"Activate audio spectra computation"}),e.jsx(Ro,{defaultValue:t.current,active:c,setActive:p=>{r(p),t.current&&(t.current.useServerFFT=p,h())}})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":c,children:[e.jsx("span",{children:"Frame definiton (power of 2)"}),e.jsx(De,{ref:o,stateChanged:a,max:4096,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":c,children:[e.jsx("span",{children:"Frame per second"}),e.jsx(De,{ref:s,stateChanged:d,max:120,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":c,children:[e.jsx("span",{children:"Number of parallel analyzed songs"}),e.jsx(De,{ref:m,stateChanged:u,max:10,min:1})]})]})},$o={FFT:Lo},Oo=({entryName:t,entryIcon:s,linkedSettingKey:o})=>{const[m,c]=n.useState(!1),r=n.useMemo(()=>$o[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":m,onClick:a=>{a.stopPropagation(),c(!m)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:r&&m&&e.jsx(r,{})})]})},Mo=()=>{const t=()=>localStorage.getItem("job-progress-view")?localStorage.getItem("job-progress-view")==="true":!0,[s,o]=n.useState(!1),[m,c]=n.useState([]),[r,a]=n.useState(0),d=n.useRef(t()),u=he();n.useEffect(()=>{_e(()=>{fetch(`${S}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{o(x)})})()},[]),n.useEffect(()=>{s.error||fetch(`${S}/auth/init-admin-pannel`,{method:"POST",credentials:"include"}).then(f=>f.json()).then(f=>{c(f.users),a(f.totalStorage)})},[s]);const h=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You are not an admin."})]}),l=f=>{const x=f===0;d.current=x,localStorage.setItem("job-progress-view",x)},p=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Admin pannel"}),e.jsx("p",{children:"Only for the true admins."}),e.jsxs("div",{className:"admin-category",children:[e.jsx(na,{}),e.jsx("h2",{children:"Users' storage usage"})]}),e.jsx("div",{className:"all-users-list",children:m.map(f=>e.jsx(Po,{user:f,totalStorage:r},f.id))}),e.jsxs("div",{className:"admin-category",children:[e.jsx(ra,{}),e.jsx("h2",{children:"Backend processes"}),e.jsx(en,{data:["Done/Total","Working/Remaining"],currentActive:t()?0:1,onClick:l})]}),e.jsxs("div",{className:"job-grid",children:[e.jsx(Xt,{jobKey:"JOB_CD",jobName:"Recompute tracks number and CDs",description:"Reextract the metadatas of the songs to remap them to the correct CD or track number. Analyses lossless.",doneTotalView:d}),e.jsx(Xt,{jobKey:"JOB_FFT",jobName:"Compute audio spectras",description:"Runs a fast Fourier transform on each audio files to extract the audio spectrum. The result is writen into .bin files. For a .flac audio of 41kHz, we expect 3Mb spectrum file.",payload:{completeLibrary:!0},doneTotalView:d}),e.jsx(Xt,{jobKey:"JOB_LYRICS",jobName:"Fetch all lyrics",description:"Accesses the API of lrclib to fetch lyrics. This may take verious time depending on the need to further serivices if the track is not found.",payload:{mode:"all_library"},doneTotalView:d})]}),e.jsxs("div",{className:"admin-category",children:[e.jsx(aa,{}),e.jsx("h2",{children:"Configuration"})]}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Oo,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Hs,{})})})]});return e.jsxs("div",{className:"account-page",children:[e.jsx(_t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>u("/home"),children:e.jsx(Ye,{})}),e.jsx("div",{className:"account-info",children:s?e.jsx(p,{}):e.jsx(h,{})})]})]})},Uo=()=>{const[t,s]=n.useState(!0),o=he(),m=async r=>{if(r.preventDefault(),!r.target.email.value||!r.target.password.value||!r.target.repeat_password.value||!r.target.name.value){alert("Please fill in all fields");return}if(r.target.password.value!==r.target.repeat_password.value){alert("Passwords do not match");return}const a=new FormData(r.target),d=await fetch(`${S}/auth/register`,{method:"POST",credentials:"include",body:a}),u=await d.json();d.ok?(alert("User registered successfully"),o("/home")):alert(u.error)};n.useEffect(()=>{fetch(`${S}/auth/any-user`,{method:"GET"}).then(r=>r.json()).then(r=>{s(r===0)})},[]);const c=()=>e.jsxs("div",{style:{marginBottom:"30px",display:"flex",flexDirection:"row",alignItems:"center",margin:"auto",gap:"20px"},children:[e.jsx("p",{style:{textWrap:"nowrap"},children:"Already an account?"}),e.jsx("button",{style:{width:"100%"},onClick:r=>{r.stopPropagation(),o("/")},children:"Login"})]});return e.jsxs("div",{className:"authDiv",children:[e.jsx(Ot,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(rn,{}),e.jsx(ne,{}),e.jsx("h2",{children:"Register"}),e.jsx("p",{children:t?`Welcome to the Crystal Music Library! Since you are the first 
            to show up here, we would like you to create the admin account.`:"Please fill the form to register as a new user."}),!t&&e.jsx(c,{}),e.jsxs("form",{onSubmit:m,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"new-password"}),e.jsx("label",{htmlFor:"repeat_password",children:"Confirm Password"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",name:"repeat_password",autoComplete:"password"}),e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",autoComplete:"name"}),e.jsx("button",{type:"submit",children:"Register"})]})]})},_o=()=>{const[t,s]=n.useState(null),{genreId:o}=Lt(),{addContainerToQueue:m,playContainerSuffle:c,playContainer:r,navigateBack:a}=ce();n.useEffect(()=>{fetch(`${S}/read-write/genre/${o}`,{method:"GET",credentials:"include"}).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>{s(l),console.log(l)})},[]);const d=async()=>{r(o,"genre")},u=async()=>{m(o,"genre")},h=async()=>{c(o,"genre")};return e.jsxs("div",{className:"genre-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:a,children:e.jsx(Ye,{})}),t?e.jsxs("div",{className:"genre-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(ie,{text:"Play",icon:e.jsx(ts,{}),onClick:d}),e.jsx(ie,{text:"Random",icon:e.jsx(it,{}),onClick:h}),e.jsx(ie,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:u})]}),e.jsx("div",{className:"genre-albums album-displayer",children:t.albums.map(l=>e.jsx(ls,{album:l},l.id))})]}):e.jsx("p",{children:"Loading..."})]})},Bo=({genre:t})=>{const s=he(),[o,m]=n.useState([]),[c,r]=n.useState([]),a=n.useRef([]),d=n.useRef(c),u=n.useRef([]),h=f=>{var v;if(console.log("changed on",f),!((v=d.current)!=null&&v.length)==0)return;const x=document.getElementById(`genre-${t.id}-img-${f}`);x==null||x.setAttribute("data-hidden","true"),setTimeout(()=>{x&&(x.src=`${S}/covers/${d==null?void 0:d.current[f]}`),x==null||x.removeAttribute("data-hidden")},500)};n.useEffect(()=>(l(m),p(),[2e3,2500,3e3].forEach((x,v)=>{setTimeout(()=>h(v),x);const j=setInterval(()=>h(v),7e3);u.current.push(j)}),()=>{a.current.forEach(clearTimeout),a.current=[],u.current.forEach(clearInterval),u.current=[],d.current=[]}),[]);const l=f=>{fetch(`${S}/read-write/trackCoversGenre/${t.id}`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{f(x)})};n.useEffect(()=>{d.current=c},[c]);const p=()=>{l(r),setTimeout(p,5500)};return e.jsxs("div",{className:`genre-card ${t==null?void 0:t.puredName}`,onClick:()=>{s(`/genres/${t.id}`)},children:[e.jsx("div",{className:"card-pivot-origin",children:o.map((f,x)=>e.jsx("div",{className:"img-pivot",style:{"--start-delay":`${3*(2-x)}`,"--start-angle":`${2-x}`,"--speed":"0.7","--scale":.4},children:e.jsx("img",{id:`genre-${t.id}-img-${x}`,className:"genre-img-cover",style:{"--scale":.7},src:`${S}/covers/${f}`})},x))}),e.jsx("div",{className:"genre-name",children:e.jsx("p",{children:t.name})})]})},Go=[{name:"rock"},{name:"hiphop"},{name:"jazz"},{name:"edm"},{name:"house"},{name:"techno"},{name:"trance"},{name:"dubstep"},{name:"reggae"},{name:"ska"},{name:"country"},{name:"folk"},{name:"acoustic"},{name:"singer"},{name:"songwriter"},{name:"latin"},{name:"salsa"},{name:"reggaeton"},{name:"afrobeat"},{name:"jpop"},{name:"jpop"},{name:"lofi"},{name:"electronic"},{name:"indie"},{name:"alternative"},{name:"punk"},{name:"metal"},{name:"opera"},{name:"classical"},{name:"funk"},{name:"blues"},{name:"soul"},{name:"rnb"},{name:"chillhop"},{name:"ambiant"},{name:"soundtrack"},{name:"art-rock"},{name:"pop-rock"},{name:"breakcore"},{name:"worldwide"},{name:"rnb-soul"},{name:"hard-rock"},{name:"shoegaze"},{name:"indie-rock"},{name:"traditional"},{name:"anime"},{name:"pop"}],Do=new qs(Go,{keys:["name"],threshold:.4}),Vo=t=>{const s=t.replace(/[^a-zA-Z ]/g," "),o=Do.search(s);return"genre-"+(o.length>0?o[0].item.name:"default")},Ho=({})=>{var a,d;const{subscribe:t}=ve(),[s,o]=n.useState([]),[m,c]=n.useState(()=>{const u=localStorage.getItem("CML_FinishedTutorials");return u&&JSON.parse(u).state[we.GENRES]||!1}),r=()=>{fetch(`${S}/read-write/genres`,{method:"GET",credentials:"include"}).then(u=>u.json()).then(u=>{u.genres=u.genres.map(h=>({...h,puredName:Vo(h.name)})),o(u)})};return n.useEffect(()=>{const u=t(`safe-finished-tutorial-${we.GENRES}`,()=>{c(!0)}),h=t("musicUploaded",r);return _e(()=>{r()})(),()=>{h(),u()}},[]),e.jsx(e.Fragment,{children:((a=s==null?void 0:s.genres)==null?void 0:a.length)!==0?e.jsx("div",{className:"home genre-displayer",children:(d=s==null?void 0:s.genres)==null?void 0:d.map(u=>e.jsx(Bo,{genre:u},u.id))}):(s==null?void 0:s.trackNum)>0?m?e.jsxs("div",{className:"info-line",id:"text-no-genre",children:[e.jsx("span",{children:"No genres found in the library."}),e.jsx(es,{className:"info-button",onClick:()=>{c(!1)}})]}):e.jsx(sn,{tutorialKey:we.GENRES}):e.jsx(us,{})})},qo=({playlist:t})=>{const s=he(),o=m=>{s(`/playlists/${m}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>o(t.id),children:[t.cover?e.jsx("img",{src:`${S}/covers/${t.cover}`,alt:`${t.name} cover`,className:"artist-card-cover"}):e.jsx(ne,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},zo=()=>{const[t,s]=n.useState([]),{createNewPlaylist:o,setPlaylistAddedCallback:m}=ce(),c=()=>{fetch(`${S}/read-write/playlists`,{method:"GET",credentials:"include"}).then(r=>r.json()).then(r=>s(r))};return n.useEffect(()=>{_e(()=>{c(),m(c)})()},[]),e.jsxs("div",{children:[e.jsx(ie,{className:"buttonRound",id:"new-playlist",onClick:o,icon:e.jsx(oa,{}),text:"Create a new playlist"}),e.jsx("div",{className:"album-displayer",children:t.map(r=>e.jsx(qo,{playlist:r},r.id))})]})},Wo=()=>{const t=n.useRef(null),s=n.useRef(null),[o,m]=n.useState(!1),[c,r]=n.useState([]),{playAudioSalad:a,setSaladContext:d,saladContext:u,openTagWindow:h}=ce(),[l,p]=n.useState([]),[f,x]=n.useState([]),{addNotification:v,notifTypes:j}=Pe(),[A,N]=n.useState([]),[L,$]=n.useState(!1),[R,b]=n.useState(!1),P=n.useRef(null),C=n.useRef(null),[k,M]=n.useState("#aabbcc"),[W,B]=n.useState(!0),{subscribe:T}=ve(),[D,U]=n.useState(()=>{const H=localStorage.getItem("CML_FinishedTutorials");return H&&JSON.parse(H).state[we.COOKING]||!1});n.useEffect(()=>{const H=ee=>{t.current&&!t.current.contains(ee.target)&&re()},O=()=>{U(!0)};let oe=T(`safe-finished-tutorial-${we.COOKING}`,O);return _e(()=>{l.length===0&&p(u||[]),fetch(`${S}/read-write/mostUsedTags`,{method:"GET",credentials:"include"}).then(ee=>ee.json()).then(ee=>{const _=ee.map(z=>({...z,type:z.total,typeElem:"tag",icon:()=>e.jsx(jt,{color:z.color}),tooltip:F=>e.jsx("span",{children:F})}));x(_),r(_)}),document.addEventListener("mousedown",H),document.addEventListener("touchstart",H)})(),()=>{oe(),document.removeEventListener("mousedown",H),document.removeEventListener("touchstart",H)}},[]);const V=H=>{const O=H.target.value;if(O===""||O.trim().length===0){r(f);return}fetch(`${S}/read-write/search/${O}/tags,salads`,{method:"GET",credentials:"include"}).then(oe=>{if(oe.ok)return oe.json();throw new Error("Error fetching search results")}).then(oe=>{var ee,_;const me=[...(ee=oe.tags)==null?void 0:ee.map(z=>({...z,typeElem:"tag",icon:()=>e.jsx(jt,{color:z.color})})),...(_=oe.salads)==null?void 0:_.map(z=>({...z,typeElem:"salad",icon:()=>e.jsx(at,{color:z.color})}))];console.log(me),r(me)})},re=()=>{m(!1)},X=H=>{p(O=>O.filter(oe=>oe.id!==H))},pe=H=>{re(),console.log(H),!l.find(O=>O.id===H.id)&&p(O=>[...O,H])},je=async()=>{a(A.map(H=>H.id)),d(l)};n.useEffect(()=>{if(d(l),l.length===0){N([]),B(!0);return}B(l.findIndex(O=>O.typeElem==="salad")===-1);const H=new FormData;H.append("tags",JSON.stringify(l.filter(O=>O.typeElem==="tag").map(O=>O.id))),H.append("salads",JSON.stringify(l.filter(O=>O.typeElem==="salad").map(O=>O.id))),fetch(`${S}/read-write/getSalad`,{method:"POST",body:H}).then(O=>O.json()).then(O=>JSON.parse(O)).then(O=>{N(xt.shuffle(O)),console.log("New tracks received",O),O.length>0?v("Salad received! Enjoy..",j.SALAD):v("This salad is empty.. No tracks found.",j.SALAD)})},[l]);const xe=async()=>{l.length!==0&&($(!0),M(`${Ws(Math.random().toFixed(4)*360,100,70.8)}`))},ae=()=>{if(!C.current.value||($(!1),l.find(O=>O.typeElem==="salad")))return;const H=new FormData;H.append("salad",JSON.stringify({name:C.current.value,color:k,tags:l.map(O=>O.id)})),fetch(`${S}/read-write/newSalad`,{method:"POST",credentials:"include",body:H}).then(O=>O.json()).then(O=>{v("Salad saved!",j.SUCCESS),p([O])})},ge=H=>{a(A.map(O=>O.id),H)},fe=()=>{m(!0),s.current.value};return e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"info-button",id:"cooking-info",onClick:()=>{U(!1)}}),D?e.jsxs("div",{className:"cooking-div",children:[e.jsx("h2",{children:"Here select some tags and play the music!"}),e.jsxs("div",{className:"cooking-header",children:[e.jsx("div",{className:"action-bar",style:{margin:"auto"},ref:t,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",style:{zIndex:"2"},children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Ue,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:V,placeholder:"Search some tags or salads..",ref:s,onFocus:fe}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Fe,{height:300,itemCount:c.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:H,style:O})=>e.jsx(lt,{entry:c[H],style:{...O,width:" calc(100% - 20px)",marginTop:"10px"},onClick:pe},H)})})]})}),e.jsx("button",{className:"open-tags-edit",onClick:h,children:e.jsx(ca,{})})]}),e.jsxs("div",{className:"cooking-selection",children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(ie,{text:"Play salad",icon:e.jsx(ia,{}),onClick:je}),W&&e.jsx(ie,{text:"Save salad",icon:e.jsx(la,{}),onClick:xe})]}),e.jsx("div",{className:"cooking-tags",style:{marginBottom:"30px"},children:l.map(H=>e.jsxs("div",{className:"small-tag","data-prefix":H.typeElem==="salad",style:{backgroundColor:H.color},children:[H.typeElem==="salad"&&e.jsx(at,{"data-prefix":"true"}),e.jsx("span",{children:H.name}),e.jsx(ye,{onClick:()=>{X(H.id)}})]},H.id))}),e.jsx("div",{className:"track-list",children:A.map((H,O)=>e.jsx(an,{index:O,isSalad:ge,track:H,playIconId:"salad",showCover:!0},H.id))})]}),L?e.jsxs("div",{className:"edit-tag",style:{left:"calc(50% - 170px)",margin:"auto"},children:[e.jsx(ye,{style:{cursor:"pointer"},onClick:()=>{$(!1)}}),e.jsx("input",{type:"text",placeholder:"Name your new salad.",ref:C}),e.jsx(ua,{style:{cursor:"pointer"},id:"color-button",color:k,onClick:()=>{b(!R)}}),R&&e.jsxs("div",{ref:P,className:"edit-tag-picker",children:[" ",e.jsx(as,{color:k,onChange:M})]}),e.jsx(ot,{onClick:ae,style:{cursor:"pointer"}})]}):null]}):e.jsx(sn,{tutorialKey:we.COOKING})]})},Fs=({radio:t})=>{const{playRadio:s,externalRadioInfos:o}=ce();return e.jsxs("div",{className:"album-card",onClick:()=>{t.id?o.current=null:o.current=t,s(t.id?`radio-id:${t.id}`:`radio-url:${t.url}`)},children:[t.coverUrl?e.jsx("img",{src:`${S}/radio/favicon-proxy?url=${encodeURIComponent(t.coverUrl)}`,alt:`${Je(t.name,25)} cover`,className:"album-card-cover"}):e.jsx(ne,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Je(t.name,40)})]})},Ko=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]}),Qo=()=>{const[t,s]=n.useState(!1),[o,m]=n.useState([]),[c,r]=n.useState([]),{subscribe:a}=ve(),{addNotification:d,notifTypes:u}=Pe();n.useEffect(()=>{const x=a("refetch-known-radios",h);return _e(()=>{h()})(),()=>{x()}},[]);const h=async()=>{const x=await fetch(`${S}/radio/radios`,{method:"GET",credentials:"include"}).then(j=>j.json());s(!0);const v=(x==null?void 0:x.length)>0?x.map(j=>({...j,uuid:j.id})):[];m(v)},l=async()=>{d("Comming soon! :)",u.INFO)},p=async()=>{const v=(await fetch(`${S}/radio/stations`).then(j=>j.json()).then(j=>JSON.parse(j))).map(j=>({coverUrl:j.favicon,name:j.name,url:j.url_resolved,uuid:j.stationuuid}));r(v)},f=async()=>{window.open("https://www.radio-browser.info/tags","_blank").focus()};return e.jsxs("div",{className:"home",id:"radio-page",children:[e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(Ut,{}),e.jsx("h3",{children:"Favorite radios"})]}),e.jsx("div",{className:"album-displayer",id:"fav-radios","data-flat":"true","data-no-tracks":(o==null?void 0:o.length)==0&&t?"true":"false",children:t?(o==null?void 0:o.length)>0?o.map(x=>e.jsx(Fs,{radio:x},x.id)):null:e.jsx(Ko,{})}),e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(da,{}),e.jsx("h3",{style:{marginRight:"20px"},children:"Discover"})]}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(ie,{text:"Filters",icon:e.jsx(ma,{}),onClick:l}),e.jsx(ie,{text:"Random",icon:e.jsx(it,{}),onClick:p}),e.jsx(ie,{text:"External search",icon:e.jsx(ha,{}),onClick:f})]}),e.jsx("div",{className:"album-displayer",children:(c==null?void 0:c.length)!==0?c.map((x,v)=>e.jsx(Fs,{radio:x},v)):null})]})},Jo=()=>{const t=n.useRef(),s=n.useRef(null),{getFFTAtCurrentTime:o,fftConfigRef:m,globalAudioRef:c,FFTUserSetingsRef:r,fetchFFTUserSettings:a,colorOverride:d,currentTrackData:u}=ce(),h=n.useRef(0),l=p=>{var x,v;if((u==null?void 0:u.type)=="radio"){cancelAnimationFrame(t.current);return}if(!s.current){t.current=requestAnimationFrame(l);return}const f=s.current.getContext("2d");if(f&&r.current&&d.current){if(p-h.current<1e3/r.current.FPS){t.current=requestAnimationFrame(l);return}h.current=p;const j=r.current.bars;f.clearRect(0,0,s.current.width,s.current.height);const A=o();if(!A){t.current=requestAnimationFrame(l);return}m.current.sampleRate/A.length;const N=Math.max(1,A.length/j),L=new Array(j);L.fill(0);for(let b=0;b<A.length;b++)L[Math.floor(b/N)]+=Number(A[b]);let $=s.current.width/j-1,R=0;for(let b=0;b<L.length;b++){const P=r.current.scale*Math.log2(L[b])*(j/5)*((x=c.current)==null?void 0:x.volume);if(((v=d.current)==null?void 0:v.length)>0){const C=Math.min(1,Math.max(0,P/r.current.scale/r.current.contrast/300));f.fillStyle=`rgb(
						${Qe(d.current[0][0],d.current[1][0],C)} 
						${Qe(d.current[0][1],d.current[1][1],C)}
						${Qe(d.current[0][2],d.current[1][2],C)}
						)`}else f.fillStyle=`rgb(${P/r.current.scale/r.current.contrast} 137 255)`;f.fillRect(R,s.current.height-P,$,P),R+=$+1}}t.current=requestAnimationFrame(l)};return n.useEffect(()=>{if(!m.current){cancelAnimationFrame(t.current),console.log("No FFT data to display, releasing anim frame.");return}t.current=requestAnimationFrame(l),console.log("FFT found, requested animation frame.")},[m.current]),n.useEffect(()=>(t.current=requestAnimationFrame(l),()=>{cancelAnimationFrame(t.current)}),[]),e.jsx("canvas",{ref:s,id:"fft-canvas",width:1900,height:1e3})},Yo=()=>{const{playingTrack:t}=ce();return e.jsxs("div",{className:"content-with-fft",children:[e.jsx(Ps,{})," ",t?e.jsx(Jo,{}):null]})},Xo=t=>{const s=/^\[(\d{1,2}):(\d{1,2}\.\d{1,2})\][ \t]*(.*)$/gm;return[...t.matchAll(s)].map(o=>({time:Number(o[1])*60+Number(o[2]),lyric:o[3]}))},Zo=()=>{const{currentTrackData:t,currentTimeRef:s}=ce(),{subscribe:o}=ve(),m=n.useRef(!1),c=n.useRef(null),r=n.useRef(0),a=n.useRef(0),d=n.useRef(null),u=n.useRef(null),h=n.useRef(null),l=n.useRef(0),p=n.useRef(null),[f,x]=n.useState(null);n.useEffect(()=>{if(!(t!=null&&t.lyrics&&c.current)){L();return}x({previous:[],current:"",next:c.current.slice(0,1).map($=>$.lyric)}),p.current=requestAnimationFrame(j)},[t==null?void 0:t.lyrics]);const v=$=>{var b,P,C;m.current=!0;const R=c.current.findIndex(k=>k.time>$);x({previous:(b=c.current[R-2])==null?void 0:b.lyrics,current:(P=c.current[R-1])==null?void 0:P.lyric,next:(C=c.current.slice(R,R+2))==null?void 0:C.map(k=>k.lyric)}),r.current=$,a.current=R};n.useEffect(()=>{if(!(t!=null&&t.lyrics))return;const $=o("on-seek-song",v);return c.current=Xo(t.lyrics),v(s.current),p.current=requestAnimationFrame(j),()=>{$(),cancelAnimationFrame(p.current)}},[]);const j=$=>{var C,k,M,W;if(!(d.current&&u.current&&h.current)){cancelAnimationFrame(p.current);return}let R=$/1e3-l.current;Math.abs(R-s.current)>.3&&(l.current=$/1e3-s.current,R=$/1e3-l.current);const b=a.current;if(!(t!=null&&t.lyrics&&((C=c.current[b])!=null&&C.time))){L();return}if(m.current){m.current=!1,p.current=requestAnimationFrame(j);return}R>=((k=c.current[b])==null?void 0:k.time)&&(x({previous:(M=c.current[b-1])==null?void 0:M.lyric,current:c.current[b].lyric,next:c.current.slice(b+1,b+2).map(B=>B.lyric)}),a.current=b+1,N());const P=((W=c.current[b])==null?void 0:W.time)-R;P<=.3&&P>0&&A(),r.current=R,p.current=requestAnimationFrame(j)},A=()=>{d.current.setAttribute("data-anim","fade-small"),u.current.setAttribute("data-anim","fade-big"),h.current.setAttribute("data-anim","fade-out")},N=()=>{d.current.removeAttribute("data-anim"),u.current.removeAttribute("data-anim"),h.current.removeAttribute("data-anim")},L=()=>{x(null),cancelAnimationFrame(j)};return e.jsxs("div",{id:"track-lyrics-div",children:[e.jsx("span",{ref:h,className:"off-lyrics",children:f==null?void 0:f.previous}),e.jsx("span",{ref:d,className:"in-lyrics","data-text":f==null?void 0:f.current,children:f==null?void 0:f.current}),e.jsx("span",{ref:u,className:"off-lyrics",children:f==null?void 0:f.next[0]}),e.jsx("span",{className:"off-lyrics",children:f==null?void 0:f.next[1]})]})},ec=()=>{const{fullScreenImage:t,currentTrackData:s,requestNewFullScreenImage:o,playingTrack:m,toggleFullScreenView:c,colorOverride:r,recomputeColors:a,songPalette:d}=ce(),u=n.useRef(null),h=n.useRef(null),l=n.useRef(null),p=n.useRef(null),f=n.useRef(null),x=n.useRef(!1),v=n.useRef(0),j=3,A=n.useRef(0),[N,L]=n.useState(!1);n.useRef([]);const $=n.useRef(0),R=n.useRef(0),b=n.useRef(0),P=T=>{x.current?(u.current.src=URL.createObjectURL(T),h.current.src=URL.createObjectURL(T),f.current=u.current):(l.current.src=URL.createObjectURL(T),p.current.src=URL.createObjectURL(T),f.current=l.current),f.current.addEventListener("load",M)};n.useEffect(()=>{if(u.current&&h.current){if((s==null?void 0:s.type)=="radio"){if(s.coverUrl){const T=`${S}/radio/favicon-proxy?url=${encodeURIComponent(s.coverUrl)}`;x.current?(u.current.src=T,h.current.src=T,f.current=u.current):(l.current.src=T,p.current.src=T,f.current=l.current)}return}m&&((t==null?void 0:t.track)!==m?(x.current=!x.current,o().then(T=>{P(T.blob)})):P(t.blob))}},[s,m]);const C=(T,D)=>{T?(u.current.setAttribute("data-hidden",D),h.current.setAttribute("data-hidden",D)):(l.current.setAttribute("data-hidden",D),p.current.setAttribute("data-hidden",D))},k=()=>{u.current.removeEventListener("load",M),W()},M=()=>{var T;(T=f.current)!=null&&T.src&&(C(x.current,!1),C(!x.current,!0),clearTimeout($.current),$.current=setTimeout(()=>{x.current?l.current&&(l.current.src=null,p.current.src=null):u.current&&(u.current.src=null,h.current.src=null)},1100),a(f,k))},W=()=>{const T=d.current.pairs.length||0;if(T===0)return;const D=d.current.pairs[T-1-b.current%T],U=[D.c1,D.c2];b.current+=1,clearTimeout(R.current),r.current.length===0?r.current=U:B(U,0)},B=(T,D)=>{r.current=r.current.map((U,V)=>U.map((re,X)=>parseInt(Qe(re,T[V][X],.1)))),!(D>150)&&(R.current=setTimeout(()=>{B(T,D+1)},1e3/60))};return n.useEffect(()=>{var V,re;const T=()=>{v.current=0,L(!1)},D=()=>{v.current++,v.current>=j?+L(!0):L(!1)},U=["mousemove","keydown","mousedown","touchstart","scroll"];return U.forEach(X=>{window.addEventListener(X,T)}),A.current=setInterval(D,1e3),(V=f.current)!=null&&V.complete&&((re=f.current)!=null&&re.src)&&a(u,k),()=>{U.forEach(X=>{window.removeEventListener(X,T)}),clearInterval(A.current),clearTimeout(R.current),r.current=[]}},[]),e.jsxs("div",{id:"full-screen-page",children:[e.jsxs("div",{className:"full-screen-header",children:[e.jsx("button",{className:"roundButton full-screen-back go-back","data-inactive":N,onClick:c,children:e.jsx(Ye,{})}),e.jsx("button",{className:"roundButton full-screen-back","data-inactive":N,onClick:W,children:e.jsx(fa,{})})]}),e.jsx(Zo,{}),e.jsx("div",{"data-inactive":N,className:"full-screen-audio-ctrl",children:e.jsx($t,{context:""})}),(m||(s==null?void 0:s.type)=="radio")&&e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:h,crossOrigin:"anonymous","data-inactive":N,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:u,crossOrigin:"anonymous","data-inactive":N,alt:"No tracks palying"})}),e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:p,crossOrigin:"anonymous","data-inactive":N,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:l,crossOrigin:"anonymous","data-inactive":N,alt:"No tracks palying"})})]})]})};function tc(t=[]){const s=Ve();n.useEffect(()=>{t.includes(s.pathname)?(document.documentElement.classList.add("scroll-enabled"),document.body.classList.add("scroll-enabled")):(document.documentElement.classList.remove("scroll-enabled"),document.body.classList.remove("scroll-enabled"))},[s,t])}const Ie={TRACK:"track",PLAYLIST:"playlist",ALBUM:"album",GENRE:"genre",ARTIST:"artist"},sc=()=>{const t=n.useRef(null),[s,o]=n.useState(!1),[m,c]=n.useState([]),{openTrackActions:r,playTrackNoQueue:a}=ce(),d=he(),u=f=>{const x=f.target.value;if(x===""||x.trim().length===0){c([]);return}console.log(`${S}/read-write/search/${x}`),fetch(`${S}/read-write/search/${x}`,{method:"GET",credentials:"include"}).then(v=>{if(v.ok)return v.json();throw new Error("Error fetching search results")}).then(v=>{var A,N,L,$,R;const j=[...(A=v.tracks)==null?void 0:A.map(b=>({type:"track",...b})),...(N=v.albums)==null?void 0:N.map(b=>({type:"album",...b})),...(L=v.artists)==null?void 0:L.map(b=>({type:"artist",...b})),...($=v.genres)==null?void 0:$.map(b=>({type:"genre",...b})),...(R=v.playlists)==null?void 0:R.map(b=>({type:"playlist",...b}))].map(b=>{const P=b.path,{trackPath:C,...k}=b,M=b.type==="artist"?Ie.ARTIST:b.type==="album"?Ie.ALBUM:b.type==="genre"?Ie.GENRE:b.type==="playlist"?Ie.PLAYLIST:Ie.TRACK;return{icon:()=>P?e.jsx("img",{className:"action-bar-entry-logo",src:`${S}/${b.type==="artist"?"artist":"covers"}/${P}`,alt:b.name}):e.jsx(ne,{className:"action-bar-entry-logo"}),tooltip:()=>e.jsx(ss,{onClick:W=>{h(W,{code:M,id:b.id})}}),code:M,fileName:P,...k}});console.log(j),c(j)})},h=(f,x)=>{r({x:f.clientX,y:f.clientY},x,()=>{},()=>{})},l=f=>{s||setTimeout(()=>{requestAnimationFrame(()=>{var x;(x=t.current)==null||x.focus()})},0)},p=f=>{switch(f.code){case Ie.TRACK:a(f.id);break;case Ie.ALBUM:d(`/albums/${f.id}`);break;case Ie.ARTIST:d(`/artists/${f.id}`);break;case Ie.GENRE:d(`/genres/${f.id}`);break;case Ie.PLAYLIST:d(`/playlists/${f.id}`);break}};return e.jsx("div",{className:"action-bar",id:"researchbar",children:e.jsxs("div",{className:"action-bar-research",onClick:l,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Ue,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:u,placeholder:"Search for tracks, artists, genres, playlists..",ref:t,onFocus:()=>{o(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${s?"block":"none"}`},children:m.map((f,x)=>e.jsx(lt,{entry:f,className:"from-search-bar",onClick:p},x))})]})})},nc=()=>(tc(["/","/register","/settings","/admin-pannel"]),e.jsx(va,{children:e.jsx(Sa,{children:e.jsxs(Ua,{children:[" ",e.jsx(lo,{children:e.jsxs(dr,{children:[e.jsx(de,{path:"/",element:e.jsx(No,{})}),e.jsx(de,{path:"register",element:e.jsx(Uo,{})}),e.jsx(de,{element:e.jsx(Yo,{}),children:e.jsx(de,{path:"full-screen",element:e.jsx(ec,{})})}),e.jsxs(de,{element:e.jsx(xo,{}),children:[e.jsx(de,{path:"home",element:e.jsx(vo,{})}),e.jsx(de,{path:"albums",element:e.jsx(jo,{})}),e.jsx(de,{path:"albums/:albumId",element:e.jsx(Is,{})}),e.jsx(de,{path:"artists",element:e.jsx(So,{})}),e.jsx(de,{path:"artists/:artistId",element:e.jsx(To,{})}),e.jsx(de,{path:"genres",element:e.jsx(Ho,{})}),e.jsx(de,{path:"genres/:genreId",element:e.jsx(_o,{})}),e.jsx(de,{path:"playlists",element:e.jsx(zo,{})}),e.jsx(de,{path:"playlists/:playlistId",element:e.jsx(Is,{isPlaylist:!0})}),e.jsx(de,{path:"cooking",element:e.jsx(Wo,{})}),e.jsx(de,{path:"radio",element:e.jsx(Qo,{})}),e.jsx(de,{path:"search",element:e.jsx(sc,{})})]}),e.jsx(de,{path:"account",element:e.jsx(Eo,{})}),e.jsx(de,{path:"settings",element:e.jsx(Fo,{})}),e.jsx(de,{path:"admin-pannel",element:e.jsx(Mo,{})}),e.jsx(de,{path:"*",element:e.jsx(wo,{})})]})})]})})}));ur.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(mr,{children:e.jsx(nc,{})})}));
