import{r as t,j as e}from"./react-DmLYqgKm.js";import{c as pn}from"./react-dom-DPPwivfB.js";import{u as ge,a as bt,L as Ye,O as es,b as jt,R as xn,c as fe,B as gn}from"./react-router-C4BYJpcq.js";import{I as vn,a as Qe,b as jn,c as Ce,d as Xe,e as yn,f as lt,g as Ze,h as ts,i as bn,j as Nn,k as Sn,l as kn,m as wn,n as yt,o as At,p as ss,q as tt,r as ns,s as rs,t as Tn,u as as,v as En,w as Cn,x as An,y as Rn,z as In,A as Fn,B as $n,C as Pn,D as Rt,E as Ln,F as On,G as Mn,H as Un,J as et,K as _n,L as Et,M as It,N as Dn,O as Bn,P as Gn,Q as Vn,R as Ft,S as Hn,T as Wn,U as zn,V as qn,W as Jn,X as Yn,Y as Kn,Z as Qn,_ as Xn,$ as Zn,a0 as er,a1 as tr,a2 as st,a3 as $t,a4 as os,a5 as sr,a6 as nr,a7 as rr,a8 as ar,a9 as or,aa as cr,ab as ir,ac as lr,ad as ur,ae as dr,af as mr,ag as hr,ah as fr,ai as pr,aj as xr,ak as gr,al as vr,am as jr,an as yr}from"./@tabler-D3Vsm3Ll.js";import{_ as gt}from"./lodash-BhRqD2di.js";import{F as Pe}from"./react-window-Dlc0x0tK.js";import{v as ct}from"./uuid-C6aID195.js";import{Z as Pt}from"./react-colorful-0uAH5Wqu.js";import{p as br}from"./music-metadata-CvBiwAZp.js";import{a as Nr}from"./axios-xsH4HHeE.js";import{u as Sr}from"./react-intersection-observer-BjkFkzMn.js";import"./content-type-kkloIWN6.js";import"./scheduler-SPyfQU6S.js";import"./cookie--_YQFYBD.js";import"./@babel-Cj2_JSWT.js";import"./memoize-one-CcMeOnPo.js";import"./strtok3-BXaumHbT.js";import"./peek-readable-BVp5v6zA.js";import"./file-type-BdA4k6lR.js";import"./token-types-D2R8hC8p.js";import"./ieee754-DcnkbHBT.js";import"./@tokenizer-Sx_RGPFW.js";import"./fflate-D0DoR3vL.js";import"./debug-Dqg9INeJ.js";import"./ms-CzQ2E3wO.js";import"./uint8array-extras-B1Dultle.js";import"./media-typer-Kaw9hxcp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function c(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=c(o);fetch(o.href,r)}})();const kr=()=>{const n=window.location.hostname,s=window.location.port;return n==="localhost"||n.startsWith("127.0.0.1")?`http://localhost:${s}`:`http://${n}:${s}`},g=kr(),wr=()=>{const[n,s]=t.useState(!1),[c,i]=t.useState(!1),o=ge();function r(){s(!n)}const l=()=>e.jsx(vn,{className:"userImage buttonRound",onClick:r}),m=()=>{fetch(`${g}/auth/logout`,{method:"POST",credentials:"include"}).then(a=>{a.ok?window.location.href="/":console.error("Logout failed")}).catch(a=>{console.error("Error:",a)})},f=()=>{o("/account")},p=()=>{o("/settings")};return t.useEffect(()=>{fetch(`${g}/auth/is-admin`,{method:"POST",credentials:"include"}).then(a=>a.json()).then(a=>{i(a)})},[]),e.jsxs("div",{className:"userDropdown",children:[e.jsx(l,{}),n&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"userAccount dropdownEntry",onClick:f,children:"Account"}),e.jsx("button",{className:"userSetting dropdownEntry",onClick:p,children:"Settings"}),c&&e.jsx("button",{className:"userSetting dropdownEntry",onClick:()=>{o("/admin-pannel")},children:"Admin pannel"}),e.jsx("button",{className:"userLogout dropdownEntry",onClick:m,children:"Logout"})]})]})},Lt=n=>{var s=function(l){return("00"+l).slice(-2)};const c=Math.floor(n/3600),i=Math.floor(n%3600/60),o=s(Math.floor(n%60)),r=c>0?`${c}:${i}:${o}`:`${i}:${o}`;return{hours:c,minutes:i,seconds:o,readable:r}},Ct=n=>{const s=Math.floor(n/1024),c=Math.floor(s/1024),i=Math.floor(c/1024),o=Math.floor(i/1024),r=o>0?`${Number(n/1024/1024/1024/1024).toFixed(2)}TB`:i>0?`${Number(n/1024/1024/1024).toFixed(2)}GB`:c>0?`${Number(n/1024/1024).toFixed(2)}MB`:`${Number(n/1024).toFixed(2)}KB`;return{kb:s,mb:c,gb:i,tb:o,readable:r}},cs=(n,s,c)=>{s/=100,c/=100;let i=(1-Math.abs(2*c-1))*s,o=i*(1-Math.abs(n/60%2-1)),r=c-i/2,l=0,m=0,f=0;return 0<=n&&n<60?(l=i,m=o,f=0):60<=n&&n<120?(l=o,m=i,f=0):120<=n&&n<180?(l=0,m=i,f=o):180<=n&&n<240?(l=0,m=o,f=i):240<=n&&n<300?(l=o,m=0,f=i):300<=n&&n<360&&(l=i,m=0,f=o),l=Math.round((l+r)*255).toString(16),m=Math.round((m+r)*255).toString(16),f=Math.round((f+r)*255).toString(16),l.length==1&&(l="0"+l),m.length==1&&(m="0"+m),f.length==1&&(f="0"+f),"#"+l+m+f},Tr=(n,s,c)=>n+(s-n)*c,Ue=(n,s)=>{var c=n??"";return c.length>s?c.substring(0,s-2)+"..":c},Er=()=>new Promise(async n=>{const s=await fetch(`${g}/auth/verifyToken`,{method:"POST",credentials:"include"}).then(async c=>c.ok?!0:(await fetch(`${g}/auth/logout`,{method:"POST",credentials:"include"}).then(i=>{i.ok?window.location.href="/":console.error("Logout failed")}),!1));n(s)}),ut=n=>async function(){Er()&&n()},pe=({col1:n="#f9c58d",col2:s="#f492f0",className:c})=>e.jsxs("svg",{viewBox:"0 0 512 512",className:c,xmlns:"http://www.w3.org/2000/svg",fill:"#000000",children:[e.jsxs("defs",{children:[e.jsx("mask",{id:"mask_logo",fill:"black",children:e.jsx("path",{fill:"white",d:"M116.215 17.404c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm64.326 12.87l-23.488 92.062h63.965l27.49-27.49-67.967-64.573zm228.147 25.958c0 20.214-20.216 40.428-40.43 40.428 20.214 0 40.43 20.214 40.43 40.428 0-20.214 20.213-40.428 40.427-40.428-20.214 0-40.428-20.214-40.428-40.428zm-150.022 53.913l-23.18 23.18L283.043 311h29.066l-53.443-200.855zm75.232 2.365l16.123 32.281 45.188 33.148-4.393-53.533-56.918-11.896zm-18.033 4.181l-26.685 38.121 10 37.586 33.38-42.283-16.695-33.424zm-160.672 23.645L172.42 206.4l21.988 12.623L239.043 311h25.365l-45.68-170.664h-63.535zm189.797 23.088l-40.03 50.703L330.737 311h.026l64.08-111.004-49.852-36.572zm122.352 5.834c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm-374.22 12.375l11.308 76.129 48.834-6.356 19.322-24.154-79.465-45.62zm346.995 53.793l-52.547 13.172L351.547 311h25.77l19.16-19.48 43.64-56.094zm-255.21 5.244l-17.403 21.75 25.77 48.58h25.761l-34.129-70.33zm-33.84 29.174l-39.005 5.074L148.145 311h24.751l-21.83-41.156zm-91.37 11.396c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zM137 329v30h238v-30H137zm32 48v78h16v-78h-16zm34 0v78h106v-78H203zm124 0v78h16v-78h-16zm-164.758 96l-30.119 16h247.754l-30.12-16H162.243z"})}),e.jsxs("linearGradient",{id:"grad_logo",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:n}),e.jsx("stop",{offset:"100%",stopColor:s})]})]}),e.jsx("rect",{x:"0",y:"0",width:"512",height:"512",fill:"url(#grad_logo)",mask:"url(#mask_logo)"})]}),dt=({entry:n,style:s,onClick:c})=>e.jsxs("div",{className:"action-bar-entry",style:s,onClick:()=>{c(n)},children:[n.icon(),e.jsxs("span",{style:{flex:"1"},children:[" ",n.name]}),n.tooltip?n.tooltip(n.type):null]}),is=t.createContext(),at={SUCCESS:"success",ERROR:"error",INFO:"info",SALAD:"salad"},Cr=({children:n})=>{const[s,c]=t.useState(null),[i,o]=t.useState(null),r=t.useRef(null),l=t.useRef([]),m=(p,a)=>{l.current.forEach(h=>clearTimeout(h)),l.current=[],o({message:p,state:a}),c(!0);const d=setTimeout(()=>{r.current&&(r.current.setAttribute("direction",""),r.current.offsetWidth,r.current.setAttribute("direction","hide"));const h=setTimeout(()=>{c(!1),o(null)},300);l.current.push(h)},2e3);l.current.push(d)};t.useEffect(()=>{i&&c(!0)},[i]),t.useEffect(()=>{!s||!r.current||r.current.setAttribute("direction","show")},[s]);const f=()=>{if(!s)return null;switch(i==null?void 0:i.state){case at.SUCCESS:return e.jsx(Xe,{className:"notification-icon"});case at.ERROR:return e.jsx(Ce,{className:"notification-icon"});case at.INFO:return e.jsx(jn,{className:"notification-icon"});case at.SALAD:return e.jsx(Qe,{className:"notification-icon"});default:return null}};return e.jsxs(is.Provider,{value:{notifTypes:at,addNotification:m},children:[n,i?e.jsx("div",{ref:r,className:"notification-parent",id:"notification-parent",children:e.jsxs("div",{className:"notification","is-open":i?"true":"false",children:[e.jsx(f,{}),e.jsx("span",{children:i.message})]})}):null]})},He=()=>t.useContext(is),Ar=({onClose:n,track:s})=>{const[c,i]=t.useState(!1),o=t.useRef(null),r=t.useRef(null),[l,m]=t.useState([]),[f,p]=t.useState(null),[a,d]=t.useState(""),{addNotification:h,notifTypes:v}=He(),T=R=>{if(R.preventDefault(),a==""&&!f){n(!1);return}fetch(`${g}/read-write/moveTrackToAlbum/${a?"true/"+a:"false/"+f.id}/${s.id}`).then(I=>I.json()).then(I=>{h(`Track ${s.title} moved to 
            ${a||f.name}.`,v.INFO),n(!0)})},b=R=>{p(null),d(R.target.value)},_=R=>{const{tooltip:I,...M}=R;y(),p(M),d("")};t.useEffect(()=>{const R=I=>{r.current&&!r.current.contains(I.target)&&y()};return document.addEventListener("mousedown",R),document.addEventListener("touchstart",R),()=>{document.removeEventListener("mousedown",R),document.removeEventListener("touchstart",R)}},[]);const y=()=>{i(!1),o.current.value="",m([])},N=()=>e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Move to album"})," "]}),C=R=>{const I=R.target.value;if(I===""||I.trim().length===0){m([]);return}console.log(`${g}/read-write/search/${I}/${["albums"]}`),fetch(`${g}/read-write/search/${I}/${["albums"]}`,{method:"GET"}).then(M=>M.json()).then(M=>{m([...M.albums].map(W=>{const S=W.path,{trackPath:K,...ee}=W;return{icon:()=>S?e.jsx("img",{className:"action-bar-entry-logo",src:`${g}/covers/${S}`,alt:W.name}):e.jsx(pe,{className:"action-bar-entry-logo"}),tooltip:N,...ee}}))})};return e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:null,children:[e.jsx("h2",{children:"Move track to another album"}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:T,children:[e.jsx("label",{htmlFor:"newAlbum",style:a?{}:{opacity:"0.5"},children:"New album name"}),e.jsx("input",{type:"text",style:a?{}:{opacity:"0.5"},id:"newAlbum",placeholder:"Enter album name",onChange:b}),e.jsx("label",{htmlFor:"existingAlbum",style:a?{opacity:"0.5"}:{},children:"Existing album"}),e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:r,style:a?{opacity:"0.5"}:{},children:e.jsxs("div",{className:"action-bar-research",style:{transform:"translateX(15px)"},id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(yn,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:C,placeholder:"Search the album you want to move the track to.",ref:o,onFocus:()=>{i(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${c?"block":"none"}`},children:e.jsx(Pe,{height:300,itemCount:l.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:R,style:I})=>e.jsx(dt,{entry:l[R],style:{...I,width:" calc(100% - 20px)",marginTop:"10px"},onClick:_},R)})})]})}),f?e.jsxs("div",{style:{height:"90px",alignItems:"center",display:"flex",gap:"10px"},children:[f!=null&&f.icon?f.icon():null,f.name]}):null,e.jsx("input",{type:"submit",value:"Submit"})]})]})})},ls=()=>e.jsxs("div",{className:"three-points-loader",children:[e.jsx("div",{className:"point point1"}),e.jsx("div",{className:"point point2"}),e.jsx("div",{className:"point point3"})]}),de=({onClick:n,text:s,icon:c,style:i})=>{const[o,r]=t.useState(!1),l=()=>{r(!0),n().then(()=>{r(!1)})},m=()=>o?e.jsx(ls,{}):e.jsxs(e.Fragment,{children:[c,s]});return e.jsx("button",{className:"button-with-callback",style:{...i},onClick:l,children:e.jsx(m,{})})},Rr=({applyCanges:n,albumClass:s})=>{var y,N;const[c,i]=t.useState({visible:!1}),[o,r]=t.useState(null),[l,m]=t.useState("2000-00-00"),[f,p]=t.useState(null),[a,d]=t.useState(!1),{deleteAlbum:h}=xe();if(!s)return null;t.useEffect(()=>{s&&(r(s.coverURL),m(s.year))},[s]);const v=()=>{const C=document.getElementById("editAlbumInfos"),R=C.artistName.value.split(",").map(ee=>ee.trim()),I=C.genre.value.split(",").map(ee=>ee.trim()).map(ee=>ee.charAt(0).toUpperCase()+ee.slice(1)).filter(ee=>ee!="");if(!(C.albumName.value!==s.name||s.artist.toString()!==R.toString()||s.year!==C.releaseDate.value||s.genre.toString()!==I.toString()||s.description!==C.description.value||f||a)){n(null);return}s.name=C.albumName.value,s.artist=R,s.year=C.releaseDate.value,s.genre=I,s.description=C.description.value;const{tracks:W,coverURL:S,...K}=s;console.log(K),n(K,f)},T=C=>{const R=C.target.files[0];R&&(s.ext=R.name.split(".").pop(),r(URL.createObjectURL(R)),p(R))},b=C=>{i({visible:!c.visible,...C})},_=C=>{console.log(C),!a&&C&&d(!0),i({visible:!1})};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(pe,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(lt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:T})]}),e.jsx("button",{className:"roundButton",onClick:()=>v(),children:"Apply"}),e.jsx(de,{onClick:async()=>{h(!0,{name:s.name,id:s.id})},text:"Delete for me",icon:e.jsx(Ze,{}),style:{marginTop:"auto"}}),e.jsx(de,{onClick:async()=>{h(!1,{name:s.name,id:s.id})},text:"Remove from library",icon:e.jsx(Ze,{})})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(y=s.artist)==null?void 0:y.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",value:l,onChange:C=>{m(C.target.value)}})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(N=s.genre)==null?void 0:N.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Pe,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:C,style:R})=>e.jsxs("div",{style:R,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[C].title}),e.jsx(ts,{className:"trackIcon",onClick:()=>{b(s.tracks[C])}})]},C)})})]}),c.visible&&e.jsx(Ar,{onClose:_,track:{id:c.id,title:c.title}})]})})},Yt=({closeOverlay:n,applyCanges:s,editPlaylistClass:c})=>{const[i,o]=t.useState(null),[r,l]=t.useState(null),[m,f]=t.useState(c||{id:ct()}),[p,a]=t.useState([]),[d,h]=t.useState([]);t.useEffect(()=>{m&&o(m.coverURL),m.collaborators&&h(m.collaborators)},[m]);const v=()=>{const y=document.getElementById("editAlbumInfos");if(!(y.playlistName.value!==m.name||m.description!==y.description.value||r||m.collaborators.map(M=>!d.includes(M)).filter(M=>M))){s(null);return}m.name=y.playlistName.value,m.description=y.description.value,m.collaborators=d.map(M=>M.id);const{tracks:C,coverURL:R,...I}=m;console.log(I),s(I,r)},T=y=>{const N=y.target.files[0];N&&(m.ext=N.name.split(".").pop(),o(URL.createObjectURL(N)),l(N))};t.useEffect(()=>{fetch(`${g}/auth/collaborators`,{method:"GET",credentials:"include"}).then(y=>y.json()).then(y=>{console.log(y),a(y)})},[]);const b=y=>{const N=y.target.value;d.includes(N)||N==="pickUsers"||(h(C=>[...C,p.find(R=>R.id==N)]),y.target.value="pickUsers")};t.useEffect(()=>{console.log(d)});const _=y=>{h(d.filter(N=>N.id!=y))};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsx(Ce,{className:"buttonRound closeOverlay",onClick:n}),e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[i?e.jsx("img",{id:"coverPicture",src:i,style:{width:"100%"}}):e.jsx(pe,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(lt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:T})]}),e.jsx("button",{className:"roundButton",onClick:()=>v(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"playlistName",children:"Playlist name"}),e.jsx("input",{type:"text",id:"playlistName",placeholder:"Enter playlist name",defaultValue:m==null?void 0:m.name}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",style:{height:"80px",paddingTop:"10px",paddingBottom:"10px"},placeholder:"Enter description",defaultValue:m==null?void 0:m.description})]}),e.jsx("label",{htmlFor:"new-collab",children:"Add collaborators"}),e.jsxs("select",{onChange:b,children:[e.jsx("option",{value:"pickUsers",children:"Pick users"},"root"),p.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]}),e.jsx("label",{children:"Collaborators:"}),e.jsx("div",{children:d==null?void 0:d.map(y=>e.jsxs("div",{children:[e.jsx("span",{children:y==null?void 0:y.name}),e.jsx(bn,{className:"buttonRound",onClick:()=>{_(y.id)}})]},y==null?void 0:y.id))})]})]})})};function Ir(){const{innerWidth:n,innerHeight:s}=window;return{width:n,height:s}}const Fr=({trackY:n,track:s,isFav:c})=>{const[i,o]=t.useState(Ir()),{onClicTrackActionEntry:r,trackActionTypes:l}=xe(),[m,f]=t.useState(!1),p=t.useRef(null),[a,d]=t.useState(null),h=bt(),[v,T]=t.useState(()=>window.innerWidth<714);return t.useEffect(()=>{const b=_=>{p.current&&!p.current.contains(_.target)&&r(l.NONE)};return document.addEventListener("mousedown",b),document.addEventListener("touchstart",b),f(h.pathname.includes("playlist")),()=>{document.removeEventListener("mousedown",b),document.removeEventListener("touchstart",b)}},[]),t.useEffect(()=>{const b=m?250:180;d(Math.min(n,i.height-b))},[m]),a&&e.jsxs("div",{className:"track-actions-div",ref:p,style:{height:"fit-content",top:a},children:[e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.TOP_QUEUE,s)},children:[e.jsx("span",{children:"Front queue"})," ",e.jsx(Nn,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.END_QUEUE,s)},children:[e.jsx("span",{children:"Back queue"})," ",e.jsx(Sn,{})]}),m&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.GOTO_ALBUM,s)},children:[e.jsx("span",{children:"View album"})," ",e.jsx(kn,{})]}),m&&!c&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.REMOVE_FROM_PLAYLIST,s)},children:[e.jsx("span",{children:"Delete from playlist"})," ",e.jsx(wn,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.TAGS,s)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(yt,{})]}),v&&s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.REMOVE_FROM_FAVORITES,s)},children:[e.jsx("span",{children:"Remove from favorite"})," ",e.jsx(At,{})]}):null,v&&!s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.ADD_TO_FAVORITES,s)},children:[e.jsx("span",{children:"Add to favorites"})," ",e.jsx(ss,{})]}):null]})},ot={name:"Create a new tag",icon:()=>e.jsx(ns,{}),isAction:!0},$r=({track:n,apply:s})=>{const c=t.useRef(null),[i,o]=t.useState(!1),[r,l]=t.useState([ot]),[m,f]=t.useState("#aabbcc"),[p,a]=t.useState(!1),d=t.useRef(null),h=t.useRef(null),[v,T]=t.useState([]),[b,_]=t.useState(null),[y,N]=t.useState(null),[C,R]=t.useState([]),I=t.useRef(),M=F=>{const $=F.target.value;if(N($),$===""||$.trim().length===0){l([ot]);return}fetch(`${g}/read-write/search/${$}/tags`,{method:"GET"}).then(J=>{if(J.ok)return J.json();throw new Error("Error fetching search results")}).then(J=>{var X;const Q=(X=J.tags)==null?void 0:X.map(oe=>({...oe,icon:()=>e.jsx(yt,{color:oe.color}),isAction:!1})),ne={name:`${ot.name}: ${$}`,icon:ot.icon,isAction:ot.isAction};Q.splice(0,0,ne),l(Q)})},W=()=>{o(!1)},S=F=>{if(W(),F.isAction){_("new"),f(`${cs(Math.random().toFixed(4)*360,100,70.8)}`);return}v.find($=>$.id===F.id)||(R($=>$.filter(J=>J!==F.id)),T($=>[...$,F]))};t.useEffect(()=>{b==="new"&&(h.current.focus(),h.current.value=y||"",I.current.value="")},[b]),t.useEffect(()=>{const F=$=>{var J;if(d.current&&!d.current.contains($.target)){if(((J=$.target.closest("svg"))==null?void 0:J.id)==="color-button")return;a(!1)}if(c.current&&!c.current.contains($.target)){W();return}};return document.addEventListener("mousedown",F),document.addEventListener("touchstart",F),fetch(`${g}/read-write/trackTags/${n.id}`,{method:"GET"}).then($=>$.json()).then($=>{T($)}),()=>{document.removeEventListener("mousedown",F),document.removeEventListener("touchstart",F)}},[]);const K=()=>{const F=h.current.value;F!==""&&b==="new"&&T($=>[...$,{name:F,color:m,id:ct(),isNew:!0}]),_(null)},ee=(F,$)=>{const J=v.filter(Q=>!(Q.isNew===F&&Q.id===$));T(J),F||R(Q=>[...Q,$])};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"albumWrapping-library",style:{height:"400px",flexDirection:"column"},children:[e.jsx(Ce,{className:"buttonRound closeOverlay",onClick:()=>{s(null)}}),e.jsxs("h3",{children:["Editing tags for track ",n.title]}),e.jsx("div",{className:"action-bar",style:{margin:"10px auto"},ref:c,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(tt,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:M,placeholder:"Search some tags..",ref:I,onFocus:()=>{o(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${i?"block":"none"}`},children:e.jsx(Pe,{height:300,itemCount:r.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:F,style:$})=>e.jsx(dt,{entry:r[F],style:{...$,width:" calc(100% - 20px)",marginTop:"10px"},onClick:S},F)})})]})}),b?e.jsxs("div",{className:"edit-tag",children:[e.jsx(ns,{style:{paddingRight:"30px"}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:h}),e.jsx(rs,{id:"color-button",color:m,onClick:()=>{a(!p)}}),p&&e.jsxs("div",{ref:d,className:"edit-tag-picker",children:[" ",e.jsx(Pt,{color:m,onChange:f})]}),e.jsx(Xe,{onClick:K})]}):null,e.jsx("div",{className:"track-tags-div",children:v.map((F,$)=>e.jsxs("div",{className:"small-tag",style:{backgroundColor:F.color},children:[e.jsx("span",{children:F.name})," ",e.jsx(Ce,{onClick:()=>{ee(F.isNew,F.id)}})]},`${F.isNew}-${F.id}`))}),e.jsx("button",{style:{marginTop:"auto"},onClick:()=>{s({current:v,deleted:C},n.id)},children:"Apply"})]})})},Pr=()=>{const{closeTagWindow:n}=xe(),[s,c]=t.useState(0),[i,o]=t.useState([]),[r,l]=t.useState([]),[m,f]=t.useState(!1),[p,a]=t.useState("#aabbcc"),[d,h]=t.useState(null),v=t.useRef(null),T=t.useRef(null),{addNotification:b,notifTypes:_}=He(),[y,N]=t.useState(null);t.useEffect(()=>{C(),R()},[]);const C=()=>{fetch(`${g}/read-write/getAllUserTags`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{o(S)})},R=()=>{fetch(`${g}/read-write/getAllUserSalads`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{l(S)})},I=S=>{h(S),a(S.color)},M=()=>{const S={id:d.id,name:v.current.value,color:p},K=new FormData;K.append(s===0?"tag":"salad",JSON.stringify(S)),fetch(`${g}/read-write/${s===0?"applyTagModifications":"applySaladModifications"}`,{method:"POST",credentials:"include",body:K}).then(ee=>ee.json()).then(ee=>{s===0?C():R(),b("Tag updated.",_.SUCCESS)}),h(null)},W=()=>{fetch(`${g}/read-write/delete/${y.type}/${y.id}`,{method:"DELETE",credentials:"include"}).then(S=>S.json()).then(S=>{s===0?C():R(),h(null),N(null),b("Tag deleted.",_.SUCCESS)})};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"tag-edtior-container",children:[e.jsx(Ce,{className:"buttonRound closeOverlay",onClick:n}),e.jsxs("div",{className:"cooking-selection",style:{marginTop:"40px"},children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(de,{text:"Edit tags",icon:e.jsx(Tn,{}),onClick:async()=>{c(0)}}),e.jsx(de,{text:"Edit salads",icon:e.jsx(Qe,{}),onClick:async()=>{c(1)}})]}),e.jsxs("div",{className:"edit-tags-content",children:[e.jsx(Pe,{className:"albumTrackList",height:250,itemCount:s===0?i.length:r.length,itemSize:35,width:"100%",children:({index:S,style:K})=>e.jsxs("div",{style:K,className:"album-wrapping-track",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:s===0?i[S].color:r[S].color}}),e.jsx("span",{children:s===0?i[S].name:r[S].name}),e.jsx(as,{className:"trackIcon",onClick:()=>{I(s===0?{...i[S],type:"tag"}:{...r[S],type:"salad"})}})]},S)}),d?e.jsxs("div",{className:"edit-tag",style:{left:"-20px",margin:"auto"},children:[e.jsx(Ce,{style:{cursor:"pointer"},onClick:()=>{h(null)}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:v,defaultValue:d.name}),e.jsx(rs,{style:{cursor:"pointer"},id:"color-button",color:p,onClick:()=>{f(!m)}}),m&&e.jsxs("div",{ref:T,className:"edit-tag-picker",children:[" ",e.jsx(Pt,{color:p,onChange:a})]}),e.jsx(Xe,{onClick:M,style:{cursor:"pointer"}}),e.jsx(Ze,{style:{cursor:"pointer"},onClick:()=>{N(d)}})]}):null,y?e.jsxs("div",{className:"deletion-confirmation",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:y.color,width:"50px"}}),e.jsxs("p",{children:["Confirm deletion of the ",y.type," ",y.name,"?"]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{N(null)},children:e.jsx(En,{})}),e.jsx("button",{onClick:()=>{W()},children:e.jsx(Xe,{})})]})]}):null]})]})]})})},Lr=({applyChanges:n,artist:s})=>{const[c,i]=t.useState(null),[o,r]=t.useState("2000-00-00"),[l,m]=t.useState(null);if(!s)return null;t.useEffect(()=>{s&&(i(s.picture),r(s.active_from))},[s]);const f=()=>{const a=document.getElementById("editArtistInfos"),d=s.active_from??"",h=a.activeFrom.value??"",v=s.name??"",T=a.artistName.value??"",b=s.bio??"",_=a.bio.value??"";if(!(v!=T||d!=h||b!=_||l)){n(null);return}s.name=a.artistName.value,s.active_from=a.activeFrom.value,s.bio=a.bio.value;const{picture:N,...C}=s;console.log(C,l),n(C,l)},p=a=>{const d=a.target.files[0];d&&(s.ext=d.name.split(".").pop(),i(URL.createObjectURL(d)),m(d))};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[c?e.jsx("img",{id:"coverPicture",src:c,style:{width:"100%"}}):e.jsx(pe,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(lt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:p})]}),e.jsx("button",{className:"roundButton",onClick:f,children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editArtistInfos",children:[e.jsx("label",{htmlFor:"artistName",children:"Artist name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("div",{className:"albumType",children:e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"activeFrom",children:"Active since"}),e.jsx("input",{type:"date",id:"activeFrom",value:o,onChange:a=>{r(a.target.value)}})]})}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",placeholder:"Enter biography",defaultValue:s.bio})]})]})]})})},us=t.createContext(),Nt=()=>t.useContext(us),Or=({children:n})=>{const s=t.useRef({}),c=(o,r)=>(s.current[o]||(s.current[o]=[]),s.current[o].push(r),console.log("registered",o,r),()=>{s.current[o]=s.current[o].filter(l=>l!=r)}),i=(o,r)=>{s.current[o]&&s.current[o].forEach(l=>{l(r),console.log("called at",l)})};return e.jsx(us.Provider,{value:{emit:i,subscribe:c},children:n})},ds=t.createContext(void 0),$e={TOP_QUEUE:"top_queue",END_QUEUE:"end_queue",TAGS:"tags",GOTO_ALBUM:"goto_album",REMOVE_FROM_PLAYLIST:"remove_from_playlist",ADD_TO_FAVORITES:"add_to_favs",REMOVE_FROM_FAVORITES:"remove_from_favs",NONE:"none"},Mr=({children:n})=>{const[s,c]=t.useState(""),[i,o]=t.useState(!1),[r,l]=t.useState({}),[m,f]=t.useState(0),p=t.useRef(null),a=t.useRef(null),d=t.useRef(null),[h,v]=t.useState([]),[T,b]=t.useState("null"),_=u=>`${u}`!="null"?`${g}/read-write/music/${u}`:null,[y,N]=t.useState(-1),C=t.useRef(h),R=t.useRef(y),[I,M]=t.useState(null),[W,S]=t.useState(null),{emit:K,subscribe:ee}=Nt(),F=t.useRef(null),[$,J]=t.useState(null),Q=t.useRef(null),{addNotification:ne,notifTypes:X}=He(),oe=ge(),[ce,Se]=t.useState(null),[ie,U]=t.useState(null),[j,G]=t.useState(null),te=t.useRef("A"),q=t.useRef(null),[le,ye]=t.useState(5),[L,D]=t.useState(!1),[me,ve]=t.useState(()=>{const u=parseFloat(localStorage.getItem("volume"));return isNaN(u)?.5:Math.min(1,Math.max(0,u))}),[ke,Le]=t.useState(!1),[We,_e]=t.useState(!1),De=t.useRef(null),E=t.useRef(null),P=t.useRef(null),k=t.useRef(null),B=t.useRef(0),z=t.useRef(null),se=t.useRef(0),Y=t.useRef(null),V=t.useRef(0),O=t.useRef(0),re=5,je=t.useRef(""),ze=t.useRef(null),Ut=t.useRef(0),rt=t.useRef({lastAudioTime:0,lastPerformanceNow:0}),qe=t.useRef(null),vs=.1,mt=t.useRef(!1),_t=t.useRef(""),js=bt(),Dt=t.useRef(null),ys=()=>{var u,x,w,A,H,ae,ue,Ne;a.current=new Audio,a.current.setAttribute("source","A"),a.current.addEventListener("error",he=>{if(a.current.src.includes("spoof"))return;const be=a.current.error;if(be&&(console.warn("Audio error occurred: code",be.code),be.code===4&&s)){const Ie=`${g}/radio/spoof/${encodeURIComponent(a.current.src)}`;a.current.src=Ie,ne("Audio stream not reachable from browser. Streaming from backend..",X.INFO),o(!0),a.current.play();const Be=new EventSource(`${g}/radio/trackStream/${encodeURIComponent(a.current.src)}`);Be.onmessage=we=>{console.log(we);const Te=JSON.parse(we.data);console.log("Now playing:",Te.metadata.StreamTitle);const Fe=Te.metadata.adw_ad=="true"?`Advertisment - ${(Number(Te.metadata.durationMilliseconds)/1e3).toFixed(1)}s`:Te.metadata.StreamTitle;l(Ge=>({...Ge,title:Fe}))},Be.addEventListener("error",we=>{console.warn("Metadata stream error",we)})}}),a.current.addEventListener("canplay",()=>{console.log("Stream is playable!")}),d.current=new Audio,d.current.setAttribute("source","B");for(const he of[a,d])he.current.crossOrigin="anonymous",he.current.playsInline=!0,he.current.setAttribute("webkit-playsinline",""),he.current.volume=parseFloat(localStorage.getItem("volume"))*.75||.5;(u=a.current)==null||u.addEventListener("timeupdate",ft),(x=d.current)==null||x.addEventListener("timeupdate",ft),(w=a.current)==null||w.addEventListener("playing",ht),(A=d.current)==null||A.addEventListener("playing",ht),(H=a.current)==null||H.addEventListener("play",Je),(ae=a.current)==null||ae.addEventListener("pause",Gt),(ue=d.current)==null||ue.addEventListener("play",Je),(Ne=d.current)==null||Ne.addEventListener("pause",Gt),kt(),console.log("Audio graph setted up")},bs=()=>{var u,x,w,A,H,ae,ue,Ne,he,be,Ie,Be,we,Te,Fe,Ge;console.log("Audio graph destructed"),(u=a.current)==null||u.pause(),a.current=null,(x=d.current)==null||x.pause(),d.current=null,(w=a.current)==null||w.removeEventListener("timeupdate",Ae),(A=a.current)==null||A.removeEventListener("ended",Re),(H=a.current)==null||H.removeEventListener("error"),(ae=a.current)==null||ae.removeEventListener("canplay"),(ue=d.current)==null||ue.removeEventListener("timeupdate",Ae),(Ne=d.current)==null||Ne.removeEventListener("ended",Re),(he=a.current)==null||he.removeEventListener("timeupdate",ft),(be=d.current)==null||be.removeEventListener("timeupdate",ft),(Ie=a.current)==null||Ie.removeEventListener("playing",ht),(Be=d.current)==null||Be.removeEventListener("playing",ht),(we=a.current)==null||we.removeEventListener("play",Je),(Te=a.current)==null||Te.removeEventListener("pause",Je),(Fe=d.current)==null||Fe.removeEventListener("play",Je),(Ge=d.current)==null||Ge.removeEventListener("pause",Je)},kt=()=>{var u,x;(u=a.current)==null||u.pause(),a.current.src=null,a.current.currentTime=0,(x=d.current)==null||x.pause(),d.current.src=null,d.current.currentTime=0,p.current=null,te.current="A",a.current.removeEventListener("timeupdate",Ae),a.current.removeEventListener("ended",Re),d.current.removeEventListener("timeupdate",Ae),d.current.removeEventListener("ended",Re)},ht=()=>{z.current&&(console.log("Record start playing",p.current.currentTime),rt.current.lastAudioTime=p.current.currentTime,rt.current.lastPerformanceNow=performance.now())},Bt=()=>{const u=p.current;!u||u.paused||Math.abs(u.currentTime-zt())>vs&&Wt()},Ns=()=>(setTimeout(Bt,200),setInterval(Bt,5e3)),Je=()=>{z.current&&(Wt(),qe.current&&clearInterval(qe.current),qe.current=Ns())},Gt=()=>{qe.current&&(clearInterval(qe.current),qe.current=null)},ft=()=>{if(!z.current)return;const u=p.current.currentTime;if(Math.abs(u-Ut.current)>1){const x=1/z.current.interval,w=re*x,A=Math.floor(u*x);se.current=0,O.current=A,Ht(je.current,A,A+w)}else ks(je.current,u);Ut.current=u};t.useEffect(()=>{r&&r.type!=="radio"&&pt()},[r]);const pt=()=>{const u=h.length<=y+1;q.current&&clearTimeout(q.current),!(u||!p.current)&&(console.log("Transition rescheduled, timesout in ",r.rawDuration,p.current.currentTime,le,r.rawDuration-p.current.currentTime-le),q.current=setTimeout(()=>{te.current=te.current==="A"?"B":"A",Vt(y+1)},Math.min(r.rawDuration-p.current.currentTime-le)*1e3,0))},Vt=async u=>{const x=h.length<=u;if(N(u),p.current=te.current==="A"?a.current:d.current,h[u].startsWith("url:")){console.log(h[u]);const ae=h[u].slice(4),ue=await fetch(`${g}/radio/${ae}`).then(he=>he.json());console.log(ue),p.current.src=ue.url,l({type:"radio",artist:ue.name,...ue,duration:"0-"});const Ne=new EventSource(`${g}/radio/trackStream/${encodeURIComponent(ue.url)}`);Ne.onmessage=he=>{console.log(he);const be=JSON.parse(he.data);console.log("Now playing:",be.metadata.StreamTitle),l(Ie=>({...Ie,title:be.metadata.StreamTitle}))},Ne.addEventListener("error",he=>{console.warn("Metadata stream error",he)}),qt(),d.current.removeEventListener("timeupdate",Ae),d.current.removeEventListener("ended",Re),o(!0),p.current.play();return}const w=h[u].split("."),A=w.length!=0?w[0]:h[u];await fetch(`${g}/read-write/trackInfos/${A}`,{method:"GET"}).then(ae=>ae.json()).then(ae=>{ae.duration=Lt(ae.rawDuration),l(ae)});const H=h[u];if(p.current.currentTime=0,await fetch(`${g}/read-write/fftConfig/${A}`,{method:"GET",credentials:"include"}).then(async ae=>{if(se.current=0,O.current=0,V.current=0,!ae.ok){z.current=null;return}const ue=await ae.json();z.current=JSON.parse(ue);const Ne=z.current.fftSize*1,he=re/z.current.interval;Y.current=new Int16Array(he*Ne),console.log("New buffer!")}),p.current.src!==_(H))p.current.src=_(H);else{f(0);return}p.current.play(),clearTimeout(P.current),c(H),je.current=H,o(!0),Us(H),console.log("Fading in",p.current),te.current==="A"?(x?xt(d,null):(xt(d,a),a.current.addEventListener("timeupdate",Ae),a.current.addEventListener("ended",Re)),d.current.removeEventListener("timeupdate",Ae),d.current.removeEventListener("ended",Re)):te.current==="B"&&(x?xt(a,null):(xt(a,d),d.current.addEventListener("timeupdate",Ae),d.current.addEventListener("ended",Re)),a.current.removeEventListener("timeupdate",Ae),a.current.removeEventListener("ended",Re))},Ht=async(u,x,w)=>{if(!z.current)return null;const A=z.current.fftSize*1*2,H=A*x,ae=A*w,ue=await fetch(`${g}/read-write/fft/${u}`,{headers:{Range:`bytes=${H}-${ae-1}`}});if(!ue.ok&&ue.status!==206)throw new Error("Failed to stream FFT data");V.current=w;const Ne=await ue.arrayBuffer(),he=new Int16Array(Ne),be=z.current.fftSize*1,Ie=he.length/be,Be=z.current.interval,we=re/Be;let Te=se.current;for(let Fe=0;Fe<Ie;Fe++){const Ge=Fe*be,fn=(Te+Fe)%we;Y.current.set(he.subarray(Ge,Ge+be),fn*be)}se.current=(Te+Ie)%we},Wt=()=>{rt.current.lastAudioTime=p.current.currentTime,rt.current.lastPerformanceNow=performance.now()},Ss=()=>{const{lastAudioTime:u,lastPerformanceNow:x}=rt.current,w=(performance.now()-x)/1e3;return u+w},zt=()=>p.current.paused?p.current.currentTime:Ss(),ks=(u,x)=>{const w=1/z.current.interval,A=Math.floor(x*w),H=V.current-A,ae=w*re;ae-H<1||Ht(u,V.current,ae+A)},ws=()=>{const u=1/z.current.interval,w=Math.floor(zt()*u)-O.current,A=re*u;return w%A},Ts=()=>{if(!z.current||!Y.current)return null;const u=z.current.fftSize*1,x=ws();if(x===null)return null;const A=Math.floor(re/z.current.interval)*u,H=x*u,ae=H+u;return ae>A?null:Y.current.slice(H,ae)},qt=()=>{P!=null&&P.current&&clearInterval(P.current)};t.useEffect(()=>{console.log("Changed inteval ref:",P.current)},[P.current]);const xt=(u,x)=>{P.current&&clearInterval(P.current);const w=150;let A=0;console.log("Init fadeout for:",x.current),P.current=setInterval(()=>{const H=Math.min(1,Math.max(0,A*w/(le*1e3)));x.current.volume=H*B.current,u.current&&(u.current.volume=(1-H)*B.current),H>=1&&(clearInterval(P.current),P.current=null,x.current&&(u.current.pause(),u.current.src=null)),A++},w)},Ae=()=>{var u;return f((u=p.current)==null?void 0:u.currentTime)},Re=()=>{h.length>0&&h.length<=y+1&&wt()};t.useEffect(()=>{!L||y===-1||h.length===0||(kt(),console.log("init Autoplay",h,y,L,a.current,d.current),Vt(y),D(!1))},[h,y,L]),t.useEffect(()=>{R.current=y},[y]),t.useEffect(()=>{C.current=h},[h]);const Es=()=>{if(console.log(y),i)p.current.pause(),o(!1),clearTimeout(q.current),clearInterval(P.current);else{if(o(!0),y===-1&&h.length!==0){N(0);return}p.current.play(),pt()}},Cs=(u,x=!1)=>{fetch(`${g}/read-write/nextSongs/${ce.type}/${ce.id}/${x}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{v(w),console.log(w),N(w.findIndex(A=>A===u)),D(!0)})},As=u=>{v([u]),N(0),D(!0)},Rs=()=>{if(p.current.currentTime>5||y===0){p.current.currentTime=0,pt();return}N(y-1),D(!0)},Is=(u,x,w=!1)=>{D(!1),fetch(`${g}/read-write/nextSongs/${x}/${u}/${w}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{v(A),N(0),D(!0)})},Fs=(u,x,w=!1)=>{D(!1),fetch(`${g}/read-write/nextSongs/${x}/${u}/${w}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{v(H=>[...H,...A])})},$s=(u,x,w=!1)=>{console.log(`${g}/read-write/nextSongs/${x}/${u}/${w}`),fetch(`${g}/read-write/nextSongs/${x}/${u}/${w}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{v(gt.shuffle(A)),D(!0),N(0)})},Ps=(u=!1)=>{const x=u?C.current:h,w=u?R.current:y;x.length<=w+1&&(wt(),console.log("stop")),N(w+1),D(!0)},wt=()=>{kt(),f(0),o(!1),l(null),D(!1),N(-1),b("null"),v([]),c(""),je.current="",console.log("No more songs in the queue"),clearInterval(P.current),clearTimeout(q.current),qt()},Ls=u=>{if(u<0||u>100)return;const x=u/100*p.current.duration;p.current.currentTime=x,f(x),pt()},Os=u=>{p.current.currentTime+u>p.current.duration?p.current.currentTime=p.current.duration:p.current.currentTime+u<0?p.current.currentTime=0:p.current.currentTime+=u,f(p.current.currentTime)},Ms=u=>{u<0||u>=h.length||(D(!0),N(u))},Us=u=>{fetch(`${g}/read-write/trackCover/${u}`,{method:"GET"}).then(x=>x.json()).then(x=>{b(`${g}/covers/${x}`)})},_s=()=>{wt(),v([]),N(-1)},Tt=()=>{fetch(`${g}/config/user/FFT`,{method:"GET",credentials:"include"}).then(u=>u.json()).then(u=>{ze.current=u})};t.useEffect(()=>{ve(parseFloat(localStorage.getItem("volume"))||.5),ys(),Tt();const u=ee("login",()=>{console.warn("login triggered!"),Tt()});return()=>{bs(),u()}},[]);const Ds=async u=>{const x=await fetch(`${g}/read-write/artist-all-tracks/${u}`,{method:"GET",credentials:"include"});if(!x.ok)throw new Error("Network response was not ok");const A=(await x.json()).map(H=>H.id);v(H=>[...H,...A])},Bs=async u=>{const x=await fetch(`${g}/read-write/artist-all-tracks/${u}`,{method:"GET",credentials:"include"});if(!x.ok)throw new Error("Network response was not ok");const A=(await x.json()).map(H=>H.id);v(gt.shuffle(A)),D(!0),N(0)},Gs=async()=>{fetch(`${g}/read-write/all-songs`,{method:"GET"}).then(u=>u.json()).then(u=>{v(gt.shuffle(u)),D(!0),N(0)})},Vs=u=>{console.log("Editing album",u),fetch(`${g}/read-write/album/${u}`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{const{albumInfos:w,genres:A,tracks:H,artists:ae}=x;M({id:u,coverURL:`${g}/covers/${w.cover}`,tracks:H,type:"album",name:w.title,artist:ae.map(ue=>ue.name),year:w.release_date,description:w.description,genre:A.map(ue=>ue.genreName)})})},Hs=u=>{fetch(`${g}/read-write/playlist/${u}/true`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{const{playlistInfos:w,collaborators:A}=x;M({id:w.id,type:"playlist",coverURL:`${g}/covers/${w.cover}`,name:w.title,description:w.description,collaborators:A})})};t.useEffect(()=>{const u=Math.min(1,Math.max(0,me));P.current||Ws(u.toFixed(4)*.75),B.current=u.toFixed(4)*.75,localStorage.setItem("volume",u)},[me]);const Ws=u=>{k.current&&clearInterval(k.current);let x=0;const w=16,A=a.current.volume;k.current=setInterval(()=>{const H=Tr(A,u,x*w/300);a.current.volume=H,d.current.volume=H,(u-A>0?H>=u:H<=u)&&(clearInterval(k.current),k.current=null),x++},w)},zs=(u,x=null)=>{if(!u){console.log("No changes made"),S(null);return}const w=new FormData;w.append("artist",JSON.stringify(u)),x&&w.append("coverArtist",x),fetch(`${g}/read-write/editContainer/artist`,{method:"POST",credentials:"include",body:w}).then(()=>{S(null),F.current()})},qs=u=>{fetch(`${g}/read-write/artist/${u}/true`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{S({id:x.id,picture:`${g}/covers/artists/${x.picture}`,name:x.name,bio:x.bio,active_from:x.active_from})})},Jt=(u,x=null)=>{if(!u){console.log("No changes made"),M(null);return}const w=new FormData;w.append(`${u.type}`,JSON.stringify(u)),x&&w.append("cover",x),fetch(`${g}/read-write/editContainer/${u.type}`,{method:"POST",credentials:"include",body:w}).then(()=>{M(null),F.current()})},Js=async(u,x)=>{const w=u?"/forMe":"";(await fetch(`${g}/read-write/delete/album/${x.id}${w}`,{method:"DELETE",credentials:"include"}).then(H=>H.json())).success&&(ne(`Album ${x.name} deleted.`,X.SUCCESS),M(null),oe("/home"))},Ys=async()=>{Le(!0)},Ks=(u,x)=>{console.log("sending playlist",u);const w=new FormData;w.append("playlist",JSON.stringify(u)),x&&(w.append("cover",x),console.log(x)),fetch(`${g}/read-write/newPlaylist`,{method:"POST",credentials:"include",body:w}).then(()=>{Le(!1),De.current()})},Qs=u=>{N(0),v([`url:${u}`]),D(!0)},Xs=()=>{Le(!1)},Zs=(u,x,w,A)=>{J({track:x,position:u}),Q.current&&Q.current(),Q.current=w,E.current=A},en=()=>{J(null),Q.current&&Q.current()},tn=(u,x,w=null)=>{switch(en(),u){case $e.NONE:return;case $e.TOP_QUEUE:nn(x);break;case $e.END_QUEUE:rn(x);break;case $e.GOTO_ALBUM:sn(x);break;case $e.REMOVE_FROM_PLAYLIST:an(x);break;case $e.TAGS:U(x),ne("Avaliable soon :)",X.INFO);break;case $e.ADD_TO_FAVORITES:fetch(`${g}/read-write/toggleFavorite/${x.id}/true`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{E.current(A)});break;case $e.REMOVE_FROM_FAVORITES:fetch(`${g}/read-write/toggleFavorite/${x.id}/false`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{E.current(A)});break}},sn=u=>{fetch(`${g}/read-write/trackAlbumId/${u.id}`,{method:"GET"}).then(x=>x.json()).then(x=>{oe(`albums/${x}`)})},nn=u=>{const x=h;x.splice(y+1,0,u.id),v(x),ne(`${u.title} playing next.`,X.SUCCESS)},rn=u=>{const x=h;x.push(u.id),v(x),ne(`${u.title} playing at the end.`,X.INFO)},an=u=>{fetch(`${g}/read-write/deleteTrackFromPlaylist/${ce.id}/${u.id}`,{method:"DELETE",credentials:"include"}).then(x=>x.json()).then(x=>{F.current(),ne(`${u.title} removed.`,X.SUCCESS)})},on=(u,x)=>{F.current=x,Se(u)},cn=(u,x)=>{if(U(null),!u)return;const w=new FormData;w.append("current",JSON.stringify(u.current)),w.append("deleted",JSON.stringify(u.deleted)),fetch(`${g}/read-write/changeTrackTags/${x}`,{method:"POST",credentials:"include",body:w}).then(A=>A.json()).then(A=>{ne("Tags upated!",X.SUCCESS)})},ln=async(u=[],x)=>{u.length!==0&&(v(u),N(x||0),D(!0))},un=()=>{_e(!0)},dn=()=>{_e(!1)},mn=()=>{mt.current=!mt.current,mt.current&&(_t.current=js.pathname),oe(mt.current?"/full-screen":_t.current)},hn=()=>new Promise(u=>{fetch(`${g}/read-write/getSongMetaDataCover/${s}`,{method:"GET",credentials:"include"}).then(x=>x.blob()).then(x=>{Dt.current={track:s,blob:x},u()})});return e.jsxs(ds.Provider,{value:{requestNewFullScreenImage:hn,fullScreenImage:Dt.current,toggleFullScreenView:mn,fetchFFTUserSettings:Tt,FFTUserSetingsRef:ze,fftConfigRef:z,getFFTAtCurrentTime:Ts,deleteAlbum:Js,editArtist:qs,playRadio:Qs,playContainer:Is,closeTagWindow:dn,openTagWindow:un,saladContext:j,setSaladContext:G,playAudioSalad:ln,linkNewContainer:on,trackActionTypes:$e,onClicTrackActionEntry:tn,openTrackActions:Zs,getNextSongsFromAlbum:Cs,currentTrackData:r,currentTime:m,isPlaying:i,toggleTrackPaused:Es,playNextSong:Ps,trackCoverUrl:T,playPreviousSong:Rs,playingTrack:s,jumpTrackSeconds:Os,jumpToPercent:Ls,addContainerToQueue:Fs,playContainerSuffle:$s,playQueue:h,queuePointer:y,jumpToQueueTrack:Ms,deleteQueue:_s,addArtistToQueue:Ds,shuffleArtistToQueue:Bs,playTrackNoQueue:As,playLibraryShuffle:Gs,setVolume:ve,volume:me,editAlbum:Vs,editPlaylist:Hs,createNewPlaylist:Ys,globalAudioRef:p,setPlaylistAddedCallback:u=>{De.current=u}},children:[n,I?I.type==="album"?e.jsx(Rr,{applyCanges:Jt,albumClass:I}):I.type==="playlist"?e.jsx(Yt,{editPlaylistClass:I,applyCanges:Jt}):null:null,W&&e.jsx(Lr,{applyChanges:zs,artist:W}),ke&&e.jsx(Yt,{closeOverlay:Xs,applyCanges:Ks}),$?e.jsx(Fr,{isFav:ce.favPlaylist,trackY:$.position.y,track:$.track}):null,ie&&e.jsx($r,{apply:cn,track:ie}),We&&e.jsx(Pr,{})]})},xe=()=>{const n=t.useContext(ds);if(n===void 0)throw new Error("useAudioPlayer must be used within an AudioPlayerProvider");return n},nt=({percent:n,text:s=null,showPercent:c=!1,isMarquee:i=!1,fillColor:o="#fffdff",style:r={},initialising:l=!1,initialisingColor:m="white",onClickPercentage:f=null,filter:p="",minWidth:a=0})=>{const d=h=>{if(l||!f)return;const v=h.currentTarget,T=v.getBoundingClientRect().x,b=h.clientX;f((b-T)/v.clientWidth*100)};return e.jsxs("div",{className:"progressBar",style:{...r,minWidth:a},onClick:d,children:[e.jsx("div",{className:"progressFill",style:{width:`${n}%`,background:`${o}`,...r}}),l?e.jsx("div",{className:"progressFill",init:"init",style:{backgroundColor:m,opacity:"0.5",...r}}):null,c&&e.jsx("span",{className:"progressPercent",style:{color:"black"},children:n+"%"}),s&&e.jsx("span",{className:"progressPercent",style:{color:"black",margin:"auto"},children:s})]})},Ur=()=>{const{currentTrackData:n,currentTime:s,jumpToPercent:c}=xe();if(!n||Object.keys(n).length===0)return null;const i=()=>e.jsxs("div",{children:[e.jsx("span",{children:Lt(s).readable}),e.jsx(nt,{percent:s/n.rawDuration*100,showPercent:!1,fillColor:"var(--violet-web-color)",style:{height:"10px"},onClickPercentage:c}),e.jsx("span",{children:n.duration.readable})]}),o=()=>null;return e.jsx("div",{className:"songProgress",children:(n==null?void 0:n.type)=="radio"?e.jsx(o,{}):e.jsx(i,{})})},_r=({context:n,active:s,setActive:c})=>{const i=r=>{const l=s===r?"active":"";return e.jsx("div",{className:"index",id:n.name+"-index_"+r,onClick:()=>c(r),active:l},r)};let o=[];for(let r=0;r<n.length;r++)o.push(i(r));return e.jsx("div",{className:"activeIndex-container "+n.name,children:o})},ms=t.memo(function({currentActive:s,onClick:c,data:i}){const[o,r]=t.useState(s);t.useEffect(()=>{r(s)},[s]);const l=m=>{r(m),c==null||c(m)};return e.jsx("div",{className:"job-view-div",children:i.map((m,f)=>e.jsx("div",{className:"cornered-button","data-active":o===f,onClick:()=>{l(f)},children:m},f))})}),Dr=({fromFile:n,setFromFile:s,tracksSelected:c,initMetadataFetching:i})=>{const[o,r]=t.useState(!1),[l,m]=t.useState(""),f=a=>{r(!0),a.target.files&&(console.log("New tracks"),c(Array.from(a.target.files)),a.target.files=null)},p=a=>{m(a.target.value)};return e.jsxs("div",{className:"addMusicSource",children:[e.jsxs("div",{className:"add-audio-source-selection",children:[e.jsx("p",{children:"Select the source: "}),e.jsx(ms,{currentActive:n?0:1,onClick:a=>{s(a==0)},data:["From file","From URL"]})]}),n?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Select files from a local storage."}),e.jsxs("div",{className:"add-music-input",children:[e.jsxs("label",{for:"files",className:"file-select",children:[e.jsx(Cn,{}),e.jsx("span",{children:"Select file"})]}),e.jsx("input",{id:"files",multiple:!0,type:"file",accept:"audio/*",onChange:f})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Link to a radio steam."}),e.jsxs("div",{className:"add-music-input",children:[e.jsx("input",{type:"text",placeholder:"Enter URL",onChange:p}),e.jsx(de,{onClick:async()=>{i(l)},text:"Resolve",icon:e.jsx(An,{})})]})]}),o&&e.jsx("p",{children:"Hold a sec'.. The metadata fetch is about to beggin."})]})},it=({text:n,progressBar:s={useProgressBar:!1}})=>e.jsxs("div",{className:"loading-container",children:[e.jsx("h2",{children:n}),s.useProgressBar?e.jsx(nt,{percent:s.percent,showPercent:s.showPercent,isMarquee:s.isMarquee,fillColor:s.fillColor,style:{height:"25px"}}):e.jsx("p",{children:"Loading..."})]}),Br=({addNewMusic:n})=>e.jsx("div",{className:"album-card",context:"add",children:e.jsx(Rn,{strokeWidth:.7,className:"album-card-cover",onClick:n})}),Gr=({album:n,deleteAlbum:s,editAlbum:c})=>e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(Ze,{className:"album-card-overview-button",use:"delete",onClick:()=>s(n.uuid)}),e.jsx(as,{className:"album-card-overview-button",use:"edit",onClick:()=>c(n.uuid)}),e.jsxs("div",{className:"album-card-overview-button",use:"song-count",children:[e.jsx(In,{className:"song-count-icon"}),e.jsx("span",{children:n.tracks.length})]}),e.jsx("img",{src:n.coverURL,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Ue(n.name,25)}),e.jsx("p",{className:"album-artist",children:Ue(n.artist.join(","),25)||"No artist"})]}),Vr=({radio:n,deleteRadio:s})=>(console.log(n),e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(Ze,{className:"album-card-overview-button",use:"delete",onClick:()=>s(n[0])}),e.jsx("img",{src:n[1].favicon==""?null:n[1].favicon,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Ue(n[1].name,25)})]})),Hr=({albums:n,radios:s,deleteRadio:c,addNewMusic:i,deleteAlbum:o,editAlbum:r,publish:l})=>{const m=n.map((a,d)=>e.jsx(Gr,{album:a,deleteAlbum:o,editAlbum:r},`alb-${d}`)),f=[...s].map((a,d)=>e.jsx(Vr,{radio:a,deleteRadio:c},`rad-${d}`)),p=[...m,...f];return console.log("rerun"),p.push(e.jsx(Br,{addNewMusic:i},-1)),e.jsxs("div",{className:"albums-overview",children:[e.jsx("div",{className:"album-overview-container",children:p.reverse()}),(n.length>0||s.size>0)&&e.jsx("button",{className:"roundButton",onClick:l,children:"Publish to library"})]})},Wr=({track:n,onClose:s})=>{const{albums:c,moveTrackToNewAlbum:i,moveTrackToAlbum:o,editingAlbum:r,setEditingAlbum:l}=Jr(),[m,f]=t.useState(""),[p,a]=t.useState(!1),d=t.useRef(null),h=T=>{T.preventDefault(),!m&&T.target.existingAlbum.value?o(n,T.target.existingAlbum.value):m!==""&&i(n,m),p&&l(null),s()},v=T=>{f(T.target.value)};return t.useEffect(()=>{c.find(({uuid:b})=>b===r).tracks.length===1?a(!0):a(!1);const T=b=>{var _;if(d.current&&!d.current.contains(b.target)){if(((_=b.target.closest("svg"))==null?void 0:_.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",T),document.addEventListener("touchstart",T),()=>{document.removeEventListener("mousedown",T),document.removeEventListener("touchstart",T)}},[]),e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:d,children:[e.jsx("h2",{children:"Move track to another album"}),p&&e.jsx("p",{className:"last-track-notify",children:"Last track of the album, if you move it, the current album will be deleted."}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:h,children:[e.jsx("label",{htmlFor:"newAlbum",children:"New album name"}),e.jsx("input",{type:"text",id:"newAlbum",placeholder:"Enter album name",onChange:v}),e.jsx("label",{htmlFor:"existingAlbum",children:"Existing album"}),e.jsx("select",{id:"existingAlbum",onChange:()=>f(""),children:c.map((T,b)=>T.uuid===r?null:e.jsx("option",{value:T.uuid,children:T.name},b))}),e.jsx("input",{type:"submit",value:"Submit"})]})]})})},zr=({setEditUid:n,albumClass:s})=>{var p,a;const[c,i]=t.useState({visible:!1}),[o,r]=t.useState(null);if(!s)return null;t.useEffect(()=>{s&&r(s.coverURL)},[s]);const l=()=>{const d=document.getElementById("editAlbumInfos");s.name=d.albumName.value,s.artist=d.artistName.value.split(",").map(h=>h.trim()),s.year=d.releaseDate.value,s.genre=d.genre.value.split(",").map(h=>h.trim()).map(h=>h.charAt(0).toUpperCase()+h.slice(1)),s.description=d.description.value,console.log(s.genre),n(null)},m=d=>{const h=d.target.files[0];h&&r(s.setCoverFromFile(h))},f=d=>{i({visible:!c.visible,...d})};return e.jsxs("div",{className:"albumWrapping",children:[e.jsxs("div",{className:"albumCover",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(pe,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(lt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:m})]}),e.jsx("button",{className:"roundButton",onClick:()=>l(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(p=s.artist)==null?void 0:p.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",defaultValue:s.year})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(a=s.genre)==null?void 0:a.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Pe,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:d,style:h})=>e.jsxs("div",{style:h,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[d].name}),e.jsx(ts,{className:"trackIcon",onClick:()=>{f(s.tracks[d])}})]},d)})})]}),c.visible&&e.jsx(Wr,{onClose:()=>{i({visible:!1})},track:{id:c.id,name:c.name}})]})};class Kt{constructor(s,c,i,o,r,l){this.name=s,this.artist=c,this.year=i,this.tracks=o,this.setCover(r),this.uuid=l}setCover(s){!s||this.coverURL||(this.coverData=s.data,this.coverMime=s.format,this.coverURL=URL.createObjectURL(new Blob([this.coverData],{type:this.coverMime})),this.ext=this.coverMime.split("/")[1],this.sourceIsBinary=!0)}setCoverFromFile(s){return this.coverURL=URL.createObjectURL(s),this.coverFile=s,console.log("Setting cover from file: ",s),this.ext=s.type.split("/")[1],this.coverURL}}const hs=t.createContext(),qr=({closeOverlay:n,uploadPercent:s,uploadProgress:c,uploadFinished:i,isMinimize:o,setMinimized:r})=>{const[l,m]=t.useState(!0),[f,p]=t.useState(0),[a,d]=t.useState([]),[h,v]=t.useState(0),[T,b]=t.useState(0),[_,y]=t.useState([]),[N,C]=t.useState([]),[R,I]=t.useState(!1),[M,W]=t.useState("xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx"),[S,K]=t.useState(0),[ee,F]=t.useState(0),[$,J]=t.useState(""),{addNotification:Q,notifTypes:ne}=He(),[X,oe]=t.useState([]),[ce,Se]=t.useState(new Map);let ie=!1;const U=t.useRef(!1),j=t.useRef(null),G=async E=>{if(console.log("Tracks selected: ",E),E.length===0)return;b(E.length),d(k=>[...k,...E]),j.current=E;const P=[];for(let k=0;k<E.length;k++)P.push({id:ct()});U.current=!0,oe(k=>[...k,...P])};t.useEffect(()=>{U.current&&(U.current=!1,te())},[X]),t.useEffect(()=>{console.log("To add tracks",a)},[a]);const te=async()=>{const E=await L();if(E)ye(E);else{const P=j.current.length;console.log(a.length,P),oe(X.filter((k,B)=>B<X.length-P)),d(a.filter((k,B)=>B<a.length-P)),v(0),p(2)}j.current=null},q=E=>{const P=E.filter(({tracks:k})=>k.length>0);I(!0),C(P)};t.useEffect(()=>{console.log("Reconstructing albums... ",N),!R&&(v(0),p(2))},[N]);const le=E=>{var z;function P(se,Y){return Y.findIndex(V=>V.name===se)}let k=[],B=X;for(let se=0;se<E.length;se++){let Y=E[se];const V=X.length-E.length+se,O=P(Y.common.album,k),re={id:X[V].id,name:Y.common.title||X[V].title};if(O===-1){const je=ct();k.push(new Kt(Y.common.album,Y.common.artist?Y.common.artist.split(",").map(ze=>ze.trim()):["Unknown artist"],Y.common.year,[re],(z=Y.common.picture)==null?void 0:z[0],je)),B[V].albumUuid=je}else k[O].tracks.push(re),B[V].albumUuid=k[O].uuid}return y(se=>[...se,...E]),oe(B),k},ye=E=>{const P=le(E);setTimeout(()=>{I(!1),C(k=>[...k,...P])},400)},L=async(E="")=>{if(!l){if(!E)return;console.log("Fetching meta at source",E);const Y=await fetch(`${g}/radio/metadata/${encodeURIComponent(E)}`,{method:"GET"}).then(re=>re.json());if(Y)Q("Radio found! "+Y[0].name,ne.INFO);else{Q("No radio found..",ne.ERROR);return}const V=Y[0];console.log(V);const O=ce;O.set(V.stationuuid,{url:V.url_resolved,favicon:V.favicon,name:V.name}),Se(O),p(2);return}const P=j.current;p(1);const k=[],B=X,z=X.length-P.length;let se=!1;return await Promise.all(P.map(async(Y,V)=>{var je;const O=await br(Y).catch(ze=>{console.log("error at",Y,ze),Q(`Track ${Y.name} seems corrupted, retry without it.`,ne.ERROR)});if(!O){se=!0;return}let re=B[V+z];O.common.title||(O.common.title=Y.name,console.log("No title found, using filename: "+Y.name),re.title=Y.name),O.common.album||(O.common.album=O.common.title,re.album=O.common.title),re.duration=O.format.duration,re.year=O.common.year,re.no=((je=O.common.track)==null?void 0:je.no)||0,re.title=O.common.title,k.splice(V,0,O),v(k.length)})),se?null:(oe(B),k)},D=E=>{const P=new Map([...ce].filter(([k,B])=>k!=E));Se(P)},me=E=>{ie=!0;let P=X;const k=N.find(O=>O.uuid===E).tracks.map(O=>O.id);let B=a;const z=P.filter(O=>!k.includes(O.id)),Y=P.map((O,re)=>k.includes(O.id)?null:re).filter(O=>O!==null).map(O=>B[O]);d(Y),oe(z);const V=N.filter(O=>O.uuid!==E);I(!1),C(V)},ve=E=>{W(E)};t.useEffect(()=>{if(M===null||N.length===0){p(2);return}p(3)},[M]);const ke=(E,P)=>{let k=X;const{id:B,name:z}=E,se=ct();console.log("Moving track: "+B+NaN+M+" to album: "+se),k=k.map(O=>(O.id===B&&(O.albumUuid=se),O));let Y=N.map(O=>(O.uuid===M&&(O.tracks=O.tracks.filter(re=>re.id!==B)),O));const V=new Kt(P,["Unknown artist"],"",[{id:B,name:z}],null,se);Y.push(V),oe(k),q(Y),Q(`Track ${z.substring(0,60)} got moved to album ${P}.`,ne.INFO)},Le=(E,P)=>{let k=X;const{id:B,name:z}=E;console.log("Moving track: "+B+NaN+M+" to album: "+P);const se=N.find(V=>V.uuid===P).name;k=k.map(V=>(V.id===B&&(V.albumUuid=P),V));let Y=N.map(V=>(V.uuid===P?V.tracks.push({id:B,name:z}):V.uuid===M&&(V.tracks=V.tracks.filter(O=>O.id!==B)),V));oe(k),q(Y),Q(`Track ${z.substring(0,60)} got moved to album ${se}.`,ne.INFO)},We=async()=>{if(ie){console.log("Deleting, aborting publish");return}if(console.log("Publishing tracks: ",a),console.log("Publishing radios: ",ce),ce.keys().forEach(async E=>{const P=new FormData;console.log(ce.get(E)),P.append("radioData",JSON.stringify({uuid:E,...ce.get(E)}));const k=await fetch(`${g}/radio/newRadio`,{method:"POST",credentials:"include",body:P}).then(B=>B.json());console.log(k)}),a.length>0){p(4);const E=N.map(k=>{if(!k.sourceIsBinary)return k.coverFile?(console.log("Using file reference for cover: "+k.coverFile),k.coverFile):null;if(console.log("Using binary reference for cover: ",k.uuid),!k.coverData||k.coverData.length===0)return console.log("returned no cover at",k.uuid),null;const B=new Uint8Array(k.coverData),z=new Blob([B],{type:k.coverMime});return new File([z],`${k.uuid}.${k.coverMime.split("/").pop()}`,{type:k.coverMime})});for(let k=0;k<N.length;k++){let B=new FormData;const{coverURL:z,sourceIsBinary:se,tracks:Y,coverFile:V,coverData:O,...re}=N[k];B.append("album",JSON.stringify({...re})),E[k]&&B.append("cover",E[k]);const je=await fetch(`${g}/read-write/upload`,{method:"POST",body:B,credentials:"include"});if(!je.ok)throw console.error("Error uploading albums:",je.statusText),new Error("Error uploading albums");B=null,console.log("Album uploaded: "+N[k].name)}N.forEach(k=>{k.coverURL&&(URL.revokeObjectURL(k.coverURL),k.coverURL=null)});let P=a.reduce((k,B)=>k+B.size,0);K((P/1024/1024).toFixed(1));for(let k=0;k<a.length;k++){const B=a[k];let z=new FormData;z.append("trackMeta",JSON.stringify(X[k])),z.append("music",B),J(B.name),c({done:k,total:a.length}),await Nr({method:"POST",data:z,withCredentials:!0,url:"/upload",baseURL:`${g}/read-write`,onUploadProgress:se=>{const{total:Y,loaded:V}=se,O=Y/1e6,re=V/1e6;s(re/O);const je=re/O*100;F(je.toFixed(2))}}).then(()=>{}).catch(se=>{console.error("Error uploading track:",se)}),z=null}}console.log("Upload finished"),i(),setTimeout(()=>{d([]),y([]),v(0),C([]);const E=ce;E.clear(),Se(E),p(0),W("xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx"),F(0),console.log("Closing overlay");const P=new CustomEvent("musicUploaded",{});window.dispatchEvent(P),n()},750)},_e=()=>{if(f!==4){n();return}r(!0)};t.useEffect(()=>{ie&&(ie=!1)},[a]);const De=()=>{switch(f){case 0:return e.jsx(Dr,{fromFile:l,setFromFile:m,tracksSelected:G,initMetadataFetching:L});case 1:return e.jsx(it,{text:`Fetching metadata... ${T?h+"/"+T:"-/-"}`});case 2:return e.jsx(Hr,{albums:N,addNewMusic:()=>p(0),deleteAlbum:me,editAlbum:ve,publish:We,radios:ce,deleteRadio:D});case 3:return e.jsx(zr,{setEditUid:W,albumClass:N.find(E=>E.uuid===M)});case 4:return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(it,{text:`Publishing ${$} ${S}Mb..`,progressBar:{useProgressBar:!0,showPercent:!0,isMarquee:!1,percent:Number(ee),fillColor:"var(--cool-green)"}}),e.jsx("p",{children:"You can close this overlay, the upload will continue. :)"})]});default:return e.jsx("div",{className:"addMusicSource",children:e.jsx("p",{children:"Not implemented yet"})})}};return e.jsx("div",{className:"addMusicContainer",style:o?{display:"none"}:{},children:e.jsxs(hs.Provider,{value:{albums:N,moveTrackToNewAlbum:ke,editingAlbum:M,moveTrackToAlbum:Le,setEditingAlbum:W},children:[e.jsx(Ce,{className:"buttonRound closeOverlay",onClick:_e}),e.jsx("h2",{children:"Add Music"}),e.jsx(_r,{context:{name:"AddMusic",length:5},active:f,setActive:null}),e.jsx(De,{})]})})},Jr=()=>t.useContext(hs),vt=({iconHovered:n,iconDefault:s,onClick:c=null,className:i})=>{const[o,r]=t.useState(!1);return e.jsx("div",{style:c?{background:"rgba(0,0,0,0)"}:{},className:`${i}`,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),onClick:c,children:o?e.jsx(n,{}):e.jsx(s,{})})},Qt=({context:n})=>{const{isPlaying:s,toggleTrackPaused:c,playNextSong:i,playPreviousSong:o,jumpTrackSeconds:r}=xe();return e.jsxs("div",{className:"audio-controls",context:n.mobile?"mobile":"desktop",children:[n.mobile?null:e.jsx(vt,{iconHovered:$n,iconDefault:Fn,onClick:o}),e.jsx(vt,{iconHovered:s?Ln:On,iconDefault:s?Pn:Rt,onClick:c}),e.jsx(vt,{iconHovered:Un,iconDefault:Mn,onClick:i})]})},Yr=({index:n,trackId:s,style:c})=>{const{getTrack:i,setTrack:o}=Qr(),[r,l]=t.useState(i(s)||null),{jumpToQueueTrack:m,queuePointer:f}=xe(),{ref:p,inView:a}=Sr({threshold:.1,triggerOnce:!0});t.useEffect(()=>{a&&!r&&fetch(`${g}/read-write/shortTrackInfos/${s}`,{method:"GET",credentials:"include"}).then(v=>{if(!v.ok)throw new Error("Network response was not ok");return v.json()}).then(v=>{l(v),o(s,v)})},[a,s,r,o]);const d=(r==null?void 0:r.title)??null,h=(r==null?void 0:r.cover)??null;return e.jsxs("div",{className:"music-queue-entry",style:{...c,overflow:"hidden"},"is-passed":`${n<f}`,"is-selected":`${n===f}`,ref:p,onClick:()=>m(n),children:[h?e.jsx("img",{src:`${g}/covers/${h}`,ralt:`${d} cover`,className:"track-image-small"}):e.jsx(pe,{className:"track-image-small"}),e.jsxs("p",{className:"track-title",style:{whiteSpace:"nowrap"},children:[n," ",d]})]})},fs=t.createContext(),Kr=({hideComponent:n})=>{const{playQueue:s,deleteQueue:c}=xe(),i=t.useRef(null),[o,r]=t.useState(new Map),l=t.useCallback(a=>o.get(a),[o]),m=t.useCallback((a,d)=>{r(h=>new Map(h).set(a,d))},[]);return t.useEffect(()=>{const a=d=>{var h;if(i.current&&!i.current.contains(d.target)){if(((h=d.target.closest("svg"))==null?void 0:h.id)==="playlist-button")return;n()}};return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[]),e.jsx("div",{className:"music-queue",ref:i,children:e.jsxs(fs.Provider,{value:{getTrack:l,setTrack:m},children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Music Queue"}),s.length>0&&e.jsx(Ze,{className:"buttonRound",onClick:c,style:{position:"absolute",right:"25px"}})]}),s.length>0?e.jsx(Pe,{height:600,itemCount:s.length,itemSize:60,width:"100%",children:({index:a,style:d})=>e.jsx(Yr,{style:d,index:a,trackId:s[a]},s[a])}):e.jsx("p",{children:"No items in the queue"})]})})},Qr=()=>t.useContext(fs),ps=t.createContext(),Z={SEARCH:"search",OPEN_ACTION_BAR:"open_action_bar",CLOSE_ACTION_BAR:"close_action_bar",PLAY_SONG:"play_song",OPEN_ALBUM:"open_album",OPEN_ARTIST:"open_artist",PLAY_LIBRARY_RANDOM:"play_library_random",TOGGLE_PLAY_PAUSE:"toggle_play_pause",OPEN_SETTINGS:"open_settings",VOLUME_UP:"volume_up",VOLUME_DOWN:"volume_down",OPEN_GENRE:"open_genre"},Oe=[{name:"Search",code:Z.SEARCH,description:"Search for a song, an album, a genra, an artist",key:"k",modifier:"ctrl",keywords:["search","find","look for","seek","search for","find for","look for for","seek for"],icon:()=>e.jsx(tt,{className:"action-bar-current-logo"})},{name:"open action bar",code:Z.OPEN_ACTION_BAR,description:"Give a command",key:" ",modifier:"ctrl",keywords:[]},{name:"Play the library in shuffle",code:Z.PLAY_LIBRARY_RANDOM,description:"",key:"r",modifier:"ctrl",keywords:["play","shuffle","random","library","all","all songs","all albums","all artists"],icon:()=>e.jsx(et,{className:"action-bar-current-logo"})},{name:"Toggle Play pause",code:Z.TOGGLE_PLAY_PAUSE,description:"",key:" ",modifier:"",keywords:["pause","play","toggle","play/pause","play pause"],icon:()=>e.jsx(et,{className:"action-bar-current-logo"})},{name:"Open settings",code:Z.OPEN_SETTINGS,description:"",key:"p",modifier:"ctrl",keywords:["settings","configuration","config","preferences","options"],icon:()=>e.jsx(_n,{className:"action-bar-current-logo"})},{name:"Volume up",code:Z.VOLUME_UP,description:"",key:"ArrowUp",modifier:"",keywords:[],icon:()=>{}},{name:"Volume down",code:Z.VOLUME_DOWN,description:"",key:"ArrowDown",modifier:"",keywords:[],icon:()=>{}}],Xr=({children:n})=>{const s=t.useRef([]),[c,i]=t.useState(!1),o=t.useRef(c),[r,l]=t.useState(null),[m,f]=t.useState(!1),[p,a]=t.useState(null),[d,h]=t.useState([]),[v,T]=t.useState(null),{playTrackNoQueue:b,playLibraryShuffle:_,toggleTrackPaused:y,setVolume:N,volume:C}=xe(),R=t.useRef(C),I=ge(),M=t.useRef(null),W=t.useRef(null),{addNotification:S,notifTypes:K}=He();t.useEffect(()=>{window.addEventListener("keydown",ee),Q();const j=G=>{M.current&&!M.current.contains(G.target)&&ie()};return document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j),window.removeEventListener("keydown",ee),s.current=[]}},[]);const ee=j=>{if(j.key=="Escape"&&o.current){ie();return}if(j.key=="Control"||p||!(j.ctrlKey||j.altKey||j.metaKey)&&(document.activeElement.nodeName==="INPUT"||document.activeElement.nodeName==="TEXTAREA"))return;const G=Oe.find(te=>j.key===te.key?!te.modifier||te.modifier===""?!0:{ctrl:j.ctrlKey,shift:j.shiftKey,alt:j.altKey,meta:j.metaKey}[te.modifier]:!1);G&&(a(G),s.current.forEach(te=>{te.code===G.code&&(te.callback(j),j.preventDefault())}))},F=(j,G)=>{const te={callback:j,code:G};s.current.push(te)},$=t.useRef(y);$.current=y;const J=()=>{i(!0),l(null),h(ne()),W.current="command",a(Oe[1])};t.useEffect(()=>{R.current=C,S(`Volume : ${(C*100).toFixed(0)} %`,K.INFO)},[C]);const Q=()=>{F(()=>{if(W.current==="command"){ie();return}J()},Z.OPEN_ACTION_BAR),F(()=>{ie()},Z.CLOSE_ACTION_BAR),F(()=>{if(W.current==="search"){ie();return}i(!0),l(Z.SEARCH),W.current="search"},Z.SEARCH),F(()=>{$.current()},Z.TOGGLE_PLAY_PAUSE),F(()=>{I("/settings")},Z.OPEN_SETTINGS),F(()=>{N(Math.min(Math.max(R.current+.1,0),1))},Z.VOLUME_UP),F(()=>{N(Math.min(Math.max(R.current-.1,0),1))},Z.VOLUME_DOWN)};t.useEffect(()=>{c&&document.getElementById("actionbar-searchbar").focus(),o.current=c},[c]),t.useEffect(()=>{switch(r){case Z.SEARCH:f(!0),T(()=>e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(tt,{className:"action-bar-current-logo"})," "]}));break;default:f(!0),T(null)}},[r]);const ne=()=>[Oe[0],Oe[2],Oe[4]],X=j=>{const G=j.target.value;if(G===""){h(ne());return}if(r===Z.SEARCH){ce(G);return}const te=Oe.filter(q=>{var le;return((le=q.keywords)==null?void 0:le.length)>0&&q.keywords.some(ye=>ye.includes(G))});h(te)},oe=j=>{switch(j){case"track":return e.jsx(Rt,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View album"})," ",e.jsx(Et,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View artist"})," ",e.jsx(Et,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View genre"})," ",e.jsx(Et,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},ce=async j=>{console.log("action bar seacrh"),!(j===""||j.trim().length===0)&&(console.log(`${g}/read-write/search/${j}`),fetch(`${g}/read-write/search/${j}`,{method:"GET"}).then(G=>{if(G.ok)return G.json();throw new Error("Error fetching search results")}).then(G=>{const te=[...G.tracks.map(q=>({type:"track",...q})),...G.albums.map(q=>({type:"album",...q})),...G.artists.map(q=>({type:"artist",...q})),...G.genres.map(q=>({type:"genre",...q}))].map(q=>{const le=q.path,ye=q.id,{trackPath:L,...D}=q;return{icon:()=>le?e.jsx("img",{className:"action-bar-entry-logo",src:`${g}/${q.type==="artist"?"artist":"covers"}/${le}`,alt:q.name}):e.jsx(pe,{className:"action-bar-entry-logo"}),tooltip:oe,code:q.type==="artist"?Z.OPEN_ARTIST:q.type==="album"?Z.OPEN_ALBUM:q.type==="genre"?Z.OPEN_GENRE:Z.PLAY_SONG,fileName:le,trackName:ye,...D}});h(te)}))},Se=j=>{switch(j.code){case Z.SEARCH:i(!0),l(Z.SEARCH),a(Oe[0]),W.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),h([]);break;case Z.CLOSE_ACTION_BAR:ie();break;case Z.PLAY_SONG:console.log("Playing song",j),b(j.trackName),ie();break;case Z.OPEN_ALBUM:ie(),I(`/albums/${j.id}`);break;case Z.OPEN_ARTIST:ie(),I(`/artists/${j.id}`);break;case Z.OPEN_GENRE:console.log("Opening genre",j),ie(),I(`/genres/${j.id}`);break;case Z.PLAY_LIBRARY_RANDOM:S("Playing the library in shuffle",K.INFO),_(),ie();break;case Z.OPEN_SETTINGS:ie(),I("/settings");break}},ie=()=>{i(!1),l(null),W.current=null,h([])},U=()=>{i(!0),l(Z.SEARCH),a(Oe[0]),W.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),h([])};return e.jsx(ps.Provider,{value:{commandCodes:Z,openCommandBar:J,openSearchBar:U},children:e.jsxs("div",{className:"action-bar-app-parent",children:[n,c&&e.jsx("div",{className:"global-action-bar",children:e.jsx("div",{className:"action-bar",ref:M,children:e.jsxs("div",{className:"action-bar-research",children:[v||null,e.jsx("input",{type:"text",id:"actionbar-searchbar",className:"searchbar",onChange:X,placeholder:`${p.description}`}),e.jsx("div",{className:"action-bar-results",children:e.jsx(Pe,{height:300,itemCount:d.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:j,style:G})=>e.jsx(dt,{entry:d[j],style:{...G,width:" calc(100% - 20px)",marginTop:"10px"},onClick:Se},j)})})]})})})]})})},xs=()=>{const n=t.useContext(ps);if(!n)throw new Error("useGlobalActionBar must be used within a GlobalActionBar provider");return n},Zr=({onClosed:n,hideComponent:s})=>{const{setVolume:c,volume:i}=xe(),o=t.useRef(null);return t.useEffect(()=>{const r=l=>{var m;if(o.current&&!o.current.contains(l.target)){if(((m=l.target.closest("svg"))==null?void 0:m.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",r),document.addEventListener("touchstart",r),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r)}},[]),e.jsx("div",{ref:o,className:"volume-bar",children:e.jsx(nt,{onClickPercentage:r=>{console.log("change volume"),c(r/100)},style:{height:"10px"},fillColor:"rgb(118, 173, 206)",percent:i*100})})},ea=({percent:n,size:s=120,strokeWidth:c=10,useText:i=!0,style:o,color:r="rgb(130, 119, 196)"})=>{const l=(s-c)/2,m=2*Math.PI*l,f=m*(1-n);return e.jsxs("div",{className:"radial-container",style:{width:s,height:s,...o},children:[e.jsxs("svg",{width:s,height:s,children:[e.jsx("circle",{className:"radial-bg",stroke:"#e6e6e6",strokeWidth:c,fill:"none",cx:s/2,cy:s/2,r:l}),e.jsx("circle",{className:"radial-progress",stroke:r,strokeWidth:c,fill:"none",cx:s/2,cy:s/2,r:l,strokeDasharray:m,strokeDashoffset:f})]}),e.jsx("div",{className:"radial-label",children:i&&e.jsxs("span",{children:[Math.round(n),"%"]})})]})},St=()=>{const[n,s]=t.useState(!1),[c,i]=t.useState(!1),[o,r]=t.useState(!1),[l,m]=t.useState(!1),[f,p]=t.useState(!1),[a,d]=t.useState({col1:"#000",col2:"#000"}),{currentTrackData:h,trackCoverUrl:v,volume:T,toggleFullScreenView:b}=xe(),{openSearchBar:_}=xs(),[y,N]=t.useState(!1),[C,R]=t.useState(null),[I,M]=t.useState(null),W=ge(),{subscribe:S}=Nt(),[K,ee]=t.useState(bt().pathname==="/admin-pannel"),F=()=>{r(!0)};t.useEffect(()=>{const ce=S("openAddMusic",F);return()=>{ce()}},[]);const $=()=>{r(!1),M(null),R(null)};function J(){m(!l)}function Q(){p(!f)}const ne=()=>!h||Object.keys(h).length===0?null:e.jsxs("div",{className:"trackinfos-parent",children:[e.jsxs("div",{className:"trackinfo-desktop",children:[e.jsx("span",{id:"songTitle",children:h.title}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{(h==null?void 0:h.type)!="radio"&&W(`/artists/${h.artistId}`)},children:h.artist}),e.jsx(Ur,{})]}),e.jsxs("div",{className:"trackinfo-mobile",children:[e.jsx("span",{id:"songTitle",children:h.title}),e.jsx(Qt,{context:{mobile:!0}})]})]});t.useEffect(()=>{const ce=[{col1:"#ffa585",col2:"#ffeda0"},{col1:"#9bf8f4",col2:"#6f7bf7"}];d(ce[Math.floor(Math.random()*ce.length)])},[]);const X=()=>{},oe=()=>{if(!C){o?($(),console.log("deactivate")):(F(),console.log("activate"));return}N(document.getElementsByClassName("addMusicContainer")[0]==null),console.log("toggle")};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header__logo",onClick:()=>W("/home"),children:[e.jsx(pe,{col1:a.col1,col2:a.col2}),e.jsx("h1",{children:"CML"})]}),e.jsx(Qt,{context:{mobile:!1}}),e.jsxs("div",{className:"musicPlayer",children:[e.jsxs("div",{className:"playPauseContainer",children:[(h==null?void 0:h.type)=="radio"?h.coverUrl==""?e.jsx(pe,{className:"trackImage"}):e.jsx("img",{src:h.coverUrl,className:"trackImage"}):v.split("/").pop()==="null"?e.jsx(pe,{className:"trackImage"}):e.jsx("img",{src:v,className:"trackImage"}),e.jsx("div",{className:"playPauseButtons",onClick:b,children:e.jsx(It,{style:{padding:"0px"}})})]}),e.jsx(ne,{})]}),e.jsxs("div",{className:"mobile-gost",children:[e.jsx(Dn,{id:"playlist-button",className:"buttonRound",onClick:()=>J()}),l&&e.jsx(Kr,{hideComponent:()=>m(!1)}),T<=1e-5?e.jsx(Bn,{className:"buttonRound",onClick:()=>Q()}):T<.5?e.jsx(Gn,{className:"buttonRound",onClick:()=>Q()}):e.jsx(Vn,{id:"volume-button",className:"buttonRound",onClick:()=>Q()}),f&&e.jsx(Zr,{hideComponent:()=>p(!1)})]}),e.jsxs("div",{className:"headerRight",children:[!K&&e.jsxs("div",{className:"serach-button-div",onClick:_,children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"K"})}),e.jsx(tt,{})]}),e.jsxs("div",{style:{position:"relative",padding:"5px",display:"flex",justifyContent:"center"},className:"upload-music-header",children:[I&&e.jsx(ea,{percent:I,size:44,useText:!1,style:{position:"absolute",transform:"translate(-1px, -5.5px)"}}),e.jsx(Ft,{style:{zIndex:"10",position:"relative"},className:"addMusicButton buttonRound",onClick:oe}),C&&e.jsxs("span",{style:{position:"absolute",bottom:"-30px",padding:"2px 7px",borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 0.7)",textAlign:"center"},children:[C.done,"/",C.total]})]}),e.jsx(wr,{})]}),o&&e.jsx(qr,{uploadPercent:M,uploadFinished:X,uploadProgress:R,isMinimize:y,setMinimized:N,closeOverlay:$})]})},ta=()=>{const[n,s]=t.useState(null),[c,i]=t.useState(null),[o,r]=t.useState(null),[l,m]=t.useState(null);t.useEffect(()=>{const a=setInterval(f,5e3);return f(),()=>clearInterval(a)},[]);const f=()=>{try{fetch(`${g}/isResponding`).then(a=>{a.status===200?(l===!1&&p(),m(!0)):m(!1)}).catch(a=>{console.error("Fetch failed (e.g., CORS error):",a),m(!1)})}catch(a){console.error("Unexpected error:",a),m(!1)}},p=()=>{fetch(`${g}/read-write/stats`,{method:"GET"}).then(a=>a.json()).then(a=>{s(a)}).catch(a=>console.error("Error fetching stats:",a)),fetch(`${g}/read-write/serverStats`,{method:"GET"}).then(a=>a.json()).then(a=>{i(Ct(a.coversByteUsage+a.tracksByteUsage).readable),r({perent:(1-a.free/a.size)*100,total:Ct(a.size).readable,free:Ct(a.free).readable})}).catch(a=>console.error("Error fetching server stats:",a))};return t.useEffect(()=>{p()},[]),e.jsxs("div",{className:"stat-short",children:[e.jsxs("div",{className:"stat-short-category",children:[e.jsxs("p",{children:["Library size: ",c]}),e.jsxs("p",{children:["Free ",o==null?void 0:o.free," of ",o==null?void 0:o.total]}),e.jsx(nt,{percent:o==null?void 0:o.perent,total:o==null?void 0:o.total,style:{height:"10px"},fillColor:"var(--chill-purple)",initialising:!c})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"5px"},children:[e.jsx("div",{className:"server-status-sprite",style:{width:"10px",height:"10px",borderRadius:"10px",backgroundColor:l?"lightgreen":"red"}}),e.jsxs("p",{children:["Server is ",l?"online":"offline"]})]})]})},sa=()=>{const{openCommandBar:n}=xs();return e.jsxs("div",{className:"sidebar",children:[e.jsxs("nav",{children:[e.jsxs(Ye,{id:"nav-recent",to:"/home",children:[e.jsx(Hn,{}),"Recent"]}),e.jsxs(Ye,{to:"/playlists",children:[e.jsx(Wn,{}),"Playlists"]}),e.jsxs(Ye,{to:"/artists",children:[e.jsx(zn,{}),"Artists"]}),e.jsxs(Ye,{to:"/genres",children:[e.jsx(qn,{}),"Genres"]}),e.jsxs(Ye,{to:"/cooking",children:[e.jsx(Qe,{}),"Cooking"]}),e.jsxs(Ye,{to:"/radio",children:[e.jsx(Jn,{}),"Radio"]})]}),e.jsx(ta,{}),e.jsxs("div",{className:"serach-button-div",onClick:n,style:{margin:"auto",marginBottom:"20px"},children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"SPACE"})}),e.jsx(Yn,{})]})]})},na=()=>{const n=t.useRef(),s=t.useRef(null),{getFFTAtCurrentTime:c,fftConfigRef:i,globalAudioRef:o,FFTUserSetingsRef:r,fetchFFTUserSettings:l}=xe(),m=t.useRef(0),f=p=>{var d;if(!s.current){n.current=requestAnimationFrame(f);return}const a=s.current.getContext("2d");if(a&&r.current){if(p-m.current<1e3/r.current.FPS){n.current=requestAnimationFrame(f);return}console.log("Refresh anim FFT"),m.current=p;const h=r.current.bars;a.clearRect(0,0,s.current.width,s.current.height);const v=c();if(!v){n.current=requestAnimationFrame(f);return}i.current.sampleRate/v.length;const T=Math.max(1,v.length/h),b=new Array(h);b.fill(0);for(let N=0;N<v.length;N++)b[Math.floor(N/T)]+=Number(v[N]);let _=s.current.width/h-1,y=0;for(let N=0;N<b.length;N++){const C=r.current.scale*Math.log2(b[N])*(h/5)*((d=o.current)==null?void 0:d.volume);a.fillStyle=`rgb(${C/r.current.scale/r.current.contrast} 137 255)`,a.fillRect(y,s.current.height-C,_,C),y+=_+1}}n.current=requestAnimationFrame(f)};return t.useEffect(()=>{if(!i.current){cancelAnimationFrame(n.current),console.log("No FFT data to display, releasing anim frame.");return}n.current=requestAnimationFrame(f),console.log("FFT found, requested animation frame.")},[i.current]),t.useEffect(()=>(n.current=requestAnimationFrame(f),()=>cancelAnimationFrame(n.current)),[]),e.jsx("canvas",{ref:s,id:"fft-canvas",width:1900,height:1e3})},ra=()=>{const n=ge(),[s,c]=t.useState(!1);if(t.useEffect(()=>{(async()=>{if((await(await fetch(`${g}/auth/verifyToken`,{method:"POST",credentials:"include"})).json()).success){c(!1);return}n("/")})()},[n]),s)return e.jsx(it,{});const o=bt().pathname,r=["/home"];return e.jsxs("div",{className:"app-container",children:[e.jsx(St,{}),e.jsxs("div",{className:"content-container",page:r.includes(o)?o:"inside",children:[e.jsx(sa,{}),e.jsxs("div",{className:"content",children:[e.jsx(es,{})," "]})]})]})},Ot=({album:n,hideArtist:s=!1})=>{const c=ge(),[i,o]=t.useState([]),r=l=>{c(`/albums/${l}`)};return t.useEffect(()=>{n.artists&&o(JSON.parse(n.artists).map(l=>l.name))},[n]),e.jsxs("div",{className:"album-card",onClick:()=>r(n.id),children:[n.cover?e.jsx("img",{src:`${g}/covers/${n.cover}`,alt:`${Ue(n.title,25)} cover`,className:"album-card-cover"}):e.jsx(pe,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Ue(n.title,40)}),!s&&e.jsx("p",{className:"album-artist",children:Ue(i.toString().replace(/,/g,", "),25)||"No artist"})]})},Mt=()=>{const{emit:n}=Nt(),s=()=>{n("openAddMusic")};return e.jsxs("div",{className:"add-music-shortcut",children:[e.jsx("h2",{children:"Welcome to the Crystal Music Library! "}),e.jsxs("button",{onClick:s,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"15px",margin:"auto"},children:[e.jsx(Ft,{}),e.jsx("h3",{style:{margin:"2px"},children:"Add music"})]})]})},aa=({})=>{const[n,s]=t.useState([]),[c,i]=t.useState(!1),o=()=>{fetch(`${g}/read-write/albums`,{method:"GET",credentials:"include"}).then(l=>{if(l.status!==200){console.error("Error fetching albums");return}return l.json()}).then(l=>{s(l),i(!0)})};t.useEffect(()=>{o();const l=m=>{console.log("Music uploaded:",m.detail),o()};return window.addEventListener("musicUploaded",l),()=>{window.removeEventListener("musicUploaded",l)}},[]);const r=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});return e.jsx("div",{className:"home album-displayer","data-no-tracks":(n==null?void 0:n.length)==0&&c?"true":"false",children:c?(n==null?void 0:n.length)!==0?n.map(l=>e.jsx(Ot,{album:l},l.id)):e.jsx(Mt,{}):e.jsx(r,{})})},oa=()=>e.jsx("p",{children:" Your albums"}),ca=()=>{const[n,s]=t.useState(!0),c=ge(),i=async r=>{if(r.preventDefault(),!r.target.email.value||!r.target.password.value||!r.target.repeat_password.value||!r.target.name.value){alert("Please fill in all fields");return}if(r.target.password.value!==r.target.repeat_password.value){alert("Passwords do not match");return}const l=new FormData(r.target),m=await fetch(`${g}/auth/register`,{method:"POST",credentials:"include",body:l}),f=await m.json();m.ok?(alert("User registered successfully"),c("/home")):alert(f.error)};t.useEffect(()=>{fetch(`${g}/auth/any-user`,{method:"GET"}).then(r=>r.json()).then(r=>{s(r===0)})},[]);const o=()=>e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsx("p",{children:"Already an account?"}),e.jsx("button",{style:{width:"100%"},onClick:()=>{c("/")},children:"Login"})]});return e.jsxs("div",{className:"authDiv",children:[e.jsx(pe,{}),e.jsx("h1",{children:"Register"}),e.jsx("p",{children:n?`Welcome to the crystal_Music Library! Since you are the first 
            to show up here, we would like you to create the admin account.`:"Please fill the form to register as a new user."}),e.jsxs("form",{onSubmit:i,children:[!n&&e.jsx(o,{}),e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"new-password"}),e.jsx("label",{htmlFor:"repeat_password",children:"Confirm Password"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",name:"repeat_password",autoComplete:"password"}),e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",autoComplete:"name"}),e.jsx("button",{type:"submit",children:"Register"})]})]})},Ee={FETCHING:"fetching",SUCCESS:"success",REJECTED:"rejected",NONE:"none"},ia=()=>{const n=t.useRef(Ee.NONE),[s,c]=t.useState(Ee.NONE),i=ge(),{emit:o}=Nt(),r=async f=>{if(f.preventDefault(),!f.target.email.value||!f.target.password.value){alert("Please fill in all fields");return}const p=new FormData(f.target),a=await fetch(`${g}/auth/login`,{method:"POST",credentials:"include",body:p}),d=await a.json();a.ok?(localStorage.setItem("username",d.username),n.current=Ee.SUCCESS):n.current=Ee.REJECTED,m()},l=()=>{switch(s){case Ee.FETCHING:return e.jsx(ls,{});case Ee.SUCCESS:return e.jsxs("div",{className:"loginFeedback",sucess:"true",children:[e.jsx(Xe,{className:"successIcon"}),e.jsx("span",{children:"Logged in"})]});case Ee.REJECTED:return e.jsxs("div",{className:"loginFeedback",sucess:"false",children:[e.jsx(Ce,{className:"failIcon"}),e.jsx("span",{children:"Wrong credentials"})]});default:return null}},m=()=>{switch(c(n.current),n.current){case Ee.REJECTED:setTimeout(()=>{c(Ee.NONE)},1e3);break;case Ee.SUCCESS:setTimeout(()=>{o("login"),i("/home")},1e3);break}};return e.jsxs("div",{className:"authDiv",children:[e.jsx(pe,{}),e.jsx("h1",{children:"Login"}),e.jsx("p",{children:"We were not able to connect you, please login."}),e.jsxs("form",{onSubmit:r,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"password"}),e.jsx("button",{type:"submit",children:"Login "}),e.jsx("p",{children:"Don't have an account?"}),e.jsx("button",{onClick:()=>{i("/register")},children:"Register"})]}),e.jsx(l,{})]})},Ke=Object.freeze({LOGIN:"login",REGISTER:"register",ANY_USER:"any_user",VERIF_TOKEN:"verif_token"}),la=()=>{const n=ge(),[s,c]=t.useState([]),[i,o]=t.useState(null),[r,l]=t.useState(!0);return t.useEffect(()=>{(async()=>{o(Ke.ANY_USER);const p=await(await fetch(`${g}/auth/any-user`,{method:"GET"})).json();if(console.log("Parsed users",p),c(p),console.log(p),p===0){l(!1),o(Ke.REGISTER);return}o(Ke.VERIF_TOKEN);const d=await(await fetch(`${g}/auth/verifyToken`,{method:"POST",credentials:"include"})).json();if(l(!1),d.success){console.log("Token is valid"),n("/home");return}o(Ke.LOGIN)})()},[n]),r?null:i===Ke.LOGIN?e.jsx(ia,{}):(i===Ke.REGISTER&&n("/register"),null)},gs=({index:n,track:s,playIconId:c,isSalad:i=null,onClick:o,showCover:r=!1})=>{const{title:l,track_number:m,rawDuration:f}=s,{playingTrack:p,openTrackActions:a}=xe(),d=s.id,[h,v]=t.useState("null"),[T,b]=t.useState(!1),[_,y]=t.useState(!1),N=()=>{if(i){i(n);return}o(s.id)},C=()=>{switch(c){case 0:return e.jsx(tr,{className:"track-number",playing:"piano","data-show-cover":r});case 1:return e.jsx(er,{className:"track-number",playing:"vinyl","data-show-cover":r});case 2:return e.jsx(Zn,{className:"track-number",playing:"piano","data-show-cover":r});case"salad":return e.jsx(Qe,{className:"track-number",playing:"piano","data-show-cover":r})}};t.useEffect(()=>{b(s.is_favorite===1),r&&fetch(`${g}/read-write/trackCover/${s.id}`,{method:"GET"}).then(S=>S.json()).then(S=>{v(`${g}/covers/${S}`)})},[]);const R=S=>{S.stopPropagation(),fetch(`${g}/read-write/toggleFavorite/${s.id}/${!T}`,{method:"GET",credentials:"include"}).then(K=>K.json()).then(K=>{b(K)})},I=()=>{y(!1)},M=S=>{S.stopPropagation(),y(!0),a({x:S.clientX,y:S.clientY},s,I,W)},W=S=>{b(S)};return e.jsxs("div",{className:"track-view","action-bar":_?"open":"",onClick:N,children:[T&&e.jsx(Kn,{className:"track-favorite"}),e.jsx(vt,{className:"track-toggle-favorite",iconHovered:T?At:Qn,iconDefault:T?At:ss,onClick:R}),r?h.split("/").pop()==="null"?null:e.jsx("img",{src:h,className:"track-mini-thumbnail"}):null,p===d?C():r?null:e.jsx("p",{className:"track-number",children:m}),e.jsx("p",{style:{flexGrow:"1",marginLeft:r?"45px":"35px"},children:l}),e.jsx(Xn,{className:"track-actions-dots",onClick:M}),e.jsx("p",{style:{paddingRight:"10px"},children:Lt(f).readable})]})},Xt=({isPlaylist:n=!1})=>{const[s,c]=t.useState(null),[i,o]=t.useState([]),[r,l]=t.useState([]),[m,f]=t.useState([]),[p,a]=t.useState(0),{addContainerToQueue:d,playContainerSuffle:h,editAlbum:v,editPlaylist:T,linkNewContainer:b,getNextSongsFromAlbum:_}=xe(),y=t.useRef(null),N=ge(),[C,R]=t.useState([]),I=n?jt().playlistId:jt().albumId,[M,W]=t.useState(null),S=t.useRef(null),{notifTypes:K,addNotification:ee}=He(),[F,$]=t.useState(!1),[J,Q]=t.useState(!1),[ne,X]=t.useState(!1);t.useEffect(()=>{oe()},[I,J]),t.useEffect(()=>{b({id:I,type:n?"playlist":"album",favPlaylist:F},oe)},[F]);const oe=()=>{fetch(`${g}/read-write/${n?"playlist":"album"}/${I}`,{method:"GET",credentials:"include"}).then(L=>{if(!L.ok)throw new Error("Network response was not ok");return L.json()}).then(L=>{a(Math.floor(Math.random()*3));const D=L.tracks.filter(ve=>(!ne&&ve.is_favorite===1&&X(!0),J?ve.is_favorite===1:!0));if(n){c(L.playlistInfos),o(D),f([L.owner,...L.collaborators]),$(L.isFavPlaylist);return}c(L.albumInfos);let me=0;for(let ve=0;ve<D.length;ve++){const ke=D[ve];ke.disc>me&&(D.splice(ve,0,{disc:ke.disc,type:"disc"}),me=ke.disc)}o(D),l(L.genres),f(L.artists),$(!1)})},ce=async()=>await d(I,n?"playlist":"album",J),Se=async()=>{h(I,n?"playlist":"album",J)},ie=()=>{if(n){T(I);return}v(I)},U={TRACK:"track",ALBUM:"album",ARTIST:"artist",PLAYLIST:"playlist",GENRE:"genre"},j=L=>{switch(L){case"track":return e.jsx(Ft,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add album"})," ",e.jsx(lt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add artist's discography"})," ",e.jsx(or,{className:"action-bar-entry-tooltip-logo"})]});case"playlist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire playlist"})," ",e.jsx(ar,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire genre"})," ",e.jsx(rr,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},G=L=>{const D=L.target.value;if(D===""||D.trim().length===0){R([]);return}console.log(`${g}/read-write/search/${D}`),fetch(`${g}/read-write/search/${D}`,{method:"GET"}).then(me=>{if(me.ok)return me.json();throw new Error("Error fetching search results")}).then(me=>{var ke,Le,We,_e,De;const ve=[...(ke=me.tracks)==null?void 0:ke.map(E=>({type:"track",...E})),...(Le=me.albums)==null?void 0:Le.map(E=>({type:"album",...E})),...(We=me.artists)==null?void 0:We.map(E=>({type:"artist",...E})),...(_e=me.genres)==null?void 0:_e.map(E=>({type:"genre",...E})),...(De=me.playlists)==null?void 0:De.map(E=>({type:"playlist",...E})).filter(({id:E})=>E!==I)].map(E=>{const P=E.path,{trackPath:k,...B}=E;return{icon:()=>P?e.jsx("img",{className:"action-bar-entry-logo",src:`${g}/${E.type==="artist"?"artist":"covers"}/${P}`,alt:E.name}):e.jsx(pe,{className:"action-bar-entry-logo"}),tooltip:j,code:E.type==="artist"?U.ARTIST:E.type==="album"?U.ALBUM:E.type==="genre"?U.GENRE:E.type==="playlist"?U.PLAYLIST:U.TRACK,fileName:P,...B}});console.log(ve),R(ve)})},te=L=>{M||setTimeout(()=>{requestAnimationFrame(()=>{var D;(D=S.current)==null||D.focus()})},0)},q=L=>{const D=new FormData;D.append("addRequest",JSON.stringify({playlistId:I,endpoint:L.code,entryId:L.id,addAllToFavorite:F||!1})),fetch(`${g}/read-write/addToPlaylist`,{method:"POST",credentials:"include",body:D}).then(me=>me.json()).then(me=>{oe(),le(),ee("Added to playlist",K.INFO)})};t.useEffect(()=>{const L=D=>{y.current&&!y.current.contains(D.target)&&le()};return document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L)}},[]);const le=()=>{W(!1),S.current.value="",R([])},ye=L=>{_(L,J)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton",onClick:()=>window.history.back(),children:e.jsx(st,{})}),(s==null?void 0:s.cover)&&e.jsx("img",{src:`${g}/covers/${s.cover}`,className:"background-image",alt:"background"}),s&&i?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:s.title}),e.jsx("div",{className:"album-artists",children:m?m.map(L=>e.jsx("span",{className:"artist-name",onClick:()=>{N(`/${n?"users":"artists"}/${L.id}`)},children:L.name},L.id)):e.jsxs("span",{className:"artist-name",children:["Unknown ",n?"Members":"Artist"]})}),e.jsxs("div",{className:"album-content",children:[e.jsx("div",{className:"album-cover-genres",children:e.jsxs("div",{className:"album-cover-wrapper",children:[s.cover?e.jsx("img",{src:`${g}/covers/${s.cover}`,alt:`${s.title} cover`,className:"cover-image"}):e.jsx(pe,{className:"cover-image"}),e.jsx("div",{className:"genres-album-div",children:r.map((L,D)=>e.jsx("span",{className:"genre-album",onClick:()=>{N(`/genres/${L.genreId}`)},children:L.genreName},D))}),s.description&&e.jsx("p",{children:s.description})]})}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(de,{text:"Add to queue",icon:e.jsx($t,{}),onClick:ce}),e.jsx(de,{text:"Random",icon:e.jsx(et,{}),onClick:Se}),!F&&e.jsx("button",{className:"button-with-callback",onClick:ie,children:e.jsx(os,{})}),!F&&ne&&e.jsx("button",{className:"button-with-callback","data-is-active":J,onClick:()=>{Q(!J)},children:e.jsx(sr,{})}),s.lossless===1&&e.jsxs("div",{className:"lossless",children:[e.jsx("span",{children:"Lossless"})," ",e.jsx(nr,{})]})]}),n&&e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:y,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",onClick:te,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(tt,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:G,placeholder:"Search for tracks, artists, genres, playlists to add.",ref:S,onFocus:()=>{W(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${M?"block":"none"}`},children:e.jsx(Pe,{height:300,itemCount:C.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:L,style:D})=>e.jsx(dt,{entry:C[L],style:{...D,width:" calc(100% - 20px)",marginTop:"10px"},onClick:q},L)})})]})}),i.map((L,D)=>(L==null?void 0:L.type)==="disc"?e.jsx("span",{children:`Disc ${L.disc}`},`disc-${D}`):e.jsx(gs,{track:L,onClick:ye,playIconId:p,showCover:n},L.id))]})]})]}):e.jsx(it,{text:"Loading album"})]})},ua=({artist:n})=>{const s=ge(),c=i=>{s(`/artists/${i}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>c(n.id),children:[n.picture?e.jsx("img",{src:`${g}/covers/artists/${n.picture}`,alt:`${n.name} cover`,className:"artist-card-cover"}):e.jsx(pe,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:n.name})]})},da=()=>{const[n,s]=t.useState([]),c=()=>{fetch(`${g}/read-write/artists`,{method:"GET",credentials:"include"}).then(i=>{if(i.status!==200){console.error("Error fetching artists");return}return i.json()}).then(i=>{s(i)})};return t.useEffect(()=>{c();const i=o=>{console.log("Music uploaded:",o.detail),c()};return window.addEventListener("musicUploaded",i),()=>{window.removeEventListener("musicUploaded",i)}},[]),e.jsx("div",{className:"home album-displayer",children:(n==null?void 0:n.length)!==0?n.map(i=>e.jsx(ua,{artist:i},i.id)):e.jsx(Mt,{})})},ma=()=>{const[n,s]=t.useState(null),[c,i]=t.useState([]),{addArtistToQueue:o,shuffleArtistToQueue:r,editArtist:l,linkNewContainer:m}=xe(),f=jt().artistId;t.useEffect(()=>{p(),m({id:f,type:"artist"},p)},[f]);const p=()=>{fetch(`${g}/read-write/artist/${f}`,{method:"GET",credentials:"include"}).then(h=>{if(!h.ok)throw new Error("Network response was not ok");return h.json()}).then(h=>{s(h.artistInfos),i(h.albums),console.log(h.artistInfos)})},a=async()=>await o(f),d=async()=>{r(f,!1)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton",onClick:()=>window.history.back(),children:e.jsx(st,{})}),n&&c?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:n.name}),e.jsxs("div",{className:"album-content",children:[n.picture?e.jsx("img",{src:`${g}/covers/artists/${n.picture}`,alt:`${n.name} cover`,className:"cover-image"}):e.jsx(pe,{className:"cover-image"}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(de,{text:"Add to queue",icon:e.jsx($t,{}),onClick:a}),e.jsx(de,{text:"Random",icon:e.jsx(et,{}),onClick:d}),e.jsx(de,{icon:e.jsx(os,{}),onClick:async()=>{l(n.id)}})]}),e.jsx("div",{className:"album-displayer",children:c.map(h=>e.jsx(Ot,{album:h,hideArtist:!0},h.id))})]})]})]}):e.jsx(it,{text:"Loading artist"})]})},ha=()=>{const n=ge(),s=()=>{n("/home")};return e.jsxs("div",{className:"not-found",children:[e.jsx("h1",{children:"Where did you land..?"}),e.jsx("p",{children:"The adress you gave is not defined, but you can go back to library:"}),e.jsx("button",{className:"btn",onClick:s,children:"Go back to library"})]})},fa=()=>{const[n,s]=t.useState("");t.useEffect(()=>{s(localStorage.getItem("username"))},[]);const c=ge();return e.jsxs("div",{className:"account-page",children:[e.jsx(St,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>c("/home"),children:e.jsx(st,{})}),e.jsxs("div",{className:"account-container",children:[e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:n}),e.jsx("p",{children:"Account information will be displayed here."})]}),e.jsx(pe,{})]})]})]})},pa=({active:n,setActive:s})=>e.jsx("div",{className:"toggle-button","data-is-active":n,onClick:c=>{c.stopPropagation(),s(!n)},children:e.jsx("div",{className:"toggle-button-active","data-is-active":n})}),Me=({stateChanged:n,min:s=0,max:c=0,ref:i})=>{const o=s===c&&c===0,r=m=>{const f=m.target.value;n(f)},l=m=>{console.log("blur");let f=parseFloat(m.target.value);isNaN(f)&&(f=s),o||(f=Math.min(c,Math.max(s,f))),m.target.value=f,n(f)};return o?e.jsx("input",{ref:i,type:"number",onBlur:l,onChange:r}):e.jsx("input",{min:s,ref:i,max:c,type:"number",onBlur:l,onChange:r})},xa=()=>{var T;const n=t.useRef(null),s=t.useRef(null),c=t.useRef(null),i=t.useRef(null),o=t.useRef(null),{FFTUserSetingsRef:r,fftConfigRef:l}=xe(),m=b=>{r.current.bars=Math.floor(b),h()},f=b=>{r.current.cutoff=parseFloat(b),h()},p=b=>{r.current.scale=parseFloat(b),h()},a=b=>{r.current.contrast=parseFloat(b),h()},d=b=>{r.current.FPS=parseFloat(b),h()},h=()=>{const b=new FormData;b.append("FFT",JSON.stringify(r.current)),fetch(`${g}/config/user/send/FFT`,{method:"POST",credentials:"include",body:b})},v=async()=>{await fetch(`${g}/config/user/FFT`,{method:"GET",credentials:"include"}).then(b=>b.json()).then(b=>{r.current=b,n.current.value=r.current.bars,i.current.value=r.current.contrast,s.current.value=r.current.scale,o.current.value=r.current.cutoff,c.current.value=r.current.FPS})};return t.useEffect(()=>{v()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Number of bars"}),e.jsx(Me,{ref:n,stateChanged:m,min:1,max:(T=l.current)==null?void 0:T.fftSize})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"FPS (High number may cause strong battery usage)"}),e.jsx(Me,{ref:c,stateChanged:d})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Scale"}),e.jsx(Me,{ref:s,stateChanged:p})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Contrast"}),e.jsx(Me,{ref:i,stateChanged:a})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Cutoff"}),e.jsx(Me,{ref:o,stateChanged:f})]})]})},ga={FFT:xa},va=({entryName:n,entryIcon:s,linkedSettingKey:c})=>{const[i,o]=t.useState(!1),r=t.useMemo(()=>ga[c]||null,[c]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":i,onClick:l=>{l.stopPropagation(),o(!i)},children:[s,e.jsx("span",{children:n})]}),e.jsx("div",{className:"admin-setting-content",children:r&&i&&e.jsx(r,{})})]})},ja=()=>{const[n,s]=t.useState(!1);t.useEffect(()=>{ut(()=>{fetch(`${g}/auth/is-admin`,{method:"POST",credentials:"include"}).then(o=>o.json()).then(o=>{s(o)})})()},[]);const c=ge();return e.jsxs("div",{className:"account-page",children:[e.jsx(St,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>c("/home"),children:e.jsx(st,{})}),e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:"Settings page"}),e.jsx("p",{children:"A shinny list of fancy settings."}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(va,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(It,{})})})]})]})]})},ya=({user:n,totalStorage:s})=>{const[c,i]=t.useState(0);return t.useEffect(()=>{fetch(`${g}/read-write/user-data-usage/${n.id}`,{method:"GET",credentials:"include"}).then(o=>o.json()).then(o=>{i(o)}).catch(o=>{console.error("Error fetching user storage data: ",o)})},[]),e.jsxs("div",{className:"user-account-infos-entry",children:[e.jsx("p",{children:n.username}),e.jsx("p",{children:n.email}),e.jsx("p",{children:n.role}),e.jsx(nt,{percent:Number(c/s*100).toFixed(2),fillColor:"var(--cool-green)",showPercent:!0,style:{maxWidth:"200px"}})]})},Ve={PENDING:"pending",RUNNING:"running",PAUSED:"paused",INACTIVE:"inactive"},Zt=({jobName:n,description:s,jobKey:c,payload:i={},doneTotalView:o=null})=>{const[r,l]=t.useState(!1),[m,f]=t.useState(!0),[p,a]=t.useState(0),[d,h]=t.useState(!1),[v,T]=t.useState(null),b=t.useRef(null),_=(S=!0,K="",ee=0)=>{var F=S;fetch(`${g}/jobs/status/${c}`,{method:"GET",credentials:"include"}).then($=>$.json()).then($=>{h(!1);let J=1e3;switch($.status){case Ve.PENDING:h(!0),l(!0),f(!1),J=500;break;case Ve.INACTIVE:if(K===Ve.RUNNING||K===Ve.PENDING){setTimeout(()=>{l(!1),a(0),T(null),_(!1,$.status)},2e3),a(100),T({done:ee,total:ee,working:0}),F=!1,console.log("Stop fast fetch job");return}l(!1);break;case Ve.PAUSED:f(!0),l(!0),J=500;break;case Ve.RUNNING:f(!1),l(!0),J=10;break}b.current&&(clearTimeout(b.current),b.current=null),F&&(b.current=setTimeout(()=>{var Q;if($.progress){const ne=$.progress.done/$.progress.total*100;a(ne),T($.progress)}else T(null);_(!0,$.status,((Q=$.progress)==null?void 0:Q.total)??0)},J))})},y=()=>{fetch(`${g}/jobs/status/${c}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{_(S.status===Ve.RUNNING)})},N=()=>{const S=new FormData;S.append("payload",JSON.stringify(i)),fetch(`${g}/jobs/run/${c}`,{method:"POST",credentials:"include",body:S}).then(K=>K.json()).then(K=>{_(!0)})},C=()=>{fetch(`${g}/jobs/pause/${c}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{_(!1)})},R=()=>{fetch(`${g}/jobs/resume/${c}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{_(!0)})},I=()=>{fetch(`${g}/jobs/stop/${c}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{_(!1)})};t.useEffect(()=>(y(),()=>{b.current&&(console.log("Trying clearTimout"),clearTimeout(b.current),b.current=null)}),[]);const M=async()=>{if(r){m?R():C(),f(!m);return}N()},W=async()=>{I(),a(0)};return e.jsxs("div",{className:"backend-job",children:[e.jsx("h3",{children:n}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"baseline",flexWrap:"wrap"},children:[e.jsx(de,{text:r?m?"Resume":"Pause":"Run",icon:r?m?e.jsx(cr,{}):e.jsx(ir,{}):e.jsx(lr,{}),onClick:M}),e.jsx(de,{text:"Stop",icon:e.jsx(ur,{}),onClick:W}),e.jsx(nt,{style:{height:"25px",filter:`grayscale(${m&&r?.8:0})`},minWidth:"200px",percent:p,showPercent:!1,text:v?o.current?`${v.done}/${v.total}`:`Working: ${v.working} | Left : ${v.total-v.done}`:null,fillColor:"linear-gradient(90deg, rgb(187, 251, 223) 0%, rgb(198, 203, 253) 50%, rgb(239, 201, 249) 100%)",initialising:d,initialisingColor:"violet"})]}),e.jsx("p",{children:s}),e.jsx("div",{className:"job-status","data-running":m?"false":"true",style:{backgroundColor:r?d?"purple":m?"red":"green":"grey"},children:e.jsx("span",{children:r?d?"Initlialising":m?"Paused":"Running":"Inactive"})})]})},ba=()=>{const n=t.useRef(null),s=t.useRef(null),c=t.useRef(null),i=t.useRef(null),[o,r]=t.useState(!1),l=d=>{n.current.samples=Math.floor(d),p()},m=d=>{n.current.samplingInterval=1/Math.floor(d),p()},f=d=>{n.current.parallelCompute=Math.floor(d),p()},p=()=>{const d=new FormData;d.append("FFT",JSON.stringify(n.current)),fetch(`${g}/config/send/FFT`,{method:"POST",credentials:"include",body:d})},a=async()=>{await fetch(`${g}/config/FFT`,{method:"GET",credentials:"include"}).then(d=>d.json()).then(d=>{n.current=d}),r(n.current.useServerFFT),c.current.value=n.current.samples,s.current.value=Math.floor(1/n.current.samplingInterval),i.current.value=n.current.parallelCompute};return t.useEffect(()=>{a()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line",children:[e.jsx("span",{children:"Activate audio spectra computation"}),e.jsx(pa,{defaultValue:n.current,active:o,setActive:d=>{r(d),n.current&&(n.current.useServerFFT=d,p())}})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":o,children:[e.jsx("span",{children:"Frame definiton (power of 2)"}),e.jsx(Me,{ref:c,stateChanged:l,max:4096,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":o,children:[e.jsx("span",{children:"Frame per second"}),e.jsx(Me,{ref:s,stateChanged:m,max:120,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":o,children:[e.jsx("span",{children:"Number of parallel analyzed songs"}),e.jsx(Me,{ref:i,stateChanged:f,max:10,min:1})]})]})},Na={FFT:ba},Sa=({entryName:n,entryIcon:s,linkedSettingKey:c})=>{const[i,o]=t.useState(!1),r=t.useMemo(()=>Na[c]||null,[c]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":i,onClick:l=>{l.stopPropagation(),o(!i)},children:[s,e.jsx("span",{children:n})]}),e.jsx("div",{className:"admin-setting-content",children:r&&i&&e.jsx(r,{})})]})},ka=()=>{const n=()=>localStorage.getItem("job-progress-view")?localStorage.getItem("job-progress-view")==="true":!0,[s,c]=t.useState(!1),[i,o]=t.useState([]),[r,l]=t.useState(0),m=t.useRef(n()),f=ge();t.useEffect(()=>{ut(()=>{fetch(`${g}/auth/is-admin`,{method:"POST",credentials:"include"}).then(v=>v.json()).then(v=>{c(v)})})()},[]),t.useEffect(()=>{s.error||fetch(`${g}/auth/init-admin-pannel`,{method:"POST",credentials:"include"}).then(h=>h.json()).then(h=>{o(h.users),l(h.totalStorage)})},[s]);const p=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You are not an admin."})]}),a=h=>{const v=h===0;m.current=v,localStorage.setItem("job-progress-view",v)},d=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Admin pannel"}),e.jsx("p",{children:"Only for the true admins."}),e.jsxs("div",{className:"admin-category",children:[e.jsx(dr,{}),e.jsx("h2",{children:"Users' storage usage"})]}),e.jsx("div",{className:"all-users-list",children:i.map(h=>e.jsx(ya,{user:h,totalStorage:r},h.id))}),e.jsxs("div",{className:"admin-category",children:[e.jsx(mr,{}),e.jsx("h2",{children:"Backend processes"}),e.jsx(ms,{data:["Done/Total","Working/Remaining"],currentActive:n()?0:1,onClick:a})]}),e.jsxs("div",{className:"job-grid",children:[e.jsx(Zt,{jobKey:"JOB_CD",jobName:"Recompute tracks number and CDs",description:"Reextract the metadatas of the songs to remap them to the correct CD or track number. Analyses lossless.",doneTotalView:m}),e.jsx(Zt,{jobKey:"JOB_FFT",jobName:"Compute audio spectras",description:"Runs a fast Fourier transform on each audio files to extract the audio spectrum. The result is writen into .bin files. For a .flac audio of 41kHz, we expect 3Mb spectrum file.",payload:{completeLibrary:!0},doneTotalView:m})]}),e.jsxs("div",{className:"admin-category",children:[e.jsx(hr,{}),e.jsx("h2",{children:"Configuration"})]}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Sa,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(It,{})})})]});return e.jsxs("div",{className:"account-page",children:[e.jsx(St,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>f("/home"),children:e.jsx(st,{})}),e.jsx("div",{className:"account-info",children:s?e.jsx(d,{}):e.jsx(p,{})})]})]})},wa=()=>{const[n,s]=t.useState(null),{genreId:c}=jt(),{addContainerToQueue:i,playContainerSuffle:o,playContainer:r}=xe();t.useEffect(()=>{fetch(`${g}/read-write/genre/${c}`,{method:"GET",credentials:"include"}).then(p=>{if(!p.ok)throw new Error("Network response was not ok");return p.json()}).then(p=>{s(p),console.log(p)})},[]);const l=async()=>{r(c,"genre")},m=async()=>{i(c,"genre")},f=async()=>{o(c,"genre")};return e.jsxs("div",{className:"genre-view",children:[e.jsx("button",{className:"roundButton",onClick:()=>window.history.back(),children:e.jsx(st,{})}),n?e.jsxs("div",{className:"genre-details",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"baseline",gap:"10px"},children:[e.jsx("h1",{style:{marginRight:"20px"},children:n.name}),e.jsx(de,{text:"Play",icon:e.jsx(Rt,{}),onClick:l}),e.jsx(de,{text:"Random",icon:e.jsx(et,{}),onClick:f}),e.jsx(de,{text:"Add to queue",icon:e.jsx($t,{}),onClick:m})]}),e.jsx("div",{className:"genre-albums album-displayer",children:n.albums.map(p=>e.jsx(Ot,{album:p},p.id))})]}):e.jsx("p",{children:"Loading..."})]})},Ta=({genre:n})=>{const s=ge(),[c,i]=t.useState([]),[o,r]=t.useState([]),l=t.useRef([]),m=t.useRef(o),f=t.useRef([]),p=h=>{var T;if(console.log("changed on",h),!((T=m.current)!=null&&T.length)==0)return;const v=document.getElementById(`genre-${n.id}-img-${h}`);v==null||v.setAttribute("data-hidden","true"),setTimeout(()=>{v&&(v.src=`${g}/covers/${m==null?void 0:m.current[h]}`),v==null||v.removeAttribute("data-hidden")},500)};t.useEffect(()=>(a(i),d(),[2e3,2500,3e3].forEach((v,T)=>{setTimeout(()=>p(T),v);const b=setInterval(()=>p(T),7e3);f.current.push(b)}),()=>{l.current.forEach(clearTimeout),l.current=[],f.current.forEach(clearInterval),f.current=[],m.current=[]}),[]);const a=h=>{fetch(`${g}/read-write/trackCoversGenre/${n.id}`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{h(v)})};t.useEffect(()=>{m.current=o},[o]);const d=()=>{a(r),setTimeout(d,5500)};return e.jsxs("div",{className:"genre-card",onClick:()=>{s(`/genres/${n.id}`)},children:[c.map((h,v)=>e.jsx("div",{className:"img-pivot",style:{"--start-delay":`${3*(2-v)}`,"--start-angle":`${2-v}`,"--speed":"0.7","--scale":.4},children:e.jsx("img",{id:`genre-${n.id}-img-${v}`,className:"genre-img-cover",style:{"--scale":.7},src:`${g}/covers/${h}`})},v)),e.jsx("div",{className:"genre-name",children:e.jsx("p",{children:n.name})})]})},Ea=({})=>{const[n,s]=t.useState([]),c=()=>{fetch(`${g}/read-write/genres`,{method:"GET",credentials:"include"}).then(i=>i.json()).then(i=>{s(i)})};return t.useEffect(()=>{ut(()=>{c();const o=r=>{console.log("Music uploaded:",r.detail),c()};return window.addEventListener("musicUploaded",o),()=>{window.removeEventListener("musicUploaded",o)}})()},[]),e.jsx("div",{className:"home genre-displayer",children:(n==null?void 0:n.length)!==0?n.map(i=>e.jsx(Ta,{genre:i},i.id)):e.jsx(Mt,{})})},Ca=({playlist:n})=>{const s=ge(),c=i=>{s(`/playlists/${i}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>c(n.id),children:[n.cover?e.jsx("img",{src:`${g}/covers/${n.cover}`,alt:`${n.name} cover`,className:"artist-card-cover"}):e.jsx(pe,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:n.name})]})},Aa=()=>{const[n,s]=t.useState([]),{createNewPlaylist:c,setPlaylistAddedCallback:i}=xe(),o=()=>{fetch(`${g}/read-write/playlists`,{method:"GET",credentials:"include"}).then(r=>r.json()).then(r=>s(r))};return t.useEffect(()=>{ut(()=>{o(),i(o)})()},[]),e.jsxs("div",{children:[e.jsx(de,{className:"buttonRound",onClick:c,style:{marginBottom:"40px"},icon:e.jsx(fr,{}),text:"Create a new playlist"}),e.jsx("div",{className:"album-displayer",children:n.map(r=>e.jsx(Ca,{playlist:r},r.id))})]})},Ra=()=>{const n=t.useRef(null),s=t.useRef(null),[c,i]=t.useState(!1),[o,r]=t.useState([]),{playAudioSalad:l,setSaladContext:m,saladContext:f,openTagWindow:p}=xe(),[a,d]=t.useState([]),[h,v]=t.useState([]),{addNotification:T,notifTypes:b}=He(),[_,y]=t.useState([]),[N,C]=t.useState(!1),[R,I]=t.useState(!1),M=t.useRef(null),W=t.useRef(null),[S,K]=t.useState("#aabbcc"),[ee,F]=t.useState(!0);t.useEffect(()=>{ut(()=>{const j=G=>{n.current&&!n.current.contains(G.target)&&J()};return a.length===0&&d(f||[]),fetch(`${g}/read-write/mostUsedTags`,{method:"GET",credentials:"include"}).then(G=>G.json()).then(G=>{const te=G.map(q=>({...q,type:q.total,typeElem:"tag",icon:()=>e.jsx(yt,{color:q.color}),tooltip:le=>e.jsx("span",{children:le})}));v(te),r(te)}),document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j)}})()},[]);const $=U=>{const j=U.target.value;if(j===""||j.trim().length===0){r(h);return}fetch(`${g}/read-write/search/${j}/tags,salads`,{method:"GET"}).then(G=>{if(G.ok)return G.json();throw new Error("Error fetching search results")}).then(G=>{var q,le;const te=[...(q=G.tags)==null?void 0:q.map(ye=>({...ye,typeElem:"tag",icon:()=>e.jsx(yt,{color:ye.color})})),...(le=G.salads)==null?void 0:le.map(ye=>({...ye,typeElem:"salad",icon:()=>e.jsx(Qe,{color:ye.color})}))];console.log(te),r(te)})},J=()=>{i(!1)},Q=U=>{d(j=>j.filter(G=>G.id!==U))},ne=U=>{J(),console.log(U),!a.find(j=>j.id===U.id)&&d(j=>[...j,U])},X=async()=>{l(_.map(U=>U.id)),m(a)};t.useEffect(()=>{if(m(a),a.length===0){y([]),F(!0);return}F(a.findIndex(j=>j.typeElem==="salad")===-1);const U=new FormData;U.append("tags",JSON.stringify(a.filter(j=>j.typeElem==="tag").map(j=>j.id))),U.append("salads",JSON.stringify(a.filter(j=>j.typeElem==="salad").map(j=>j.id))),fetch(`${g}/read-write/getSalad`,{method:"POST",body:U}).then(j=>j.json()).then(j=>JSON.parse(j)).then(j=>{y(gt.shuffle(j)),console.log("New tracks received",j),j.length>0?T("Salad received! Enjoy..",b.SALAD):T("This salad is empty.. No tracks found.",b.SALAD)})},[a]);const oe=async()=>{a.length!==0&&(C(!0),K(`${cs(Math.random().toFixed(4)*360,100,70.8)}`))},ce=()=>{if(!W.current.value||(C(!1),a.find(j=>j.typeElem==="salad")))return;const U=new FormData;U.append("salad",JSON.stringify({name:W.current.value,color:S,tags:a.map(j=>j.id)})),fetch(`${g}/read-write/newSalad`,{method:"POST",credentials:"include",body:U}).then(j=>j.json()).then(j=>{T("Salad saved!",b.SUCCESS),d([j])})},Se=U=>{l(_.map(j=>j.id),U)},ie=()=>{i(!0),s.current.value};return e.jsxs("div",{className:"cooking-div",children:[e.jsx("h2",{children:"Here select some tags and play the music!"}),e.jsxs("div",{className:"cooking-header",children:[e.jsx("div",{className:"action-bar",style:{margin:"auto"},ref:n,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",style:{zIndex:"2"},children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(tt,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:$,placeholder:"Search some tags or salads..",ref:s,onFocus:ie}),e.jsx("div",{className:"action-bar-results",style:{display:`${c?"block":"none"}`},children:e.jsx(Pe,{height:300,itemCount:o.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:U,style:j})=>e.jsx(dt,{entry:o[U],style:{...j,width:" calc(100% - 20px)",marginTop:"10px"},onClick:ne},U)})})]})}),e.jsx("button",{className:"open-tags-edit",onClick:p,children:e.jsx(pr,{})})]}),e.jsxs("div",{className:"cooking-selection",children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(de,{text:"Play the salad",icon:e.jsx(xr,{}),onClick:X}),ee&&e.jsx(de,{text:"Save this salad",icon:e.jsx(gr,{}),onClick:oe})]}),e.jsx("div",{className:"cooking-tags",style:{marginBottom:"30px"},children:a.map(U=>e.jsxs("div",{className:"small-tag","data-prefix":U.typeElem==="salad",style:{backgroundColor:U.color},children:[U.typeElem==="salad"&&e.jsx(Qe,{"data-prefix":"true"}),e.jsx("span",{children:U.name}),e.jsx(Ce,{onClick:()=>{Q(U.id)}})]},U.id))}),e.jsx("div",{className:"track-list",children:_.map((U,j)=>e.jsx(gs,{index:j,isSalad:Se,track:U,playIconId:"salad",showCover:!0},U.id))})]}),N?e.jsxs("div",{className:"edit-tag",style:{left:"calc(50% - 170px)",margin:"auto"},children:[e.jsx(Ce,{style:{cursor:"pointer"},onClick:()=>{C(!1)}}),e.jsx("input",{type:"text",placeholder:"Name your new salad.",ref:W}),e.jsx(vr,{style:{cursor:"pointer"},id:"color-button",color:S,onClick:()=>{I(!R)}}),R&&e.jsxs("div",{ref:M,className:"edit-tag-picker",children:[" ",e.jsx(Pt,{color:S,onChange:K})]}),e.jsx(Xe,{onClick:ce,style:{cursor:"pointer"}})]}):null]})},Ia=({radio:n})=>{const{playRadio:s}=xe();return e.jsxs("div",{className:"album-card",onClick:()=>s(n.id),children:[n.coverUrl?e.jsx("img",{src:`${n.coverUrl}`,alt:`${Ue(n.name,25)} cover`,className:"album-card-cover"}):e.jsx(pe,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Ue(n.name,40)})]})},Fa=()=>{const[n,s]=t.useState(!1),[c,i]=t.useState([]),o=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});t.useEffect(()=>{},[]);const r=()=>{},l=()=>{},m=async()=>{window.open("https://www.radio-browser.info/tags","_blank").focus()};return e.jsxs("div",{className:"home",children:[e.jsx("h3",{children:"Recently heard"}),e.jsx("div",{className:"album-displayer","data-no-tracks":(c==null?void 0:c.length)==0&&n?"true":"false",children:n?(c==null?void 0:c.length)!==0?c.map(f=>e.jsx(Ia,{radio:f},f.id)):null:e.jsx(o,{})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx("h3",{style:{marginRight:"20px"},children:"Discover"}),e.jsx(de,{text:"Filters",icon:e.jsx(jr,{}),onClick:r}),e.jsx(de,{text:"Random",icon:e.jsx(et,{}),onClick:l}),e.jsx(de,{text:"External search",icon:e.jsx(yr,{}),onClick:m})]})]})},$a=()=>{const{playingTrack:n}=xe();return e.jsxs("div",{className:"content-with-fft",children:[e.jsx(es,{})," ",n?e.jsx(na,{}):null]})},Pa=()=>{};function La(){return e.jsx(Or,{children:e.jsx(Cr,{children:e.jsxs(Mr,{children:[" ",e.jsx(Xr,{children:e.jsxs(xn,{children:[e.jsx(fe,{path:"/",element:e.jsx(la,{})}),e.jsx(fe,{path:"register",element:e.jsx(ca,{})}),e.jsxs(fe,{element:e.jsx($a,{}),children:[e.jsxs(fe,{element:e.jsx(ra,{}),children:[e.jsx(fe,{path:"home",element:e.jsx(aa,{})}),e.jsx(fe,{path:"albums",element:e.jsx(oa,{})}),e.jsx(fe,{path:"albums/:albumId",element:e.jsx(Xt,{})}),e.jsx(fe,{path:"artists",element:e.jsx(da,{})}),e.jsx(fe,{path:"artists/:artistId",element:e.jsx(ma,{})}),e.jsx(fe,{path:"genres",element:e.jsx(Ea,{})}),e.jsx(fe,{path:"genres/:genreId",element:e.jsx(wa,{})}),e.jsx(fe,{path:"playlists",element:e.jsx(Aa,{})}),e.jsx(fe,{path:"playlists/:playlistId",element:e.jsx(Xt,{isPlaylist:!0})}),e.jsx(fe,{path:"cooking",element:e.jsx(Ra,{})}),e.jsx(fe,{path:"radio",element:e.jsx(Fa,{})})]}),e.jsx(fe,{path:"full-screen",element:e.jsx(Pa,{})}),e.jsx(fe,{path:"account",element:e.jsx(fa,{})}),e.jsx(fe,{path:"settings",element:e.jsx(ja,{})}),e.jsx(fe,{path:"admin-pannel",element:e.jsx(ka,{})}),e.jsx(fe,{path:"*",element:e.jsx(ha,{})})]})]})})]})})})}pn.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(gn,{children:e.jsx(La,{})})}));
