import{r as n,j as e}from"./react-DmLYqgKm.js";import{c as ar}from"./react-dom-DPPwivfB.js";import{u as me,a as Ke,L as tt,O as Rs,b as Lt,R as or,c as ce,B as cr}from"./react-router-C4BYJpcq.js";import{I as ir,a as Mt,b as at,c as Xt,d as xe,e as ot,f as lr,g as yt,h as ct,i as As,j as ur,k as dr,l as mr,m as hr,n as fr,o as vt,p as Yt,q as Is,r as Qe,s as Fs,t as Ps,u as pr,v as Ls,w as gr,x as xr,y as vr,z as jr,A as Zt,B as br,C as yr,D as Nr,E as kr,F as $s,G as Ut,H as Sr,J as Os,K as wr,L as Tr,M as Er,N as Cr,O as Ms,P as es,Q as it,R as Rr,S as Us,T as _s,U as Qt,V as Ar,W as Ir,X as Fr,Y as ts,Z as Pr,_ as Lr,$ as $r,a0 as Or,a1 as Mr,a2 as Ur,a3 as _r,a4 as Br,a5 as Gr,a6 as Dr,a7 as Je,a8 as Vr,a9 as Hr,aa as zr,ab as qr,ac as Wr,ad as Bs,ae as Kr,af as Qr,ag as Jr,ah as Yr,ai as Xr,aj as Zr,ak as ea,al as ta,am as sa,an as na,ao as ra,ap as aa,aq as oa,ar as ca,as as ia,at as la}from"./@tabler-CH3xQ0-C.js";import{F as Ae}from"./react-window-Dlc0x0tK.js";import{v as jt}from"./uuid-C6aID195.js";import{Z as ss}from"./react-colorful-0uAH5Wqu.js";import{_ as gt}from"./lodash-BhRqD2di.js";import{p as ua}from"./music-metadata-CvBiwAZp.js";import{a as da}from"./axios-xsH4HHeE.js";import{F as Gs}from"./fuse.js-Ch1WBRTM.js";import"./content-type-kkloIWN6.js";import"./scheduler-SPyfQU6S.js";import"./cookie--_YQFYBD.js";import"./@babel-Cj2_JSWT.js";import"./memoize-one-CcMeOnPo.js";import"./strtok3-BXaumHbT.js";import"./peek-readable-BVp5v6zA.js";import"./file-type-BdA4k6lR.js";import"./token-types-D2R8hC8p.js";import"./ieee754-DcnkbHBT.js";import"./@tokenizer-Sx_RGPFW.js";import"./fflate-D0DoR3vL.js";import"./debug-Dqg9INeJ.js";import"./ms-CzQ2E3wO.js";import"./uint8array-extras-B1Dultle.js";import"./media-typer-Kaw9hxcp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&u(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function u(l){if(l.ep)return;l.ep=!0;const r=o(l);fetch(l.href,r)}})();const ma=()=>{const t=window.location.hostname,s=window.location.port;return t==="localhost"||t.startsWith("127.0.0.1")?`http://localhost:${s}`:`http://${t}:${s}`},N=ma(),Ds=n.createContext(),ge=()=>n.useContext(Ds),ha=({children:t})=>{const s=n.useRef(new Map),o=(l,r)=>(s.current.has(l)||s.current.set(l,new Set),s.current.get(l).add(r),()=>{var a;(a=s.current.get(l))==null||a.delete(r)}),u=(l,r)=>{s.current.has(l)&&s.current.get(l).forEach(a=>{a(r),console.log("called at",a)})};return e.jsx(Ds.Provider,{value:{emit:u,subscribe:o},children:t})},fa=()=>{const[t,s]=n.useState(!1),[o,u]=n.useState(!1),l=me(),r=n.useRef(null),{subscribe:a}=ge(),d=()=>{s(!t)},m=()=>{fetch(`${N}/auth/logout`,{method:"POST",credentials:"include"}).then(p=>{p.ok?l("/"):console.error("Logout failed")}).catch(p=>{console.error("Error:",p)})},h=()=>{l("/account")},c=()=>{l("/settings")};return n.useEffect(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{u(x)});const p=x=>{var b;if(r.current&&!r.current.contains(x.target)){if(((b=x.target.closest("svg"))==null?void 0:b.id)==="user-button")return;s(!1)}},f=a("action-bar-open",()=>{s(!1)});return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{f(),document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[]),e.jsxs("div",{className:"userDropdown",ref:r,children:[e.jsx(ir,{id:"user-button",className:"userImage buttonRound",onClick:d}),t&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"userAccount dropdownEntry",onClick:h,children:"Account"}),e.jsx("button",{className:"userSetting dropdownEntry",onClick:c,children:"Settings"}),o&&e.jsx("button",{className:"userSetting dropdownEntry",onClick:()=>{l("/admin-pannel")},children:"Admin pannel"}),e.jsx("button",{className:"userLogout dropdownEntry",onClick:m,children:"Logout"})]})]})},ns=t=>{var s=function(a){return("00"+a).slice(-2)};const o=Math.floor(t/3600),u=Math.floor(t%3600/60),l=s(Math.floor(t%60)),r=o>0?`${o}:${u}:${l}`:`${u}:${l}`;return{hours:o,minutes:u,seconds:l,readable:r}},Jt=t=>{const s=Math.floor(t/1024),o=Math.floor(s/1024),u=Math.floor(o/1024),l=Math.floor(u/1024),r=l>0?`${Number(t/1024/1024/1024/1024).toFixed(2)}TB`:u>0?`${Number(t/1024/1024/1024).toFixed(2)}GB`:o>0?`${Number(t/1024/1024).toFixed(2)}MB`:`${Number(t/1024).toFixed(2)}KB`;return{kb:s,mb:o,gb:u,tb:l,readable:r}},Vs=(t,s,o)=>{s/=100,o/=100;let u=(1-Math.abs(2*o-1))*s,l=u*(1-Math.abs(t/60%2-1)),r=o-u/2,a=0,d=0,m=0;return 0<=t&&t<60?(a=u,d=l,m=0):60<=t&&t<120?(a=l,d=u,m=0):120<=t&&t<180?(a=0,d=u,m=l):180<=t&&t<240?(a=0,d=l,m=u):240<=t&&t<300?(a=l,d=0,m=u):300<=t&&t<360&&(a=u,d=0,m=l),a=Math.round((a+r)*255).toString(16),d=Math.round((d+r)*255).toString(16),m=Math.round((m+r)*255).toString(16),a.length==1&&(a="0"+a),d.length==1&&(d="0"+d),m.length==1&&(m="0"+m),"#"+a+d+m},bs=(t,s,o)=>(t=t.toString(16),s=s.toString(16),o=o.toString(16),t.length==1&&(t="0"+t),s.length==1&&(s="0"+s),o.length==1&&(o="0"+o),"#"+t+s+o),Me=t=>{let s=0,o=0,u=0;return t.length==4?(s="0x"+t[1]+t[1],o="0x"+t[2]+t[2],u="0x"+t[3]+t[3]):t.length==7&&(s="0x"+t[1]+t[2],o="0x"+t[3]+t[4],u="0x"+t[5]+t[6]),[parseInt(s),parseInt(o),parseInt(u)]},We=(t,s,o)=>t+(s-t)*o,pa=(t,s,o,u,l)=>We(u,l,(t-s)/(o-s)),Be=(t,s)=>{var o=t??"";return o.length>s?o.substring(0,s-2)+"..":o},ga=(t="")=>{const s=["/","/register"];return new Promise(async o=>{const u=await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"}).then(async l=>l.ok?!0:(s.includes(t)||await fetch(`${N}/auth/logout`,{method:"POST",credentials:"include"}).then(r=>{r.ok?window.location.href="/":console.error("Logout failed")}),!1));o(u)})},Oe=(t,s="")=>async function(){await ga(s)&&t()},xa=t=>t.charAt(0).toUpperCase()+t.slice(1),ys=([t,s,o])=>{const u=[t,s,o].map(l=>(l/=255,l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4)));return .2126*u[0]+.7152*u[1]+.0722*u[2]},va=(t,s)=>{const o=ys(t),u=ys(s);return(Math.max(o,u)+.05)/(Math.min(o,u)+.05)},te=({col1:t="#f9c58d",col2:s="#f492f0",className:o,style:u={},id:l=""})=>e.jsxs("svg",{id:l,viewBox:"0 0 512 512",style:{...u},className:o,xmlns:"http://www.w3.org/2000/svg",fill:"#000000",children:[e.jsxs("defs",{children:[e.jsx("mask",{id:"mask_logo",fill:"black",children:e.jsx("path",{fill:"white",d:"M116.215 17.404c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm64.326 12.87l-23.488 92.062h63.965l27.49-27.49-67.967-64.573zm228.147 25.958c0 20.214-20.216 40.428-40.43 40.428 20.214 0 40.43 20.214 40.43 40.428 0-20.214 20.213-40.428 40.427-40.428-20.214 0-40.428-20.214-40.428-40.428zm-150.022 53.913l-23.18 23.18L283.043 311h29.066l-53.443-200.855zm75.232 2.365l16.123 32.281 45.188 33.148-4.393-53.533-56.918-11.896zm-18.033 4.181l-26.685 38.121 10 37.586 33.38-42.283-16.695-33.424zm-160.672 23.645L172.42 206.4l21.988 12.623L239.043 311h25.365l-45.68-170.664h-63.535zm189.797 23.088l-40.03 50.703L330.737 311h.026l64.08-111.004-49.852-36.572zm122.352 5.834c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm-374.22 12.375l11.308 76.129 48.834-6.356 19.322-24.154-79.465-45.62zm346.995 53.793l-52.547 13.172L351.547 311h25.77l19.16-19.48 43.64-56.094zm-255.21 5.244l-17.403 21.75 25.77 48.58h25.761l-34.129-70.33zm-33.84 29.174l-39.005 5.074L148.145 311h24.751l-21.83-41.156zm-91.37 11.396c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zM137 329v30h238v-30H137zm32 48v78h16v-78h-16zm34 0v78h106v-78H203zm124 0v78h16v-78h-16zm-164.758 96l-30.119 16h247.754l-30.12-16H162.243z"})}),e.jsxs("linearGradient",{id:"grad_logo",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:t}),e.jsx("stop",{offset:"100%",stopColor:s})]})]}),e.jsx("rect",{x:"0",y:"0",width:"512",height:"512",fill:"url(#grad_logo)",mask:"url(#mask_logo)"})]}),Nt=({entry:t,style:s,onClick:o})=>e.jsxs("div",{className:"action-bar-entry",style:s,onClick:()=>{o(t)},children:[t.icon(),e.jsxs("span",{style:{flex:"1"},children:[" ",t.name]}),t.tooltip?t.tooltip(t.type):null]}),Hs=n.createContext(),st={SUCCESS:"success",ERROR:"error",INFO:"info",SALAD:"salad",QUEUE:"queue"},ja=({children:t})=>{const[s,o]=n.useState(null),[u,l]=n.useState(null),r=n.useRef(null),a=n.useRef([]),d=(h,c)=>{a.current.forEach(f=>clearTimeout(f)),a.current=[],l({message:h,state:c}),o(!0);const p=setTimeout(()=>{r.current&&(r.current.setAttribute("direction",""),r.current.offsetWidth,r.current.setAttribute("direction","hide"));const f=setTimeout(()=>{o(!1),l(null)},300);a.current.push(f)},2e3);a.current.push(p)};n.useEffect(()=>{u&&o(!0)},[u]),n.useEffect(()=>{!s||!r.current||r.current.setAttribute("direction","show")},[s]);const m=()=>{if(!s)return null;switch(u==null?void 0:u.state){case st.SUCCESS:return e.jsx(ot,{className:"notification-icon"});case st.ERROR:return e.jsx(xe,{className:"notification-icon"});case st.INFO:return e.jsx(Xt,{className:"notification-icon"});case st.SALAD:return e.jsx(at,{className:"notification-icon"});case st.QUEUE:return e.jsx(Mt,{className:"notification-icon"});default:return null}};return e.jsxs(Hs.Provider,{value:{notifTypes:st,addNotification:d},children:[t,u?e.jsx("div",{ref:r,className:"notification-parent",id:"notification-parent",children:e.jsxs("div",{className:"notification","is-open":u?"true":"false",children:[e.jsx(m,{}),e.jsx("span",{children:u.message})]})}):null]})},Ie=()=>n.useContext(Hs),ba=({onClose:t,track:s})=>{const[o,u]=n.useState(!1),l=n.useRef(null),r=n.useRef(null),[a,d]=n.useState([]),[m,h]=n.useState(null),[c,p]=n.useState(""),{addNotification:f,notifTypes:x}=Ie(),b=L=>{if(L.preventDefault(),c==""&&!m){t(!1);return}fetch(`${N}/read-write/moveTrackToAlbum/${c?"true/"+c:"false/"+m.id}/${s.id}`).then(I=>I.json()).then(I=>{f(`Track ${s.title} moved to 
            ${c||m.name}.`,x.INFO),t(!0)})},j=L=>{h(null),p(L.target.value)},F=L=>{const{tooltip:I,...P}=L;k(),h(P),p("")};n.useEffect(()=>{const L=I=>{r.current&&!r.current.contains(I.target)&&k()};return document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L)}},[]);const k=()=>{u(!1),l.current.value="",d([])},S=()=>e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Move to album"})," "]}),$=L=>{const I=L.target.value;if(I===""||I.trim().length===0){d([]);return}console.log(`${N}/read-write/search/${I}/${["albums"]}`),fetch(`${N}/read-write/search/${I}/${["albums"]}`,{method:"GET"}).then(P=>P.json()).then(P=>{d([...P.albums].map(R=>{const T=R.path,{trackPath:U,...q}=R;return{icon:()=>T?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/covers/${T}`,alt:R.name}):e.jsx(te,{className:"action-bar-entry-logo"}),tooltip:S,...q}}))})};return e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:null,children:[e.jsx("h2",{children:"Move track to another album"}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:b,children:[e.jsx("label",{htmlFor:"newAlbum",style:c?{}:{opacity:"0.5"},children:"New album name"}),e.jsx("input",{type:"text",style:c?{}:{opacity:"0.5"},id:"newAlbum",placeholder:"Enter album name",onChange:j}),e.jsx("label",{htmlFor:"existingAlbum",style:c?{opacity:"0.5"}:{},children:"Existing album"}),e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:r,style:c?{opacity:"0.5"}:{},children:e.jsxs("div",{className:"action-bar-research",style:{transform:"translateX(15px)"},id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(lr,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:$,placeholder:"Search the album you want to move the track to.",ref:l,onFocus:()=>{u(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Ae,{height:300,itemCount:a.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:L,style:I})=>e.jsx(Nt,{entry:a[L],style:{...I,width:" calc(100% - 20px)",marginTop:"10px"},onClick:F},L)})})]})}),m?e.jsxs("div",{style:{height:"90px",alignItems:"center",display:"flex",gap:"10px"},children:[m!=null&&m.icon?m.icon():null,m.name]}):null,e.jsx("input",{type:"submit",value:"Submit"})]})]})})},zs=()=>e.jsxs("div",{className:"three-points-loader",children:[e.jsx("div",{className:"point point1"}),e.jsx("div",{className:"point point2"}),e.jsx("div",{className:"point point3"})]}),se=({onClick:t,text:s,icon:o,style:u,id:l=""})=>{const[r,a]=n.useState(!1),d=()=>{a(!0),t().then(()=>{a(!1)})},m=()=>r?e.jsx(zs,{}):e.jsxs(e.Fragment,{children:[o,s]});return e.jsx("button",{className:"button-with-callback",id:l,style:{...u},onClick:d,children:e.jsx(m,{})})},ya=({applyCanges:t,albumClass:s})=>{var I,P;const[o,u]=n.useState({visible:!1}),[l,r]=n.useState(null),[a,d]=n.useState("2000-00-00"),[m,h]=n.useState(null),[c,p]=n.useState(!1),{deleteAlbum:f}=re(),{notifTypes:x,addNotification:b}=Ie();if(!s)return null;n.useEffect(()=>{s&&(r(s.coverURL),d(s.year))},[s]);const j=()=>{const R=document.getElementById("editAlbumInfos"),T=R.artistName.value.split(",").map(B=>B.trim()),U=R.genre.value.split(",").map(B=>B.trim()).map(B=>B.charAt(0).toUpperCase()+B.slice(1)).filter(B=>B!="");if(!(R.albumName.value!==s.name||s.artist.toString()!==T.toString()||s.year!==R.releaseDate.value||s.genre.toString()!==U.toString()||s.description!==R.description.value||m||c)){t(null);return}s.name=R.albumName.value,s.artist=T,s.year=R.releaseDate.value,s.genre=U,s.description=R.description.value;const{tracks:G,coverURL:E,...V}=s;console.log(V),t(V,m)},F=R=>{const T=R.target.files[0];T&&(s.ext=T.name.split(".").pop(),r(URL.createObjectURL(T)),h(T))},k=R=>{u({visible:!o.visible,...R})},S=R=>{console.log(R),!c&&R&&p(!0),u({visible:!1})},$=async()=>{b("Comming soon :)",x.INFO)},L=async()=>{f(!1,{name:s.name,id:s.id})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(te,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(yt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:F})]}),e.jsx("button",{className:"roundButton",onClick:()=>j(),children:"Apply"}),e.jsx(se,{onClick:$,text:"Delete for me",icon:e.jsx(ct,{}),style:{marginTop:"auto"}}),e.jsx(se,{onClick:L,text:"Remove from library",icon:e.jsx(ct,{})})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(I=s.artist)==null?void 0:I.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",value:a,onChange:R=>{d(R.target.value)}})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(P=s.genre)==null?void 0:P.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Ae,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:R,style:T})=>e.jsxs("div",{style:T,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[R].title}),e.jsx(As,{className:"trackIcon",onClick:()=>{k(s.tracks[R])}})]},R)})})]}),o.visible&&e.jsx(ba,{onClose:S,track:{id:o.id,title:o.title}})]})})},Ns=({closeOverlay:t,applyCanges:s,editPlaylistClass:o})=>{const[u,l]=n.useState(null),[r,a]=n.useState(null),[d,m]=n.useState(o||{id:jt()}),[h,c]=n.useState([]),[p,f]=n.useState([]);n.useEffect(()=>{d&&l(d.coverURL),d.collaborators&&f(d.collaborators)},[d]);const x=()=>{const k=document.getElementById("editAlbumInfos");if(!(k.playlistName.value!==d.name||d.description!==k.description.value||r||d.collaborators.map(P=>!p.includes(P)).filter(P=>P))){s(null);return}d.name=k.playlistName.value,d.description=k.description.value,d.collaborators=p.map(P=>P.id);const{tracks:$,coverURL:L,...I}=d;console.log(I),s(I,r)},b=k=>{const S=k.target.files[0];S&&(d.ext=S.name.split(".").pop(),l(URL.createObjectURL(S)),a(S))};n.useEffect(()=>{fetch(`${N}/auth/collaborators`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{console.log(k),c(k)})},[]);const j=k=>{const S=k.target.value;p.includes(S)||S==="pickUsers"||(f($=>[...$,h.find(L=>L.id==S)]),k.target.value="pickUsers")};n.useEffect(()=>{console.log(p)});const F=k=>{f(p.filter(S=>S.id!=k))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsx(xe,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[u?e.jsx("img",{id:"coverPicture",src:u,style:{width:"100%"}}):e.jsx(te,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(yt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:b})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"playlistName",children:"Playlist name"}),e.jsx("input",{type:"text",id:"playlistName",placeholder:"Enter playlist name",defaultValue:d==null?void 0:d.name}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",style:{height:"80px",paddingTop:"10px",paddingBottom:"10px"},placeholder:"Enter description",defaultValue:d==null?void 0:d.description})]}),e.jsx("label",{htmlFor:"new-collab",children:"Add collaborators"}),e.jsxs("select",{onChange:j,children:[e.jsx("option",{value:"pickUsers",children:"Pick users"},"root"),h.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),e.jsx("label",{children:"Collaborators:"}),e.jsx("div",{children:p==null?void 0:p.map(k=>e.jsxs("div",{children:[e.jsx("span",{children:k==null?void 0:k.name}),e.jsx(ur,{className:"buttonRound",onClick:()=>{F(k.id)}})]},k==null?void 0:k.id))})]})]})})};function Na(){const{innerWidth:t,innerHeight:s}=window;return{width:t,height:s}}const ka=({trackY:t,track:s,isFav:o})=>{const[u,l]=n.useState(Na()),{onClicTrackActionEntry:r,trackActionTypes:a}=re(),[d,m]=n.useState(!1),h=n.useRef(null),[c,p]=n.useState(null),f=Ke(),[x,b]=n.useState(()=>window.innerWidth<714);return n.useEffect(()=>{const j=F=>{h.current&&!h.current.contains(F.target)&&r(a.NONE)};return document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),m(f.pathname.includes("playlist")),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j)}},[]),n.useEffect(()=>{const j=d?250:180;p(Math.min(t,u.height-j))},[d]),c&&e.jsxs("div",{className:"track-actions-div",ref:h,style:{height:"fit-content",top:c},children:[e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TOP_QUEUE,s)},children:[e.jsx("span",{children:"Front queue"})," ",e.jsx(dr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.END_QUEUE,s)},children:[e.jsx("span",{children:"Back queue"})," ",e.jsx(mr,{})]}),d&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.GOTO_ALBUM,s)},children:[e.jsx("span",{children:"View album"})," ",e.jsx(hr,{})]}),d&&!o&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_PLAYLIST,s)},children:[e.jsx("span",{children:"Delete from playlist"})," ",e.jsx(fr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TAGS,s)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(vt,{})]}),x&&s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_FAVORITES,s)},children:[e.jsx("span",{children:"Remove from favorite"})," ",e.jsx(Yt,{})]}):null,x&&!s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.ADD_TO_FAVORITES,s)},children:[e.jsx("span",{children:"Add to favorites"})," ",e.jsx(Is,{})]}):null]})},ft={name:"Create a new tag",icon:()=>e.jsx(Fs,{}),isAction:!0},Sa=({track:t,apply:s})=>{const o=n.useRef(null),[u,l]=n.useState(!1),[r,a]=n.useState([ft]),[d,m]=n.useState("#aabbcc"),[h,c]=n.useState(!1),p=n.useRef(null),f=n.useRef(null),[x,b]=n.useState([]),[j,F]=n.useState(null),[k,S]=n.useState(null),[$,L]=n.useState([]),I=n.useRef(),P=G=>{const E=G.target.value;if(S(E),E===""||E.trim().length===0){a([ft]);return}fetch(`${N}/read-write/search/${E}/tags`,{method:"GET"}).then(V=>{if(V.ok)return V.json();throw new Error("Error fetching search results")}).then(V=>{var X;const B=(X=V.tags)==null?void 0:X.map(Z=>({...Z,icon:()=>e.jsx(vt,{color:Z.color}),isAction:!1})),W={name:`${ft.name}: ${E}`,icon:ft.icon,isAction:ft.isAction};B.splice(0,0,W),a(B)})},R=()=>{l(!1)},T=G=>{if(R(),G.isAction){F("new"),m(`${Vs(Math.random().toFixed(4)*360,100,70.8)}`);return}x.find(E=>E.id===G.id)||(L(E=>E.filter(V=>V!==G.id)),b(E=>[...E,G]))};n.useEffect(()=>{j==="new"&&(f.current.focus(),f.current.value=k||"",I.current.value="")},[j]),n.useEffect(()=>{const G=E=>{var V;if(p.current&&!p.current.contains(E.target)){if(((V=E.target.closest("svg"))==null?void 0:V.id)==="color-button")return;c(!1)}if(o.current&&!o.current.contains(E.target)){R();return}};return document.addEventListener("mousedown",G),document.addEventListener("touchstart",G),fetch(`${N}/read-write/trackTags/${t.id}`,{method:"GET"}).then(E=>E.json()).then(E=>{b(E)}),()=>{document.removeEventListener("mousedown",G),document.removeEventListener("touchstart",G)}},[]);const U=()=>{const G=f.current.value;G!==""&&j==="new"&&b(E=>[...E,{name:G,color:d,id:jt(),isNew:!0}]),F(null)},q=(G,E)=>{const V=x.filter(B=>!(B.isNew===G&&B.id===E));b(V),G||L(B=>[...B,E])};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",style:{height:"500px",flexDirection:"column"},children:[e.jsx(xe,{className:"buttonRound closeOverlay",onClick:()=>{s(null)}}),e.jsxs("h3",{children:["Editing tags for track ",t.title]}),e.jsx("div",{className:"action-bar",style:{margin:"10px auto"},ref:o,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Qe,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:P,placeholder:"Search some tags..",ref:I,onFocus:()=>{l(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${u?"block":"none"}`},children:e.jsx(Ae,{height:300,itemCount:r.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:G,style:E})=>e.jsx(Nt,{entry:r[G],style:{...E,width:" calc(100% - 20px)",marginTop:"10px"},onClick:T},G)})})]})}),j?e.jsxs("div",{className:"edit-tag",children:[e.jsx(Fs,{style:{paddingRight:"30px"}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:f}),e.jsx(Ps,{id:"color-button",color:d,onClick:()=>{c(!h)}}),h&&e.jsxs("div",{ref:p,className:"edit-tag-picker",children:[" ",e.jsx(ss,{color:d,onChange:m})]}),e.jsx(ot,{onClick:U})]}):null,e.jsx("div",{className:"track-tags-div",children:x.map((G,E)=>e.jsxs("div",{className:"small-tag",style:{backgroundColor:G.color},children:[e.jsx("span",{children:G.name})," ",e.jsx(xe,{onClick:()=>{q(G.isNew,G.id)}})]},`${G.isNew}-${G.id}`))}),e.jsx("button",{style:{marginTop:"auto"},onClick:()=>{s({current:x,deleted:$},t.id)},children:"Apply"})]})})},wa=()=>{const{closeTagWindow:t}=re(),[s,o]=n.useState(0),[u,l]=n.useState([]),[r,a]=n.useState([]),[d,m]=n.useState(!1),[h,c]=n.useState("#aabbcc"),[p,f]=n.useState(null),x=n.useRef(null),b=n.useRef(null),{addNotification:j,notifTypes:F}=Ie(),[k,S]=n.useState(null);n.useEffect(()=>{$(),L()},[]);const $=()=>{fetch(`${N}/read-write/getAllUserTags`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{l(T)})},L=()=>{fetch(`${N}/read-write/getAllUserSalads`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{a(T)})},I=T=>{f(T),c(T.color)},P=()=>{const T={id:p.id,name:x.current.value,color:h},U=new FormData;U.append(s===0?"tag":"salad",JSON.stringify(T)),fetch(`${N}/read-write/${s===0?"applyTagModifications":"applySaladModifications"}`,{method:"POST",credentials:"include",body:U}).then(q=>q.json()).then(q=>{s===0?$():L(),j("Tag updated.",F.SUCCESS)}),f(null)},R=()=>{fetch(`${N}/read-write/delete/${k.type}/${k.id}`,{method:"DELETE",credentials:"include"}).then(T=>T.json()).then(T=>{s===0?$():L(),f(null),S(null),j("Tag deleted.",F.SUCCESS)})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"tag-edtior-container",children:[e.jsx(xe,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"cooking-selection",style:{marginTop:"40px"},children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(se,{text:"Edit tags",icon:e.jsx(pr,{}),onClick:async()=>{o(0)}}),e.jsx(se,{text:"Edit salads",icon:e.jsx(at,{}),onClick:async()=>{o(1)}})]}),e.jsxs("div",{className:"edit-tags-content",children:[e.jsx(Ae,{className:"albumTrackList",height:250,itemCount:s===0?u.length:r.length,itemSize:35,width:"100%",children:({index:T,style:U})=>e.jsxs("div",{style:U,className:"album-wrapping-track",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:s===0?u[T].color:r[T].color}}),e.jsx("span",{children:s===0?u[T].name:r[T].name}),e.jsx(Ls,{className:"trackIcon",onClick:()=>{I(s===0?{...u[T],type:"tag"}:{...r[T],type:"salad"})}})]},T)}),p?e.jsxs("div",{className:"edit-tag",style:{left:"-20px",margin:"auto"},children:[e.jsx(xe,{style:{cursor:"pointer"},onClick:()=>{f(null)}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:x,defaultValue:p.name}),e.jsx(Ps,{style:{cursor:"pointer"},id:"color-button",color:h,onClick:()=>{m(!d)}}),d&&e.jsxs("div",{ref:b,className:"edit-tag-picker",children:[" ",e.jsx(ss,{color:h,onChange:c})]}),e.jsx(ot,{onClick:P,style:{cursor:"pointer"}}),e.jsx(ct,{style:{cursor:"pointer"},onClick:()=>{S(p)}})]}):null,k?e.jsxs("div",{className:"deletion-confirmation",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:k.color,width:"50px"}}),e.jsxs("p",{children:["Confirm deletion of the ",k.type," ",k.name,"?"]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{S(null)},children:e.jsx(gr,{})}),e.jsx("button",{onClick:()=>{R()},children:e.jsx(ot,{})})]})]}):null]})]})]})})},Ta=({applyChanges:t,artist:s})=>{const[o,u]=n.useState(null),[l,r]=n.useState("2000-00-00"),[a,d]=n.useState(null);if(!s)return null;n.useEffect(()=>{s&&(u(s.picture),r(s.active_from))},[s]);const m=()=>{const c=document.getElementById("editArtistInfos"),p=s.active_from??"",f=c.activeFrom.value??"",x=s.name??"",b=c.artistName.value??"",j=s.bio??"",F=c.bio.value??"";if(!(x!=b||p!=f||j!=F||a)){t(null);return}s.name=c.artistName.value,s.active_from=c.activeFrom.value,s.bio=c.bio.value;const{picture:S,...$}=s;console.log($,a),t($,a)},h=c=>{const p=c.target.files[0];p&&(s.ext=p.name.split(".").pop(),u(URL.createObjectURL(p)),d(p))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(te,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(yt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:h})]}),e.jsx("button",{className:"roundButton",onClick:m,children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editArtistInfos",children:[e.jsx("label",{htmlFor:"artistName",children:"Artist name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("div",{className:"albumType",children:e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"activeFrom",children:"Active since"}),e.jsx("input",{type:"date",id:"activeFrom",value:l,onChange:c=>{r(c.target.value)}})]})}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",placeholder:"Enter biography",defaultValue:s.bio})]})]})]})})};var Ft=function(t,s){return t<s?-1:t>s?1:0},ks=function(t){return t.reduce(function(s,o){return s+o},0)},Ea=function(){function t(o){this.colors=o}var s=t.prototype;return s.palette=function(){return this.colors},s.map=function(o){return o},t}(),Ca=function(){function t(r,a,d){return(r<<10)+(a<<5)+d}function s(r){var a=[],d=!1;function m(){a.sort(r),d=!0}return{push:function(h){a.push(h),d=!1},peek:function(h){return d||m(),h===void 0&&(h=a.length-1),a[h]},pop:function(){return d||m(),a.pop()},size:function(){return a.length},map:function(h){return a.map(h)},debug:function(){return d||m(),a}}}function o(r,a,d,m,h,c,p){var f=this;f.r1=r,f.r2=a,f.g1=d,f.g2=m,f.b1=h,f.b2=c,f.histo=p}function u(){this.vboxes=new s(function(r,a){return Ft(r.vbox.count()*r.vbox.volume(),a.vbox.count()*a.vbox.volume())})}function l(r,a){if(a.count()){var d=a.r2-a.r1+1,m=a.g2-a.g1+1,h=Math.max.apply(null,[d,m,a.b2-a.b1+1]);if(a.count()==1)return[a.copy()];var c,p,f,x,b=0,j=[],F=[];if(h==d)for(c=a.r1;c<=a.r2;c++){for(x=0,p=a.g1;p<=a.g2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[t(c,p,f)]||0;j[c]=b+=x}else if(h==m)for(c=a.g1;c<=a.g2;c++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[t(p,c,f)]||0;j[c]=b+=x}else for(c=a.b1;c<=a.b2;c++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.g1;f<=a.g2;f++)x+=r[t(p,f,c)]||0;j[c]=b+=x}return j.forEach(function(k,S){F[S]=b-k}),function(k){var S,$,L,I,P,R=k+"1",T=k+"2",U=0;for(c=a[R];c<=a[T];c++)if(j[c]>b/2){for(L=a.copy(),I=a.copy(),P=(S=c-a[R])<=($=a[T]-c)?Math.min(a[T]-1,~~(c+$/2)):Math.max(a[R],~~(c-1-S/2));!j[P];)P++;for(U=F[P];!U&&j[P-1];)U=F[--P];return L[T]=P,I[R]=L[T]+1,[L,I]}}(h==d?"r":h==m?"g":"b")}}return o.prototype={volume:function(r){var a=this;return a._volume&&!r||(a._volume=(a.r2-a.r1+1)*(a.g2-a.g1+1)*(a.b2-a.b1+1)),a._volume},count:function(r){var a=this,d=a.histo;if(!a._count_set||r){var m,h,c,p=0;for(m=a.r1;m<=a.r2;m++)for(h=a.g1;h<=a.g2;h++)for(c=a.b1;c<=a.b2;c++)p+=d[t(m,h,c)]||0;a._count=p,a._count_set=!0}return a._count},copy:function(){var r=this;return new o(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(r){var a=this,d=a.histo;if(!a._avg||r){var m,h,c,p,f=0,x=0,b=0,j=0;if(a.r1===a.r2&&a.g1===a.g2&&a.b1===a.b2)a._avg=[a.r1<<3,a.g1<<3,a.b1<<3];else{for(h=a.r1;h<=a.r2;h++)for(c=a.g1;c<=a.g2;c++)for(p=a.b1;p<=a.b2;p++)f+=m=d[t(h,c,p)]||0,x+=m*(h+.5)*8,b+=m*(c+.5)*8,j+=m*(p+.5)*8;a._avg=f?[~~(x/f),~~(b/f),~~(j/f)]:[~~(8*(a.r1+a.r2+1)/2),~~(8*(a.g1+a.g2+1)/2),~~(8*(a.b1+a.b2+1)/2)]}}return a._avg},contains:function(r){var a=this,d=r[0]>>3;return gval=r[1]>>3,bval=r[2]>>3,d>=a.r1&&d<=a.r2&&gval>=a.g1&&gval<=a.g2&&bval>=a.b1&&bval<=a.b2}},u.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var a=this.vboxes,d=0;d<a.size();d++)if(a.peek(d).vbox.contains(r))return a.peek(d).color;return this.nearest(r)},nearest:function(r){for(var a,d,m,h=this.vboxes,c=0;c<h.size();c++)((d=Math.sqrt(Math.pow(r[0]-h.peek(c).color[0],2)+Math.pow(r[1]-h.peek(c).color[1],2)+Math.pow(r[2]-h.peek(c).color[2],2)))<a||a===void 0)&&(a=d,m=h.peek(c).color);return m},forcebw:function(){var r=this.vboxes;r.sort(function(h,c){return Ft(ks(h.color),ks(c.color))});var a=r[0].color;a[0]<5&&a[1]<5&&a[2]<5&&(r[0].color=[0,0,0]);var d=r.length-1,m=r[d].color;m[0]>251&&m[1]>251&&m[2]>251&&(r[d].color=[255,255,255])}},{quantize:function(r,a){if(!Number.isInteger(a)||a<1||a>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!r.length||a<2||a>256||!r.length||a<2||a>256)return!1;for(var d=[],m=new Set,h=0;h<r.length;h++){var c=r[h],p=c.join(",");m.has(p)||(m.add(p),d.push(c))}if(d.length<=a)return new Ea(d);var f=function(S){var $,L=new Array(32768);return S.forEach(function(I){$=t(I[0]>>3,I[1]>>3,I[2]>>3),L[$]=(L[$]||0)+1}),L}(r);f.forEach(function(){});var x=function(S,$){var L,I,P,R=1e6,T=0,U=1e6,q=0,G=1e6,E=0;return S.forEach(function(V){(L=V[0]>>3)<R?R=L:L>T&&(T=L),(I=V[1]>>3)<U?U=I:I>q&&(q=I),(P=V[2]>>3)<G?G=P:P>E&&(E=P)}),new o(R,T,U,q,G,E,$)}(r,f),b=new s(function(S,$){return Ft(S.count(),$.count())});function j(S,$){for(var L,I=S.size(),P=0;P<1e3;){if(I>=$||P++>1e3)return;if((L=S.pop()).count()){var R=l(f,L),T=R[0],U=R[1];if(!T)return;S.push(T),U&&(S.push(U),I++)}else S.push(L),P++}}b.push(x),j(b,.75*a);for(var F=new s(function(S,$){return Ft(S.count()*S.volume(),$.count()*$.volume())});b.size();)F.push(b.pop());j(F,a);for(var k=new u;F.size();)k.push(F.pop());return k}}}().quantize,qs=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};qs.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var rt=function(){};rt.prototype.getColor=function(t,s){return s===void 0&&(s=10),this.getPalette(t,5,s)[0]},rt.prototype.getPalette=function(t,s,o){var u=function(d){var m=d.colorCount,h=d.quality;if(m!==void 0&&Number.isInteger(m)){if(m===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");m=Math.max(m,2),m=Math.min(m,20)}else m=10;return(h===void 0||!Number.isInteger(h)||h<1)&&(h=10),{colorCount:m,quality:h}}({colorCount:s,quality:o}),l=new qs(t),r=function(d,m,h){for(var c,p,f,x,b,j=d,F=[],k=0;k<m;k+=h)p=j[0+(c=4*k)],f=j[c+1],x=j[c+2],((b=j[c+3])===void 0||b>=125)&&(p>250&&f>250&&x>250||F.push([p,f,x]));return F}(l.getImageData().data,l.width*l.height,u.quality),a=Ca(r,u.colorCount);return a?a.palette():null},rt.prototype.getColorFromUrl=function(t,s,o){var u=this,l=document.createElement("img");l.addEventListener("load",function(){var r=u.getPalette(l,5,o);s(r[0],t)}),l.src=t},rt.prototype.getImageData=function(t,s){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){if(this.status==200){var u=new Uint8Array(this.response);i=u.length;for(var l=new Array(i),r=0;r<u.length;r++)l[r]=String.fromCharCode(u[r]);var a=l.join(""),d=window.btoa(a);s("data:image/png;base64,"+d)}},o.send()},rt.prototype.getColorAsync=function(t,s,o){var u=this;this.getImageData(t,function(l){var r=document.createElement("img");r.addEventListener("load",function(){var a=u.getPalette(r,5,o);s(a[0],this)}),r.src=l})};const xt=({iconHovered:t,iconDefault:s,onClick:o=null,className:u="",id:l=""})=>{const[r,a]=n.useState(!1);return e.jsx("div",{style:o?{background:"rgba(0,0,0,0)"}:{},className:u,id:l,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:o,children:r?e.jsx(t,{}):e.jsx(s,{})})},$t=({context:t})=>{const{isPlaying:s,toggleTrackPaused:o,playNextSong:u,playPreviousSong:l}=re(),r=m=>{m.stopPropagation(),o()},a=m=>{m.stopPropagation(),u()},d=m=>{m.stopPropagation(),l()};return e.jsxs("div",{className:"audio-controls","data-mobile-context":t.mobile,children:[!t.mobile||t.maximize?e.jsx(xt,{iconHovered:vr,iconDefault:xr,onClick:d}):null,e.jsx(xt,{iconHovered:s?br:yr,iconDefault:s?jr:Zt,onClick:r}),e.jsx(xt,{iconHovered:kr,iconDefault:Nr,onClick:a})]})},Ws=n.memo(({index:t,style:s,data:o})=>{const{playQueue:u,cacheRef:l,jumpToQueueTrack:r,queuePointer:a}=o,d=u[t],[m,h]=n.useState(!!l.current[d]);let c=l.current[d];c||(c={title:"Loading...",cover:"loading"}),n.useEffect(()=>{m||(l.current[d]=c,fetch(`${N}/read-write/shortTrackInfos/${d}`,{credentials:"include"}).then(f=>f.json()).then(f=>{l.current[d]=f,h(!0)}))},[m,d]);const p={...s,width:"calc(100% - 15px)",height:"47.5px"};return e.jsxs("div",{className:"music-queue-entry",style:p,"is-passed":`${t<a}`,"is-selected":`${t===a}`,onClick:()=>r(t),children:[c.cover?e.jsx("img",{src:`${N}/covers/${c.cover}`,className:"track-image-small"}):e.jsx(te,{className:"track-image-small"}),e.jsx("p",{className:"track-title",children:c.title})]})},(t,s)=>t.data.playQueue[t.data.queuePointer]===s.data.playQueue[s.data.queuePointer]),Ra=50,Aa=0,Ss=n.memo(({title:t,radio:s,artist:o,artistId:u,isMinimal:l,fn:r})=>{console.log("radio",s);const a=me(),[d,m]=n.useState(!0);return n.useEffect(()=>{m(!0);const h=setTimeout(()=>m(!1),500);return()=>clearTimeout(h)},[t]),e.jsxs("div",{className:"mobile-view-track-artist",style:{"--item-align":l?"left":"center"},children:[e.jsx("span",{id:"songTitle","data-new":d,children:t}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{s||(r&&r(),a(`/artists/${u}`))},children:o})]})},(t,s)=>t.title===s.title&&t.artist===s.artist&&t.artistId===s.artistId&&t.radio===s.radio),Ia=()=>{var U;const{currentTrackData:t,trackCoverUrl:s,setTrackMobileView:o,toggleTrackFavorite:u,playQueue:l,jumpToQueueTrack:r,queuePointer:a,playLibraryShuffle:d,isPlaying:m}=re(),{addNotification:h}=Ie(),c=n.useRef(new Map),p=n.useRef(null),[f,x]=n.useState(!1),[b,j]=n.useState((t==null?void 0:t.isFav)||!1),F=n.useRef(null),k=n.useRef(0),S=n.useRef(0),$=n.useRef(null);n.useEffect(()=>{t&&j(t.isFav)},[t]);const L=async()=>{t&&u(t.id,!b,j)},I=()=>{o(!1)},P=q=>{k.current=q.touches[0].clientY,S.current=0,$.current&&(clearTimeout($.current),$.current=null),F.current.setAttribute("data-shift-back","false")},R=q=>{k.current&&F.current&&(q.preventDefault(),!(S.current<-40)&&(S.current=q.touches[0].clientY-k.current,F.current.style.translate=`0px ${S.current}px`))},T=q=>{(S.current||0)<90?(F.current.setAttribute("data-shift-back","true"),F.current.style.translate="0px 0px",$.current&&clearTimeout($.current),$.current=setTimeout(()=>{F.current.setAttribute("data-shift-back","false"),$.current=null},500)):(F.current.setAttribute("data-shift-back","true"),F.current.style.translate=`0px ${window.screen.height}px`,$.current&&clearTimeout($.current),$.current=setTimeout(()=>{F.current.setAttribute("data-shift-back","false"),$.current=null,I()},200))};return e.jsx("div",{id:"track-mobile-view",ref:F,onTouchStart:P,onTouchMove:R,onTouchEnd:T,children:e.jsxs("div",{id:"track-mobile-view-content",children:[e.jsxs("div",{id:"floating-audio-state","data-minimize":f,children:[e.jsx("div",{id:"track-mobile-down",onTouchEnd:I,children:e.jsx("div",{})}),(t==null?void 0:t.type)=="radio"?t.coverUrl==""?e.jsx(te,{className:"trackImage","data-playing":m}):e.jsx("img",{src:t.coverUrl,"data-playing":m,className:"trackImage"}):s.split("/").pop()==="null"?e.jsx(te,{className:"trackImage","data-playing":m}):e.jsx("img",{src:s,className:"trackImage","data-playing":m}),t?e.jsx(Ss,{title:t.title,artist:t.artist,artistId:t.artistId,radio:t.type==="radio",isMinimal:!0,fn:I}):null]}),f?l.length>0?e.jsx("div",{id:"music-queue",ref:p,children:e.jsx(Ae,{height:((U=p.current)==null?void 0:U.offsetHeight)||Aa,itemCount:l.length,itemSize:Ra,width:"100%",itemData:{playQueue:l,cacheRef:c,jumpToQueueTrack:r,queuePointer:a},children:Ws})}):e.jsx("p",{id:"no-items-in-queue",children:"No items in the queue"}):null,e.jsxs("div",{id:"fixed-audio-state",children:[t?e.jsx(Ss,{title:t.title,artist:t.artist,artistId:t.artistId,radio:t.type==="radio",isMinimal:!1,fn:I}):null,e.jsx(Qs,{}),e.jsx($t,{context:{mobile:!0,maximize:!0}}),e.jsxs("div",{className:"track-list-header",children:[l.length>0?e.jsx(se,{text:"",icon:b?e.jsx($s,{}):e.jsx(Ut,{}),onClick:L}):e.jsx(se,{text:"",icon:e.jsx(Sr,{}),onClick:d}),e.jsx(se,{text:"",icon:e.jsx(Os,{}),onClick:async()=>{x(!f)}})]})]})]})})},Ks=n.createContext(void 0),$e={TOP_QUEUE:"top_queue",END_QUEUE:"end_queue",TAGS:"tags",GOTO_ALBUM:"goto_album",REMOVE_FROM_PLAYLIST:"remove_from_playlist",ADD_TO_FAVORITES:"add_to_favs",REMOVE_FROM_FAVORITES:"remove_from_favs",NONE:"none"},Fa=()=>{const t=Ke(),s=n.useRef({pointer:0,history:new Array(6).fill(null)});return n.useEffect(()=>{const{pointer:o,history:u}=s.current,l=(o-1+u.length)%u.length;u[l]!==t.pathname&&(u[o]=t.pathname,s.current.pointer=(o+1)%u.length)},[t]),s.current},Pa=({children:t})=>{const[s,o]=n.useState(""),[u,l]=n.useState(!1),[r,a]=n.useState({}),[d,m]=n.useState(0),h=n.useRef(null),c=n.useRef(null),p=n.useRef(null),[f,x]=n.useState([]),[b,j]=n.useState("null"),F=g=>`${g}`!="null"?`${N}/read-write/music/${g}`:null,[k,S]=n.useState(-1),$=n.useRef(f),L=n.useRef(k),[I,P]=n.useState(null),[R,T]=n.useState(null),{emit:U,subscribe:q}=ge(),G=n.useRef(null),[E,V]=n.useState(null),B=n.useRef(null),{addNotification:W,notifTypes:X}=Ie(),Z=me(),[he,ie]=n.useState(null),[fe,de]=n.useState(null),[pe,Te]=n.useState(null),H=n.useRef("A"),D=n.useRef(null),[ae,be]=n.useState(5),[le,A]=n.useState(!1),[Q,y]=n.useState(()=>{const g=parseFloat(localStorage.getItem("volume"));return isNaN(g)?.5:Math.min(1,Math.max(0,g))}),[O,M]=n.useState(!1),[_,ee]=n.useState(!1),oe=n.useRef(null),ve=n.useRef(null),z=n.useRef(null),je=n.useRef(null),Ye=n.useRef(0),Ge=n.useRef(null),ue=n.useRef(null),St=n.useRef(0),ut=n.useRef(null),wt=n.useRef(0),Bt=n.useRef(0),De=5,Tt=n.useRef(""),is=n.useRef(null),ls=n.useRef(0),dt=n.useRef({lastAudioTime:0,lastPerformanceNow:0}),Xe=n.useRef(null),sn=.1,mt=n.useRef(!1),Gt=Ke(),Ze=n.useRef(""),nn=n.useRef([]),ht=n.useRef({track:"",pairs:[]}),us=n.useRef(null),Dt=Fa(),[Et,ds]=n.useState(!1),Vt=n.useRef(null),Ht=n.useRef(null),rn=()=>{var g,v,w,C,K,Y,ne,ye;c.current=new Audio,c.current.setAttribute("source","A"),c.current.addEventListener("error",Ne=>{if(c.current.src.includes("spoof"))return;const ke=c.current.error;if(ke&&(console.warn("Audio error occurred: code",ke.code),ke.code===4&&s)){const Ve=`${N}/radio/spoof/${encodeURIComponent(c.current.src)}`;c.current.src=Ve,W("Audio stream not reachable from browser. Streaming from backend..",X.INFO),l(!0),c.current.play();const He=new EventSource(`${N}/radio/trackStream/${encodeURIComponent(c.current.src)}`);He.onmessage=Ee=>{console.log(Ee);const Ce=JSON.parse(Ee.data);console.log("Now playing:",Ce.metadata.StreamTitle);const Le=Ce.metadata.adw_ad=="true"?`Advertisment - ${(Number(Ce.metadata.durationMilliseconds)/1e3).toFixed(1)}s`:Ce.metadata.StreamTitle;a(ze=>({...ze,title:Le}))},He.addEventListener("error",Ee=>{console.warn("Metadata stream error",Ee)})}}),c.current.addEventListener("canplay",()=>{console.log("Stream is playable!")}),p.current=new Audio,p.current.setAttribute("source","B");for(const Ne of[c,p])Ne.current.crossOrigin="anonymous",Ne.current.playsInline=!0,Ne.current.setAttribute("webkit-playsinline",""),Ne.current.volume=parseFloat(localStorage.getItem("volume"))*.75||.5;(g=c.current)==null||g.addEventListener("timeupdate",Rt),(v=p.current)==null||v.addEventListener("timeupdate",Rt),(w=c.current)==null||w.addEventListener("playing",Ct),(C=p.current)==null||C.addEventListener("playing",Ct),(K=c.current)==null||K.addEventListener("play",et),(Y=c.current)==null||Y.addEventListener("pause",hs),(ne=p.current)==null||ne.addEventListener("play",et),(ye=p.current)==null||ye.addEventListener("pause",hs),zt(),console.log("Audio graph setted up")},an=()=>{var g,v,w,C,K,Y,ne,ye,Ne,ke,Ve,He,Ee,Ce,Le,ze;console.log("Audio graph destructed"),(g=c.current)==null||g.pause(),c.current=null,(v=p.current)==null||v.pause(),p.current=null,(w=c.current)==null||w.removeEventListener("timeupdate",Fe),(C=c.current)==null||C.removeEventListener("ended",Pe),(K=c.current)==null||K.removeEventListener("error"),(Y=c.current)==null||Y.removeEventListener("canplay"),(ne=p.current)==null||ne.removeEventListener("timeupdate",Fe),(ye=p.current)==null||ye.removeEventListener("ended",Pe),(Ne=c.current)==null||Ne.removeEventListener("timeupdate",Rt),(ke=p.current)==null||ke.removeEventListener("timeupdate",Rt),(Ve=c.current)==null||Ve.removeEventListener("playing",Ct),(He=p.current)==null||He.removeEventListener("playing",Ct),(Ee=c.current)==null||Ee.removeEventListener("play",et),(Ce=c.current)==null||Ce.removeEventListener("pause",et),(Le=p.current)==null||Le.removeEventListener("play",et),(ze=p.current)==null||ze.removeEventListener("pause",et)},zt=()=>{var g,v;(g=c.current)==null||g.pause(),c.current.src=null,c.current.currentTime=0,(v=p.current)==null||v.pause(),p.current.src=null,p.current.currentTime=0,h.current=null,H.current="A",c.current.removeEventListener("timeupdate",Fe),c.current.removeEventListener("ended",Pe),p.current.removeEventListener("timeupdate",Fe),p.current.removeEventListener("ended",Pe)},Ct=()=>{ue.current&&(console.log("Record start playing",h.current.currentTime),dt.current.lastAudioTime=h.current.currentTime,dt.current.lastPerformanceNow=performance.now())},ms=()=>{const g=h.current;!g||g.paused||Math.abs(g.currentTime-xs())>sn&&gs()},on=()=>(setTimeout(ms,200),setInterval(ms,5e3)),et=()=>{ue.current&&(gs(),Xe.current&&clearInterval(Xe.current),Xe.current=on())},hs=()=>{Xe.current&&(clearInterval(Xe.current),Xe.current=null)},Rt=()=>{if(!ue.current||!h.current)return;const g=h.current.currentTime;if(Math.abs(g-ls.current)>1){const v=Math.round(1/ue.current.interval),w=De*v,C=Math.floor(g*v);console.log("Seeking chunk",C,w,v,De),St.current=0,Bt.current=C,ps(Tt.current,C,C+w)}else ln(Tt.current,g);ls.current=g};n.useEffect(()=>{r&&r.type!=="radio"&&At()},[r]);const At=()=>{const g=f.length<=k+1;D.current&&clearTimeout(D.current),!(g||!h.current)&&(console.log("Transition rescheduled, timesout in ",r.rawDuration,h.current.currentTime,ae,r.rawDuration-h.current.currentTime-ae),D.current=setTimeout(()=>{H.current=H.current==="A"?"B":"A",fs(k+1)},Math.min(r.rawDuration-h.current.currentTime-ae)*1e3,0))},fs=async g=>{const v=f.length<=g;if(S(g),h.current=H.current==="A"?c.current:p.current,f[g].startsWith("radio-")){let C={};if(f[g].startsWith("radio-id")){const Y=f[g].split("radio-id:")[1];C=await fetch(`${N}/radio/${Y}`).then(ne=>ne.json()),console.log(C),Ge.current=null,a({type:"radio",artist:C.name,...C,duration:"0-",uuid:Y})}else{C.url=f[g].split("radio-url:")[1],console.log(Ge.current);const{name:Y,...ne}=Ge.current,ye={artist:Y,...ne};a({type:"radio",...ye,duration:"0-"})}h.current.src=C.url;const K=new EventSource(`${N}/radio/trackStream/${encodeURIComponent(C.url)}`);K.onmessage=Y=>{console.log(Y);const ne=JSON.parse(Y.data);console.log("Now playing:",ne.metadata.StreamTitle),a(ye=>({...ye,title:ne.metadata.StreamTitle}))},o(""),K.addEventListener("error",Y=>{console.warn("Metadata stream error",Y)}),vs(),p.current.removeEventListener("timeupdate",Fe),p.current.removeEventListener("ended",Pe),l(!0),h.current.play();return}Ge.current=null;const w=f[g];if(await fetch(`${N}/read-write/trackInfos/${w}`,{method:"GET"}).then(C=>C.json()).then(C=>{C.duration=ns(C.rawDuration),a(C)}),h.current.currentTime=0,await fetch(`${N}/read-write/fftConfig/${w}`,{method:"GET",credentials:"include"}).then(async C=>{if(St.current=0,Bt.current=0,wt.current=0,!C.ok){ue.current=null;return}const K=await C.json();ue.current=JSON.parse(K),console.log(ue.current);const Y=ue.current.fftSize*1,ne=De/ue.current.interval;ut.current=new Int16Array(ne*Y),console.log("New buffer!")}),h.current.src!==F(w))h.current.src=F(w);else{m(0);return}h.current.play(),clearTimeout(z.current),o(w),Tt.current=w,l(!0),kn(w),console.log("Fading in",h.current),H.current==="A"?(v?It(p,null):(It(p,c),c.current.addEventListener("timeupdate",Fe),c.current.addEventListener("ended",Pe)),p.current.removeEventListener("timeupdate",Fe),p.current.removeEventListener("ended",Pe)):H.current==="B"&&(v?It(c,null):(It(c,p),p.current.addEventListener("timeupdate",Fe),p.current.addEventListener("ended",Pe)),c.current.removeEventListener("timeupdate",Fe),c.current.removeEventListener("ended",Pe))},ps=async(g,v,w)=>{if(!ue.current)return ut.current=null,null;const C=ue.current.fftSize*1*2,K=C*v,Y=C*w,ne=await fetch(`${N}/read-write/fft/${g}`,{headers:{Range:`bytes=${K}-${Y-1}`}});if(!ne.ok&&ne.status!==206){console.error("Failed to stream FFT data");return}wt.current=Math.floor(w);const ye=await ne.arrayBuffer(),Ne=new Int16Array(ye),ke=ue.current.fftSize*1,Ve=Ne.length/ke,He=ue.current.interval,Ee=De/He;let Ce=St.current;for(let Le=0;Le<Ve;Le++){const ze=Le*ke,rr=(Ce+Le)%Ee;ut.current.set(Ne.subarray(ze,ze+ke),rr*ke)}St.current=(Ce+Ve)%Ee},gs=()=>{dt.current.lastAudioTime=h.current.currentTime,dt.current.lastPerformanceNow=performance.now()},cn=()=>{const{lastAudioTime:g,lastPerformanceNow:v}=dt.current,w=(performance.now()-v)/1e3;return g+w},xs=()=>h.current.paused?h.current.currentTime:cn(),ln=(g,v)=>{const w=Math.round(1/ue.current.interval),C=Math.floor(v*w),K=Math.floor(wt.current)-C,Y=w*De;Y-K<1||ps(g,Math.floor(wt.current),Y+C)},un=()=>{const g=Math.round(1/ue.current.interval),w=Math.floor(xs()*g)-Bt.current,C=De*g;return w%C},dn=()=>{if(!ue.current||!ut.current)return null;const g=ue.current.fftSize*1,v=un();if(v===null)return null;const C=Math.floor(De/ue.current.interval)*g,K=v*g,Y=K+g;return Y>C?null:ut.current.slice(K,Y)},vs=()=>{z!=null&&z.current&&clearInterval(z.current)};n.useEffect(()=>{console.log("Changed inteval ref:",z.current)},[z.current]);const It=(g,v)=>{z.current&&clearInterval(z.current);const w=150;let C=0;console.log("Init fadeout for:",v.current),z.current=setInterval(()=>{const K=Math.min(1,Math.max(0,C*w/(ae*1e3)));v.current.volume=K*Ye.current,g.current&&(g.current.volume=(1-K)*Ye.current),K>=1&&(clearInterval(z.current),z.current=null,v.current&&(g.current.pause(),g.current.src=null)),C++},w)},Fe=()=>{var g;return m((g=h.current)==null?void 0:g.currentTime)},Pe=()=>{f.length>0&&f.length<=k+1&&qt()};n.useEffect(()=>{!le||k===-1||f.length===0||(zt(),console.log("init Autoplay",f,k,le,c.current,p.current),fs(k),A(!1))},[f,k,le]),n.useEffect(()=>{L.current=k},[k]),n.useEffect(()=>{$.current=f},[f]);const mn=()=>{var g,v;if(!h.current&&$.current.length>0){S(0),A(!0);return}if(u)(g=h.current)==null||g.pause(),l(!1),clearTimeout(D.current),clearInterval(z.current);else{if(l(!0),k===-1&&f.length!==0){S(0);return}(v=h.current)==null||v.play(),At()}},hn=(g,v=!1)=>{fetch(`${N}/read-write/nextSongs/${he.type}/${he.id}/${v}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{x(w),console.log(w),S(w.findIndex(C=>C===g)),A(!0)})},fn=g=>{x([g]),S(0),A(!0)},pn=()=>{if(h.current.currentTime>5||k===0){h.current.currentTime=0,At();return}S(k-1),A(!0)},gn=(g,v,w=!1)=>{A(!1),fetch(`${N}/read-write/nextSongs/${v}/${g}/${w}`,{method:"GET",credentials:"include"}).then(C=>C.json()).then(C=>{x(C),S(0),A(!0)})},xn=(g,v,w=!1)=>{A(!1),fetch(`${N}/read-write/nextSongs/${v}/${g}/${w}`,{method:"GET",credentials:"include"}).then(C=>C.json()).then(C=>{x(K=>[...K,...C]),W("Queued!",X.QUEUE)})},vn=(g,v,w=!1)=>{console.log(`${N}/read-write/nextSongs/${v}/${g}/${w}`),fetch(`${N}/read-write/nextSongs/${v}/${g}/${w}`,{method:"GET",credentials:"include"}).then(C=>C.json()).then(C=>{x(gt.shuffle(C)),A(!0),S(0)})},jn=(g=!1)=>{const v=g?$.current:f,w=g?L.current:k;v.length<=w+1&&(qt(),console.log("stop")),S(w+1),A(!0)},qt=()=>{zt(),m(0),l(!1),a(null),A(!1),S(-1),j("null"),x([]),o(""),Tt.current="",console.log("No more songs in the queue"),clearInterval(z.current),clearTimeout(D.current),vs()},bn=g=>{if(g<0||g>100)return;const v=g/100*h.current.duration;h.current.currentTime=v,m(v),At()},yn=g=>{h.current.currentTime+g>h.current.duration?h.current.currentTime=h.current.duration:h.current.currentTime+g<0?h.current.currentTime=0:h.current.currentTime+=g,m(h.current.currentTime)},Nn=g=>{g<0||g>=f.length||(A(!0),S(g))},kn=g=>{fetch(`${N}/read-write/trackCover/${g}`,{method:"GET"}).then(v=>v.json()).then(v=>{j(`${N}/covers/${v}`)})},Sn=()=>{qt(),x([]),S(-1)},Wt=()=>{fetch(`${N}/config/user/FFT`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{is.current=g})};n.useEffect(()=>{y(parseFloat(localStorage.getItem("volume"))||.5),rn(),Gt.pathname==="/full-screen"&&(Ze.current="",mt.current=!0),Wt();const g=q("login",Wt);return()=>{an(),g()}},[]);const wn=async g=>{const v=await fetch(`${N}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!v.ok)throw new Error("Network response was not ok");const C=(await v.json()).map(K=>K.id);x(K=>[...K,...C])},Tn=async g=>{const v=await fetch(`${N}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!v.ok)throw new Error("Network response was not ok");const C=(await v.json()).map(K=>K.id);x(gt.shuffle(C)),A(!0),S(0)},En=async()=>{fetch(`${N}/read-write/all-songs`,{method:"GET"}).then(g=>g.json()).then(g=>{x(gt.shuffle(g)),A(!0),S(0),W("Playing the library in shuffle",X.INFO)})},Cn=g=>{console.log("Editing album",g),fetch(`${N}/read-write/album/${g}`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{const{albumInfos:w,genres:C,tracks:K,artists:Y}=v;P({id:g,coverURL:`${N}/covers/${w.cover}`,tracks:K,type:"album",name:w.title,artist:Y.map(ne=>ne.name),year:w.release_date,description:w.description,genre:C.map(ne=>ne.genreName)})})},Rn=g=>{fetch(`${N}/read-write/playlist/${g}/true`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{const{playlistInfos:w,collaborators:C}=v;P({id:w.id,type:"playlist",coverURL:`${N}/covers/${w.cover}`,name:w.title,description:w.description,collaborators:C})})};n.useEffect(()=>{const g=Math.min(1,Math.max(0,Q));z.current||An(g.toFixed(4)*.75),Ye.current=g.toFixed(4)*.75,localStorage.setItem("volume",g)},[Q]);const An=g=>{je.current&&clearInterval(je.current);let v=0;const w=16,C=c.current.volume;je.current=setInterval(()=>{const K=We(C,g,v*w/300);c.current.volume=K,p.current.volume=K,(g-C>0?K>=g:K<=g)&&(clearInterval(je.current),je.current=null),v++},w)},In=(g,v=null)=>{if(!g){console.log("No changes made"),T(null);return}const w=new FormData;w.append("artist",JSON.stringify(g)),v&&w.append("coverArtist",v),fetch(`${N}/read-write/editContainer/artist`,{method:"POST",credentials:"include",body:w}).then(()=>{T(null),G.current()})},Fn=g=>{fetch(`${N}/read-write/artist/${g}/true`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{T({id:v.id,picture:`${N}/covers/artists/${v.picture}`,name:v.name,bio:v.bio,active_from:v.active_from})})},js=(g,v=null)=>{if(!g){console.log("No changes made"),P(null);return}const w=new FormData;w.append(`${g.type}`,JSON.stringify(g)),v&&w.append("cover",v),fetch(`${N}/read-write/editContainer/${g.type}`,{method:"POST",credentials:"include",body:w}).then(()=>{P(null),G.current()})},Pn=async(g,v)=>{const w=g?"/forMe":"";(await fetch(`${N}/read-write/delete/album/${v.id}${w}`,{method:"DELETE",credentials:"include"}).then(K=>K.json())).success&&(W(`Album ${v.name} deleted.`,X.SUCCESS),P(null),Z("/home"))},Ln=async()=>{M(!0)},$n=(g,v)=>{console.log("sending playlist",g);const w=new FormData;w.append("playlist",JSON.stringify(g)),v&&(w.append("cover",v),console.log(v)),fetch(`${N}/read-write/newPlaylist`,{method:"POST",credentials:"include",body:w}).then(()=>{M(!1),oe.current()})},On=g=>{S(0),x([g]),A(!0)},Mn=()=>{M(!1)},Un=(g,v,w,C)=>{V({track:v,position:g}),B.current&&B.current(),B.current=w,ve.current=C},_n=()=>{V(null),B.current&&B.current()},Bn=(g,v,w=null)=>{switch(_n(),g){case $e.NONE:return;case $e.TOP_QUEUE:Dn(v);break;case $e.END_QUEUE:Vn(v);break;case $e.GOTO_ALBUM:Gn(v);break;case $e.REMOVE_FROM_PLAYLIST:Hn(v);break;case $e.TAGS:de(v),W("Avaliable soon :)",X.INFO);break;case $e.ADD_TO_FAVORITES:Kt(v.id,!0,ve.current);break;case $e.REMOVE_FROM_FAVORITES:Kt(v.id,!0,ve.current);break}},Gn=g=>{fetch(`${N}/read-write/trackAlbumId/${g.id}`,{method:"GET"}).then(v=>v.json()).then(v=>{Z(`albums/${v}`)})},Dn=g=>{const v=f;v.splice(k+1,0,g.id),x(v),W(`${g.title} playing next.`,X.SUCCESS)},Vn=g=>{const v=f;v.push(g.id),x(v),W(`${g.title} playing at the end.`,X.INFO)},Hn=g=>{fetch(`${N}/read-write/deleteTrackFromPlaylist/${he.id}/${g.id}`,{method:"DELETE",credentials:"include"}).then(v=>v.json()).then(v=>{G.current(),W(`${g.title} removed.`,X.SUCCESS)})},zn=(g,v)=>{G.current=v,ie(g)},qn=(g,v)=>{if(de(null),!g)return;const w=new FormData;w.append("current",JSON.stringify(g.current)),w.append("deleted",JSON.stringify(g.deleted)),fetch(`${N}/read-write/changeTrackTags/${v}`,{method:"POST",credentials:"include",body:w}).then(C=>C.json()).then(C=>{W("Tags upated!",X.SUCCESS)})},Wn=async(g=[],v)=>{g.length!==0&&(x(g),S(v||0),A(!0))},Kn=()=>{ee(!0)},Qn=()=>{ee(!1)},Jn=()=>{mt.current=!mt.current,mt.current&&(Ze.current=Gt.pathname),console.log(Ze.current),Z(mt.current?"/full-screen":Ze.current&&Ze.current!=="/full-screen"?Ze.current:"/home")},Yn=()=>new Promise(g=>{fetch(`${N}/read-write/getSongMetaDataCover/${s}`,{method:"GET",credentials:"include"}).then(v=>v.blob()).then(v=>{us.current={track:s,blob:v},g({track:s,blob:v})})}),Xn=g=>{h.current&&(h.current.currentTime+=(g?1:-1)*10)},Zn=()=>{const{history:g,pointer:v}=Dt;if(g.every(Y=>Y===null)){Z("/home");return}let w=(v-2+g.length)%g.length,C=g[w],K=0;for(;(!C||C==="/full-screen")&&K<g.length||C===Gt.pathname;)w=(w-1+g.length)%g.length,C=g[w],K++;Dt.pointer=w,Z(C||"/home")},er=()=>{(r==null?void 0:r.type)==="radio"&&fetch(`${N}/radio/addToFavs/${r.uuid}`,{method:"POST",credentials:"include"}).then(async g=>({json:await g.json(),ok:g.ok})).then(g=>{W(g.json.message,X.INFO),console.log(g),g.ok&&U("refetch-known-radios")}).catch(g=>{W("An error occured, you may check server logs."+g.code,X.ERROR)})},tr=(g,v)=>{var K,Y;if(((K=ht.current)==null?void 0:K.track)===s&&((Y=ht.current)==null?void 0:Y.pairs.length)>0){v();return}const C=new rt().getPalette(g.current,10);sr(C),console.log("recomputed"),console.log(ht.current),v()},sr=g=>{const v=[];for(let w=0;w<g.length;w++)for(let C=w+1;C<g.length;C++)v.push({c1:g[w],c2:g[C],contrast:va(g[w],g[C])});ht.current={track:s,pairs:v.sort((w,C)=>w.contrast-C.contrast)}},nr=()=>{window.screen.width<714&&ds(!0)};n.useEffect(()=>{Vt.current&&Ht.current&&(Vt.current.style.display=Et?"none":"flex",Ht.current.style.display=Et?"none":"flex")},[Et]);const Kt=async(g,v,w)=>{fetch(`${N}/read-write/toggleFavorite/${g}/${v}`,{method:"GET",credentials:"include"}).then(C=>C.json()).then(C=>{w(C),console.log(r.id,g),r.id===g&&(r.isFav=C)})};return e.jsxs(Ks.Provider,{value:{currentDisplayedPage:Ht,mobileMusicPlayRef:Vt,toggleTrackFavorite:Kt,setTrackMobileView:ds,openTrackMobileView:nr,recomputeColors:tr,songPalette:ht,skipAudioSeconds:Xn,toggleCurrentRadioToFavorites:er,externalRadioInfos:Ge,playRadio:On,navigateBack:Zn,history:Dt,colorOverride:nn,requestNewFullScreenImage:Yn,fullScreenImage:us.current,toggleFullScreenView:Jn,fetchFFTUserSettings:Wt,FFTUserSetingsRef:is,fftConfigRef:ue,getFFTAtCurrentTime:dn,deleteAlbum:Pn,editArtist:Fn,playContainer:gn,closeTagWindow:Qn,openTagWindow:Kn,saladContext:pe,setSaladContext:Te,playAudioSalad:Wn,linkNewContainer:zn,trackActionTypes:$e,onClicTrackActionEntry:Bn,openTrackActions:Un,getNextSongsFromAlbum:hn,currentTrackData:r,currentTime:d,isPlaying:u,toggleTrackPaused:mn,playNextSong:jn,trackCoverUrl:b,playPreviousSong:pn,playingTrack:s,jumpTrackSeconds:yn,jumpToPercent:bn,addContainerToQueue:xn,playContainerSuffle:vn,playQueue:f,queuePointer:k,jumpToQueueTrack:Nn,deleteQueue:Sn,addArtistToQueue:wn,shuffleArtistToQueue:Tn,playTrackNoQueue:fn,playLibraryShuffle:En,setVolume:y,volume:Q,editAlbum:Cn,editPlaylist:Rn,createNewPlaylist:Ln,globalAudioRef:h,setPlaylistAddedCallback:g=>{oe.current=g}},children:[t,I?I.type==="album"?e.jsx(ya,{applyCanges:js,albumClass:I}):I.type==="playlist"?e.jsx(Ns,{editPlaylistClass:I,applyCanges:js}):null:null,R&&e.jsx(Ta,{applyChanges:In,artist:R}),O&&e.jsx(Ns,{closeOverlay:Mn,applyCanges:$n}),E?e.jsx(ka,{isFav:he.favPlaylist,trackY:E.position.y,track:E.track}):null,fe&&e.jsx(Sa,{apply:qn,track:fe}),_&&e.jsx(wa,{}),Et&&e.jsx(Ia,{})]})},re=()=>{const t=n.useContext(Ks);if(t===void 0)throw new Error("useAudioPlayer must be used within an AudioPlayerProvider");return t},lt=n.memo(({percent:t,text:s=null,showPercent:o=!1,isMarquee:u=!1,fillColor:l="#fffdff",style:r={},initialising:a=!1,initialisingColor:d="white",onClickPercentage:m=null,minWidth:h=0})=>{const c=n.useRef(null),p=f=>{if(a||!m)return;const x=f.currentTarget,b=x.getBoundingClientRect().x,j=f.clientX;m((j-b)/x.clientWidth*100)};return n.useEffect(()=>{c.current&&c.current.style.setProperty("--progress",`${t}%`)},[t]),e.jsxs("div",{className:"progressBar",style:{...r,minWidth:h},onClick:p,children:[e.jsx("div",{className:"progressFill",ref:c,style:{background:l,...r}}),a&&e.jsx("div",{className:"progressFill",init:"init",style:{backgroundColor:d,opacity:.5,...r}}),o&&e.jsx("span",{className:"progressPercent",children:t+"%"}),s&&e.jsx("span",{className:"progressPercent",style:{margin:"auto"},children:s})]})},(t,s)=>t.text===s.text&&t.initialising===s.initialising&&t.percent===s.percent),Qs=({})=>{const{currentTrackData:t,currentTime:s,jumpToPercent:o}=re();return!t||Object.keys(t).length===0?null:e.jsx("div",{className:"songProgress",children:e.jsxs("div",{children:[e.jsx("span",{id:"time-elapsed",children:ns(s).readable}),e.jsx(lt,{percent:s/t.rawDuration*100,showPercent:!1,fillColor:"var(--violet-web-color)",style:{height:"10px"},onClickPercentage:o}),e.jsx("span",{id:"time-remaining",children:t.duration.readable})]})})},La=n.memo(({id:t,isActive:s,setActive:o,contextName:u})=>e.jsx("div",{className:"index",id:`${u}-index_${t}`,onClick:()=>o(t),"data-active":s?"active":"","data-clickable":!!o}),(t,s)=>t.id===s.id&&t.isActive===s.isActive&&t.contextName===s.contextName),rs=({context:t,active:s,setActive:o})=>e.jsx("div",{className:`activeIndex-container ${t.name}`,children:Array.from({length:t.length},(u,l)=>e.jsx(La,{id:l,isActive:s===l,setActive:o,contextName:t.name},l))}),Js=n.memo(function({currentActive:s,onClick:o,data:u}){const[l,r]=n.useState(s);n.useEffect(()=>{r(s)},[s]);const a=d=>{r(d),o==null||o(d)};return e.jsx("div",{className:"job-view-div",children:u.map((d,m)=>e.jsx("div",{className:"cornered-button","data-active":l===m,onClick:()=>{a(m)},children:d},m))})}),$a=({fromFile:t,setFromFile:s,tracksSelected:o,initMetadataFetching:u})=>{const[l,r]=n.useState(!1),[a,d]=n.useState(""),m=c=>{r(!0),c.target.files&&(console.log("New tracks"),o(Array.from(c.target.files)),c.target.files=null)},h=c=>{d(c.target.value)};return e.jsxs("div",{className:"addMusicSource",children:[e.jsxs("div",{className:"add-audio-source-selection",children:[e.jsx("p",{children:"Select the source: "}),e.jsx(Js,{currentActive:t?0:1,onClick:c=>{s(c==0)},data:["From file","From URL"]})]}),t?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Select files from a local storage."}),e.jsxs("div",{className:"add-music-input",children:[e.jsxs("label",{htmlFor:"files",className:"file-select",children:[e.jsx(wr,{}),e.jsx("span",{children:"Select file"})]}),e.jsx("input",{id:"files",multiple:!0,type:"file",accept:"audio/*",onChange:m})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Link to a radio steam."}),e.jsxs("div",{className:"add-music-input",children:[e.jsx("input",{type:"text",placeholder:"Enter URL",onChange:h}),e.jsx(se,{onClick:async()=>{u(a)},text:"Resolve",icon:e.jsx(Tr,{})})]})]}),l&&e.jsx("p",{children:"Hold a sec'.. The metadata fetch is about to beggin."})]})},bt=({text:t,progressBar:s={useProgressBar:!1}})=>e.jsxs("div",{className:"loading-container",children:[e.jsx("h3",{children:t}),s.useProgressBar?e.jsx(lt,{percent:s.percent,showPercent:s.showPercent,isMarquee:s.isMarquee,fillColor:s.fillColor,style:{height:"25px"}}):e.jsx("p",{children:"Loading..."})]}),Oa=({addNewMusic:t})=>e.jsx("div",{className:"album-card",context:"add",children:e.jsx(Er,{strokeWidth:.7,className:"album-card-cover",onClick:t})}),Ma=({album:t,deleteAlbum:s,editAlbum:o})=>e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(ct,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t.uuid)}),e.jsx(Ls,{className:"album-card-overview-button",use:"edit",onClick:()=>o(t.uuid)}),e.jsxs("div",{className:"album-card-overview-button",use:"song-count",children:[e.jsx(Cr,{className:"song-count-icon"}),e.jsx("span",{children:t.tracks.length})]}),e.jsx("img",{src:t.coverURL,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Be(t.name,25)}),e.jsx("p",{className:"album-artist",children:Be(t.artist.join(","),25)||"No artist"})]}),Ua=({radio:t,deleteRadio:s})=>(console.log(t),e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(ct,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t[0])}),e.jsx("img",{src:t[1].favicon==""?null:t[1].favicon,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Be(t[1].name,25)})]})),_a=({albums:t,radios:s,deleteRadio:o,addNewMusic:u,deleteAlbum:l,editAlbum:r,publish:a})=>{const d=t.map((c,p)=>e.jsx(Ma,{album:c,deleteAlbum:l,editAlbum:r},`alb-${p}`)),m=[...s].map((c,p)=>e.jsx(Ua,{radio:c,deleteRadio:o},`rad-${p}`)),h=[...d,...m];return console.log("rerun"),h.push(e.jsx(Oa,{addNewMusic:u},-1)),e.jsxs("div",{className:"albums-overview",children:[e.jsx("div",{className:"album-overview-container",children:h.reverse()}),(t.length>0||s.size>0)&&e.jsx("button",{className:"roundButton",id:"publish-to-library",onClick:a,children:"Publish to library"})]})},Ba=({track:t,onClose:s})=>{const{albums:o,moveTrackToNewAlbum:u,moveTrackToAlbum:l,editingAlbum:r,setEditingAlbum:a}=Ha(),[d,m]=n.useState(""),[h,c]=n.useState(!1),p=n.useRef(null),f=b=>{b.preventDefault(),!d&&b.target.existingAlbum.value?l(t,b.target.existingAlbum.value):d!==""&&u(t,d),h&&a(null),s()},x=b=>{m(b.target.value)};return n.useEffect(()=>{o.find(({uuid:j})=>j===r).tracks.length===1?c(!0):c(!1);const b=j=>{var F;if(p.current&&!p.current.contains(j.target)){if(((F=j.target.closest("svg"))==null?void 0:F.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",b),document.addEventListener("touchstart",b),()=>{document.removeEventListener("mousedown",b),document.removeEventListener("touchstart",b)}},[]),e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:p,children:[e.jsx("h2",{children:"Move track to another album"}),h&&e.jsx("p",{className:"last-track-notify",children:"Last track of the album, if you move it, the current album will be deleted."}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:f,children:[e.jsx("label",{htmlFor:"newAlbum",children:"New album name"}),e.jsx("input",{type:"text",id:"newAlbum",placeholder:"Enter album name",onChange:x}),e.jsx("label",{htmlFor:"existingAlbum",children:"Existing album"}),e.jsx("select",{id:"existingAlbum",onChange:()=>m(""),children:o.map((b,j)=>b.uuid===r?null:e.jsx("option",{value:b.uuid,children:b.name},j))}),e.jsx("input",{type:"submit",value:"Submit"})]})]})})},Ga=({setEditUid:t,albumClass:s})=>{var c,p;const[o,u]=n.useState({visible:!1,track:null}),[l,r]=n.useState(null),a=n.useRef(null);if(!s)return null;n.useEffect(()=>{s&&r(s.coverURL)},[s]);const d=()=>{const f=a.current;s.name=f.albumName.value,s.artist=f.artistName.value.split(",").map(b=>b.trim()),s.year=f.releaseDate.value;const x=f.genre.value.split(",").map(b=>b.trim()).map(b=>b.charAt(0).toUpperCase()+b.slice(1));s.genre=x.filter(b=>b!=""),s.description=f.description.value,t(null)},m=f=>{const x=f.target.files[0];x&&r(s.setCoverFromFile(x))},h=f=>{u({visible:!o.visible,track:f})};return e.jsxs("div",{className:"albumWrapping",children:[e.jsxs("div",{className:"albumCover",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(te,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(yt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:m})]}),e.jsx("button",{className:"roundButton go-back",onClick:()=>d(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",ref:a,children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(c=s.artist)==null?void 0:c.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",defaultValue:s.year})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(p=s.genre)==null?void 0:p.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Ae,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:f,style:x})=>e.jsxs("div",{style:x,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[f].title}),e.jsx(As,{className:"trackIcon",onClick:()=>{h(s.tracks[f])}})]},f)})})]}),o.visible&&e.jsx(Ba,{onClose:()=>{u({visible:!1})},track:o.track})]})};class ws{constructor(s,o,u,l,r){this.name=s,this.artist=o,this.year=u,this.tracks=[],this.setCover(l),this.uuid=r}setCover(s){!s||this.coverURL||(this.coverData=s.data,this.coverMime=s.format,this.coverURL=URL.createObjectURL(new Blob([this.coverData],{type:this.coverMime})),this.ext=this.coverMime.split("/")[1],this.sourceIsBinary=!0)}setCoverFromFile(s){return this.coverURL=URL.createObjectURL(s),this.coverFile=s,console.log("Setting cover from file: ",s),this.ext=s.type.split("/")[1],this.coverURL}addTrack(s){s&&(this.tracks.push(s),s.album=this)}removeTrack(s){s&&(this.tracks=this.tracks.filter(o=>o.id!==s.id),s.album=null)}getPuredData(){return{name:this.name,artists:this.artist,year:this.year,uuid:this.uuid,ext:this.ext}}getPuredCover(){if(!this.sourceIsBinary)return this.coverFile?(console.log("Using file reference for cover: "+album.coverFile),this.coverFile):null;if(console.log("Using binary reference for cover: ",this.uuid),!this.coverData||this.coverData.length===0)return console.log("returned no cover at",this.uuid),null;const s=new Uint8Array(this.coverData),o=new Blob([s],{type:this.coverMime});return new File([o],`${this.uuid}.${this.coverMime.split("/").pop()}`,{type:this.coverMime})}}class Da{constructor(s){this.id=jt(),this.file=s,this.album=null,this.albumName="",this.artists=[],this.title=s.name,this.no=1,this.duration=0,this.year=2003,this.picture=null}setPicture(s){this.picture=s}setAdditionalData(s="",o="",u=1,l=0,r=2e3,a=[]){this.title=o,this.no=u,this.duration=l,this.year=r,this.artists=a,this.albumName=s}setAlbum(s){this.album=s}getUrl(){return URL.createObjectURL(this.file)}getArtists(){return this.artists?this.artists.map(s=>s.trim()):["Unknown artist"]}getPuredTrackMeta(){return{albumUuid:this.album.uuid,duration:this.duration,no:this.no,year:this.year,title:this.title,id:this.id}}}const Ys=n.createContext(),Va=({closeOverlay:t,uploadPercent:s,uploadProgress:o,uploadFinished:u,isMinimize:l,setMinimized:r})=>{const[a,d]=n.useState(!0),[m,h]=n.useState(0),[c,p]=n.useState(0),[f,x]=n.useState(0),[b,j]=n.useState([]),[F,k]=n.useState(!1),[S,$]=n.useState(null),[L,I]=n.useState(0),[P,R]=n.useState(0),[T,U]=n.useState(""),{addNotification:q,notifTypes:G}=Ie(),[E,V]=n.useState(new Map),B=n.useRef([]),W=n.useRef([]),{emit:X}=ge(),Z=n.useRef(null),he=async y=>{if(y.length===0)return;x(y.length);const O=y.map(M=>new Da(M));Z.current=O,ie()},ie=async()=>{const y=await pe(),O=y.length>0?Z.current.filter(M=>!y.includes(M.id)):Z.current;console.log("Valid new tracks",O),B.current=[...B.current,...O],Z.current=null,de()},fe=()=>{W.current=W.current.filter(y=>y.tracks.length>0),k(!0),j(W.current)};n.useEffect(()=>{console.log("New albums ",b),!F&&(p(0),h(2))},[b]);const de=()=>{function y(O){return W.current.find(M=>M.name===O)}for(const O of B.current){const M=y(O.albumName);if(M)M.addTrack(O);else{const _=jt(),ee=new ws(O.albumName,O.getArtists(),O.year,O.picture,_);W.current.push(ee),ee.addTrack(O)}}j(W.current)},pe=async(y="")=>{if(!a){if(!y)return;console.log("Fetching meta at source",y);const M=await fetch(`${N}/radio/metadata/${encodeURIComponent(y)}`,{method:"GET"}).then(oe=>oe.json());if(M)q("Radio found! "+M[0].name,G.INFO);else{q("No radio found..",G.ERROR);return}const _=M[0];console.log(_);const ee=E;ee.set(_.stationuuid,{url:_.url_resolved,favicon:_.favicon,name:_.name}),V(ee),h(2);return}h(1);const O=[];return await Promise.all(Z.current.map(async M=>{var ee,oe,ve;const _=await ua(M.file).catch(z=>{console.error("error at",file,z),q(`Track ${M.title} seems corrupted, retry without it.`,G.ERROR)});if(!_){O.push(M.id);return}M.setAdditionalData(_.common.album||_.common.title,_.common.title||M.file.name,((ee=_.common.track)==null?void 0:ee.no)||0,_.format.duration||0,_.common.year,_.common.artists.map(z=>z.split(",")).flat(1).map(z=>z.trim())),M.setPicture((ve=(oe=_.common)==null?void 0:oe.picture)==null?void 0:ve[0]),p(z=>z+1)})),O},Te=y=>{const O=new Map([...E].filter(([M,_])=>M!=y));V(O)},H=y=>{B.current=B.current.filter(O=>O.album.uuid!==y),console.log("Deleted album, remaining tracks",B.current),W.current=W.current.filter(O=>O.uuid!==y),k(!1),j(W.current)},D=y=>{$(y)};n.useEffect(()=>{if(S===null||b.length===0){h(2);return}h(3)},[S]);const ae=(y,O)=>{const M=jt();console.log("Moving track: "+y.id+NaN+S+" to album: "+M),y.album.removeTrack(y);const _=new ws(O,y.getArtists(),y.year,y.picture,O);W.current.push(_),_.addTrack(y),fe(),q(`Track ${y.title.substring(0,60)} got moved to album ${O}.`,G.INFO)},be=(y,O)=>{console.log("Moving track: "+y.id+NaN+S+" to album: "+O),y.album.removeTrack(y);const M=W.current.find(_=>_.uuid===O);M.addTrack(y),fe(),q(`Track ${y.title.substring(0,60)} got moved to album ${M.name}.`,G.INFO)},le=async()=>{if(console.log("Publishing tracks: ",B.current),console.log("Publishing radios: ",E),E.keys().forEach(async y=>{const O=new FormData;console.log(E.get(y)),O.append("radioData",JSON.stringify({uuid:y,...E.get(y)}));const M=await fetch(`${N}/radio/newRadio`,{method:"POST",credentials:"include",body:O}).then(_=>_.json());console.log(M)}),B.current.length>0){h(4);for(const M of W.current){let _=new FormData;_.append("album",JSON.stringify(M.getPuredData()));const ee=M.getPuredCover();ee&&_.append("cover",ee);const oe=await fetch(`${N}/read-write/upload`,{method:"POST",body:_,credentials:"include"});if(!oe.ok)throw console.error("Error uploading albums:",oe.statusText),new Error("Error uploading albums");_=null,console.log("Album uploaded: "+M.name)}W.current.forEach(M=>{M.coverURL&&(URL.revokeObjectURL(M.coverURL),M.coverURL=null)});let y=B.current.reduce((M,_)=>M+_.file.size,0);I((y/1024/1024).toFixed(1));let O=0;for(const M of B.current){let _=new FormData;_.append("trackMeta",JSON.stringify(M.getPuredTrackMeta())),_.append("music",M.file),U(M.title),o({done:O,total:B.current.length}),await da({method:"POST",data:_,withCredentials:!0,url:"/upload",baseURL:`${N}/read-write`,onUploadProgress:ee=>{const{total:oe,loaded:ve}=ee,z=oe/1e6,je=ve/1e6;s(je/z);const Ye=je/z*100;R(Ye.toFixed(2))}}).catch(ee=>{console.error("Error uploading track:",ee)}).finally(()=>{O++}),_=null}}console.log("Upload finished"),u(),setTimeout(()=>{W.current=null,B.current=null,p(0),j([]);const y=E;y.clear(),V(y),h(0),$(null),R(0),console.log("Closing overlay"),X("musicUploaded"),t()},750)},A=()=>{if(m!==4){t();return}r(!0)},Q=()=>{switch(m){case 0:return e.jsx($a,{fromFile:a,setFromFile:d,tracksSelected:he,initMetadataFetching:pe});case 1:return e.jsx(bt,{text:`Fetching metadatas.. ${f?c+"/"+f:"-/-"}`});case 2:return e.jsx(_a,{albums:b,addNewMusic:()=>h(0),deleteAlbum:H,editAlbum:D,publish:le,radios:E,deleteRadio:Te});case 3:return e.jsx(Ga,{setEditUid:$,albumClass:b.find(y=>y.uuid===S)});case 4:return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(bt,{text:`Publishing ${T} ${L}Mb..`,progressBar:{useProgressBar:!0,showPercent:!0,isMarquee:!1,percent:Number(P),fillColor:"var(--cool-green)"}}),e.jsx("p",{children:"You can close this overlay, the upload will continue. :)"})]});default:return e.jsx("div",{className:"addMusicSource",children:e.jsx("p",{children:"Not implemented yet"})})}};return e.jsx("div",{className:"addMusicRoot",children:e.jsx("div",{className:"addMusicContainer",style:l?{display:"none"}:{},children:e.jsxs(Ys.Provider,{value:{albums:b,moveTrackToNewAlbum:ae,editingAlbum:S,moveTrackToAlbum:be,setEditingAlbum:$},children:[e.jsx(xe,{className:"buttonRound closeOverlay",onClick:A}),e.jsx("h2",{children:"Add Music"}),e.jsx(rs,{context:{name:"AddMusic",length:5},active:m,setActive:h}),e.jsx(Q,{})]})})})},Ha=()=>n.useContext(Ys),za=50,qa=({hideComponent:t})=>{const{playQueue:s,deleteQueue:o,jumpToQueueTrack:u,queuePointer:l}=re(),r=n.useRef(null),{subscribe:a}=ge(),d=n.useRef(new Map);return n.useEffect(()=>{const m=c=>{var p;if(r.current&&!r.current.contains(c.target)){if(((p=c.target.closest("svg"))==null?void 0:p.id)==="playlist-button")return;t()}},h=a("action-bar-open",()=>{t()});return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),()=>{h(),document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m)}},[]),e.jsxs("div",{className:"music-queue",ref:r,children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Music Queue"}),s.length>0&&e.jsx(ct,{className:"buttonRound",id:"queue-trash",onClick:o})]}),s.length>0?e.jsx(Ae,{height:"auto",itemCount:s.length,itemSize:za,width:"100%",itemData:{playQueue:s,cacheRef:d,jumpToQueueTrack:u,queuePointer:l},children:Ws}):e.jsx("p",{children:"No items in the queue"})]})},Wa=n.memo(({payload:t})=>{const[s,o]=n.useState(!1);return e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Open a song's dropdown"}),e.jsxs("div",{id:"tuto-0-cooking-container",children:[e.jsx(te,{className:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-cooking-songs-container",children:[e.jsxs("div",{className:"tuto-cooking-0-song-skeleton","data-target":!0,children:[e.jsx(Ms,{id:"tuto-cooking-dots",onClick:()=>{o(!s)}}),s&&e.jsxs("div",{id:"tuto-0-cooking-dropdown",children:[e.jsxs("div",{className:"tuto-cooking-0-action-skeleton track-action-entry","data-target":"true",onClick:()=>{t(1)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(vt,{})]}),e.jsx("div",{className:"tuto-cooking-0-action-skeleton"})]})]}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"})]})]})]})}),Ka=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Here you can remove and add tags:"}),e.jsxs("div",{id:"tuto-tags-1",children:[e.jsxs("div",{className:"tuto-search-skeleton",children:[e.jsx(Qe,{}),e.jsx("span",{id:"animated-write-span",children:"140BPM, roses, gaming, 2010s"}),e.jsx("div",{className:"blinking-cursor"})]}),e.jsxs("div",{id:"tuto-tags",children:[e.jsxs("div",{className:"small-tag",children:["Evening",e.jsx(xe,{})]}),e.jsxs("div",{className:"small-tag",children:["Chill",e.jsx(xe,{})]}),e.jsxs("div",{className:"small-tag",children:["Friends",e.jsx(xe,{})]}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:"Got it!"})]})]})]})),Qa=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Cooking lets you play all the tracks mataching the tags:"}),e.jsx("div",{id:"tuto-tags-salad",children:e.jsxs("div",{id:"tuto-tags",children:[e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#a79cf5"}})]})}),e.jsxs("div",{id:"tuto-song-list",children:[e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}})}),e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})}),e.jsxs("div",{className:"tuto-tag-song-skeleton",children:[e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})]})]}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]})),Ja=[Wa,Ka,Qa],Ya=n.memo(()=>{const{onTutoialFinished:t}=kt(),[s,o]=n.useState(0),u=Ja[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{t(we.COOKING)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Manage tags and cook salads"}),e.jsx(rs,{context:{name:"tutorial",length:3},active:s,setActive:o}),e.jsx(u,{payload:r[s]})]})}),Xa=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Pick an album:"}),e.jsxs("div",{id:"tuto-genre-albums-container",children:[e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(te,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]}),e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(te,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]})]})]})),Za=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Edit the desired album:"}),e.jsxs("div",{id:"tuto-genre-0-lib",children:[e.jsx(te,{id:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsxs("div",{id:"tuto-genre-0-header",children:[e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:e.jsx(es,{})})]}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"})]})]})]})),eo=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Change the genre:"}),e.jsxs("div",{id:"tuto-genre-1-lib",children:[e.jsxs("div",{id:"tuto-genre-1-logo-btn",children:[e.jsx(te,{id:"tuto-genre-logo"}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton","data-target":!0,children:e.jsx("span",{children:"Genre"})}),e.jsxs("div",{className:"tuto-genre-1-input-skeleton tuto-target","data-target":!0,children:[e.jsx("span",{id:"animated-write-span",children:"Rock, Breakcore, Soundtrack, .."}),e.jsx("div",{className:"blinking-cursor"})]})]})]})]})),to=[Xa,Za,eo],so=n.memo(()=>{const{onTutoialFinished:t}=kt(),[s,o]=n.useState(0),u=to[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{t(we.GENRES)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Add genre to albums"}),e.jsx(rs,{context:{name:"tutorial",length:3},active:s,setActive:o}),e.jsx(u,{payload:r[s]})]})}),we={GENRES:"genres",COOKING:"cooking"},as=new Map;as.set(we.GENRES,so);as.set(we.COOKING,Ya);const Xs=({tutorialKey:t=we.GENRES})=>{const s=as.get(t)??(()=>e.jsx("div",{children:"Not found"}));return e.jsx("div",{className:"page-overlay-blur",children:e.jsx(s,{})})},Zs=n.createContext(),J={SEARCH:"search",OPEN_ACTION_BAR:"open_action_bar",CLOSE_ACTION_BAR:"close_action_bar",PLAY_SONG:"play_song",OPEN_ALBUM:"open_album",OPEN_ARTIST:"open_artist",PLAY_LIBRARY_RANDOM:"play_library_random",TOGGLE_PLAY_PAUSE:"toggle_play_pause",OPEN_SETTINGS:"open_settings",VOLUME_UP:"volume_up",VOLUME_DOWN:"volume_down",OPEN_GENRE:"open_genre",TOGGLE_FULL_SCREEN:"toggle_full_screen",SKIP_PLUS:"skip_plus",SKIP_MINUS:"skip_minus"},Ue=[{name:"Search",code:J.SEARCH,description:"Search for a song, an album, a genra, an artist",key:"k",modifier:"ctrl",keywords:["search","find","look for","seek","search for","find for","look for for","seek for"],icon:()=>e.jsx(Qe,{className:"action-bar-current-logo"})},{name:"open action bar",code:J.OPEN_ACTION_BAR,description:"Give a command",key:" ",modifier:"ctrl",keywords:[]},{name:"Play the library in shuffle",code:J.PLAY_LIBRARY_RANDOM,description:"",key:"r",modifier:"ctrl",keywords:["play","shuffle","random","library","all","all songs","all albums","all artists"],icon:()=>e.jsx(it,{className:"action-bar-current-logo"})},{name:"Toggle Play pause",code:J.TOGGLE_PLAY_PAUSE,description:"",key:" ",modifier:"",icon:()=>e.jsx(it,{className:"action-bar-current-logo"})},{name:"Open settings",code:J.OPEN_SETTINGS,description:"",key:"p",modifier:"ctrl",keywords:["settings","configuration","config","preferences","options"],icon:()=>e.jsx(Rr,{className:"action-bar-current-logo"})},{name:"Volume up",code:J.VOLUME_UP,description:"",key:"ArrowUp",modifier:"",keywords:[],icon:()=>{}},{name:"Volume down",code:J.VOLUME_DOWN,description:"",key:"ArrowDown",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:J.SKIP_PLUS,description:"",key:"ArrowRight",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:J.SKIP_MINUS,description:"",key:"ArrowLeft",modifier:"",keywords:[],icon:()=>{}},{name:"Toggle color theme",code:J.TOGGLE_THEME,description:"Toggles the app dark or light theme.",key:"t",modifier:"ctrl",keywords:["dark","light","color","theme","color-theme","toggle"],icon:()=>e.jsx(Us,{className:"action-bar-current-logo"})},{name:"Toggle full screen",code:J.TOGGLE_FULL_SCREEN,description:"Toggles the full screen mode.",key:"",modifier:"",keywords:["bars","wallpaper","full-screen","fft","spectrum","toggle"],icon:()=>e.jsx(_s,{className:"action-bar-current-logo"})}],no=new Gs(Ue,{keys:["keywords"],threshold:.3}),Se={DARK:"dark",LIGHT:"light"},ro=({children:t})=>{const s=n.useRef([]),[o,u]=n.useState(!1),l=n.useRef(o),[r,a]=n.useState(null),[d,m]=n.useState(!1),[h,c]=n.useState(null),[p,f]=n.useState([]),[x,b]=n.useState(null),{playTrackNoQueue:j,playLibraryShuffle:F,toggleTrackPaused:k,setVolume:S,volume:$,toggleFullScreenView:L,skipAudioSeconds:I}=re(),P=n.useRef($),R=me(),T=Ke(),U=n.useRef(null),q=n.useRef(null),{addNotification:G,notifTypes:E}=Ie(),[V,B]=n.useState(()=>{const y=localStorage.getItem("CML_theme");return y?y===Se.LIGHT?(document.documentElement.classList.remove("dark"),Se.LIGHT):(document.documentElement.classList.add("dark"),Se.DARK):(localStorage.setItem("CML_theme",Se.LIGHT),Se.LIGHT)}),{emit:W,subscribe:X}=ge();n.useEffect(()=>{window.addEventListener("keydown",he),pe();const y=O=>{U.current&&!U.current.contains(O.target)&&A()};return document.addEventListener("mousedown",y),document.addEventListener("touchstart",y),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("touchstart",y),window.removeEventListener("keydown",he),s.current=[]}},[]);const Z=y=>{const O=localStorage.getItem("CML_FinishedTutorials"),M=O?JSON.parse(O):{state:{}};M.state[y]=!0,localStorage.setItem("CML_FinishedTutorials",JSON.stringify(M)),W(`safe-finished-tutorial-${y}`)},he=y=>{if(y.key=="Escape"&&l.current){A();return}if(y.key=="Escape"&&T.pathname==="/full-screen"){L();return}if(y.key=="Control"||h||!(y.ctrlKey||y.altKey||y.metaKey)&&(document.activeElement.nodeName==="INPUT"||document.activeElement.nodeName==="TEXTAREA"))return;const O=Ue.find(M=>y.key===M.key?!M.modifier||M.modifier===""?!0:{ctrl:y.ctrlKey,shift:y.shiftKey,alt:y.altKey,meta:y.metaKey}[M.modifier]:!1);O&&(c(O),s.current.forEach(M=>{M.code===O.code&&(M.callback(y),y.preventDefault())}))},ie=(y,O)=>{const M={callback:y,code:O};s.current.push(M)},fe=n.useRef(k);fe.current=k;const de=()=>{Oe(()=>{u(!0),a(null),f(Te()),q.current="command",c(Ue[1])},T.pathname)()};n.useEffect(()=>{P.current=$,G(`Volume : ${($*100).toFixed(0)} %`,E.INFO)},[$]);const pe=()=>{ie(()=>{if(q.current==="command"){A();return}de()},J.OPEN_ACTION_BAR),ie(()=>{A()},J.CLOSE_ACTION_BAR),ie(()=>{if(q.current==="search"){A();return}u(!0),a(J.SEARCH),q.current="search"},J.SEARCH),ie(()=>{fe.current()},J.TOGGLE_PLAY_PAUSE),ie(()=>{R("/settings")},J.OPEN_SETTINGS),ie(()=>{S(Math.min(Math.max(P.current+.1,0),1))},J.VOLUME_UP),ie(()=>{S(Math.min(Math.max(P.current-.1,0),1))},J.VOLUME_DOWN),ie(()=>{I(!0)},J.SKIP_PLUS),ie(()=>{I(!1)},J.SKIP_MINUS)};n.useEffect(()=>{o&&document.getElementById("actionbar-searchbar").focus(),l.current=o},[o]),n.useEffect(()=>{switch(r){case J.SEARCH:m(!0),b(()=>e.jsx("div",{className:"action-bar-logo-container",children:e.jsx(Qe,{className:"action-bar-current-logo"})}));break;default:m(!0),b(null)}},[r]);const Te=()=>[Ue[0],Ue[2],Ue[4]],H=y=>{var _;const O=y.target.value;if(O===""){f(Te());return}if(r===J.SEARCH){ae(O);return}const M=(_=no.search(O))==null?void 0:_.map(ee=>ee.item).filter(ee=>{var oe;return((oe=ee.keywords)==null?void 0:oe.length)>0});f(M)},D=y=>{switch(y){case"track":return e.jsx(Zt,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View album"})," ",e.jsx(Qt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View artist"})," ",e.jsx(Qt,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View genre"})," ",e.jsx(Qt,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},ae=async y=>{y===""||y.trim().length===0||fetch(`${N}/read-write/search/${y}`,{method:"GET"}).then(O=>{if(O.ok)return O.json();throw new Error("Error fetching search results")}).then(O=>{const M=[...O.tracks.map(_=>({type:"track",..._})),...O.albums.map(_=>({type:"album",..._})),...O.artists.map(_=>({type:"artist",..._})),...O.genres.map(_=>({type:"genre",..._}))].map(_=>{const ee=_.path,oe=_.id,{trackPath:ve,...z}=_;return{icon:()=>ee?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${_.type==="artist"?"artist":"covers"}/${ee}`,alt:_.name}):e.jsx(te,{className:"action-bar-entry-logo"}),tooltip:D,code:_.type==="artist"?J.OPEN_ARTIST:_.type==="album"?J.OPEN_ALBUM:_.type==="genre"?J.OPEN_GENRE:J.PLAY_SONG,fileName:ee,trackName:oe,...z}});f(M)})},be=y=>{switch(y.code){case J.SEARCH:u(!0),a(J.SEARCH),c(Ue[0]),q.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),f([]);break;case J.CLOSE_ACTION_BAR:A();break;case J.PLAY_SONG:console.log("Playing song",y),j(y.trackName),A();break;case J.OPEN_ALBUM:A(),R(`/albums/${y.id}`);break;case J.OPEN_ARTIST:A(),R(`/artists/${y.id}`);break;case J.OPEN_GENRE:console.log("Opening genre",y),A(),R(`/genres/${y.id}`);break;case J.PLAY_LIBRARY_RANDOM:F(),A();break;case J.OPEN_SETTINGS:A(),R("/settings");break;case J.TOGGLE_THEME:le(),A();break;case J.TOGGLE_FULL_SCREEN:L(),A();break}},le=()=>{V===Se.DARK?(document.documentElement.classList.remove("dark"),localStorage.setItem("CML_theme",Se.LIGHT)):(document.documentElement.classList.add("dark"),localStorage.setItem("CML_theme",Se.DARK)),B(V===Se.DARK?Se.LIGHT:Se.DARK)},A=()=>{u(!1),a(null),q.current=null,f([])},Q=()=>{u(!0),a(J.SEARCH),c(Ue[0]),q.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),f([])};return n.useEffect(()=>{o&&W("action-bar-open")},[o]),e.jsx(Zs.Provider,{value:{commandCodes:J,openCommandBar:de,openSearchBar:Q,colorTheme:V,toggleColorTheme:le,onTutoialFinished:Z},children:e.jsxs("div",{className:"action-bar-app-parent",children:[t,o&&e.jsx("div",{className:"global-action-bar",children:e.jsx("div",{className:"action-bar",ref:U,children:e.jsxs("div",{className:"action-bar-research",children:[x||null,e.jsx("input",{type:"text",id:"actionbar-searchbar",className:"searchbar",onChange:H,placeholder:`${h.description}`}),e.jsx("div",{className:"action-bar-results",children:e.jsx(Ae,{height:300,itemCount:p.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:y,style:O})=>e.jsx(Nt,{entry:p[y],style:{...O,width:" calc(100% - 20px)",marginTop:"10px"},onClick:be},y)})})]})})})]})})},kt=()=>{const t=n.useContext(Zs);if(!t)throw new Error("useGlobalActionBar must be used within a GlobalActionBar provider");return t},ao=({onClosed:t,hideComponent:s})=>{const{setVolume:o,volume:u}=re(),l=n.useRef(null),{subscribe:r}=ge();return n.useEffect(()=>{const a=m=>{var h;if(l.current&&!l.current.contains(m.target)){if(((h=m.target.closest("svg"))==null?void 0:h.id)==="volume-button")return;s()}},d=r("action-bar-open",()=>{s()});return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),()=>{d(),document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[]),e.jsx("div",{ref:l,className:"volume-bar",children:e.jsx(lt,{onClickPercentage:a=>{console.log("change volume"),o(a/100)},style:{height:"10px"},fillColor:"rgb(118, 173, 206)",percent:u*100})})},oo=({percent:t,size:s=120,strokeWidth:o=10,useText:u=!0,style:l,color:r="rgb(130, 119, 196)"})=>{const a=(s-o)/2,d=2*Math.PI*a,m=d*(1-t);return e.jsxs("div",{className:"radial-container",style:{width:s,height:s,...l},children:[e.jsxs("svg",{width:s,height:s,children:[e.jsx("circle",{className:"radial-bg",stroke:"#e6e6e6",strokeWidth:o,fill:"none",cx:s/2,cy:s/2,r:a}),e.jsx("circle",{className:"radial-progress",stroke:r,strokeWidth:o,fill:"none",cx:s/2,cy:s/2,r:a,strokeDasharray:d,strokeDashoffset:m})]}),e.jsx("div",{className:"radial-label",children:u&&e.jsxs("span",{children:[Math.round(t),"%"]})})]})},co=({fps:t=45})=>{const s=n.useRef(),o=n.useRef(null),{getFFTAtCurrentTime:u,fftConfigRef:l,globalAudioRef:r,FFTUserSetingsRef:a,fetchFFTUserSettings:d,colorOverride:m,currentTrackData:h}=re(),c=n.useRef(0),p=n.useRef(!1),f=x=>{var j;if((h==null?void 0:h.type)=="radio"||p.current){cancelAnimationFrame(s.current);return}if(!o.current){s.current=requestAnimationFrame(f);return}const b=o.current.getContext("2d");if(b&&a.current){if(x-c.current<1e3/t){s.current=requestAnimationFrame(f);return}c.current=x;const F=5;b.clearRect(0,0,o.current.width,o.current.height);const k=u();if(!k){s.current=requestAnimationFrame(f);return}let S=k.subarray(Math.floor(k.length*.3),Math.floor(k.length*.6));const $=Math.max(1,S.length/F),L=new Array(F);L.fill(0);for(let R=0;R<S.length;R++)L[Math.floor(R/$)]+=Number(k[R]);let I=o.current.width/F-5,P=0;b.strokeStyle="#ffffff",b.fillStyle="#ffffff";for(let R=0;R<L.length;R++){const T=pa(Math.log2(L[R])*(F/5),5,25,0,1),U=Math.max(10,Math.min(80*T*((j=r.current)==null?void 0:j.volume),o.current.height-10));b.beginPath(),b.roundRect(2+P,(o.current.height-U)/2,I,U,7),b.fill(),b.stroke(),P+=I+5}}s.current=requestAnimationFrame(f)};return n.useEffect(()=>{if(!l.current){cancelAnimationFrame(s.current),console.log("No FFT data to display, releasing anim frame.");return}s.current=requestAnimationFrame(f),console.log("FFT found, requested animation frame.")},[l.current]),n.useEffect(()=>{const x=window.matchMedia("(max-width: 714px)"),b=j=>{p.current=j.matches,s.current=requestAnimationFrame(f),console.log("Canvas hidden?",p.current)};return b(x),x.addEventListener("change",b),()=>{x.removeEventListener("change",b)}},[]),e.jsx("canvas",{ref:o,id:"fft-canvas-small",className:"in-song-header",width:50,height:50})},Ot=({useText:t=!1,style:s={},className:o=""})=>{const u=n.useRef(null),{colorTheme:l,toggleColorTheme:r}=kt();return n.useEffect(()=>{u.current.setAttribute("data-color-theme",l)},[l]),e.jsxs("div",{style:s,className:`color-theme-btn ${o}`,children:[e.jsx(Us,{id:"color-theme-svg",ref:u,className:"buttonRound",onClick:r}),t&&e.jsx("span",{children:xa(l.toString())})]})},_t=()=>{const[t,s]=n.useState(!1),[o,u]=n.useState(!1),[l,r]=n.useState(!1),[a,d]=n.useState(!1),[m,h]=n.useState(!1),[c,p]=n.useState({col1:"#000",col2:"#000"}),{currentTrackData:f,trackCoverUrl:x,volume:b,toggleFullScreenView:j,toggleCurrentRadioToFavorites:F,openTrackMobileView:k,mobileMusicPlayRef:S}=re(),{openSearchBar:$}=kt(),[L,I]=n.useState(!1),[P,R]=n.useState(null),[T,U]=n.useState(null),q=me(),{subscribe:G}=ge();n.useRef(null);const[E,V]=n.useState(Ke().pathname==="/admin-pannel"),B=()=>{r(!0)};n.useEffect(()=>{const de=G("openAddMusic",B);return()=>{de()}},[]);const W=()=>{r(!1),U(null),R(null)};function X(){d(!a)}function Z(){h(!m)}n.useEffect(()=>{const de=[{col1:"#ffa585",col2:"#ffeda0"},{col1:"#9bf8f4",col2:"#6f7bf7"}];p(de[Math.floor(Math.random()*de.length)])},[]);const he=()=>{},ie=()=>{if(!P){l?(W(),console.log("deactivate")):(B(),console.log("activate"));return}I(document.getElementsByClassName("addMusicContainer")[0]==null),console.log("toggle")},fe=de=>{de.stopPropagation(),j()};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header__logo",onClick:()=>q("/home"),children:[e.jsx(te,{col1:c.col1,col2:c.col2}),e.jsx("h1",{children:"CML"})]}),e.jsx($t,{context:{mobile:!1}}),e.jsxs("div",{className:"musicPlayer",ref:S,onClick:k,children:[e.jsxs("div",{className:"playPauseContainer",children:[(f==null?void 0:f.type)=="radio"?f.coverUrl==""?e.jsx(te,{className:"trackImage"}):e.jsx("img",{src:f.coverUrl,className:"trackImage"}):x.split("/").pop()==="null"?e.jsx(te,{className:"trackImage"}):e.jsx("img",{src:x,className:"trackImage"}),e.jsx("div",{className:"playPauseButtons",onClick:fe,children:e.jsx(_s,{style:{padding:"0px"}})})]}),!f||Object.keys(f).length===0?null:e.jsxs("div",{className:"trackinfos-parent",children:[e.jsxs("div",{className:"trackinfo-desktop",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{(f==null?void 0:f.type)!="radio"&&q(`/artists/${f.artistId}`)},children:f.artist}),e.jsx(Qs,{})]}),(f==null?void 0:f.type)==="radio"?e.jsx(xt,{id:"add-radio-fav",iconHovered:$s,iconDefault:Ut,onClick:F}):e.jsx(co,{}),e.jsxs("div",{className:"trackinfo-mobile",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx($t,{context:{mobile:!0}})]})]})]}),e.jsxs("div",{className:"mobile-gost",children:[e.jsx(Os,{id:"playlist-button",className:"buttonRound",onClick:()=>X()}),a&&e.jsx(qa,{hideComponent:()=>d(!1)}),b<=1e-5?e.jsx(Ar,{className:"buttonRound",onClick:()=>Z()}):b<.5?e.jsx(Ir,{className:"buttonRound",onClick:()=>Z()}):e.jsx(Fr,{id:"volume-button",className:"buttonRound",onClick:()=>Z()}),m&&e.jsx(ao,{hideComponent:()=>h(!1)}),e.jsx(Ot,{})]}),e.jsxs("div",{className:"headerRight",children:[e.jsx(Ot,{className:"desktop-ghost"}),!E&&e.jsxs("div",{className:"serach-button-div",onClick:$,children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"K"})}),e.jsx(Qe,{})]}),e.jsxs("div",{style:{position:"relative",padding:"5px",display:"flex",justifyContent:"center"},className:"upload-music-header",children:[T&&e.jsx(oo,{percent:T,size:44,useText:!1,style:{position:"absolute",transform:"translate(-1px, -5.5px)"}}),e.jsx(ts,{style:{zIndex:"10",position:"relative"},className:"addMusicButton buttonRound",onClick:ie}),P&&e.jsxs("span",{style:{position:"absolute",bottom:"-30px",padding:"2px 7px",borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 0.7)",textAlign:"center"},children:[P.done,"/",P.total]})]}),e.jsx(fa,{})]}),l&&e.jsx(Va,{uploadPercent:U,uploadFinished:he,uploadProgress:R,isMinimize:L,setMinimized:I,closeOverlay:W})]})},io=()=>{const[t,s]=n.useState(null),[o,u]=n.useState(null),[l,r]=n.useState(null),[a,d]=n.useState(null);n.useEffect(()=>{const c=setInterval(m,5e3);return m(),()=>clearInterval(c)},[]);const m=()=>{try{fetch(`${N}/isResponding`).then(c=>{c.status===200?(a===!1&&h(),d(!0)):d(!1)}).catch(c=>{console.error("Fetch failed (e.g., CORS error):",c),d(!1)})}catch(c){console.error("Unexpected error:",c),d(!1)}},h=()=>{fetch(`${N}/read-write/stats`,{method:"GET"}).then(c=>c.json()).then(c=>{s(c)}).catch(c=>console.error("Error fetching stats:",c)),fetch(`${N}/read-write/serverStats`,{method:"GET"}).then(c=>c.json()).then(c=>{u(Jt(c.coversByteUsage+c.tracksByteUsage).readable),r({perent:(1-c.free/c.size)*100,total:Jt(c.size).readable,free:Jt(c.free).readable})}).catch(c=>console.error("Error fetching server stats:",c))};return n.useEffect(()=>{h()},[]),e.jsxs("div",{className:"stat-short",children:[e.jsxs("div",{className:"stat-short-category",children:[e.jsxs("p",{children:["Library size: ",o]}),e.jsxs("p",{children:["Free ",l==null?void 0:l.free," of ",l==null?void 0:l.total]}),e.jsx(lt,{percent:(l==null?void 0:l.perent)||0,total:l==null?void 0:l.total,style:{height:"10px"},fillColor:"var(--chill-purple)",initialising:!o})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"5px"},children:[e.jsx("div",{className:"server-status-sprite",style:{width:"10px",height:"10px",borderRadius:"10px",backgroundColor:a?"lightgreen":"red"}}),e.jsxs("p",{children:["Server is ",a?"online":"offline"]})]})]})},lo=()=>{const{openCommandBar:t}=kt();return e.jsxs("div",{className:"sidebar",children:[e.jsxs("nav",{children:[e.jsxs(tt,{id:"nav-recent",to:"/home",children:[e.jsx(Pr,{}),"Recent"]}),e.jsxs(tt,{to:"/playlists",children:[e.jsx(Lr,{}),"Playlists"]}),e.jsxs(tt,{to:"/artists",children:[e.jsx($r,{}),"Artists"]}),e.jsxs(tt,{to:"/genres",children:[e.jsx(Or,{}),"Genres"]}),e.jsxs(tt,{to:"/cooking",children:[e.jsx(at,{}),"Cooking"]}),e.jsxs(tt,{to:"/radio",children:[e.jsx(Mr,{}),"Radio"]})]}),e.jsx(io,{}),e.jsxs("div",{className:"serach-button-div",onClick:t,style:{margin:"auto",marginBottom:"20px"},children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"SPACE"})}),e.jsx(Ur,{})]})]})},uo=()=>{const t=me(),[s,o]=n.useState(!1),{currentDisplayedPage:u}=re();if(n.useEffect(()=>{(async()=>{if((await(await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"})).json()).success){o(!1);return}t("/")})()},[t]),s)return e.jsx(bt,{});const r=Ke().pathname,a=["/home"];return e.jsxs("div",{className:"app-container",children:[e.jsx(_t,{}),e.jsxs("div",{className:"content-container",ref:u,page:a.includes(r)?r:"inside",children:[e.jsx(lo,{}),e.jsxs("div",{className:"content",children:[e.jsx(Rs,{})," "]})]})]})},os=({album:t,hideArtist:s=!1})=>{const o=me(),[u,l]=n.useState([]),r=a=>{o(`/albums/${a}`)};return n.useEffect(()=>{t.artists&&l(JSON.parse(t.artists).map(a=>a.name))},[t]),e.jsxs("div",{className:"album-card",onClick:()=>r(t.id),children:[t.cover?e.jsx("img",{src:`${N}/covers/${t.cover}`,alt:`${Be(t.title,25)} cover`,className:"album-card-cover"}):e.jsx(te,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Be(t.title,40)}),!s&&e.jsx("p",{className:"album-artist",children:Be(u.toString().replace(/,/g,", "),25)||"No artist"})]})},cs=()=>{const{emit:t}=ge(),s=()=>{t("openAddMusic")};return e.jsxs("div",{className:"add-music-shortcut",children:[e.jsx("h2",{children:"Welcome to the Crystal Music Library !"}),e.jsxs("button",{onClick:s,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"15px",margin:"auto"},children:[e.jsx(ts,{}),e.jsx("h3",{style:{margin:"2px"},children:"Add music"})]})]})},mo=({})=>{const[t,s]=n.useState([]),[o,u]=n.useState(!1),{subscribe:l}=ge(),r=()=>{fetch(`${N}/read-write/albums`,{method:"GET",credentials:"include"}).then(d=>{if(d.status!==200){console.error("Error fetching albums");return}return d.json()}).then(d=>{s(d),u(!0)})};n.useEffect(()=>{Oe(()=>{r()})();const m=l("musicUploaded",r);return()=>{m()}},[]);const a=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});return e.jsx("div",{className:"home album-displayer","data-no-tracks":(t==null?void 0:t.length)==0&&o?"true":"false",children:o?(t==null?void 0:t.length)!==0?t.map(d=>e.jsx(os,{album:d},d.id)):e.jsx(cs,{}):e.jsx(a,{})})},ho=()=>e.jsx("p",{children:" Your albums"}),Re={FETCHING:"fetching",SUCCESS:"success",REJECTED:"rejected",NONE:"none"},fo=()=>{const t=n.useRef(Re.NONE),[s,o]=n.useState(Re.NONE),u=me(),{emit:l}=ge(),r=async m=>{if(m.preventDefault(),!m.target.email.value||!m.target.password.value){alert("Please fill in all fields");return}const h=new FormData(m.target),c=await fetch(`${N}/auth/login`,{method:"POST",credentials:"include",body:h}),p=await c.json();c.ok?(localStorage.setItem("username",p.username),t.current=Re.SUCCESS):t.current=Re.REJECTED,d()},a=()=>{switch(s){case Re.FETCHING:return e.jsx(zs,{});case Re.SUCCESS:return e.jsxs("div",{className:"loginFeedback",sucess:"true",children:[e.jsx(ot,{className:"successIcon"}),e.jsx("span",{children:"Logged in"})]});case Re.REJECTED:return e.jsxs("div",{className:"loginFeedback",sucess:"false",children:[e.jsx(xe,{className:"failIcon"}),e.jsx("span",{children:"Wrong credentials"})]});default:return null}},d=()=>{switch(o(t.current),t.current){case Re.REJECTED:setTimeout(()=>{o(Re.NONE)},1e3);break;case Re.SUCCESS:setTimeout(()=>{l("login"),u("/home")},1e3);break}};return e.jsxs("div",{className:"authDiv",children:[e.jsx(Ot,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(te,{}),e.jsx("h2",{children:"Login"}),e.jsx("p",{children:"We were not able to connect you, please login."}),e.jsxs("form",{onSubmit:r,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"password"}),e.jsx("button",{type:"submit",children:"Login "}),e.jsx("p",{children:"Don't have an account?"}),e.jsx("button",{onClick:()=>{u("/register")},children:"Register"})]}),e.jsx(a,{})]})},po=[Me("#f8be99"),Me("#f495e9"),Me("#bbfbdf"),Me("#c4d3f8"),Me("#edc9f9"),Me("#909ef8"),Me("#96ebf4")],Pt=60,pt=Me("#242424"),en=()=>{const[t,s]=n.useState([pt,pt]),o=n.useRef([]),u=n.useRef([pt,pt]),l=n.useRef(po),r=n.useRef(0),a=n.useRef(0);n.useEffect(()=>(a.current=setInterval(m,1e3/Pt),()=>{clearInterval(a.current)}),[]);const d=()=>{const h=gt.sample(l.current);return l.current.filter(c=>c.join(",")!=h.join(",")),h},m=()=>{r.current%Pt===0&&(o.current[0]&&o.current[0]!==pt&&l.current.push(...o.current),o.current=u.current,u.current=[d(),d()]),s(o.current.map((h,c)=>u.current[c].map((p,f)=>parseInt(We(h[f],p,r.current%Pt/Pt))))),r.current+=1};return e.jsx("div",{id:"background-img",style:{"--col1":bs(...t[0]),"--col2":bs(...t[1])}})},nt=Object.freeze({LOGIN:"login",REGISTER:"register",ANY_USER:"any_user",VERIF_TOKEN:"verif_token"}),go=()=>{const t=me(),[s,o]=n.useState([]),[u,l]=n.useState(null),[r,a]=n.useState(!0);return n.useRef(null),n.useEffect(()=>{(async()=>{l(nt.ANY_USER);const h=await(await fetch(`${N}/auth/any-user`,{method:"GET"})).json();if(console.log("Parsed users",h),o(h),console.log(h),h===0){a(!1),l(nt.REGISTER);return}l(nt.VERIF_TOKEN);const p=await(await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"})).json();if(a(!1),p.success){console.log("Token is valid"),t("/home");return}l(nt.LOGIN)})()},[t]),u===nt.REGISTER&&!r&&t("/register"),e.jsxs(e.Fragment,{children:[e.jsx(en,{}),!r&&u===nt.LOGIN?e.jsx(fo,{}):null]})},tn=({index:t,track:s,playIconId:o,isSalad:u=null,onClick:l,showCover:r=!1})=>{const{title:a,track_number:d,rawDuration:m}=s,{playingTrack:h,openTrackActions:c,toggleTrackFavorite:p}=re(),f=s.id,[x,b]=n.useState("null"),[j,F]=n.useState(!1),[k,S]=n.useState(!1),$=()=>{if(u){u(t);return}l(s.id)},L=()=>{switch(o){case 0:return e.jsx(Dr,{className:"track-number",playing:"piano","data-show-cover":r});case 1:return e.jsx(Gr,{className:"track-number",playing:"vinyl","data-show-cover":r});case 2:return e.jsx(Br,{className:"track-number",playing:"piano","data-show-cover":r});case"salad":return e.jsx(at,{className:"track-number",playing:"piano","data-show-cover":r})}};n.useEffect(()=>{F(s.is_favorite===1),r&&fetch(`${N}/read-write/trackCover/${s.id}`,{method:"GET"}).then(U=>U.json()).then(U=>{b(`${N}/covers/${U}`)})},[]);const I=U=>{U.stopPropagation(),p(s.id,!j,F)},P=()=>{S(!1)},R=U=>{U.stopPropagation(),S(!0),c({x:U.clientX,y:U.clientY},s,P,T)},T=U=>{F(U)};return e.jsxs("div",{className:"track-view","action-bar":k?"open":"",onClick:$,children:[j&&e.jsx(Ut,{className:"track-favorite"}),e.jsx(xt,{className:"track-toggle-favorite",iconHovered:j?Yt:_r,iconDefault:j?Yt:Is,onClick:I}),r?x.split("/").pop()==="null"?null:e.jsx("img",{src:x,className:"track-mini-thumbnail"}):null,h===f?L():r?null:e.jsx("p",{className:"track-number",children:d}),e.jsx("p",{className:"track-name",style:{"--margin":r?"45px":"35px"},children:a}),e.jsx(Ms,{className:"track-actions-dots",onClick:R}),e.jsx("p",{className:"track-length",children:ns(m).readable})]})},Ts=({isPlaylist:t=!1})=>{const[s,o]=n.useState(null),[u,l]=n.useState([]),[r,a]=n.useState([]),[d,m]=n.useState([]),[h,c]=n.useState(0),{addContainerToQueue:p,playContainerSuffle:f,editAlbum:x,editPlaylist:b,linkNewContainer:j,getNextSongsFromAlbum:F,navigateBack:k}=re(),S=n.useRef(null),$=me(),[L,I]=n.useState([]),P=t?Lt().playlistId:Lt().albumId,[R,T]=n.useState(null),U=n.useRef(null),{notifTypes:q,addNotification:G}=Ie(),[E,V]=n.useState(!1),[B,W]=n.useState(!1),[X,Z]=n.useState(!1);n.useEffect(()=>{he()},[P,B]),n.useEffect(()=>{j({id:P,type:t?"playlist":"album",favPlaylist:E},he)},[E]);const he=()=>{fetch(`${N}/read-write/${t?"playlist":"album"}/${P}`,{method:"GET",credentials:"include"}).then(A=>{if(!A.ok)throw new Error("Network response was not ok");return A.json()}).then(A=>{c(Math.floor(Math.random()*3));const Q=A.tracks.filter(O=>(!X&&O.is_favorite===1&&Z(!0),B?O.is_favorite===1:!0));if(t){o(A.playlistInfos),l(Q),m([A.owner,...A.collaborators]),V(A.isFavPlaylist);return}o(A.albumInfos);let y=0;for(let O=0;O<Q.length;O++){const M=Q[O];M.disc>y&&(Q.splice(O,0,{disc:M.disc,type:"disc"}),y=M.disc)}l(Q),a(A.genres),m(A.artists),V(!1)})},ie=async()=>await p(P,t?"playlist":"album",B),fe=async()=>{f(P,t?"playlist":"album",B)},de=()=>{if(t){b(P);return}x(P)},pe={TRACK:"track",ALBUM:"album",ARTIST:"artist",PLAYLIST:"playlist",GENRE:"genre"},Te=A=>{switch(A){case"track":return e.jsx(ts,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add album"})," ",e.jsx(yt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add artist's discography"})," ",e.jsx(Wr,{className:"action-bar-entry-tooltip-logo"})]});case"playlist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire playlist"})," ",e.jsx(qr,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire genre"})," ",e.jsx(zr,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},H=A=>{const Q=A.target.value;if(Q===""||Q.trim().length===0){I([]);return}console.log(`${N}/read-write/search/${Q}`),fetch(`${N}/read-write/search/${Q}`,{method:"GET"}).then(y=>{if(y.ok)return y.json();throw new Error("Error fetching search results")}).then(y=>{var M,_,ee,oe,ve;const O=[...(M=y.tracks)==null?void 0:M.map(z=>({type:"track",...z})),...(_=y.albums)==null?void 0:_.map(z=>({type:"album",...z})),...(ee=y.artists)==null?void 0:ee.map(z=>({type:"artist",...z})),...(oe=y.genres)==null?void 0:oe.map(z=>({type:"genre",...z})),...(ve=y.playlists)==null?void 0:ve.map(z=>({type:"playlist",...z})).filter(({id:z})=>z!==P)].map(z=>{const je=z.path,{trackPath:Ye,...Ge}=z;return{icon:()=>je?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${z.type==="artist"?"artist":"covers"}/${je}`,alt:z.name}):e.jsx(te,{className:"action-bar-entry-logo"}),tooltip:Te,code:z.type==="artist"?pe.ARTIST:z.type==="album"?pe.ALBUM:z.type==="genre"?pe.GENRE:z.type==="playlist"?pe.PLAYLIST:pe.TRACK,fileName:je,...Ge}});console.log(O),I(O)})},D=A=>{R||setTimeout(()=>{requestAnimationFrame(()=>{var Q;(Q=U.current)==null||Q.focus()})},0)},ae=A=>{const Q=new FormData;Q.append("addRequest",JSON.stringify({playlistId:P,endpoint:A.code,entryId:A.id,addAllToFavorite:E||!1})),fetch(`${N}/read-write/addToPlaylist`,{method:"POST",credentials:"include",body:Q}).then(y=>y.json()).then(y=>{he(),be(),G("Added to playlist",q.INFO)})};n.useEffect(()=>{const A=Q=>{S.current&&!S.current.contains(Q.target)&&be()};return document.addEventListener("mousedown",A),document.addEventListener("touchstart",A),()=>{document.removeEventListener("mousedown",A),document.removeEventListener("touchstart",A)}},[]);const be=()=>{T(!1),U.current.value="",I([])},le=A=>{F(A,B)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:k,children:e.jsx(Je,{})}),(s==null?void 0:s.cover)&&e.jsx("img",{src:`${N}/covers/${s.cover}`,className:"background-image",alt:"background"}),s&&u?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:s.title}),e.jsx("div",{className:"album-artists",children:d?d.map(A=>e.jsx("span",{className:"artist-name",onClick:()=>{$(`/${t?"users":"artists"}/${A.id}`)},children:A.name},A.id)):e.jsxs("span",{className:"artist-name",children:["Unknown ",t?"Members":"Artist"]})}),e.jsxs("div",{className:"album-content",children:[e.jsx("div",{className:"album-cover-genres",children:e.jsxs("div",{className:"album-cover-wrapper",children:[s.cover?e.jsx("img",{src:`${N}/covers/${s.cover}`,alt:`${s.title} cover`,className:"cover-image"}):e.jsx(te,{className:"cover-image"}),e.jsx("div",{className:"genres-album-div",children:r.map((A,Q)=>e.jsx("span",{className:"genre-album",onClick:()=>{$(`/genres/${A.genreId}`)},children:A.genreName},Q))}),s.description&&e.jsx("p",{children:s.description})]})}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(se,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:ie}),e.jsx(se,{text:"Random",icon:e.jsx(it,{}),onClick:fe}),!E&&e.jsx("button",{className:"button-with-callback",onClick:de,children:e.jsx(es,{})}),!E&&X&&e.jsx("button",{className:"button-with-callback","data-is-active":B,onClick:()=>{W(!B)},children:e.jsx(Vr,{})}),s.lossless===1&&e.jsxs("div",{className:"lossless",children:[e.jsx("span",{children:"Lossless"})," ",e.jsx(Hr,{})]})]}),t&&e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:S,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",onClick:D,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Qe,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:H,placeholder:"Search for tracks, artists, genres, playlists to add.",ref:U,onFocus:()=>{T(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${R?"block":"none"}`},children:e.jsx(Ae,{height:300,itemCount:L.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:A,style:Q})=>e.jsx(Nt,{entry:L[A],style:{...Q,width:" calc(100% - 20px)",marginTop:"10px"},onClick:ae},A)})})]})}),u.map((A,Q)=>(A==null?void 0:A.type)==="disc"?e.jsx("span",{children:`Disc ${A.disc}`},`disc-${Q}`):e.jsx(tn,{track:A,onClick:le,playIconId:h,showCover:t},A.id))]})]})]}):e.jsx(bt,{text:"Loading album"})]})},xo=({artist:t})=>{const s=me(),o=u=>{s(`/artists/${u}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>o(t.id),children:[t.picture?e.jsx("img",{src:`${N}/covers/artists/${t.picture}`,alt:`${t.name} cover`,className:"artist-card-cover"}):e.jsx(te,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},vo=()=>{const[t,s]=n.useState([]),{subscribe:o}=ge(),u=()=>{fetch(`${N}/read-write/artists`,{method:"GET",credentials:"include"}).then(l=>{if(l.status!==200){console.error("Error fetching artists");return}return l.json()}).then(l=>{s(l)})};return n.useEffect(()=>{Oe(()=>{u()})();const r=o("musicUploaded",u);return()=>{r()}},[]),e.jsx("div",{className:`home ${(t==null?void 0:t.length)!==0?"album-displayer":""}`,children:(t==null?void 0:t.length)!==0?t.map(l=>e.jsx(xo,{artist:l},l.id)):e.jsx(cs,{})})},jo=()=>{const[t,s]=n.useState(null),[o,u]=n.useState([]),{addArtistToQueue:l,shuffleArtistToQueue:r,editArtist:a,linkNewContainer:d,navigateBack:m}=re(),h=Lt().artistId;n.useEffect(()=>{c(),d({id:h,type:"artist"},c)},[h]);const c=()=>{fetch(`${N}/read-write/artist/${h}`,{method:"GET",credentials:"include"}).then(x=>{if(!x.ok)throw new Error("Network response was not ok");return x.json()}).then(x=>{s(x.artistInfos),u(x.albums),console.log(x.artistInfos)})},p=async()=>await l(h),f=async()=>{r(h,!1)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:m,children:e.jsx(Je,{})}),t&&o?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"album-content",children:[t.picture?e.jsx("img",{src:`${N}/covers/artists/${t.picture}`,alt:`${t.name} cover`,className:"cover-image"}):e.jsx(te,{className:"cover-image"}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(se,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:p}),e.jsx(se,{text:"Random",icon:e.jsx(it,{}),onClick:f}),e.jsx(se,{icon:e.jsx(es,{}),onClick:async()=>{a(t.id)}})]}),e.jsx("div",{className:"album-displayer",children:o.map(x=>e.jsx(os,{album:x,hideArtist:!0},x.id))})]})]})]}):e.jsx(bt,{text:"Loading artist"})]})},bo=()=>{const t=me(),s=()=>{t("/home")};return e.jsxs("div",{className:"not-found",children:[e.jsx("h1",{children:"Where did you land..?"}),e.jsx("p",{children:"The adress you gave is not defined, but you can go back to library:"}),e.jsx("button",{className:"btn",onClick:s,children:"Go back to library"})]})},yo=()=>{const[t,s]=n.useState("");n.useEffect(()=>{s(localStorage.getItem("username"))},[]);const o=me();return e.jsxs("div",{className:"account-page",children:[e.jsx(_t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Je,{})}),e.jsxs("div",{className:"account-container",children:[e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:t}),e.jsx("p",{children:"Account information will be displayed here."})]}),e.jsx(te,{})]})]})]})},No=({active:t,setActive:s})=>e.jsx("div",{className:"toggle-button","data-is-active":t,onClick:o=>{o.stopPropagation(),s(!t)},children:e.jsx("div",{className:"toggle-button-active","data-is-active":t})}),_e=({stateChanged:t,min:s=0,max:o=0,ref:u})=>{const l=s===o&&o===0,r=d=>{const m=d.target.value;t(m)},a=d=>{console.log("blur");let m=parseFloat(d.target.value);isNaN(m)&&(m=s),l||(m=Math.min(o,Math.max(s,m))),d.target.value=m,t(m)};return l?e.jsx("input",{ref:u,type:"number",onBlur:a,onChange:r}):e.jsx("input",{min:s,ref:u,max:o,type:"number",onBlur:a,onChange:r})},ko=()=>{var b;const t=n.useRef(null),s=n.useRef(null),o=n.useRef(null),u=n.useRef(null),l=n.useRef(null),{FFTUserSetingsRef:r,fftConfigRef:a}=re(),d=j=>{r.current.bars=Math.floor(j),f()},m=j=>{r.current.cutoff=parseFloat(j),f()},h=j=>{r.current.scale=parseFloat(j),f()},c=j=>{r.current.contrast=parseFloat(j),f()},p=j=>{r.current.FPS=parseFloat(j),f()},f=()=>{const j=new FormData;j.append("FFT",JSON.stringify(r.current)),fetch(`${N}/config/user/send/FFT`,{method:"POST",credentials:"include",body:j})},x=async()=>{await fetch(`${N}/config/user/FFT`,{method:"GET",credentials:"include"}).then(j=>j.json()).then(j=>{r.current=j,t.current.value=r.current.bars,u.current.value=r.current.contrast,s.current.value=r.current.scale,l.current.value=r.current.cutoff,o.current.value=r.current.FPS})};return n.useEffect(()=>{x()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Number of bars"}),e.jsx(_e,{ref:t,stateChanged:d,min:1,max:(b=a.current)==null?void 0:b.fftSize})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"FPS (High number may cause strong battery usage)"}),e.jsx(_e,{ref:o,stateChanged:p})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Scale"}),e.jsx(_e,{ref:s,stateChanged:h})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Contrast"}),e.jsx(_e,{ref:u,stateChanged:c})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Cutoff"}),e.jsx(_e,{ref:l,stateChanged:m})]})]})},So={FFT:ko},wo=({entryName:t,entryIcon:s,linkedSettingKey:o})=>{const[u,l]=n.useState(!1),r=n.useMemo(()=>So[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":u,onClick:a=>{a.stopPropagation(),l(!u)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:r&&u&&e.jsx(r,{})})]})},To=()=>{const[t,s]=n.useState(!1);n.useEffect(()=>{Oe(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(l=>l.json()).then(l=>{s(l)})})()},[]);const o=me();return e.jsxs("div",{className:"account-page",children:[e.jsx(_t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Je,{})}),e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:"Settings page"}),e.jsx("p",{children:"A shinny list of fancy settings."}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(wo,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Bs,{})})})]})]})]})},Eo=({user:t,totalStorage:s})=>{const[o,u]=n.useState(0);return n.useEffect(()=>{fetch(`${N}/read-write/user-data-usage/${t.id}`,{method:"GET",credentials:"include"}).then(l=>l.json()).then(l=>{u(l)}).catch(l=>{console.error("Error fetching user storage data: ",l)})},[]),e.jsxs("div",{className:"user-account-infos-entry",children:[e.jsx("p",{children:t.username}),e.jsx("p",{children:t.email}),e.jsx("p",{children:t.role}),e.jsx(lt,{percent:Number(o/s*100).toFixed(2),fillColor:"var(--cool-green)",showPercent:!0,style:{maxWidth:"200px"}})]})},qe={PENDING:"pending",RUNNING:"running",PAUSED:"paused",INACTIVE:"inactive"},Es=({jobName:t,description:s,jobKey:o,payload:u={},doneTotalView:l=null})=>{const[r,a]=n.useState(!1),[d,m]=n.useState(!0),[h,c]=n.useState(0),[p,f]=n.useState(!1),[x,b]=n.useState(null),j=n.useRef(null),F=(T=!0,U="",q=0)=>{var G=T;fetch(`${N}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(E=>E.json()).then(E=>{f(!1);let V=1e3;switch(E.status){case qe.PENDING:f(!0),a(!0),m(!1),V=500;break;case qe.INACTIVE:if(U===qe.RUNNING||U===qe.PENDING){setTimeout(()=>{a(!1),c(0),b(null),F(!1,E.status)},2e3),c(100),b({done:q,total:q,working:0}),G=!1,console.log("Stop fast fetch job");return}a(!1);break;case qe.PAUSED:m(!0),a(!0),V=500;break;case qe.RUNNING:m(!1),a(!0),V=10;break}j.current&&(clearTimeout(j.current),j.current=null),G&&(j.current=setTimeout(()=>{var B;if(E.progress){const W=E.progress.done/E.progress.total*100;c(W),b(E.progress)}else b(null);F(!0,E.status,((B=E.progress)==null?void 0:B.total)??0)},V))})},k=()=>{fetch(`${N}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{F(T.status===qe.RUNNING)})},S=()=>{const T=new FormData;T.append("payload",JSON.stringify(u)),fetch(`${N}/jobs/run/${o}`,{method:"POST",credentials:"include",body:T}).then(U=>U.json()).then(U=>{F(!0)})},$=()=>{fetch(`${N}/jobs/pause/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{F(!1)})},L=()=>{fetch(`${N}/jobs/resume/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{F(!0)})},I=()=>{fetch(`${N}/jobs/stop/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{F(!1)})};n.useEffect(()=>(k(),()=>{j.current&&(console.log("Trying clearTimout"),clearTimeout(j.current),j.current=null)}),[]);const P=async()=>{if(r){d?L():$(),m(!d);return}S()},R=async()=>{I(),c(0)};return e.jsxs("div",{className:"backend-job",children:[e.jsx("h3",{children:t}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"baseline",flexWrap:"wrap"},children:[e.jsx(se,{text:r?d?"Resume":"Pause":"Run",icon:r?d?e.jsx(Kr,{}):e.jsx(Qr,{}):e.jsx(Jr,{}),onClick:P}),e.jsx(se,{text:"Stop",icon:e.jsx(Yr,{}),onClick:R}),e.jsx(lt,{style:{height:"25px",filter:`grayscale(${d&&r?.8:0})`},minWidth:"200px",percent:h,showPercent:!1,text:x?l.current?`${x.done}/${x.total}`:`Working: ${x.working} | Left : ${x.total-x.done}`:null,fillColor:"linear-gradient(90deg, rgb(187, 251, 223) 0%, rgb(198, 203, 253) 50%, rgb(239, 201, 249) 100%)",initialising:p,initialisingColor:"violet"})]}),e.jsx("p",{children:s}),e.jsx("div",{className:"job-status","data-running":d?"false":"true","data-status":r?p?"init":d?"stop":"run":"inactive",children:e.jsx("span",{children:r?p?"Initlialising":d?"Paused":"Running":"Inactive"})})]})},Co=()=>{const t=n.useRef(null),s=n.useRef(null),o=n.useRef(null),u=n.useRef(null),[l,r]=n.useState(!1),a=p=>{t.current.samples=Math.floor(p),h()},d=p=>{t.current.samplingInterval=1/Math.floor(p),h()},m=p=>{t.current.parallelCompute=Math.floor(p),h()},h=()=>{const p=new FormData;p.append("FFT",JSON.stringify(t.current)),fetch(`${N}/config/send/FFT`,{method:"POST",credentials:"include",body:p})},c=async()=>{await fetch(`${N}/config/FFT`,{method:"GET",credentials:"include"}).then(p=>p.json()).then(p=>{t.current=p}),r(t.current.useServerFFT),o.current.value=t.current.samples,s.current.value=Math.floor(1/t.current.samplingInterval),u.current.value=t.current.parallelCompute};return n.useEffect(()=>{c()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line",children:[e.jsx("span",{children:"Activate audio spectra computation"}),e.jsx(No,{defaultValue:t.current,active:l,setActive:p=>{r(p),t.current&&(t.current.useServerFFT=p,h())}})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame definiton (power of 2)"}),e.jsx(_e,{ref:o,stateChanged:a,max:4096,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame per second"}),e.jsx(_e,{ref:s,stateChanged:d,max:120,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Number of parallel analyzed songs"}),e.jsx(_e,{ref:u,stateChanged:m,max:10,min:1})]})]})},Ro={FFT:Co},Ao=({entryName:t,entryIcon:s,linkedSettingKey:o})=>{const[u,l]=n.useState(!1),r=n.useMemo(()=>Ro[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":u,onClick:a=>{a.stopPropagation(),l(!u)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:r&&u&&e.jsx(r,{})})]})},Io=()=>{const t=()=>localStorage.getItem("job-progress-view")?localStorage.getItem("job-progress-view")==="true":!0,[s,o]=n.useState(!1),[u,l]=n.useState([]),[r,a]=n.useState(0),d=n.useRef(t()),m=me();n.useEffect(()=>{Oe(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{o(x)})})()},[]),n.useEffect(()=>{s.error||fetch(`${N}/auth/init-admin-pannel`,{method:"POST",credentials:"include"}).then(f=>f.json()).then(f=>{l(f.users),a(f.totalStorage)})},[s]);const h=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You are not an admin."})]}),c=f=>{const x=f===0;d.current=x,localStorage.setItem("job-progress-view",x)},p=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Admin pannel"}),e.jsx("p",{children:"Only for the true admins."}),e.jsxs("div",{className:"admin-category",children:[e.jsx(Xr,{}),e.jsx("h2",{children:"Users' storage usage"})]}),e.jsx("div",{className:"all-users-list",children:u.map(f=>e.jsx(Eo,{user:f,totalStorage:r},f.id))}),e.jsxs("div",{className:"admin-category",children:[e.jsx(Zr,{}),e.jsx("h2",{children:"Backend processes"}),e.jsx(Js,{data:["Done/Total","Working/Remaining"],currentActive:t()?0:1,onClick:c})]}),e.jsxs("div",{className:"job-grid",children:[e.jsx(Es,{jobKey:"JOB_CD",jobName:"Recompute tracks number and CDs",description:"Reextract the metadatas of the songs to remap them to the correct CD or track number. Analyses lossless.",doneTotalView:d}),e.jsx(Es,{jobKey:"JOB_FFT",jobName:"Compute audio spectras",description:"Runs a fast Fourier transform on each audio files to extract the audio spectrum. The result is writen into .bin files. For a .flac audio of 41kHz, we expect 3Mb spectrum file.",payload:{completeLibrary:!0},doneTotalView:d})]}),e.jsxs("div",{className:"admin-category",children:[e.jsx(ea,{}),e.jsx("h2",{children:"Configuration"})]}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Ao,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Bs,{})})})]});return e.jsxs("div",{className:"account-page",children:[e.jsx(_t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>m("/home"),children:e.jsx(Je,{})}),e.jsx("div",{className:"account-info",children:s?e.jsx(p,{}):e.jsx(h,{})})]})]})},Fo=()=>{const[t,s]=n.useState(!0),o=me(),u=async r=>{if(r.preventDefault(),!r.target.email.value||!r.target.password.value||!r.target.repeat_password.value||!r.target.name.value){alert("Please fill in all fields");return}if(r.target.password.value!==r.target.repeat_password.value){alert("Passwords do not match");return}const a=new FormData(r.target),d=await fetch(`${N}/auth/register`,{method:"POST",credentials:"include",body:a}),m=await d.json();d.ok?(alert("User registered successfully"),o("/home")):alert(m.error)};n.useEffect(()=>{fetch(`${N}/auth/any-user`,{method:"GET"}).then(r=>r.json()).then(r=>{s(r===0)})},[]);const l=()=>e.jsxs("div",{style:{marginBottom:"30px",display:"flex",flexDirection:"row",alignItems:"center",margin:"auto",gap:"20px"},children:[e.jsx("p",{style:{textWrap:"nowrap"},children:"Already an account?"}),e.jsx("button",{style:{width:"100%"},onClick:r=>{r.stopPropagation(),o("/")},children:"Login"})]});return e.jsxs("div",{className:"authDiv",children:[e.jsx(Ot,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(en,{}),e.jsx(te,{}),e.jsx("h2",{children:"Register"}),e.jsx("p",{children:t?`Welcome to the Crystal Music Library! Since you are the first 
            to show up here, we would like you to create the admin account.`:"Please fill the form to register as a new user."}),!t&&e.jsx(l,{}),e.jsxs("form",{onSubmit:u,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"new-password"}),e.jsx("label",{htmlFor:"repeat_password",children:"Confirm Password"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",name:"repeat_password",autoComplete:"password"}),e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",autoComplete:"name"}),e.jsx("button",{type:"submit",children:"Register"})]})]})},Po=()=>{const[t,s]=n.useState(null),{genreId:o}=Lt(),{addContainerToQueue:u,playContainerSuffle:l,playContainer:r,navigateBack:a}=re();n.useEffect(()=>{fetch(`${N}/read-write/genre/${o}`,{method:"GET",credentials:"include"}).then(c=>{if(!c.ok)throw new Error("Network response was not ok");return c.json()}).then(c=>{s(c),console.log(c)})},[]);const d=async()=>{r(o,"genre")},m=async()=>{u(o,"genre")},h=async()=>{l(o,"genre")};return e.jsxs("div",{className:"genre-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:a,children:e.jsx(Je,{})}),t?e.jsxs("div",{className:"genre-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(se,{text:"Play",icon:e.jsx(Zt,{}),onClick:d}),e.jsx(se,{text:"Random",icon:e.jsx(it,{}),onClick:h}),e.jsx(se,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:m})]}),e.jsx("div",{className:"genre-albums album-displayer",children:t.albums.map(c=>e.jsx(os,{album:c},c.id))})]}):e.jsx("p",{children:"Loading..."})]})},Lo=({genre:t})=>{const s=me(),[o,u]=n.useState([]),[l,r]=n.useState([]),a=n.useRef([]),d=n.useRef(l),m=n.useRef([]),h=f=>{var b;if(console.log("changed on",f),!((b=d.current)!=null&&b.length)==0)return;const x=document.getElementById(`genre-${t.id}-img-${f}`);x==null||x.setAttribute("data-hidden","true"),setTimeout(()=>{x&&(x.src=`${N}/covers/${d==null?void 0:d.current[f]}`),x==null||x.removeAttribute("data-hidden")},500)};n.useEffect(()=>(c(u),p(),[2e3,2500,3e3].forEach((x,b)=>{setTimeout(()=>h(b),x);const j=setInterval(()=>h(b),7e3);m.current.push(j)}),()=>{a.current.forEach(clearTimeout),a.current=[],m.current.forEach(clearInterval),m.current=[],d.current=[]}),[]);const c=f=>{fetch(`${N}/read-write/trackCoversGenre/${t.id}`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{f(x)})};n.useEffect(()=>{d.current=l},[l]);const p=()=>{c(r),setTimeout(p,5500)};return e.jsxs("div",{className:`genre-card ${t==null?void 0:t.puredName}`,onClick:()=>{s(`/genres/${t.id}`)},children:[e.jsx("div",{className:"card-pivot-origin",children:o.map((f,x)=>e.jsx("div",{className:"img-pivot",style:{"--start-delay":`${3*(2-x)}`,"--start-angle":`${2-x}`,"--speed":"0.7","--scale":.4},children:e.jsx("img",{id:`genre-${t.id}-img-${x}`,className:"genre-img-cover",style:{"--scale":.7},src:`${N}/covers/${f}`})},x))}),e.jsx("div",{className:"genre-name",children:e.jsx("p",{children:t.name})})]})},$o=[{name:"rock"},{name:"hiphop"},{name:"jazz"},{name:"edm"},{name:"house"},{name:"techno"},{name:"trance"},{name:"dubstep"},{name:"reggae"},{name:"ska"},{name:"country"},{name:"folk"},{name:"acoustic"},{name:"singer"},{name:"songwriter"},{name:"latin"},{name:"salsa"},{name:"reggaeton"},{name:"afrobeat"},{name:"jpop"},{name:"jpop"},{name:"lofi"},{name:"electronic"},{name:"indie"},{name:"alternative"},{name:"punk"},{name:"metal"},{name:"opera"},{name:"classical"},{name:"funk"},{name:"blues"},{name:"soul"},{name:"rnb"},{name:"chillhop"},{name:"ambiant"},{name:"soundtrack"},{name:"art-rock"},{name:"pop-rock"},{name:"breakcore"},{name:"worldwide"},{name:"rnb-soul"},{name:"hard-rock"},{name:"shoegaze"},{name:"indie-rock"},{name:"traditional"},{name:"anime"},{name:"pop"}],Oo=new Gs($o,{keys:["name"],threshold:.4}),Mo=t=>{const s=t.replace(/[^a-zA-Z ]/g," "),o=Oo.search(s);return"genre-"+(o.length>0?o[0].item.name:"default")},Uo=({})=>{var a,d;const{subscribe:t}=ge(),[s,o]=n.useState([]),[u,l]=n.useState(()=>{const m=localStorage.getItem("CML_FinishedTutorials");return m&&JSON.parse(m).state[we.GENRES]||!1}),r=()=>{fetch(`${N}/read-write/genres`,{method:"GET",credentials:"include"}).then(m=>m.json()).then(m=>{m.genres=m.genres.map(h=>({...h,puredName:Mo(h.name)})),o(m)})};return n.useEffect(()=>{const m=t(`safe-finished-tutorial-${we.GENRES}`,()=>{l(!0)}),h=t("musicUploaded",r);return Oe(()=>{r()})(),()=>{h(),m()}},[]),e.jsx(e.Fragment,{children:((a=s==null?void 0:s.genres)==null?void 0:a.length)!==0?e.jsx("div",{className:"home genre-displayer",children:(d=s==null?void 0:s.genres)==null?void 0:d.map(m=>e.jsx(Lo,{genre:m},m.id))}):(s==null?void 0:s.trackNum)>0?u?e.jsxs("div",{className:"info-line",id:"text-no-genre",children:[e.jsx("span",{children:"No genres found in the library."}),e.jsx(Xt,{className:"info-button",onClick:()=>{l(!1)}})]}):e.jsx(Xs,{tutorialKey:we.GENRES}):e.jsx(cs,{})})},_o=({playlist:t})=>{const s=me(),o=u=>{s(`/playlists/${u}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>o(t.id),children:[t.cover?e.jsx("img",{src:`${N}/covers/${t.cover}`,alt:`${t.name} cover`,className:"artist-card-cover"}):e.jsx(te,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},Bo=()=>{const[t,s]=n.useState([]),{createNewPlaylist:o,setPlaylistAddedCallback:u}=re(),l=()=>{fetch(`${N}/read-write/playlists`,{method:"GET",credentials:"include"}).then(r=>r.json()).then(r=>s(r))};return n.useEffect(()=>{Oe(()=>{l(),u(l)})()},[]),e.jsxs("div",{children:[e.jsx(se,{className:"buttonRound",id:"new-playlist",onClick:o,icon:e.jsx(ta,{}),text:"Create a new playlist"}),e.jsx("div",{className:"album-displayer",children:t.map(r=>e.jsx(_o,{playlist:r},r.id))})]})},Go=()=>{const t=n.useRef(null),s=n.useRef(null),[o,u]=n.useState(!1),[l,r]=n.useState([]),{playAudioSalad:a,setSaladContext:d,saladContext:m,openTagWindow:h}=re(),[c,p]=n.useState([]),[f,x]=n.useState([]),{addNotification:b,notifTypes:j}=Ie(),[F,k]=n.useState([]),[S,$]=n.useState(!1),[L,I]=n.useState(!1),P=n.useRef(null),R=n.useRef(null),[T,U]=n.useState("#aabbcc"),[q,G]=n.useState(!0),{subscribe:E}=ge(),[V,B]=n.useState(()=>{const H=localStorage.getItem("CML_FinishedTutorials");return H&&JSON.parse(H).state[we.COOKING]||!1});n.useEffect(()=>{const H=le=>{t.current&&!t.current.contains(le.target)&&X()},D=()=>{B(!0)};let ae=E(`safe-finished-tutorial-${we.COOKING}`,D);return Oe(()=>{c.length===0&&p(m||[]),fetch(`${N}/read-write/mostUsedTags`,{method:"GET",credentials:"include"}).then(le=>le.json()).then(le=>{const A=le.map(Q=>({...Q,type:Q.total,typeElem:"tag",icon:()=>e.jsx(vt,{color:Q.color}),tooltip:y=>e.jsx("span",{children:y})}));x(A),r(A)}),document.addEventListener("mousedown",H),document.addEventListener("touchstart",H)})(),()=>{ae(),document.removeEventListener("mousedown",H),document.removeEventListener("touchstart",H)}},[]);const W=H=>{const D=H.target.value;if(D===""||D.trim().length===0){r(f);return}fetch(`${N}/read-write/search/${D}/tags,salads`,{method:"GET"}).then(ae=>{if(ae.ok)return ae.json();throw new Error("Error fetching search results")}).then(ae=>{var le,A;const be=[...(le=ae.tags)==null?void 0:le.map(Q=>({...Q,typeElem:"tag",icon:()=>e.jsx(vt,{color:Q.color})})),...(A=ae.salads)==null?void 0:A.map(Q=>({...Q,typeElem:"salad",icon:()=>e.jsx(at,{color:Q.color})}))];console.log(be),r(be)})},X=()=>{u(!1)},Z=H=>{p(D=>D.filter(ae=>ae.id!==H))},he=H=>{X(),console.log(H),!c.find(D=>D.id===H.id)&&p(D=>[...D,H])},ie=async()=>{a(F.map(H=>H.id)),d(c)};n.useEffect(()=>{if(d(c),c.length===0){k([]),G(!0);return}G(c.findIndex(D=>D.typeElem==="salad")===-1);const H=new FormData;H.append("tags",JSON.stringify(c.filter(D=>D.typeElem==="tag").map(D=>D.id))),H.append("salads",JSON.stringify(c.filter(D=>D.typeElem==="salad").map(D=>D.id))),fetch(`${N}/read-write/getSalad`,{method:"POST",body:H}).then(D=>D.json()).then(D=>JSON.parse(D)).then(D=>{k(gt.shuffle(D)),console.log("New tracks received",D),D.length>0?b("Salad received! Enjoy..",j.SALAD):b("This salad is empty.. No tracks found.",j.SALAD)})},[c]);const fe=async()=>{c.length!==0&&($(!0),U(`${Vs(Math.random().toFixed(4)*360,100,70.8)}`))},de=()=>{if(!R.current.value||($(!1),c.find(D=>D.typeElem==="salad")))return;const H=new FormData;H.append("salad",JSON.stringify({name:R.current.value,color:T,tags:c.map(D=>D.id)})),fetch(`${N}/read-write/newSalad`,{method:"POST",credentials:"include",body:H}).then(D=>D.json()).then(D=>{b("Salad saved!",j.SUCCESS),p([D])})},pe=H=>{a(F.map(D=>D.id),H)},Te=()=>{u(!0),s.current.value};return e.jsxs(e.Fragment,{children:[e.jsx(Xt,{className:"info-button",id:"cooking-info",onClick:()=>{B(!1)}}),V?e.jsxs("div",{className:"cooking-div",children:[e.jsx("h2",{children:"Here select some tags and play the music!"}),e.jsxs("div",{className:"cooking-header",children:[e.jsx("div",{className:"action-bar",style:{margin:"auto"},ref:t,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",style:{zIndex:"2"},children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Qe,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:W,placeholder:"Search some tags or salads..",ref:s,onFocus:Te}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Ae,{height:300,itemCount:l.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:H,style:D})=>e.jsx(Nt,{entry:l[H],style:{...D,width:" calc(100% - 20px)",marginTop:"10px"},onClick:he},H)})})]})}),e.jsx("button",{className:"open-tags-edit",onClick:h,children:e.jsx(sa,{})})]}),e.jsxs("div",{className:"cooking-selection",children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(se,{text:"Play salad",icon:e.jsx(na,{}),onClick:ie}),q&&e.jsx(se,{text:"Save salad",icon:e.jsx(ra,{}),onClick:fe})]}),e.jsx("div",{className:"cooking-tags",style:{marginBottom:"30px"},children:c.map(H=>e.jsxs("div",{className:"small-tag","data-prefix":H.typeElem==="salad",style:{backgroundColor:H.color},children:[H.typeElem==="salad"&&e.jsx(at,{"data-prefix":"true"}),e.jsx("span",{children:H.name}),e.jsx(xe,{onClick:()=>{Z(H.id)}})]},H.id))}),e.jsx("div",{className:"track-list",children:F.map((H,D)=>e.jsx(tn,{index:D,isSalad:pe,track:H,playIconId:"salad",showCover:!0},H.id))})]}),S?e.jsxs("div",{className:"edit-tag",style:{left:"calc(50% - 170px)",margin:"auto"},children:[e.jsx(xe,{style:{cursor:"pointer"},onClick:()=>{$(!1)}}),e.jsx("input",{type:"text",placeholder:"Name your new salad.",ref:R}),e.jsx(aa,{style:{cursor:"pointer"},id:"color-button",color:T,onClick:()=>{I(!L)}}),L&&e.jsxs("div",{ref:P,className:"edit-tag-picker",children:[" ",e.jsx(ss,{color:T,onChange:U})]}),e.jsx(ot,{onClick:de,style:{cursor:"pointer"}})]}):null]}):e.jsx(Xs,{tutorialKey:we.COOKING})]})},Cs=({radio:t})=>{const{playRadio:s,externalRadioInfos:o}=re();return e.jsxs("div",{className:"album-card",onClick:()=>{t.id?o.current=null:o.current=t,s(t.id?`radio-id:${t.id}`:`radio-url:${t.url}`)},children:[t.coverUrl?e.jsx("img",{src:`${N}/radio/favicon-proxy?url=${encodeURIComponent(t.coverUrl)}`,alt:`${Be(t.name,25)} cover`,className:"album-card-cover"}):e.jsx(te,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Be(t.name,40)})]})},Do=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]}),Vo=()=>{const[t,s]=n.useState(!1),[o,u]=n.useState([]),[l,r]=n.useState([]),{subscribe:a}=ge(),{addNotification:d,notifTypes:m}=Ie();n.useEffect(()=>{const x=a("refetch-known-radios",h);return Oe(()=>{h()})(),()=>{x()}},[]);const h=async()=>{const x=await fetch(`${N}/radio/radios`,{method:"GET",credentials:"include"}).then(j=>j.json());s(!0);const b=(x==null?void 0:x.length)>0?x.map(j=>({...j,uuid:j.id})):[];u(b)},c=async()=>{d("Comming soon! :)",m.INFO)},p=async()=>{const b=(await fetch(`${N}/radio/stations`).then(j=>j.json()).then(j=>JSON.parse(j))).map(j=>({coverUrl:j.favicon,name:j.name,url:j.url_resolved,uuid:j.stationuuid}));r(b)},f=async()=>{window.open("https://www.radio-browser.info/tags","_blank").focus()};return e.jsxs("div",{className:"home",id:"radio-page",children:[e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(Ut,{}),e.jsx("h3",{children:"Favorite radios"})]}),e.jsx("div",{className:"album-displayer",id:"fav-radios","data-flat":"true","data-no-tracks":(o==null?void 0:o.length)==0&&t?"true":"false",children:t?(o==null?void 0:o.length)>0?o.map(x=>e.jsx(Cs,{radio:x},x.id)):null:e.jsx(Do,{})}),e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(oa,{}),e.jsx("h3",{style:{marginRight:"20px"},children:"Discover"})]}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(se,{text:"Filters",icon:e.jsx(ca,{}),onClick:c}),e.jsx(se,{text:"Random",icon:e.jsx(it,{}),onClick:p}),e.jsx(se,{text:"External search",icon:e.jsx(ia,{}),onClick:f})]}),e.jsx("div",{className:"album-displayer",children:(l==null?void 0:l.length)!==0?l.map((x,b)=>e.jsx(Cs,{radio:x},b)):null})]})},Ho=()=>{const t=n.useRef(),s=n.useRef(null),{getFFTAtCurrentTime:o,fftConfigRef:u,globalAudioRef:l,FFTUserSetingsRef:r,fetchFFTUserSettings:a,colorOverride:d,currentTrackData:m}=re(),h=n.useRef(0),c=p=>{var x,b;if((m==null?void 0:m.type)=="radio"){cancelAnimationFrame(t.current);return}if(!s.current){t.current=requestAnimationFrame(c);return}const f=s.current.getContext("2d");if(f&&r.current&&d.current){if(p-h.current<1e3/r.current.FPS){t.current=requestAnimationFrame(c);return}h.current=p;const j=r.current.bars;f.clearRect(0,0,s.current.width,s.current.height);const F=o();if(!F){t.current=requestAnimationFrame(c);return}u.current.sampleRate/F.length;const k=Math.max(1,F.length/j),S=new Array(j);S.fill(0);for(let I=0;I<F.length;I++)S[Math.floor(I/k)]+=Number(F[I]);let $=s.current.width/j-1,L=0;for(let I=0;I<S.length;I++){const P=r.current.scale*Math.log2(S[I])*(j/5)*((x=l.current)==null?void 0:x.volume);if(((b=d.current)==null?void 0:b.length)>0){const R=Math.min(1,Math.max(0,P/r.current.scale/r.current.contrast/300));f.fillStyle=`rgb(
						${We(d.current[0][0],d.current[1][0],R)} 
						${We(d.current[0][1],d.current[1][1],R)}
						${We(d.current[0][2],d.current[1][2],R)}
						)`}else f.fillStyle=`rgb(${P/r.current.scale/r.current.contrast} 137 255)`;f.fillRect(L,s.current.height-P,$,P),L+=$+1}}t.current=requestAnimationFrame(c)};return n.useEffect(()=>{if(!u.current){cancelAnimationFrame(t.current),console.log("No FFT data to display, releasing anim frame.");return}t.current=requestAnimationFrame(c),console.log("FFT found, requested animation frame.")},[u.current]),n.useEffect(()=>(t.current=requestAnimationFrame(c),()=>{cancelAnimationFrame(t.current)}),[]),e.jsx("canvas",{ref:s,id:"fft-canvas",width:1900,height:1e3})},zo=()=>{const{playingTrack:t}=re();return e.jsxs("div",{className:"content-with-fft",children:[e.jsx(Rs,{})," ",t?e.jsx(Ho,{}):null]})},qo=()=>{const{fullScreenImage:t,currentTrackData:s,requestNewFullScreenImage:o,playingTrack:u,toggleFullScreenView:l,colorOverride:r,recomputeColors:a,songPalette:d}=re(),m=n.useRef(null),h=n.useRef(null),c=n.useRef(null),p=n.useRef(null),f=n.useRef(null),x=n.useRef(!1),b=n.useRef(0),j=3,F=n.useRef(0),[k,S]=n.useState(!1);n.useRef([]);const $=n.useRef(0),L=n.useRef(0),I=n.useRef(0),P=E=>{x.current?(m.current.src=URL.createObjectURL(E),h.current.src=URL.createObjectURL(E),f.current=m.current):(c.current.src=URL.createObjectURL(E),p.current.src=URL.createObjectURL(E),f.current=c.current),f.current.addEventListener("load",U)};n.useEffect(()=>{if(m.current&&h.current){if((s==null?void 0:s.type)=="radio"){if(s.coverUrl){const E=`${N}/radio/favicon-proxy?url=${encodeURIComponent(s.coverUrl)}`;x.current?(m.current.src=E,h.current.src=E,f.current=m.current):(c.current.src=E,p.current.src=E,f.current=c.current)}return}u&&((t==null?void 0:t.track)!==u?(x.current=!x.current,o().then(E=>{P(E.blob)})):P(t.blob))}},[s,u]);const R=(E,V)=>{E?(m.current.setAttribute("data-hidden",V),h.current.setAttribute("data-hidden",V)):(c.current.setAttribute("data-hidden",V),p.current.setAttribute("data-hidden",V))},T=()=>{m.current.removeEventListener("load",U),q()},U=()=>{var E;(E=f.current)!=null&&E.src&&(R(x.current,!1),R(!x.current,!0),clearTimeout($.current),$.current=setTimeout(()=>{x.current?c.current&&(c.current.src=null,p.current.src=null):m.current&&(m.current.src=null,h.current.src=null)},1100),a(f,T))},q=()=>{const E=d.current.pairs.length||0;if(E===0)return;const V=d.current.pairs[E-1-I.current%E],B=[V.c1,V.c2];I.current+=1,clearTimeout(L.current),r.current.length===0?r.current=B:G(B,0)},G=(E,V)=>{r.current=r.current.map((B,W)=>B.map((X,Z)=>parseInt(We(X,E[W][Z],.1)))),!(V>150)&&(L.current=setTimeout(()=>{G(E,V+1)},1e3/60))};return n.useEffect(()=>{var W,X;const E=()=>{b.current=0,S(!1)},V=()=>{b.current++,b.current>=j?+S(!0):S(!1)},B=["mousemove","keydown","mousedown","touchstart","scroll"];return B.forEach(Z=>{window.addEventListener(Z,E)}),F.current=setInterval(V,1e3),(W=f.current)!=null&&W.complete&&((X=f.current)!=null&&X.src)&&a(m,T),()=>{B.forEach(Z=>{window.removeEventListener(Z,E)}),clearInterval(F.current),clearTimeout(L.current),r.current=[]}},[]),e.jsxs("div",{id:"full-screen-page",children:[e.jsxs("div",{className:"full-screen-header",children:[e.jsx("button",{className:"roundButton full-screen-back go-back","data-inactive":k,onClick:l,children:e.jsx(Je,{})}),e.jsx("button",{className:"roundButton full-screen-back","data-inactive":k,onClick:q,children:e.jsx(la,{})})]}),e.jsx("div",{"data-inactive":k,className:"full-screen-audio-ctrl",children:e.jsx($t,{context:""})}),(u||(s==null?void 0:s.type)=="radio")&&e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:h,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:m,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"})}),e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:p,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:c,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"})})]})]})};function Wo(t=[]){const s=Ke();n.useEffect(()=>{t.includes(s.pathname)?(document.documentElement.classList.add("scroll-enabled"),document.body.classList.add("scroll-enabled")):(document.documentElement.classList.remove("scroll-enabled"),document.body.classList.remove("scroll-enabled"))},[s,t])}const Ko=()=>(Wo(["/","/register","/settings","/admin-pannel"]),e.jsx(ha,{children:e.jsx(ja,{children:e.jsxs(Pa,{children:[" ",e.jsx(ro,{children:e.jsxs(or,{children:[e.jsx(ce,{path:"/",element:e.jsx(go,{})}),e.jsx(ce,{path:"register",element:e.jsx(Fo,{})}),e.jsx(ce,{element:e.jsx(zo,{}),children:e.jsx(ce,{path:"full-screen",element:e.jsx(qo,{})})}),e.jsxs(ce,{element:e.jsx(uo,{}),children:[e.jsx(ce,{path:"home",element:e.jsx(mo,{})}),e.jsx(ce,{path:"albums",element:e.jsx(ho,{})}),e.jsx(ce,{path:"albums/:albumId",element:e.jsx(Ts,{})}),e.jsx(ce,{path:"artists",element:e.jsx(vo,{})}),e.jsx(ce,{path:"artists/:artistId",element:e.jsx(jo,{})}),e.jsx(ce,{path:"genres",element:e.jsx(Uo,{})}),e.jsx(ce,{path:"genres/:genreId",element:e.jsx(Po,{})}),e.jsx(ce,{path:"playlists",element:e.jsx(Bo,{})}),e.jsx(ce,{path:"playlists/:playlistId",element:e.jsx(Ts,{isPlaylist:!0})}),e.jsx(ce,{path:"cooking",element:e.jsx(Go,{})}),e.jsx(ce,{path:"radio",element:e.jsx(Vo,{})})]}),e.jsx(ce,{path:"account",element:e.jsx(yo,{})}),e.jsx(ce,{path:"settings",element:e.jsx(To,{})}),e.jsx(ce,{path:"admin-pannel",element:e.jsx(Io,{})}),e.jsx(ce,{path:"*",element:e.jsx(bo,{})})]})})]})})}));ar.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(cr,{children:e.jsx(Ko,{})})}));
