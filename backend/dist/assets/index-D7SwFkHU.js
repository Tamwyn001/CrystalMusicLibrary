import{r as n,j as e}from"./react-DmLYqgKm.js";import{c as Bn}from"./react-dom-DPPwivfB.js";import{u as ye,a as ht,L as at,O as ys,b as $t,R as Dn,c as pe,B as Gn}from"./react-router-C4BYJpcq.js";import{I as Vn,a as lt,b as zt,c as we,d as ut,e as Hn,f as kt,g as dt,h as bs,i as zn,j as qn,k as Wn,l as Kn,m as Jn,n as bt,o as Vt,p as Ns,q as Xe,r as ks,s as Ss,t as Yn,u as ws,v as Qn,w as Xn,x as Zn,y as er,z as tr,A as sr,B as nr,C as rr,D as qt,E as ar,F as or,G as cr,H as ir,J as Ts,K as Wt,L as mt,M as lr,N as Es,O as Dt,P as ur,Q as dr,R as mr,S as hr,T as fr,U as Kt,V as pr,W as gr,X as xr,Y as vr,Z as jr,_ as yr,$ as br,a0 as Nr,a1 as kr,a2 as Sr,a3 as wr,a4 as Ze,a5 as Jt,a6 as Tr,a7 as Er,a8 as Cr,a9 as Rr,aa as Ar,ab as Cs,ac as Ir,ad as Fr,ae as Lr,af as Pr,ag as $r,ah as Or,ai as Mr,aj as Ur,ak as _r,al as Br,am as Dr,an as Gr,ao as Vr,ap as Hr,aq as zr}from"./@tabler-Dq-diia7.js";import{F as Be}from"./react-window-Dlc0x0tK.js";import{v as yt}from"./uuid-C6aID195.js";import{Z as Yt}from"./react-colorful-0uAH5Wqu.js";import{_ as it}from"./lodash-BhRqD2di.js";import{p as qr}from"./music-metadata-CvBiwAZp.js";import{a as Wr}from"./axios-xsH4HHeE.js";import{F as Rs}from"./fuse.js-Ch1WBRTM.js";import"./content-type-kkloIWN6.js";import"./scheduler-SPyfQU6S.js";import"./cookie--_YQFYBD.js";import"./@babel-Cj2_JSWT.js";import"./memoize-one-CcMeOnPo.js";import"./strtok3-BXaumHbT.js";import"./peek-readable-BVp5v6zA.js";import"./file-type-BdA4k6lR.js";import"./token-types-D2R8hC8p.js";import"./ieee754-DcnkbHBT.js";import"./@tokenizer-Sx_RGPFW.js";import"./fflate-D0DoR3vL.js";import"./debug-Dqg9INeJ.js";import"./ms-CzQ2E3wO.js";import"./uint8array-extras-B1Dultle.js";import"./media-typer-Kaw9hxcp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&u(r)}).observe(document,{childList:!0,subtree:!0});function c(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(l){if(l.ep)return;l.ep=!0;const a=c(l);fetch(l.href,a)}})();const Kr=()=>{const t=window.location.hostname,s=window.location.port;return t==="localhost"||t.startsWith("127.0.0.1")?`http://localhost:${s}`:`http://${t}:${s}`},b=Kr(),As=n.createContext(),Le=()=>n.useContext(As),Jr=({children:t})=>{const s=n.useRef({}),c=(l,a)=>(s.current[l]||(s.current[l]=[]),s.current[l].push(a),console.log("registered",l,a),()=>{s.current[l]=s.current[l].filter(r=>r!=a)}),u=(l,a)=>{s.current[l]&&s.current[l].forEach(r=>{r(a),console.log("called at",r)})};return e.jsx(As.Provider,{value:{emit:u,subscribe:c},children:t})},Yr=()=>{const[t,s]=n.useState(!1),[c,u]=n.useState(!1),l=ye(),a=n.useRef(null),{subscribe:r}=Le(),d=()=>{s(!t)},f=()=>{fetch(`${b}/auth/logout`,{method:"POST",credentials:"include"}).then(h=>{h.ok?l("/"):console.error("Logout failed")}).catch(h=>{console.error("Error:",h)})},m=()=>{l("/account")},o=()=>{l("/settings")};return n.useEffect(()=>{fetch(`${b}/auth/is-admin`,{method:"POST",credentials:"include"}).then(p=>p.json()).then(p=>{u(p)});const h=p=>{var x;if(a.current&&!a.current.contains(p.target)){if(((x=p.target.closest("svg"))==null?void 0:x.id)==="user-button")return;s(!1)}};return r("action-bar-open",()=>{s(!1)}),document.addEventListener("mousedown",h),document.addEventListener("touchstart",h),()=>{document.removeEventListener("mousedown",h),document.removeEventListener("touchstart",h)}},[]),e.jsxs("div",{className:"userDropdown",ref:a,children:[e.jsx(Vn,{id:"user-button",className:"userImage buttonRound",onClick:d}),t&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"userAccount dropdownEntry",onClick:m,children:"Account"}),e.jsx("button",{className:"userSetting dropdownEntry",onClick:o,children:"Settings"}),c&&e.jsx("button",{className:"userSetting dropdownEntry",onClick:()=>{l("/admin-pannel")},children:"Admin pannel"}),e.jsx("button",{className:"userLogout dropdownEntry",onClick:f,children:"Logout"})]})]})},Qt=t=>{var s=function(r){return("00"+r).slice(-2)};const c=Math.floor(t/3600),u=Math.floor(t%3600/60),l=s(Math.floor(t%60)),a=c>0?`${c}:${u}:${l}`:`${u}:${l}`;return{hours:c,minutes:u,seconds:l,readable:a}},Gt=t=>{const s=Math.floor(t/1024),c=Math.floor(s/1024),u=Math.floor(c/1024),l=Math.floor(u/1024),a=l>0?`${Number(t/1024/1024/1024/1024).toFixed(2)}TB`:u>0?`${Number(t/1024/1024/1024).toFixed(2)}GB`:c>0?`${Number(t/1024/1024).toFixed(2)}MB`:`${Number(t/1024).toFixed(2)}KB`;return{kb:s,mb:c,gb:u,tb:l,readable:a}},Is=(t,s,c)=>{s/=100,c/=100;let u=(1-Math.abs(2*c-1))*s,l=u*(1-Math.abs(t/60%2-1)),a=c-u/2,r=0,d=0,f=0;return 0<=t&&t<60?(r=u,d=l,f=0):60<=t&&t<120?(r=l,d=u,f=0):120<=t&&t<180?(r=0,d=u,f=l):180<=t&&t<240?(r=0,d=l,f=u):240<=t&&t<300?(r=l,d=0,f=u):300<=t&&t<360&&(r=u,d=0,f=l),r=Math.round((r+a)*255).toString(16),d=Math.round((d+a)*255).toString(16),f=Math.round((f+a)*255).toString(16),r.length==1&&(r="0"+r),d.length==1&&(d="0"+d),f.length==1&&(f="0"+f),"#"+r+d+f},hs=(t,s,c)=>(t=t.toString(16),s=s.toString(16),c=c.toString(16),t.length==1&&(t="0"+t),s.length==1&&(s="0"+s),c.length==1&&(c="0"+c),"#"+t+s+c),Ve=t=>{let s=0,c=0,u=0;return t.length==4?(s="0x"+t[1]+t[1],c="0x"+t[2]+t[2],u="0x"+t[3]+t[3]):t.length==7&&(s="0x"+t[1]+t[2],c="0x"+t[3]+t[4],u="0x"+t[5]+t[6]),[parseInt(s),parseInt(c),parseInt(u)]},Qe=(t,s,c)=>t+(s-t)*c,Qr=(t,s,c,u,l)=>Qe(u,l,(t-s)/(c-s)),qe=(t,s)=>{var c=t??"";return c.length>s?c.substring(0,s-2)+"..":c},Xr=(t="")=>{const s=["/","/register"];return new Promise(async c=>{const u=await fetch(`${b}/auth/verifyToken`,{method:"POST",credentials:"include"}).then(async l=>l.ok?!0:(s.includes(t)||await fetch(`${b}/auth/logout`,{method:"POST",credentials:"include"}).then(a=>{a.ok?window.location.href="/":console.error("Logout failed")}),!1));c(u)})},et=(t,s="")=>async function(){await Xr(s)&&t()},Zr=t=>t.charAt(0).toUpperCase()+t.slice(1),ie=({col1:t="#f9c58d",col2:s="#f492f0",className:c,style:u={},id:l=""})=>e.jsxs("svg",{id:l,viewBox:"0 0 512 512",style:{...u},className:c,xmlns:"http://www.w3.org/2000/svg",fill:"#000000",children:[e.jsxs("defs",{children:[e.jsx("mask",{id:"mask_logo",fill:"black",children:e.jsx("path",{fill:"white",d:"M116.215 17.404c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm64.326 12.87l-23.488 92.062h63.965l27.49-27.49-67.967-64.573zm228.147 25.958c0 20.214-20.216 40.428-40.43 40.428 20.214 0 40.43 20.214 40.43 40.428 0-20.214 20.213-40.428 40.427-40.428-20.214 0-40.428-20.214-40.428-40.428zm-150.022 53.913l-23.18 23.18L283.043 311h29.066l-53.443-200.855zm75.232 2.365l16.123 32.281 45.188 33.148-4.393-53.533-56.918-11.896zm-18.033 4.181l-26.685 38.121 10 37.586 33.38-42.283-16.695-33.424zm-160.672 23.645L172.42 206.4l21.988 12.623L239.043 311h25.365l-45.68-170.664h-63.535zm189.797 23.088l-40.03 50.703L330.737 311h.026l64.08-111.004-49.852-36.572zm122.352 5.834c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm-374.22 12.375l11.308 76.129 48.834-6.356 19.322-24.154-79.465-45.62zm346.995 53.793l-52.547 13.172L351.547 311h25.77l19.16-19.48 43.64-56.094zm-255.21 5.244l-17.403 21.75 25.77 48.58h25.761l-34.129-70.33zm-33.84 29.174l-39.005 5.074L148.145 311h24.751l-21.83-41.156zm-91.37 11.396c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zM137 329v30h238v-30H137zm32 48v78h16v-78h-16zm34 0v78h106v-78H203zm124 0v78h16v-78h-16zm-164.758 96l-30.119 16h247.754l-30.12-16H162.243z"})}),e.jsxs("linearGradient",{id:"grad_logo",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:t}),e.jsx("stop",{offset:"100%",stopColor:s})]})]}),e.jsx("rect",{x:"0",y:"0",width:"512",height:"512",fill:"url(#grad_logo)",mask:"url(#mask_logo)"})]}),St=({entry:t,style:s,onClick:c})=>e.jsxs("div",{className:"action-bar-entry",style:s,onClick:()=>{c(t)},children:[t.icon(),e.jsxs("span",{style:{flex:"1"},children:[" ",t.name]}),t.tooltip?t.tooltip(t.type):null]}),Fs=n.createContext(),xt={SUCCESS:"success",ERROR:"error",INFO:"info",SALAD:"salad"},ea=({children:t})=>{const[s,c]=n.useState(null),[u,l]=n.useState(null),a=n.useRef(null),r=n.useRef([]),d=(m,o)=>{r.current.forEach(p=>clearTimeout(p)),r.current=[],l({message:m,state:o}),c(!0);const h=setTimeout(()=>{a.current&&(a.current.setAttribute("direction",""),a.current.offsetWidth,a.current.setAttribute("direction","hide"));const p=setTimeout(()=>{c(!1),l(null)},300);r.current.push(p)},2e3);r.current.push(h)};n.useEffect(()=>{u&&c(!0)},[u]),n.useEffect(()=>{!s||!a.current||a.current.setAttribute("direction","show")},[s]);const f=()=>{if(!s)return null;switch(u==null?void 0:u.state){case xt.SUCCESS:return e.jsx(ut,{className:"notification-icon"});case xt.ERROR:return e.jsx(we,{className:"notification-icon"});case xt.INFO:return e.jsx(zt,{className:"notification-icon"});case xt.SALAD:return e.jsx(lt,{className:"notification-icon"});default:return null}};return e.jsxs(Fs.Provider,{value:{notifTypes:xt,addNotification:d},children:[t,u?e.jsx("div",{ref:a,className:"notification-parent",id:"notification-parent",children:e.jsxs("div",{className:"notification","is-open":u?"true":"false",children:[e.jsx(f,{}),e.jsx("span",{children:u.message})]})}):null]})},tt=()=>n.useContext(Fs),ta=({onClose:t,track:s})=>{const[c,u]=n.useState(!1),l=n.useRef(null),a=n.useRef(null),[r,d]=n.useState([]),[f,m]=n.useState(null),[o,h]=n.useState(""),{addNotification:p,notifTypes:x}=tt(),S=E=>{if(E.preventDefault(),o==""&&!f){t(!1);return}fetch(`${b}/read-write/moveTrackToAlbum/${o?"true/"+o:"false/"+f.id}/${s.id}`).then(C=>C.json()).then(C=>{p(`Track ${s.title} moved to 
            ${o||f.name}.`,x.INFO),t(!0)})},y=E=>{m(null),h(E.target.value)},O=E=>{const{tooltip:C,...I}=E;k(),m(I),h("")};n.useEffect(()=>{const E=C=>{a.current&&!a.current.contains(C.target)&&k()};return document.addEventListener("mousedown",E),document.addEventListener("touchstart",E),()=>{document.removeEventListener("mousedown",E),document.removeEventListener("touchstart",E)}},[]);const k=()=>{u(!1),l.current.value="",d([])},N=()=>e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Move to album"})," "]}),T=E=>{const C=E.target.value;if(C===""||C.trim().length===0){d([]);return}console.log(`${b}/read-write/search/${C}/${["albums"]}`),fetch(`${b}/read-write/search/${C}/${["albums"]}`,{method:"GET"}).then(I=>I.json()).then(I=>{d([...I.albums].map(B=>{const w=B.path,{trackPath:$,...H}=B;return{icon:()=>w?e.jsx("img",{className:"action-bar-entry-logo",src:`${b}/covers/${w}`,alt:B.name}):e.jsx(ie,{className:"action-bar-entry-logo"}),tooltip:N,...H}}))})};return e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:null,children:[e.jsx("h2",{children:"Move track to another album"}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:S,children:[e.jsx("label",{htmlFor:"newAlbum",style:o?{}:{opacity:"0.5"},children:"New album name"}),e.jsx("input",{type:"text",style:o?{}:{opacity:"0.5"},id:"newAlbum",placeholder:"Enter album name",onChange:y}),e.jsx("label",{htmlFor:"existingAlbum",style:o?{opacity:"0.5"}:{},children:"Existing album"}),e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:a,style:o?{opacity:"0.5"}:{},children:e.jsxs("div",{className:"action-bar-research",style:{transform:"translateX(15px)"},id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Hn,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:T,placeholder:"Search the album you want to move the track to.",ref:l,onFocus:()=>{u(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${c?"block":"none"}`},children:e.jsx(Be,{height:300,itemCount:r.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:E,style:C})=>e.jsx(St,{entry:r[E],style:{...C,width:" calc(100% - 20px)",marginTop:"10px"},onClick:O},E)})})]})}),f?e.jsxs("div",{style:{height:"90px",alignItems:"center",display:"flex",gap:"10px"},children:[f!=null&&f.icon?f.icon():null,f.name]}):null,e.jsx("input",{type:"submit",value:"Submit"})]})]})})},Ls=()=>e.jsxs("div",{className:"three-points-loader",children:[e.jsx("div",{className:"point point1"}),e.jsx("div",{className:"point point2"}),e.jsx("div",{className:"point point3"})]}),me=({onClick:t,text:s,icon:c,style:u})=>{const[l,a]=n.useState(!1),r=()=>{a(!0),t().then(()=>{a(!1)})},d=()=>l?e.jsx(Ls,{}):e.jsxs(e.Fragment,{children:[c,s]});return e.jsx("button",{className:"button-with-callback",style:{...u},onClick:r,children:e.jsx(d,{})})},sa=({applyCanges:t,albumClass:s})=>{var k,N;const[c,u]=n.useState({visible:!1}),[l,a]=n.useState(null),[r,d]=n.useState("2000-00-00"),[f,m]=n.useState(null),[o,h]=n.useState(!1),{deleteAlbum:p}=he();if(!s)return null;n.useEffect(()=>{s&&(a(s.coverURL),d(s.year))},[s]);const x=()=>{const T=document.getElementById("editAlbumInfos"),E=T.artistName.value.split(",").map(H=>H.trim()),C=T.genre.value.split(",").map(H=>H.trim()).map(H=>H.charAt(0).toUpperCase()+H.slice(1)).filter(H=>H!="");if(!(T.albumName.value!==s.name||s.artist.toString()!==E.toString()||s.year!==T.releaseDate.value||s.genre.toString()!==C.toString()||s.description!==T.description.value||f||o)){t(null);return}s.name=T.albumName.value,s.artist=E,s.year=T.releaseDate.value,s.genre=C,s.description=T.description.value;const{tracks:B,coverURL:w,...$}=s;console.log($),t($,f)},S=T=>{const E=T.target.files[0];E&&(s.ext=E.name.split(".").pop(),a(URL.createObjectURL(E)),m(E))},y=T=>{u({visible:!c.visible,...T})},O=T=>{console.log(T),!o&&T&&h(!0),u({visible:!1})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(ie,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:S})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"}),e.jsx(me,{onClick:async()=>{p(!0,{name:s.name,id:s.id})},text:"Delete for me",icon:e.jsx(dt,{}),style:{marginTop:"auto"}}),e.jsx(me,{onClick:async()=>{p(!1,{name:s.name,id:s.id})},text:"Remove from library",icon:e.jsx(dt,{})})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(k=s.artist)==null?void 0:k.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",value:r,onChange:T=>{d(T.target.value)}})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(N=s.genre)==null?void 0:N.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Be,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:T,style:E})=>e.jsxs("div",{style:E,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[T].title}),e.jsx(bs,{className:"trackIcon",onClick:()=>{y(s.tracks[T])}})]},T)})})]}),c.visible&&e.jsx(ta,{onClose:O,track:{id:c.id,title:c.title}})]})})},fs=({closeOverlay:t,applyCanges:s,editPlaylistClass:c})=>{const[u,l]=n.useState(null),[a,r]=n.useState(null),[d,f]=n.useState(c||{id:yt()}),[m,o]=n.useState([]),[h,p]=n.useState([]);n.useEffect(()=>{d&&l(d.coverURL),d.collaborators&&p(d.collaborators)},[d]);const x=()=>{const k=document.getElementById("editAlbumInfos");if(!(k.playlistName.value!==d.name||d.description!==k.description.value||a||d.collaborators.map(I=>!h.includes(I)).filter(I=>I))){s(null);return}d.name=k.playlistName.value,d.description=k.description.value,d.collaborators=h.map(I=>I.id);const{tracks:T,coverURL:E,...C}=d;console.log(C),s(C,a)},S=k=>{const N=k.target.files[0];N&&(d.ext=N.name.split(".").pop(),l(URL.createObjectURL(N)),r(N))};n.useEffect(()=>{fetch(`${b}/auth/collaborators`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{console.log(k),o(k)})},[]);const y=k=>{const N=k.target.value;h.includes(N)||N==="pickUsers"||(p(T=>[...T,m.find(E=>E.id==N)]),k.target.value="pickUsers")};n.useEffect(()=>{console.log(h)});const O=k=>{p(h.filter(N=>N.id!=k))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsx(we,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[u?e.jsx("img",{id:"coverPicture",src:u,style:{width:"100%"}}):e.jsx(ie,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:S})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"playlistName",children:"Playlist name"}),e.jsx("input",{type:"text",id:"playlistName",placeholder:"Enter playlist name",defaultValue:d==null?void 0:d.name}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",style:{height:"80px",paddingTop:"10px",paddingBottom:"10px"},placeholder:"Enter description",defaultValue:d==null?void 0:d.description})]}),e.jsx("label",{htmlFor:"new-collab",children:"Add collaborators"}),e.jsxs("select",{onChange:y,children:[e.jsx("option",{value:"pickUsers",children:"Pick users"},"root"),m.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),e.jsx("label",{children:"Collaborators:"}),e.jsx("div",{children:h==null?void 0:h.map(k=>e.jsxs("div",{children:[e.jsx("span",{children:k==null?void 0:k.name}),e.jsx(zn,{className:"buttonRound",onClick:()=>{O(k.id)}})]},k==null?void 0:k.id))})]})]})})};function na(){const{innerWidth:t,innerHeight:s}=window;return{width:t,height:s}}const ra=({trackY:t,track:s,isFav:c})=>{const[u,l]=n.useState(na()),{onClicTrackActionEntry:a,trackActionTypes:r}=he(),[d,f]=n.useState(!1),m=n.useRef(null),[o,h]=n.useState(null),p=ht(),[x,S]=n.useState(()=>window.innerWidth<714);return n.useEffect(()=>{const y=O=>{m.current&&!m.current.contains(O.target)&&a(r.NONE)};return document.addEventListener("mousedown",y),document.addEventListener("touchstart",y),f(p.pathname.includes("playlist")),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("touchstart",y)}},[]),n.useEffect(()=>{const y=d?250:180;h(Math.min(t,u.height-y))},[d]),o&&e.jsxs("div",{className:"track-actions-div",ref:m,style:{height:"fit-content",top:o},children:[e.jsxs("div",{className:"track-action-entry",onClick:()=>{a(r.TOP_QUEUE,s)},children:[e.jsx("span",{children:"Front queue"})," ",e.jsx(qn,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{a(r.END_QUEUE,s)},children:[e.jsx("span",{children:"Back queue"})," ",e.jsx(Wn,{})]}),d&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{a(r.GOTO_ALBUM,s)},children:[e.jsx("span",{children:"View album"})," ",e.jsx(Kn,{})]}),d&&!c&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{a(r.REMOVE_FROM_PLAYLIST,s)},children:[e.jsx("span",{children:"Delete from playlist"})," ",e.jsx(Jn,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{a(r.TAGS,s)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(bt,{})]}),x&&s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{a(r.REMOVE_FROM_FAVORITES,s)},children:[e.jsx("span",{children:"Remove from favorite"})," ",e.jsx(Vt,{})]}):null,x&&!s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{a(r.ADD_TO_FAVORITES,s)},children:[e.jsx("span",{children:"Add to favorites"})," ",e.jsx(Ns,{})]}):null]})},vt={name:"Create a new tag",icon:()=>e.jsx(ks,{}),isAction:!0},aa=({track:t,apply:s})=>{const c=n.useRef(null),[u,l]=n.useState(!1),[a,r]=n.useState([vt]),[d,f]=n.useState("#aabbcc"),[m,o]=n.useState(!1),h=n.useRef(null),p=n.useRef(null),[x,S]=n.useState([]),[y,O]=n.useState(null),[k,N]=n.useState(null),[T,E]=n.useState([]),C=n.useRef(),I=_=>{const P=_.target.value;if(N(P),P===""||P.trim().length===0){r([vt]);return}fetch(`${b}/read-write/search/${P}/tags`,{method:"GET"}).then(J=>{if(J.ok)return J.json();throw new Error("Error fetching search results")}).then(J=>{var X;const z=(X=J.tags)==null?void 0:X.map(ne=>({...ne,icon:()=>e.jsx(bt,{color:ne.color}),isAction:!1})),ae={name:`${vt.name}: ${P}`,icon:vt.icon,isAction:vt.isAction};z.splice(0,0,ae),r(z)})},B=()=>{l(!1)},w=_=>{if(B(),_.isAction){O("new"),f(`${Is(Math.random().toFixed(4)*360,100,70.8)}`);return}x.find(P=>P.id===_.id)||(E(P=>P.filter(J=>J!==_.id)),S(P=>[...P,_]))};n.useEffect(()=>{y==="new"&&(p.current.focus(),p.current.value=k||"",C.current.value="")},[y]),n.useEffect(()=>{const _=P=>{var J;if(h.current&&!h.current.contains(P.target)){if(((J=P.target.closest("svg"))==null?void 0:J.id)==="color-button")return;o(!1)}if(c.current&&!c.current.contains(P.target)){B();return}};return document.addEventListener("mousedown",_),document.addEventListener("touchstart",_),fetch(`${b}/read-write/trackTags/${t.id}`,{method:"GET"}).then(P=>P.json()).then(P=>{S(P)}),()=>{document.removeEventListener("mousedown",_),document.removeEventListener("touchstart",_)}},[]);const $=()=>{const _=p.current.value;_!==""&&y==="new"&&S(P=>[...P,{name:_,color:d,id:yt(),isNew:!0}]),O(null)},H=(_,P)=>{const J=x.filter(z=>!(z.isNew===_&&z.id===P));S(J),_||E(z=>[...z,P])};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",style:{height:"400px",flexDirection:"column"},children:[e.jsx(we,{className:"buttonRound closeOverlay",onClick:()=>{s(null)}}),e.jsxs("h3",{children:["Editing tags for track ",t.title]}),e.jsx("div",{className:"action-bar",style:{margin:"10px auto"},ref:c,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Xe,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:I,placeholder:"Search some tags..",ref:C,onFocus:()=>{l(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${u?"block":"none"}`},children:e.jsx(Be,{height:300,itemCount:a.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:_,style:P})=>e.jsx(St,{entry:a[_],style:{...P,width:" calc(100% - 20px)",marginTop:"10px"},onClick:w},_)})})]})}),y?e.jsxs("div",{className:"edit-tag",children:[e.jsx(ks,{style:{paddingRight:"30px"}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:p}),e.jsx(Ss,{id:"color-button",color:d,onClick:()=>{o(!m)}}),m&&e.jsxs("div",{ref:h,className:"edit-tag-picker",children:[" ",e.jsx(Yt,{color:d,onChange:f})]}),e.jsx(ut,{onClick:$})]}):null,e.jsx("div",{className:"track-tags-div",children:x.map((_,P)=>e.jsxs("div",{className:"small-tag",style:{backgroundColor:_.color},children:[e.jsx("span",{children:_.name})," ",e.jsx(we,{onClick:()=>{H(_.isNew,_.id)}})]},`${_.isNew}-${_.id}`))}),e.jsx("button",{style:{marginTop:"auto"},onClick:()=>{s({current:x,deleted:T},t.id)},children:"Apply"})]})})},oa=()=>{const{closeTagWindow:t}=he(),[s,c]=n.useState(0),[u,l]=n.useState([]),[a,r]=n.useState([]),[d,f]=n.useState(!1),[m,o]=n.useState("#aabbcc"),[h,p]=n.useState(null),x=n.useRef(null),S=n.useRef(null),{addNotification:y,notifTypes:O}=tt(),[k,N]=n.useState(null);n.useEffect(()=>{T(),E()},[]);const T=()=>{fetch(`${b}/read-write/getAllUserTags`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{l(w)})},E=()=>{fetch(`${b}/read-write/getAllUserSalads`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{r(w)})},C=w=>{p(w),o(w.color)},I=()=>{const w={id:h.id,name:x.current.value,color:m},$=new FormData;$.append(s===0?"tag":"salad",JSON.stringify(w)),fetch(`${b}/read-write/${s===0?"applyTagModifications":"applySaladModifications"}`,{method:"POST",credentials:"include",body:$}).then(H=>H.json()).then(H=>{s===0?T():E(),y("Tag updated.",O.SUCCESS)}),p(null)},B=()=>{fetch(`${b}/read-write/delete/${k.type}/${k.id}`,{method:"DELETE",credentials:"include"}).then(w=>w.json()).then(w=>{s===0?T():E(),p(null),N(null),y("Tag deleted.",O.SUCCESS)})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"tag-edtior-container",children:[e.jsx(we,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"cooking-selection",style:{marginTop:"40px"},children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(me,{text:"Edit tags",icon:e.jsx(Yn,{}),onClick:async()=>{c(0)}}),e.jsx(me,{text:"Edit salads",icon:e.jsx(lt,{}),onClick:async()=>{c(1)}})]}),e.jsxs("div",{className:"edit-tags-content",children:[e.jsx(Be,{className:"albumTrackList",height:250,itemCount:s===0?u.length:a.length,itemSize:35,width:"100%",children:({index:w,style:$})=>e.jsxs("div",{style:$,className:"album-wrapping-track",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:s===0?u[w].color:a[w].color}}),e.jsx("span",{children:s===0?u[w].name:a[w].name}),e.jsx(ws,{className:"trackIcon",onClick:()=>{C(s===0?{...u[w],type:"tag"}:{...a[w],type:"salad"})}})]},w)}),h?e.jsxs("div",{className:"edit-tag",style:{left:"-20px",margin:"auto"},children:[e.jsx(we,{style:{cursor:"pointer"},onClick:()=>{p(null)}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:x,defaultValue:h.name}),e.jsx(Ss,{style:{cursor:"pointer"},id:"color-button",color:m,onClick:()=>{f(!d)}}),d&&e.jsxs("div",{ref:S,className:"edit-tag-picker",children:[" ",e.jsx(Yt,{color:m,onChange:o})]}),e.jsx(ut,{onClick:I,style:{cursor:"pointer"}}),e.jsx(dt,{style:{cursor:"pointer"},onClick:()=>{N(h)}})]}):null,k?e.jsxs("div",{className:"deletion-confirmation",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:k.color,width:"50px"}}),e.jsxs("p",{children:["Confirm deletion of the ",k.type," ",k.name,"?"]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{N(null)},children:e.jsx(Qn,{})}),e.jsx("button",{onClick:()=>{B()},children:e.jsx(ut,{})})]})]}):null]})]})]})})},ca=({applyChanges:t,artist:s})=>{const[c,u]=n.useState(null),[l,a]=n.useState("2000-00-00"),[r,d]=n.useState(null);if(!s)return null;n.useEffect(()=>{s&&(u(s.picture),a(s.active_from))},[s]);const f=()=>{const o=document.getElementById("editArtistInfos"),h=s.active_from??"",p=o.activeFrom.value??"",x=s.name??"",S=o.artistName.value??"",y=s.bio??"",O=o.bio.value??"";if(!(x!=S||h!=p||y!=O||r)){t(null);return}s.name=o.artistName.value,s.active_from=o.activeFrom.value,s.bio=o.bio.value;const{picture:N,...T}=s;console.log(T,r),t(T,r)},m=o=>{const h=o.target.files[0];h&&(s.ext=h.name.split(".").pop(),u(URL.createObjectURL(h)),d(h))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[c?e.jsx("img",{id:"coverPicture",src:c,style:{width:"100%"}}):e.jsx(ie,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:m})]}),e.jsx("button",{className:"roundButton",onClick:f,children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editArtistInfos",children:[e.jsx("label",{htmlFor:"artistName",children:"Artist name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("div",{className:"albumType",children:e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"activeFrom",children:"Active since"}),e.jsx("input",{type:"date",id:"activeFrom",value:l,onChange:o=>{a(o.target.value)}})]})}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",placeholder:"Enter biography",defaultValue:s.bio})]})]})]})})},Ps=n.createContext(void 0),_e={TOP_QUEUE:"top_queue",END_QUEUE:"end_queue",TAGS:"tags",GOTO_ALBUM:"goto_album",REMOVE_FROM_PLAYLIST:"remove_from_playlist",ADD_TO_FAVORITES:"add_to_favs",REMOVE_FROM_FAVORITES:"remove_from_favs",NONE:"none"},ia=()=>{const t=ht(),s=n.useRef({pointer:0,history:new Array(6).fill(null)});return n.useEffect(()=>{const{pointer:c,history:u}=s.current,l=(c-1+u.length)%u.length;u[l]!==t.pathname&&(u[c]=t.pathname,s.current.pointer=(c+1)%u.length)},[t]),s.current},la=({children:t})=>{const[s,c]=n.useState(""),[u,l]=n.useState(!1),[a,r]=n.useState({}),[d,f]=n.useState(0),m=n.useRef(null),o=n.useRef(null),h=n.useRef(null),[p,x]=n.useState([]),[S,y]=n.useState("null"),O=g=>`${g}`!="null"?`${b}/read-write/music/${g}`:null,[k,N]=n.useState(-1),T=n.useRef(p),E=n.useRef(k),[C,I]=n.useState(null),[B,w]=n.useState(null),{emit:$,subscribe:H}=Le(),_=n.useRef(null),[P,J]=n.useState(null),z=n.useRef(null),{addNotification:ae,notifTypes:X}=tt(),ne=ye(),[ue,Te]=n.useState(null),[ke,Se]=n.useState(null),[be,Pe]=n.useState(null),V=n.useRef("A"),U=n.useRef(null),[oe,ce]=n.useState(5),[ve,j]=n.useState(!1),[M,Q]=n.useState(()=>{const g=parseFloat(localStorage.getItem("volume"));return isNaN(g)?.5:Math.min(1,Math.max(0,g))}),[Z,de]=n.useState(!1),[Ee,De]=n.useState(!1),$e=n.useRef(null),G=n.useRef(null),F=n.useRef(null),A=n.useRef(null),K=n.useRef(0),re=n.useRef(null),q=n.useRef(null),ee=n.useRef(0),Y=n.useRef(null),D=n.useRef(0),le=n.useRef(0),je=5,Ge=n.useRef(""),ns=n.useRef(null),rs=n.useRef(0),pt=n.useRef({lastAudioTime:0,lastPerformanceNow:0}),st=n.useRef(null),Gs=.1,gt=n.useRef(!1),Tt=ht(),nt=n.useRef(""),Vs=n.useRef([]),as=n.useRef(null),Mt=ia(),Hs=()=>{var g,v,R,L,W,te,ge,xe;o.current=new Audio,o.current.setAttribute("source","A"),o.current.addEventListener("error",fe=>{if(o.current.src.includes("spoof"))return;const Ne=o.current.error;if(Ne&&(console.warn("Audio error occurred: code",Ne.code),Ne.code===4&&s)){const We=`${b}/radio/spoof/${encodeURIComponent(o.current.src)}`;o.current.src=We,ae("Audio stream not reachable from browser. Streaming from backend..",X.INFO),l(!0),o.current.play();const Ke=new EventSource(`${b}/radio/trackStream/${encodeURIComponent(o.current.src)}`);Ke.onmessage=Ae=>{console.log(Ae);const Ie=JSON.parse(Ae.data);console.log("Now playing:",Ie.metadata.StreamTitle);const Ue=Ie.metadata.adw_ad=="true"?`Advertisment - ${(Number(Ie.metadata.durationMilliseconds)/1e3).toFixed(1)}s`:Ie.metadata.StreamTitle;r(Je=>({...Je,title:Ue}))},Ke.addEventListener("error",Ae=>{console.warn("Metadata stream error",Ae)})}}),o.current.addEventListener("canplay",()=>{console.log("Stream is playable!")}),h.current=new Audio,h.current.setAttribute("source","B");for(const fe of[o,h])fe.current.crossOrigin="anonymous",fe.current.playsInline=!0,fe.current.setAttribute("webkit-playsinline",""),fe.current.volume=parseFloat(localStorage.getItem("volume"))*.75||.5;(g=o.current)==null||g.addEventListener("timeupdate",Ct),(v=h.current)==null||v.addEventListener("timeupdate",Ct),(R=o.current)==null||R.addEventListener("playing",Et),(L=h.current)==null||L.addEventListener("playing",Et),(W=o.current)==null||W.addEventListener("play",rt),(te=o.current)==null||te.addEventListener("pause",cs),(ge=h.current)==null||ge.addEventListener("play",rt),(xe=h.current)==null||xe.addEventListener("pause",cs),Ut(),console.log("Audio graph setted up")},zs=()=>{var g,v,R,L,W,te,ge,xe,fe,Ne,We,Ke,Ae,Ie,Ue,Je;console.log("Audio graph destructed"),(g=o.current)==null||g.pause(),o.current=null,(v=h.current)==null||v.pause(),h.current=null,(R=o.current)==null||R.removeEventListener("timeupdate",Oe),(L=o.current)==null||L.removeEventListener("ended",Me),(W=o.current)==null||W.removeEventListener("error"),(te=o.current)==null||te.removeEventListener("canplay"),(ge=h.current)==null||ge.removeEventListener("timeupdate",Oe),(xe=h.current)==null||xe.removeEventListener("ended",Me),(fe=o.current)==null||fe.removeEventListener("timeupdate",Ct),(Ne=h.current)==null||Ne.removeEventListener("timeupdate",Ct),(We=o.current)==null||We.removeEventListener("playing",Et),(Ke=h.current)==null||Ke.removeEventListener("playing",Et),(Ae=o.current)==null||Ae.removeEventListener("play",rt),(Ie=o.current)==null||Ie.removeEventListener("pause",rt),(Ue=h.current)==null||Ue.removeEventListener("play",rt),(Je=h.current)==null||Je.removeEventListener("pause",rt)},Ut=()=>{var g,v;(g=o.current)==null||g.pause(),o.current.src=null,o.current.currentTime=0,(v=h.current)==null||v.pause(),h.current.src=null,h.current.currentTime=0,m.current=null,V.current="A",o.current.removeEventListener("timeupdate",Oe),o.current.removeEventListener("ended",Me),h.current.removeEventListener("timeupdate",Oe),h.current.removeEventListener("ended",Me)},Et=()=>{q.current&&(console.log("Record start playing",m.current.currentTime),pt.current.lastAudioTime=m.current.currentTime,pt.current.lastPerformanceNow=performance.now())},os=()=>{const g=m.current;!g||g.paused||(console.log(g.currentTime,At(),Math.abs(g.currentTime-At())),Math.abs(g.currentTime-At())>Gs&&us())},qs=()=>(setTimeout(os,200),setInterval(os,5e3)),rt=()=>{q.current&&(us(),st.current&&clearInterval(st.current),st.current=qs())},cs=()=>{st.current&&(clearInterval(st.current),st.current=null)},Ct=()=>{if(!q.current)return;const g=m.current.currentTime;if(Math.abs(g-rs.current)>1){const v=1/q.current.interval,R=je*v,L=Math.floor(g*v);ee.current=0,le.current=L,ls(Ge.current,L,L+R)}else Ks(Ge.current,g);rs.current=g};n.useEffect(()=>{a&&a.type!=="radio"&&Rt()},[a]);const Rt=()=>{const g=p.length<=k+1;U.current&&clearTimeout(U.current),!(g||!m.current)&&(console.log("Transition rescheduled, timesout in ",a.rawDuration,m.current.currentTime,oe,a.rawDuration-m.current.currentTime-oe),U.current=setTimeout(()=>{V.current=V.current==="A"?"B":"A",is(k+1)},Math.min(a.rawDuration-m.current.currentTime-oe)*1e3,0))},is=async g=>{const v=p.length<=g;if(N(g),m.current=V.current==="A"?o.current:h.current,p[g].startsWith("radio-")){console.log(p[g]);let te={};if(p[g].startsWith("radio-id")){const xe=p[g].split("radio-id:")[1];te=await fetch(`${b}/radio/${xe}`).then(fe=>fe.json()),console.log(te),re.current=null,r({type:"radio",artist:te.name,...te,duration:"0-"})}else{te.url=p[g].split("radio-url:")[1],console.log(re.current);const{name:xe,...fe}=re.current,Ne={artist:xe,...fe};r({type:"radio",...Ne,duration:"0-"})}m.current.src=te.url;const ge=new EventSource(`${b}/radio/trackStream/${encodeURIComponent(te.url)}`);ge.onmessage=xe=>{console.log(xe);const fe=JSON.parse(xe.data);console.log("Now playing:",fe.metadata.StreamTitle),r(Ne=>({...Ne,title:fe.metadata.StreamTitle}))},ge.addEventListener("error",xe=>{console.warn("Metadata stream error",xe)}),ds(),h.current.removeEventListener("timeupdate",Oe),h.current.removeEventListener("ended",Me),l(!0),m.current.play();return}re.current=null;const R=p[g].split("."),L=R.length!=0?R[0]:p[g];await fetch(`${b}/read-write/trackInfos/${L}`,{method:"GET"}).then(te=>te.json()).then(te=>{te.duration=Qt(te.rawDuration),r(te)});const W=p[g];if(m.current.currentTime=0,await fetch(`${b}/read-write/fftConfig/${L}`,{method:"GET",credentials:"include"}).then(async te=>{if(ee.current=0,le.current=0,D.current=0,!te.ok){q.current=null;return}const ge=await te.json();q.current=JSON.parse(ge);const xe=q.current.fftSize*1,fe=je/q.current.interval;Y.current=new Int16Array(fe*xe),console.log("New buffer!")}),m.current.src!==O(W))m.current.src=O(W);else{f(0);return}m.current.play(),clearTimeout(F.current),c(W),Ge.current=W,l(!0),ln(W),console.log("Fading in",m.current),V.current==="A"?(v?It(h,null):(It(h,o),o.current.addEventListener("timeupdate",Oe),o.current.addEventListener("ended",Me)),h.current.removeEventListener("timeupdate",Oe),h.current.removeEventListener("ended",Me)):V.current==="B"&&(v?It(o,null):(It(o,h),h.current.addEventListener("timeupdate",Oe),h.current.addEventListener("ended",Me)),o.current.removeEventListener("timeupdate",Oe),o.current.removeEventListener("ended",Me))},ls=async(g,v,R)=>{if(!q.current)return null;const L=q.current.fftSize*1*2,W=L*v,te=L*R,ge=await fetch(`${b}/read-write/fft/${g}`,{headers:{Range:`bytes=${W}-${te-1}`}});if(!ge.ok&&ge.status!==206)throw new Error("Failed to stream FFT data");D.current=R;const xe=await ge.arrayBuffer(),fe=new Int16Array(xe),Ne=q.current.fftSize*1,We=fe.length/Ne,Ke=q.current.interval,Ae=je/Ke;let Ie=ee.current;for(let Ue=0;Ue<We;Ue++){const Je=Ue*Ne,_n=(Ie+Ue)%Ae;Y.current.set(fe.subarray(Je,Je+Ne),_n*Ne)}ee.current=(Ie+We)%Ae},us=()=>{pt.current.lastAudioTime=m.current.currentTime,pt.current.lastPerformanceNow=performance.now()},Ws=()=>{const{lastAudioTime:g,lastPerformanceNow:v}=pt.current,R=(performance.now()-v)/1e3;return g+R},At=()=>m.current.paused?m.current.currentTime:Ws(),Ks=(g,v)=>{const R=1/q.current.interval,L=Math.floor(v*R),W=D.current-L,te=R*je;te-W<1||ls(g,D.current,te+L)},Js=()=>{const g=1/q.current.interval,R=Math.floor(At()*g)-le.current,L=je*g;return R%L},Ys=()=>{if(!q.current||!Y.current)return null;const g=q.current.fftSize*1,v=Js();if(v===null)return null;const L=Math.floor(je/q.current.interval)*g,W=v*g,te=W+g;return te>L?null:Y.current.slice(W,te)},ds=()=>{F!=null&&F.current&&clearInterval(F.current)};n.useEffect(()=>{console.log("Changed inteval ref:",F.current)},[F.current]);const It=(g,v)=>{F.current&&clearInterval(F.current);const R=150;let L=0;console.log("Init fadeout for:",v.current),F.current=setInterval(()=>{const W=Math.min(1,Math.max(0,L*R/(oe*1e3)));v.current.volume=W*K.current,g.current&&(g.current.volume=(1-W)*K.current),W>=1&&(clearInterval(F.current),F.current=null,v.current&&(g.current.pause(),g.current.src=null)),L++},R)},Oe=()=>{var g;return f((g=m.current)==null?void 0:g.currentTime)},Me=()=>{p.length>0&&p.length<=k+1&&_t()};n.useEffect(()=>{!ve||k===-1||p.length===0||(Ut(),console.log("init Autoplay",p,k,ve,o.current,h.current),is(k),j(!1))},[p,k,ve]),n.useEffect(()=>{E.current=k},[k]),n.useEffect(()=>{T.current=p},[p]);const Qs=()=>{var g,v;if(!m.current&&T.current.length>0){N(0),j(!0);return}if(u)(g=m.current)==null||g.pause(),l(!1),clearTimeout(U.current),clearInterval(F.current);else{if(l(!0),k===-1&&p.length!==0){N(0);return}(v=m.current)==null||v.play(),Rt()}},Xs=(g,v=!1)=>{fetch(`${b}/read-write/nextSongs/${ue.type}/${ue.id}/${v}`,{method:"GET",credentials:"include"}).then(R=>R.json()).then(R=>{x(R),console.log(R),N(R.findIndex(L=>L===g)),j(!0)})},Zs=g=>{x([g]),N(0),j(!0)},en=()=>{if(m.current.currentTime>5||k===0){m.current.currentTime=0,Rt();return}N(k-1),j(!0)},tn=(g,v,R=!1)=>{j(!1),fetch(`${b}/read-write/nextSongs/${v}/${g}/${R}`,{method:"GET",credentials:"include"}).then(L=>L.json()).then(L=>{x(L),N(0),j(!0)})},sn=(g,v,R=!1)=>{j(!1),fetch(`${b}/read-write/nextSongs/${v}/${g}/${R}`,{method:"GET",credentials:"include"}).then(L=>L.json()).then(L=>{x(W=>[...W,...L])})},nn=(g,v,R=!1)=>{console.log(`${b}/read-write/nextSongs/${v}/${g}/${R}`),fetch(`${b}/read-write/nextSongs/${v}/${g}/${R}`,{method:"GET",credentials:"include"}).then(L=>L.json()).then(L=>{x(it.shuffle(L)),j(!0),N(0)})},rn=(g=!1)=>{const v=g?T.current:p,R=g?E.current:k;v.length<=R+1&&(_t(),console.log("stop")),N(R+1),j(!0)},_t=()=>{Ut(),f(0),l(!1),r(null),j(!1),N(-1),y("null"),x([]),c(""),Ge.current="",console.log("No more songs in the queue"),clearInterval(F.current),clearTimeout(U.current),ds()},an=g=>{if(g<0||g>100)return;const v=g/100*m.current.duration;m.current.currentTime=v,f(v),Rt()},on=g=>{m.current.currentTime+g>m.current.duration?m.current.currentTime=m.current.duration:m.current.currentTime+g<0?m.current.currentTime=0:m.current.currentTime+=g,f(m.current.currentTime)},cn=g=>{g<0||g>=p.length||(j(!0),N(g))},ln=g=>{fetch(`${b}/read-write/trackCover/${g}`,{method:"GET"}).then(v=>v.json()).then(v=>{y(`${b}/covers/${v}`)})},un=()=>{_t(),x([]),N(-1)},Bt=()=>{fetch(`${b}/config/user/FFT`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{ns.current=g})};n.useEffect(()=>{Q(parseFloat(localStorage.getItem("volume"))||.5),Hs(),console.log("mount",Tt.pathname),Tt.pathname==="/full-screen"&&(nt.current="",gt.current=!0),Bt();const g=H("login",()=>{console.warn("login triggered!"),Bt()});return()=>{zs(),g()}},[]);const dn=async g=>{const v=await fetch(`${b}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!v.ok)throw new Error("Network response was not ok");const L=(await v.json()).map(W=>W.id);x(W=>[...W,...L])},mn=async g=>{const v=await fetch(`${b}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!v.ok)throw new Error("Network response was not ok");const L=(await v.json()).map(W=>W.id);x(it.shuffle(L)),j(!0),N(0)},hn=async()=>{fetch(`${b}/read-write/all-songs`,{method:"GET"}).then(g=>g.json()).then(g=>{x(it.shuffle(g)),j(!0),N(0)})},fn=g=>{console.log("Editing album",g),fetch(`${b}/read-write/album/${g}`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{const{albumInfos:R,genres:L,tracks:W,artists:te}=v;I({id:g,coverURL:`${b}/covers/${R.cover}`,tracks:W,type:"album",name:R.title,artist:te.map(ge=>ge.name),year:R.release_date,description:R.description,genre:L.map(ge=>ge.genreName)})})},pn=g=>{fetch(`${b}/read-write/playlist/${g}/true`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{const{playlistInfos:R,collaborators:L}=v;I({id:R.id,type:"playlist",coverURL:`${b}/covers/${R.cover}`,name:R.title,description:R.description,collaborators:L})})};n.useEffect(()=>{const g=Math.min(1,Math.max(0,M));F.current||gn(g.toFixed(4)*.75),K.current=g.toFixed(4)*.75,localStorage.setItem("volume",g)},[M]);const gn=g=>{A.current&&clearInterval(A.current);let v=0;const R=16,L=o.current.volume;A.current=setInterval(()=>{const W=Qe(L,g,v*R/300);o.current.volume=W,h.current.volume=W,(g-L>0?W>=g:W<=g)&&(clearInterval(A.current),A.current=null),v++},R)},xn=(g,v=null)=>{if(!g){console.log("No changes made"),w(null);return}const R=new FormData;R.append("artist",JSON.stringify(g)),v&&R.append("coverArtist",v),fetch(`${b}/read-write/editContainer/artist`,{method:"POST",credentials:"include",body:R}).then(()=>{w(null),_.current()})},vn=g=>{fetch(`${b}/read-write/artist/${g}/true`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{w({id:v.id,picture:`${b}/covers/artists/${v.picture}`,name:v.name,bio:v.bio,active_from:v.active_from})})},ms=(g,v=null)=>{if(!g){console.log("No changes made"),I(null);return}const R=new FormData;R.append(`${g.type}`,JSON.stringify(g)),v&&R.append("cover",v),fetch(`${b}/read-write/editContainer/${g.type}`,{method:"POST",credentials:"include",body:R}).then(()=>{I(null),_.current()})},jn=async(g,v)=>{const R=g?"/forMe":"";(await fetch(`${b}/read-write/delete/album/${v.id}${R}`,{method:"DELETE",credentials:"include"}).then(W=>W.json())).success&&(ae(`Album ${v.name} deleted.`,X.SUCCESS),I(null),ne("/home"))},yn=async()=>{de(!0)},bn=(g,v)=>{console.log("sending playlist",g);const R=new FormData;R.append("playlist",JSON.stringify(g)),v&&(R.append("cover",v),console.log(v)),fetch(`${b}/read-write/newPlaylist`,{method:"POST",credentials:"include",body:R}).then(()=>{de(!1),$e.current()})},Nn=g=>{N(0),x([g]),j(!0)},kn=()=>{de(!1)},Sn=(g,v,R,L)=>{J({track:v,position:g}),z.current&&z.current(),z.current=R,G.current=L},wn=()=>{J(null),z.current&&z.current()},Tn=(g,v,R=null)=>{switch(wn(),g){case _e.NONE:return;case _e.TOP_QUEUE:Cn(v);break;case _e.END_QUEUE:Rn(v);break;case _e.GOTO_ALBUM:En(v);break;case _e.REMOVE_FROM_PLAYLIST:An(v);break;case _e.TAGS:Se(v),ae("Avaliable soon :)",X.INFO);break;case _e.ADD_TO_FAVORITES:fetch(`${b}/read-write/toggleFavorite/${v.id}/true`,{method:"GET",credentials:"include"}).then(L=>L.json()).then(L=>{G.current(L)});break;case _e.REMOVE_FROM_FAVORITES:fetch(`${b}/read-write/toggleFavorite/${v.id}/false`,{method:"GET",credentials:"include"}).then(L=>L.json()).then(L=>{G.current(L)});break}},En=g=>{fetch(`${b}/read-write/trackAlbumId/${g.id}`,{method:"GET"}).then(v=>v.json()).then(v=>{ne(`albums/${v}`)})},Cn=g=>{const v=p;v.splice(k+1,0,g.id),x(v),ae(`${g.title} playing next.`,X.SUCCESS)},Rn=g=>{const v=p;v.push(g.id),x(v),ae(`${g.title} playing at the end.`,X.INFO)},An=g=>{fetch(`${b}/read-write/deleteTrackFromPlaylist/${ue.id}/${g.id}`,{method:"DELETE",credentials:"include"}).then(v=>v.json()).then(v=>{_.current(),ae(`${g.title} removed.`,X.SUCCESS)})},In=(g,v)=>{_.current=v,Te(g)},Fn=(g,v)=>{if(Se(null),!g)return;const R=new FormData;R.append("current",JSON.stringify(g.current)),R.append("deleted",JSON.stringify(g.deleted)),fetch(`${b}/read-write/changeTrackTags/${v}`,{method:"POST",credentials:"include",body:R}).then(L=>L.json()).then(L=>{ae("Tags upated!",X.SUCCESS)})},Ln=async(g=[],v)=>{g.length!==0&&(x(g),N(v||0),j(!0))},Pn=()=>{De(!0)},$n=()=>{De(!1)},On=()=>{gt.current=!gt.current,gt.current&&(nt.current=Tt.pathname),console.log(nt.current),ne(gt.current?"/full-screen":nt.current&&nt.current!=="/full-screen"?nt.current:"/home")},Mn=()=>new Promise(g=>{fetch(`${b}/read-write/getSongMetaDataCover/${s}`,{method:"GET",credentials:"include"}).then(v=>v.blob()).then(v=>{as.current={track:s,blob:v},g({track:s,blob:v})})}),Un=()=>{const{history:g,pointer:v}=Mt;if(g.every(te=>te===null)){ne("/home");return}let R=(v-2+g.length)%g.length,L=g[R],W=0;for(;(!L||L==="/full-screen")&&W<g.length||L===Tt.pathname;)R=(R-1+g.length)%g.length,L=g[R],W++;Mt.pointer=R,ne(L||"/home")};return e.jsxs(Ps.Provider,{value:{externalRadioInfos:re,playRadio:Nn,navigateBack:Un,history:Mt,colorOverride:Vs,requestNewFullScreenImage:Mn,fullScreenImage:as.current,toggleFullScreenView:On,fetchFFTUserSettings:Bt,FFTUserSetingsRef:ns,fftConfigRef:q,getFFTAtCurrentTime:Ys,deleteAlbum:jn,editArtist:vn,playContainer:tn,closeTagWindow:$n,openTagWindow:Pn,saladContext:be,setSaladContext:Pe,playAudioSalad:Ln,linkNewContainer:In,trackActionTypes:_e,onClicTrackActionEntry:Tn,openTrackActions:Sn,getNextSongsFromAlbum:Xs,currentTrackData:a,currentTime:d,isPlaying:u,toggleTrackPaused:Qs,playNextSong:rn,trackCoverUrl:S,playPreviousSong:en,playingTrack:s,jumpTrackSeconds:on,jumpToPercent:an,addContainerToQueue:sn,playContainerSuffle:nn,playQueue:p,queuePointer:k,jumpToQueueTrack:cn,deleteQueue:un,addArtistToQueue:dn,shuffleArtistToQueue:mn,playTrackNoQueue:Zs,playLibraryShuffle:hn,setVolume:Q,volume:M,editAlbum:fn,editPlaylist:pn,createNewPlaylist:yn,globalAudioRef:m,setPlaylistAddedCallback:g=>{$e.current=g}},children:[t,C?C.type==="album"?e.jsx(sa,{applyCanges:ms,albumClass:C}):C.type==="playlist"?e.jsx(fs,{editPlaylistClass:C,applyCanges:ms}):null:null,B&&e.jsx(ca,{applyChanges:xn,artist:B}),Z&&e.jsx(fs,{closeOverlay:kn,applyCanges:bn}),P?e.jsx(ra,{isFav:ue.favPlaylist,trackY:P.position.y,track:P.track}):null,ke&&e.jsx(aa,{apply:Fn,track:ke}),Ee&&e.jsx(oa,{})]})},he=()=>{const t=n.useContext(Ps);if(t===void 0)throw new Error("useAudioPlayer must be used within an AudioPlayerProvider");return t},ft=({percent:t,text:s=null,showPercent:c=!1,isMarquee:u=!1,fillColor:l="#fffdff",style:a={},initialising:r=!1,initialisingColor:d="white",onClickPercentage:f=null,filter:m="",minWidth:o=0})=>{const h=p=>{if(r||!f)return;const x=p.currentTarget,S=x.getBoundingClientRect().x,y=p.clientX;f((y-S)/x.clientWidth*100)};return e.jsxs("div",{className:"progressBar",style:{...a,minWidth:o},onClick:h,children:[e.jsx("div",{className:"progressFill",style:{width:`${t}%`,background:`${l}`,...a}}),r?e.jsx("div",{className:"progressFill",init:"init",style:{backgroundColor:d,opacity:"0.5",...a}}):null,c&&e.jsx("span",{className:"progressPercent",children:t+"%"}),s&&e.jsx("span",{className:"progressPercent",style:{margin:"auto"},children:s})]})},ua=()=>{const{currentTrackData:t,currentTime:s,jumpToPercent:c}=he();if(!t||Object.keys(t).length===0)return null;const u=()=>e.jsxs("div",{children:[e.jsx("span",{children:Qt(s).readable}),e.jsx(ft,{percent:s/t.rawDuration*100,showPercent:!1,fillColor:"var(--violet-web-color)",style:{height:"10px"},onClickPercentage:c}),e.jsx("span",{children:t.duration.readable})]}),l=()=>null;return e.jsx("div",{className:"songProgress",children:(t==null?void 0:t.type)=="radio"?e.jsx(l,{}):e.jsx(u,{})})},da=n.memo(({id:t,isActive:s,setActive:c,contextName:u})=>e.jsx("div",{className:"index",id:`${u}-index_${t}`,onClick:()=>c(t),"data-active":s?"active":"","data-clickable":!!c}),(t,s)=>t.id===s.id&&t.isActive===s.isActive&&t.contextName===s.contextName),Xt=({context:t,active:s,setActive:c})=>e.jsx("div",{className:`activeIndex-container ${t.name}`,children:Array.from({length:t.length},(u,l)=>e.jsx(da,{id:l,isActive:s===l,setActive:c,contextName:t.name},l))}),$s=n.memo(function({currentActive:s,onClick:c,data:u}){const[l,a]=n.useState(s);n.useEffect(()=>{a(s)},[s]);const r=d=>{a(d),c==null||c(d)};return e.jsx("div",{className:"job-view-div",children:u.map((d,f)=>e.jsx("div",{className:"cornered-button","data-active":l===f,onClick:()=>{r(f)},children:d},f))})}),ma=({fromFile:t,setFromFile:s,tracksSelected:c,initMetadataFetching:u})=>{const[l,a]=n.useState(!1),[r,d]=n.useState(""),f=o=>{a(!0),o.target.files&&(console.log("New tracks"),c(Array.from(o.target.files)),o.target.files=null)},m=o=>{d(o.target.value)};return e.jsxs("div",{className:"addMusicSource",children:[e.jsxs("div",{className:"add-audio-source-selection",children:[e.jsx("p",{children:"Select the source: "}),e.jsx($s,{currentActive:t?0:1,onClick:o=>{s(o==0)},data:["From file","From URL"]})]}),t?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Select files from a local storage."}),e.jsxs("div",{className:"add-music-input",children:[e.jsxs("label",{for:"files",className:"file-select",children:[e.jsx(Xn,{}),e.jsx("span",{children:"Select file"})]}),e.jsx("input",{id:"files",multiple:!0,type:"file",accept:"audio/*",onChange:f})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Link to a radio steam."}),e.jsxs("div",{className:"add-music-input",children:[e.jsx("input",{type:"text",placeholder:"Enter URL",onChange:m}),e.jsx(me,{onClick:async()=>{u(r)},text:"Resolve",icon:e.jsx(Zn,{})})]})]}),l&&e.jsx("p",{children:"Hold a sec'.. The metadata fetch is about to beggin."})]})},Nt=({text:t,progressBar:s={useProgressBar:!1}})=>e.jsxs("div",{className:"loading-container",children:[e.jsx("h2",{children:t}),s.useProgressBar?e.jsx(ft,{percent:s.percent,showPercent:s.showPercent,isMarquee:s.isMarquee,fillColor:s.fillColor,style:{height:"25px"}}):e.jsx("p",{children:"Loading..."})]}),ha=({addNewMusic:t})=>e.jsx("div",{className:"album-card",context:"add",children:e.jsx(er,{strokeWidth:.7,className:"album-card-cover",onClick:t})}),fa=({album:t,deleteAlbum:s,editAlbum:c})=>e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(dt,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t.uuid)}),e.jsx(ws,{className:"album-card-overview-button",use:"edit",onClick:()=>c(t.uuid)}),e.jsxs("div",{className:"album-card-overview-button",use:"song-count",children:[e.jsx(tr,{className:"song-count-icon"}),e.jsx("span",{children:t.tracks.length})]}),e.jsx("img",{src:t.coverURL,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:qe(t.name,25)}),e.jsx("p",{className:"album-artist",children:qe(t.artist.join(","),25)||"No artist"})]}),pa=({radio:t,deleteRadio:s})=>(console.log(t),e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(dt,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t[0])}),e.jsx("img",{src:t[1].favicon==""?null:t[1].favicon,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:qe(t[1].name,25)})]})),ga=({albums:t,radios:s,deleteRadio:c,addNewMusic:u,deleteAlbum:l,editAlbum:a,publish:r})=>{const d=t.map((o,h)=>e.jsx(fa,{album:o,deleteAlbum:l,editAlbum:a},`alb-${h}`)),f=[...s].map((o,h)=>e.jsx(pa,{radio:o,deleteRadio:c},`rad-${h}`)),m=[...d,...f];return console.log("rerun"),m.push(e.jsx(ha,{addNewMusic:u},-1)),e.jsxs("div",{className:"albums-overview",children:[e.jsx("div",{className:"album-overview-container",children:m.reverse()}),(t.length>0||s.size>0)&&e.jsx("button",{className:"roundButton",id:"publish-to-library",onClick:r,children:"Publish to library"})]})},xa=({track:t,onClose:s})=>{const{albums:c,moveTrackToNewAlbum:u,moveTrackToAlbum:l,editingAlbum:a,setEditingAlbum:r}=ya(),[d,f]=n.useState(""),[m,o]=n.useState(!1),h=n.useRef(null),p=S=>{S.preventDefault(),!d&&S.target.existingAlbum.value?l(t,S.target.existingAlbum.value):d!==""&&u(t,d),m&&r(null),s()},x=S=>{f(S.target.value)};return n.useEffect(()=>{c.find(({uuid:y})=>y===a).tracks.length===1?o(!0):o(!1);const S=y=>{var O;if(h.current&&!h.current.contains(y.target)){if(((O=y.target.closest("svg"))==null?void 0:O.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",S),document.addEventListener("touchstart",S),()=>{document.removeEventListener("mousedown",S),document.removeEventListener("touchstart",S)}},[]),e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:h,children:[e.jsx("h2",{children:"Move track to another album"}),m&&e.jsx("p",{className:"last-track-notify",children:"Last track of the album, if you move it, the current album will be deleted."}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:p,children:[e.jsx("label",{htmlFor:"newAlbum",children:"New album name"}),e.jsx("input",{type:"text",id:"newAlbum",placeholder:"Enter album name",onChange:x}),e.jsx("label",{htmlFor:"existingAlbum",children:"Existing album"}),e.jsx("select",{id:"existingAlbum",onChange:()=>f(""),children:c.map((S,y)=>S.uuid===a?null:e.jsx("option",{value:S.uuid,children:S.name},y))}),e.jsx("input",{type:"submit",value:"Submit"})]})]})})},va=({setEditUid:t,albumClass:s})=>{var m,o;const[c,u]=n.useState({visible:!1}),[l,a]=n.useState(null);if(!s)return null;n.useEffect(()=>{s&&a(s.coverURL)},[s]);const r=()=>{const h=document.getElementById("editAlbumInfos");s.name=h.albumName.value,s.artist=h.artistName.value.split(",").map(p=>p.trim()),s.year=h.releaseDate.value,s.genre=h.genre.value.split(",").map(p=>p.trim()).map(p=>p.charAt(0).toUpperCase()+p.slice(1)),s.description=h.description.value,console.log(s.genre),t(null)},d=h=>{const p=h.target.files[0];p&&a(s.setCoverFromFile(p))},f=h=>{u({visible:!c.visible,...h})};return e.jsxs("div",{className:"albumWrapping",children:[e.jsxs("div",{className:"albumCover",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(ie,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:d})]}),e.jsx("button",{className:"roundButton",onClick:()=>r(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(m=s.artist)==null?void 0:m.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",defaultValue:s.year})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(o=s.genre)==null?void 0:o.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Be,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:h,style:p})=>e.jsxs("div",{style:p,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[h].name}),e.jsx(bs,{className:"trackIcon",onClick:()=>{f(s.tracks[h])}})]},h)})})]}),c.visible&&e.jsx(xa,{onClose:()=>{u({visible:!1})},track:{id:c.id,name:c.name}})]})};class ps{constructor(s,c,u,l,a,r){this.name=s,this.artist=c,this.year=u,this.tracks=l,this.setCover(a),this.uuid=r}setCover(s){!s||this.coverURL||(this.coverData=s.data,this.coverMime=s.format,this.coverURL=URL.createObjectURL(new Blob([this.coverData],{type:this.coverMime})),this.ext=this.coverMime.split("/")[1],this.sourceIsBinary=!0)}setCoverFromFile(s){return this.coverURL=URL.createObjectURL(s),this.coverFile=s,console.log("Setting cover from file: ",s),this.ext=s.type.split("/")[1],this.coverURL}}const Os=n.createContext(),ja=({closeOverlay:t,uploadPercent:s,uploadProgress:c,uploadFinished:u,isMinimize:l,setMinimized:a})=>{const[r,d]=n.useState(!0),[f,m]=n.useState(0),[o,h]=n.useState([]),[p,x]=n.useState(0),[S,y]=n.useState(0),[O,k]=n.useState([]),[N,T]=n.useState([]),[E,C]=n.useState(!1),[I,B]=n.useState("xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx"),[w,$]=n.useState(0),[H,_]=n.useState(0),[P,J]=n.useState(""),{addNotification:z,notifTypes:ae}=tt(),[X,ne]=n.useState([]),[ue,Te]=n.useState(new Map);let ke=!1;const Se=n.useRef(!1),be=n.useRef(null),Pe=async G=>{if(console.log("Tracks selected: ",G),G.length===0)return;y(G.length),h(A=>[...A,...G]),be.current=G;const F=[];for(let A=0;A<G.length;A++)F.push({id:yt()});Se.current=!0,ne(A=>[...A,...F])};n.useEffect(()=>{Se.current&&(Se.current=!1,V())},[X]),n.useEffect(()=>{console.log("To add tracks",o)},[o]);const V=async()=>{const G=await ve();if(G)ce(G);else{const F=be.current.length;console.log(o.length,F),ne(X.filter((A,K)=>K<X.length-F)),h(o.filter((A,K)=>K<o.length-F)),x(0),m(2)}be.current=null},U=G=>{const F=G.filter(({tracks:A})=>A.length>0);C(!0),T(F)};n.useEffect(()=>{console.log("Reconstructing albums... ",N),!E&&(x(0),m(2))},[N]);const oe=G=>{var re;function F(q,ee){return ee.findIndex(Y=>Y.name===q)}let A=[],K=X;for(let q=0;q<G.length;q++){let ee=G[q];const Y=X.length-G.length+q,D=F(ee.common.album,A),le={id:X[Y].id,name:ee.common.title||X[Y].title};if(D===-1){const je=yt();A.push(new ps(ee.common.album,ee.common.artist?ee.common.artist.split(",").map(Ge=>Ge.trim()):["Unknown artist"],ee.common.year,[le],(re=ee.common.picture)==null?void 0:re[0],je)),K[Y].albumUuid=je}else A[D].tracks.push(le),K[Y].albumUuid=A[D].uuid}return k(q=>[...q,...G]),ne(K),A},ce=G=>{const F=oe(G);setTimeout(()=>{C(!1),T(A=>[...A,...F])},400)},ve=async(G="")=>{if(!r){if(!G)return;console.log("Fetching meta at source",G);const ee=await fetch(`${b}/radio/metadata/${encodeURIComponent(G)}`,{method:"GET"}).then(le=>le.json());if(ee)z("Radio found! "+ee[0].name,ae.INFO);else{z("No radio found..",ae.ERROR);return}const Y=ee[0];console.log(Y);const D=ue;D.set(Y.stationuuid,{url:Y.url_resolved,favicon:Y.favicon,name:Y.name}),Te(D),m(2);return}const F=be.current;m(1);const A=[],K=X,re=X.length-F.length;let q=!1;return await Promise.all(F.map(async(ee,Y)=>{var je;const D=await qr(ee).catch(Ge=>{console.log("error at",ee,Ge),z(`Track ${ee.name} seems corrupted, retry without it.`,ae.ERROR)});if(!D){q=!0;return}let le=K[Y+re];D.common.title||(D.common.title=ee.name,console.log("No title found, using filename: "+ee.name),le.title=ee.name),D.common.album||(D.common.album=D.common.title,le.album=D.common.title),le.duration=D.format.duration,le.year=D.common.year,le.no=((je=D.common.track)==null?void 0:je.no)||0,le.title=D.common.title,A.splice(Y,0,D),x(A.length)})),q?null:(ne(K),A)},j=G=>{const F=new Map([...ue].filter(([A,K])=>A!=G));Te(F)},M=G=>{ke=!0;let F=X;const A=N.find(D=>D.uuid===G).tracks.map(D=>D.id);let K=o;const re=F.filter(D=>!A.includes(D.id)),ee=F.map((D,le)=>A.includes(D.id)?null:le).filter(D=>D!==null).map(D=>K[D]);h(ee),ne(re);const Y=N.filter(D=>D.uuid!==G);C(!1),T(Y)},Q=G=>{B(G)};n.useEffect(()=>{if(I===null||N.length===0){m(2);return}m(3)},[I]);const Z=(G,F)=>{let A=X;const{id:K,name:re}=G,q=yt();console.log("Moving track: "+K+NaN+I+" to album: "+q),A=A.map(D=>(D.id===K&&(D.albumUuid=q),D));let ee=N.map(D=>(D.uuid===I&&(D.tracks=D.tracks.filter(le=>le.id!==K)),D));const Y=new ps(F,["Unknown artist"],"",[{id:K,name:re}],null,q);ee.push(Y),ne(A),U(ee),z(`Track ${re.substring(0,60)} got moved to album ${F}.`,ae.INFO)},de=(G,F)=>{let A=X;const{id:K,name:re}=G;console.log("Moving track: "+K+NaN+I+" to album: "+F);const q=N.find(Y=>Y.uuid===F).name;A=A.map(Y=>(Y.id===K&&(Y.albumUuid=F),Y));let ee=N.map(Y=>(Y.uuid===F?Y.tracks.push({id:K,name:re}):Y.uuid===I&&(Y.tracks=Y.tracks.filter(D=>D.id!==K)),Y));ne(A),U(ee),z(`Track ${re.substring(0,60)} got moved to album ${q}.`,ae.INFO)},Ee=async()=>{if(ke){console.log("Deleting, aborting publish");return}if(console.log("Publishing tracks: ",o),console.log("Publishing radios: ",ue),ue.keys().forEach(async G=>{const F=new FormData;console.log(ue.get(G)),F.append("radioData",JSON.stringify({uuid:G,...ue.get(G)}));const A=await fetch(`${b}/radio/newRadio`,{method:"POST",credentials:"include",body:F}).then(K=>K.json());console.log(A)}),o.length>0){m(4);const G=N.map(A=>{if(!A.sourceIsBinary)return A.coverFile?(console.log("Using file reference for cover: "+A.coverFile),A.coverFile):null;if(console.log("Using binary reference for cover: ",A.uuid),!A.coverData||A.coverData.length===0)return console.log("returned no cover at",A.uuid),null;const K=new Uint8Array(A.coverData),re=new Blob([K],{type:A.coverMime});return new File([re],`${A.uuid}.${A.coverMime.split("/").pop()}`,{type:A.coverMime})});for(let A=0;A<N.length;A++){let K=new FormData;const{coverURL:re,sourceIsBinary:q,tracks:ee,coverFile:Y,coverData:D,...le}=N[A];K.append("album",JSON.stringify({...le})),G[A]&&K.append("cover",G[A]);const je=await fetch(`${b}/read-write/upload`,{method:"POST",body:K,credentials:"include"});if(!je.ok)throw console.error("Error uploading albums:",je.statusText),new Error("Error uploading albums");K=null,console.log("Album uploaded: "+N[A].name)}N.forEach(A=>{A.coverURL&&(URL.revokeObjectURL(A.coverURL),A.coverURL=null)});let F=o.reduce((A,K)=>A+K.size,0);$((F/1024/1024).toFixed(1));for(let A=0;A<o.length;A++){const K=o[A];let re=new FormData;re.append("trackMeta",JSON.stringify(X[A])),re.append("music",K),J(K.name),c({done:A,total:o.length}),await Wr({method:"POST",data:re,withCredentials:!0,url:"/upload",baseURL:`${b}/read-write`,onUploadProgress:q=>{const{total:ee,loaded:Y}=q,D=ee/1e6,le=Y/1e6;s(le/D);const je=le/D*100;_(je.toFixed(2))}}).then(()=>{}).catch(q=>{console.error("Error uploading track:",q)}),re=null}}console.log("Upload finished"),u(),setTimeout(()=>{h([]),k([]),x(0),T([]);const G=ue;G.clear(),Te(G),m(0),B("xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx"),_(0),console.log("Closing overlay");const F=new CustomEvent("musicUploaded",{});window.dispatchEvent(F),t()},750)},De=()=>{if(f!==4){t();return}a(!0)};n.useEffect(()=>{ke&&(ke=!1)},[o]);const $e=()=>{switch(f){case 0:return e.jsx(ma,{fromFile:r,setFromFile:d,tracksSelected:Pe,initMetadataFetching:ve});case 1:return e.jsx(Nt,{text:`Fetching metadatas.. ${S?p+"/"+S:"-/-"}`});case 2:return e.jsx(ga,{albums:N,addNewMusic:()=>m(0),deleteAlbum:M,editAlbum:Q,publish:Ee,radios:ue,deleteRadio:j});case 3:return e.jsx(va,{setEditUid:B,albumClass:N.find(G=>G.uuid===I)});case 4:return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Nt,{text:`Publishing ${P} ${w}Mb..`,progressBar:{useProgressBar:!0,showPercent:!0,isMarquee:!1,percent:Number(H),fillColor:"var(--cool-green)"}}),e.jsx("p",{children:"You can close this overlay, the upload will continue. :)"})]});default:return e.jsx("div",{className:"addMusicSource",children:e.jsx("p",{children:"Not implemented yet"})})}};return e.jsx("div",{className:"addMusicRoot",children:e.jsx("div",{className:"addMusicContainer",style:l?{display:"none"}:{},children:e.jsxs(Os.Provider,{value:{albums:N,moveTrackToNewAlbum:Z,editingAlbum:I,moveTrackToAlbum:de,setEditingAlbum:B},children:[e.jsx(we,{className:"buttonRound closeOverlay",onClick:De}),e.jsx("h2",{children:"Add Music"}),e.jsx(Xt,{context:{name:"AddMusic",length:5},active:f,setActive:null}),e.jsx($e,{})]})})})},ya=()=>n.useContext(Os),Pt=({iconHovered:t,iconDefault:s,onClick:c=null,className:u})=>{const[l,a]=n.useState(!1);return e.jsx("div",{style:c?{background:"rgba(0,0,0,0)"}:{},className:`${u}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:c,children:l?e.jsx(t,{}):e.jsx(s,{})})},Ht=({context:t})=>{const{isPlaying:s,toggleTrackPaused:c,playNextSong:u,playPreviousSong:l,jumpTrackSeconds:a}=he();return e.jsxs("div",{className:"audio-controls",context:t.mobile?"mobile":"desktop",children:[t.mobile?null:e.jsx(Pt,{iconHovered:nr,iconDefault:sr,onClick:l}),e.jsx(Pt,{iconHovered:s?ar:or,iconDefault:s?rr:qt,onClick:c}),e.jsx(Pt,{iconHovered:ir,iconDefault:cr,onClick:u})]})},ba=n.memo(({index:t,style:s,data:c})=>{const{playQueue:u,cacheRef:l,jumpToQueueTrack:a,queuePointer:r}=c,d=u[t],[f,m]=n.useState(!!l.current[d]);let o=l.current[d];o||(o={title:"Loading...",cover:"loading"}),n.useEffect(()=>{f||(l.current[d]=o,fetch(`${b}/read-write/shortTrackInfos/${d}`,{credentials:"include"}).then(p=>p.json()).then(p=>{l.current[d]=p,m(!0)}))},[f,d]);const h={...s,width:"calc(100% - 15px)",height:"47.5px"};return e.jsxs("div",{className:"music-queue-entry",style:h,"is-passed":`${t<r}`,"is-selected":`${t===r}`,onClick:()=>a(t),children:[o.cover?e.jsx("img",{src:`${b}/covers/${o.cover}`,className:"track-image-small"}):e.jsx(ie,{className:"track-image-small"}),e.jsx("p",{className:"track-title",children:o.title})]})},(t,s)=>t.data.playQueue[t.data.queuePointer]===s.data.playQueue[s.data.queuePointer]),Na=50,ka=600,Sa=({hideComponent:t})=>{const{playQueue:s,deleteQueue:c,jumpToQueueTrack:u,queuePointer:l}=he(),a=n.useRef(null),{subscribe:r}=Le(),d=n.useRef(new Map);return n.useEffect(()=>{const f=m=>{var o;if(a.current&&!a.current.contains(m.target)){if(((o=m.target.closest("svg"))==null?void 0:o.id)==="playlist-button")return;t()}};return r("action-bar-open",()=>{t()}),document.addEventListener("mousedown",f),document.addEventListener("touchstart",f),()=>{document.removeEventListener("mousedown",f),document.removeEventListener("touchstart",f)}},[]),e.jsxs("div",{className:"music-queue",ref:a,children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Music Queue"}),s.length>0&&e.jsx(dt,{className:"buttonRound",id:"queue-trash",onClick:c})]}),s.length>0?e.jsx(Be,{height:ka,itemCount:s.length,itemSize:Na,width:"100%",itemData:{playQueue:s,cacheRef:d,jumpToQueueTrack:u,queuePointer:l},children:ba}):e.jsx("p",{children:"No items in the queue"})]})},wa=n.memo(({payload:t})=>{const[s,c]=n.useState(!1);return e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Open a song's dropdown"}),e.jsxs("div",{id:"tuto-0-cooking-container",children:[e.jsx(ie,{className:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-cooking-songs-container",children:[e.jsxs("div",{className:"tuto-cooking-0-song-skeleton","data-target":!0,children:[e.jsx(Ts,{id:"tuto-cooking-dots",onClick:()=>{c(!s)}}),s&&e.jsxs("div",{id:"tuto-0-cooking-dropdown",children:[e.jsxs("div",{className:"tuto-cooking-0-action-skeleton track-action-entry","data-target":"true",onClick:()=>{t(1)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(bt,{})]}),e.jsx("div",{className:"tuto-cooking-0-action-skeleton"})]})]}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"})]})]})]})}),Ta=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Here you can remove and add tags:"}),e.jsxs("div",{id:"tuto-tags-1",children:[e.jsxs("div",{className:"tuto-search-skeleton",children:[e.jsx(Xe,{}),e.jsx("span",{id:"animated-write-span",children:"140BPM, roses, gaming, 2010s"}),e.jsx("div",{className:"blinking-cursor"})]}),e.jsxs("div",{id:"tuto-tags",children:[e.jsxs("div",{className:"small-tag",children:["Evening",e.jsx(we,{})]}),e.jsxs("div",{className:"small-tag",children:["Chill",e.jsx(we,{})]}),e.jsxs("div",{className:"small-tag",children:["Friends",e.jsx(we,{})]}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:"Got it!"})]})]})]})),Ea=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Cooking lets you play all the tracks mataching the tags:"}),e.jsx("div",{id:"tuto-tags-salad",children:e.jsxs("div",{id:"tuto-tags",children:[e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#a79cf5"}})]})}),e.jsxs("div",{id:"tuto-song-list",children:[e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}})}),e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})}),e.jsxs("div",{className:"tuto-tag-song-skeleton",children:[e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})]})]}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]})),Ca=[wa,Ta,Ea],Ra=n.memo(()=>{const{onTutoialFinished:t}=wt(),[s,c]=n.useState(0),u=Ca[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),a=[c,c,()=>{t(Re.COOKING)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Manage tags and cook salads"}),e.jsx(Xt,{context:{name:"tutorial",length:3},active:s,setActive:c}),e.jsx(u,{payload:a[s]})]})}),Aa=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Pick an album:"}),e.jsxs("div",{id:"tuto-genre-albums-container",children:[e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(ie,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]}),e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(ie,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]})]})]})),Ia=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Edit the desired album:"}),e.jsxs("div",{id:"tuto-genre-0-lib",children:[e.jsx(ie,{id:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsxs("div",{id:"tuto-genre-0-header",children:[e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:e.jsx(Wt,{})})]}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"})]})]})]})),Fa=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Change the genre:"}),e.jsxs("div",{id:"tuto-genre-1-lib",children:[e.jsxs("div",{id:"tuto-genre-1-logo-btn",children:[e.jsx(ie,{id:"tuto-genre-logo"}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton","data-target":!0,children:e.jsx("span",{children:"Genre"})}),e.jsxs("div",{className:"tuto-genre-1-input-skeleton tuto-target","data-target":!0,children:[e.jsx("span",{id:"animated-write-span",children:"Rock, Breakcore, Soundtrack, .."}),e.jsx("div",{className:"blinking-cursor"})]})]})]})]})),La=[Aa,Ia,Fa],Pa=n.memo(()=>{const{onTutoialFinished:t}=wt(),[s,c]=n.useState(0),u=La[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),a=[c,c,()=>{t(Re.GENRES)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Add genre to albums"}),e.jsx(Xt,{context:{name:"tutorial",length:3},active:s,setActive:c}),e.jsx(u,{payload:a[s]})]})}),Re={GENRES:"genres",COOKING:"cooking"},Zt=new Map;Zt.set(Re.GENRES,Pa);Zt.set(Re.COOKING,Ra);const Ms=({tutorialKey:t=Re.GENRES})=>{const s=Zt.get(t)??(()=>e.jsx("div",{children:"Not found"}));return e.jsx("div",{className:"page-overlay-blur",children:e.jsx(s,{})})},Us=n.createContext(),se={SEARCH:"search",OPEN_ACTION_BAR:"open_action_bar",CLOSE_ACTION_BAR:"close_action_bar",PLAY_SONG:"play_song",OPEN_ALBUM:"open_album",OPEN_ARTIST:"open_artist",PLAY_LIBRARY_RANDOM:"play_library_random",TOGGLE_PLAY_PAUSE:"toggle_play_pause",OPEN_SETTINGS:"open_settings",VOLUME_UP:"volume_up",VOLUME_DOWN:"volume_down",OPEN_GENRE:"open_genre"},He=[{name:"Search",code:se.SEARCH,description:"Search for a song, an album, a genra, an artist",key:"k",modifier:"ctrl",keywords:["search","find","look for","seek","search for","find for","look for for","seek for"],icon:()=>e.jsx(Xe,{className:"action-bar-current-logo"})},{name:"open action bar",code:se.OPEN_ACTION_BAR,description:"Give a command",key:" ",modifier:"ctrl",keywords:[]},{name:"Play the library in shuffle",code:se.PLAY_LIBRARY_RANDOM,description:"",key:"r",modifier:"ctrl",keywords:["play","shuffle","random","library","all","all songs","all albums","all artists"],icon:()=>e.jsx(mt,{className:"action-bar-current-logo"})},{name:"Toggle Play pause",code:se.TOGGLE_PLAY_PAUSE,description:"",key:" ",modifier:"",icon:()=>e.jsx(mt,{className:"action-bar-current-logo"})},{name:"Open settings",code:se.OPEN_SETTINGS,description:"",key:"p",modifier:"ctrl",keywords:["settings","configuration","config","preferences","options"],icon:()=>e.jsx(lr,{className:"action-bar-current-logo"})},{name:"Volume up",code:se.VOLUME_UP,description:"",key:"ArrowUp",modifier:"",keywords:[],icon:()=>{}},{name:"Volume down",code:se.VOLUME_DOWN,description:"",key:"ArrowDown",modifier:"",keywords:[],icon:()=>{}},{name:"Toggle color theme",code:se.TOGGLE_THEME,description:"Toggles the app dark or light theme.",key:"t",modifier:"ctrl",keywords:["dark","light","color","theme","color-theme","toggle"],icon:()=>e.jsx(Es,{className:"action-bar-current-logo"})}],$a=new Rs(He,{keys:["keywords"],threshold:.3}),Ce={DARK:"dark",LIGHT:"light"},Oa=({children:t})=>{const s=n.useRef([]),[c,u]=n.useState(!1),l=n.useRef(c),[a,r]=n.useState(null),[d,f]=n.useState(!1),[m,o]=n.useState(null),[h,p]=n.useState([]),[x,S]=n.useState(null),{playTrackNoQueue:y,playLibraryShuffle:O,toggleTrackPaused:k,setVolume:N,volume:T}=he(),E=n.useRef(T),C=ye(),I=ht(),B=n.useRef(null),w=n.useRef(null),{addNotification:$,notifTypes:H}=tt(),[_,P]=n.useState(()=>{const j=localStorage.getItem("CML_theme");return j?j===Ce.LIGHT?(document.documentElement.classList.remove("dark"),Ce.LIGHT):(document.documentElement.classList.add("dark"),Ce.DARK):(localStorage.setItem("CML_theme",Ce.LIGHT),Ce.LIGHT)}),{emit:J,subscribe:z}=Le();n.useEffect(()=>{window.addEventListener("keydown",X),ke();const j=M=>{B.current&&!B.current.contains(M.target)&&ce()};return document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j),window.removeEventListener("keydown",X),s.current=[]}},[]);const ae=j=>{const M=localStorage.getItem("CML_FinishedTutorials"),Q=M?JSON.parse(M):{state:{}};Q.state[j]=!0,localStorage.setItem("CML_FinishedTutorials",JSON.stringify(Q)),J(`safe-finished-tutorial-${j}`)},X=j=>{if(j.key=="Escape"&&l.current){ce();return}if(j.key=="Control"||m||!(j.ctrlKey||j.altKey||j.metaKey)&&(document.activeElement.nodeName==="INPUT"||document.activeElement.nodeName==="TEXTAREA"))return;const M=He.find(Q=>j.key===Q.key?!Q.modifier||Q.modifier===""?!0:{ctrl:j.ctrlKey,shift:j.shiftKey,alt:j.altKey,meta:j.metaKey}[Q.modifier]:!1);M&&(o(M),s.current.forEach(Q=>{Q.code===M.code&&(Q.callback(j),j.preventDefault())}))},ne=(j,M)=>{const Q={callback:j,code:M};s.current.push(Q)},ue=n.useRef(k);ue.current=k;const Te=()=>{et(()=>{u(!0),r(null),p(Se()),w.current="command",o(He[1])},I.pathname)()};n.useEffect(()=>{E.current=T,$(`Volume : ${(T*100).toFixed(0)} %`,H.INFO)},[T]);const ke=()=>{ne(()=>{if(w.current==="command"){ce();return}Te()},se.OPEN_ACTION_BAR),ne(()=>{ce()},se.CLOSE_ACTION_BAR),ne(()=>{if(w.current==="search"){ce();return}u(!0),r(se.SEARCH),w.current="search"},se.SEARCH),ne(()=>{ue.current()},se.TOGGLE_PLAY_PAUSE),ne(()=>{C("/settings")},se.OPEN_SETTINGS),ne(()=>{N(Math.min(Math.max(E.current+.1,0),1))},se.VOLUME_UP),ne(()=>{N(Math.min(Math.max(E.current-.1,0),1))},se.VOLUME_DOWN)};n.useEffect(()=>{c&&document.getElementById("actionbar-searchbar").focus(),l.current=c},[c]),n.useEffect(()=>{switch(a){case se.SEARCH:f(!0),S(()=>e.jsx("div",{className:"action-bar-logo-container",children:e.jsx(Xe,{className:"action-bar-current-logo"})}));break;default:f(!0),S(null)}},[a]);const Se=()=>[He[0],He[2],He[4]],be=j=>{var Z;const M=j.target.value;if(M===""){p(Se());return}if(a===se.SEARCH){V(M);return}const Q=(Z=$a.search(M))==null?void 0:Z.map(de=>de.item).filter(de=>{var Ee;return((Ee=de.keywords)==null?void 0:Ee.length)>0});p(Q)},Pe=j=>{switch(j){case"track":return e.jsx(qt,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View album"})," ",e.jsx(Dt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View artist"})," ",e.jsx(Dt,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View genre"})," ",e.jsx(Dt,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},V=async j=>{j===""||j.trim().length===0||fetch(`${b}/read-write/search/${j}`,{method:"GET"}).then(M=>{if(M.ok)return M.json();throw new Error("Error fetching search results")}).then(M=>{const Q=[...M.tracks.map(Z=>({type:"track",...Z})),...M.albums.map(Z=>({type:"album",...Z})),...M.artists.map(Z=>({type:"artist",...Z})),...M.genres.map(Z=>({type:"genre",...Z}))].map(Z=>{const de=Z.path,Ee=Z.id,{trackPath:De,...$e}=Z;return{icon:()=>de?e.jsx("img",{className:"action-bar-entry-logo",src:`${b}/${Z.type==="artist"?"artist":"covers"}/${de}`,alt:Z.name}):e.jsx(ie,{className:"action-bar-entry-logo"}),tooltip:Pe,code:Z.type==="artist"?se.OPEN_ARTIST:Z.type==="album"?se.OPEN_ALBUM:Z.type==="genre"?se.OPEN_GENRE:se.PLAY_SONG,fileName:de,trackName:Ee,...$e}});p(Q)})},U=j=>{switch(j.code){case se.SEARCH:u(!0),r(se.SEARCH),o(He[0]),w.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),p([]);break;case se.CLOSE_ACTION_BAR:ce();break;case se.PLAY_SONG:console.log("Playing song",j),y(j.trackName),ce();break;case se.OPEN_ALBUM:ce(),C(`/albums/${j.id}`);break;case se.OPEN_ARTIST:ce(),C(`/artists/${j.id}`);break;case se.OPEN_GENRE:console.log("Opening genre",j),ce(),C(`/genres/${j.id}`);break;case se.PLAY_LIBRARY_RANDOM:$("Playing the library in shuffle",H.INFO),O(),ce();break;case se.OPEN_SETTINGS:ce(),C("/settings");break;case se.TOGGLE_THEME:oe(),ce()}},oe=()=>{_===Ce.DARK?(document.documentElement.classList.remove("dark"),localStorage.setItem("CML_theme",Ce.LIGHT)):(document.documentElement.classList.add("dark"),localStorage.setItem("CML_theme",Ce.DARK)),P(_===Ce.DARK?Ce.LIGHT:Ce.DARK)},ce=()=>{u(!1),r(null),w.current=null,p([])},ve=()=>{u(!0),r(se.SEARCH),o(He[0]),w.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),p([])};return n.useEffect(()=>{c&&J("action-bar-open")},[c]),e.jsx(Us.Provider,{value:{commandCodes:se,openCommandBar:Te,openSearchBar:ve,colorTheme:_,toggleColorTheme:oe,onTutoialFinished:ae},children:e.jsxs("div",{className:"action-bar-app-parent",children:[t,c&&e.jsx("div",{className:"global-action-bar",children:e.jsx("div",{className:"action-bar",ref:B,children:e.jsxs("div",{className:"action-bar-research",children:[x||null,e.jsx("input",{type:"text",id:"actionbar-searchbar",className:"searchbar",onChange:be,placeholder:`${m.description}`}),e.jsx("div",{className:"action-bar-results",children:e.jsx(Be,{height:300,itemCount:h.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:j,style:M})=>e.jsx(St,{entry:h[j],style:{...M,width:" calc(100% - 20px)",marginTop:"10px"},onClick:U},j)})})]})})})]})})},wt=()=>{const t=n.useContext(Us);if(!t)throw new Error("useGlobalActionBar must be used within a GlobalActionBar provider");return t},Ma=({onClosed:t,hideComponent:s})=>{const{setVolume:c,volume:u}=he(),l=n.useRef(null),{subscribe:a}=Le();return n.useEffect(()=>{const r=d=>{var f;if(l.current&&!l.current.contains(d.target)){if(((f=d.target.closest("svg"))==null?void 0:f.id)==="volume-button")return;s()}};return a("action-bar-open",()=>{s()}),document.addEventListener("mousedown",r),document.addEventListener("touchstart",r),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r)}},[]),e.jsx("div",{ref:l,className:"volume-bar",children:e.jsx(ft,{onClickPercentage:r=>{console.log("change volume"),c(r/100)},style:{height:"10px"},fillColor:"rgb(118, 173, 206)",percent:u*100})})},Ua=({percent:t,size:s=120,strokeWidth:c=10,useText:u=!0,style:l,color:a="rgb(130, 119, 196)"})=>{const r=(s-c)/2,d=2*Math.PI*r,f=d*(1-t);return e.jsxs("div",{className:"radial-container",style:{width:s,height:s,...l},children:[e.jsxs("svg",{width:s,height:s,children:[e.jsx("circle",{className:"radial-bg",stroke:"#e6e6e6",strokeWidth:c,fill:"none",cx:s/2,cy:s/2,r}),e.jsx("circle",{className:"radial-progress",stroke:a,strokeWidth:c,fill:"none",cx:s/2,cy:s/2,r,strokeDasharray:d,strokeDashoffset:f})]}),e.jsx("div",{className:"radial-label",children:u&&e.jsxs("span",{children:[Math.round(t),"%"]})})]})},_a=({fps:t=45})=>{const s=n.useRef(),c=n.useRef(null),{getFFTAtCurrentTime:u,fftConfigRef:l,globalAudioRef:a,FFTUserSetingsRef:r,fetchFFTUserSettings:d,colorOverride:f}=he(),m=n.useRef(0),o=h=>{var x;if(!c.current){s.current=requestAnimationFrame(o);return}const p=c.current.getContext("2d");if(p&&r.current){if(h-m.current<1e3/t){s.current=requestAnimationFrame(o);return}m.current=h;const S=5;p.clearRect(0,0,c.current.width,c.current.height);const y=u();if(!y){s.current=requestAnimationFrame(o);return}let O=y.subarray(Math.floor(y.length*.3),Math.floor(y.length*.6));const k=Math.max(1,O.length/S),N=new Array(S);N.fill(0);for(let C=0;C<O.length;C++)N[Math.floor(C/k)]+=Number(y[C]);let T=c.current.width/S-5,E=0;p.strokeStyle="#ffffff",p.fillStyle="#ffffff";for(let C=0;C<N.length;C++){const I=Qr(Math.log2(N[C])*(S/5),5,25,0,1),B=Math.max(10,Math.min(80*I*((x=a.current)==null?void 0:x.volume),c.current.height-10));p.beginPath(),p.roundRect(2+E,(c.current.height-B)/2,T,B,7),p.fill(),p.stroke(),E+=T+5}}s.current=requestAnimationFrame(o)};return n.useEffect(()=>{if(!l.current){cancelAnimationFrame(s.current),console.log("No FFT data to display, releasing anim frame.");return}s.current=requestAnimationFrame(o),console.log("FFT found, requested animation frame.")},[l.current]),n.useEffect(()=>(s.current=requestAnimationFrame(o),()=>cancelAnimationFrame(s.current)),[]),e.jsx("canvas",{ref:c,id:"fft-canvas-small",width:60,height:50})},es=({useText:t=!1,style:s={}})=>{const c=n.useRef(null),{colorTheme:u,toggleColorTheme:l}=wt();return n.useEffect(()=>{c.current.setAttribute("data-color-theme",u)},[u]),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"center",...s},children:[e.jsx(Es,{id:"color-theme-svg",ref:c,className:"buttonRound",onClick:l}),t&&e.jsx("span",{children:Zr(u.toString())})]})},Ot=()=>{const[t,s]=n.useState(!1),[c,u]=n.useState(!1),[l,a]=n.useState(!1),[r,d]=n.useState(!1),[f,m]=n.useState(!1),[o,h]=n.useState({col1:"#000",col2:"#000"}),{currentTrackData:p,trackCoverUrl:x,volume:S,toggleFullScreenView:y}=he(),{openSearchBar:O}=wt(),[k,N]=n.useState(!1),[T,E]=n.useState(null),[C,I]=n.useState(null),B=ye(),{subscribe:w}=Le();n.useRef(null);const[$,H]=n.useState(ht().pathname==="/admin-pannel"),_=()=>{a(!0)};n.useEffect(()=>{const ne=w("openAddMusic",_);return()=>{ne()}},[]);const P=()=>{a(!1),I(null),E(null)};function J(){d(!r)}function z(){m(!f)}n.useEffect(()=>{const ne=[{col1:"#ffa585",col2:"#ffeda0"},{col1:"#9bf8f4",col2:"#6f7bf7"}];h(ne[Math.floor(Math.random()*ne.length)])},[]);const ae=()=>{},X=()=>{if(!T){l?(P(),console.log("deactivate")):(_(),console.log("activate"));return}N(document.getElementsByClassName("addMusicContainer")[0]==null),console.log("toggle")};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header__logo",onClick:()=>B("/home"),children:[e.jsx(ie,{col1:o.col1,col2:o.col2}),e.jsx("h1",{children:"CML"})]}),e.jsx(Ht,{context:{mobile:!1}}),e.jsxs("div",{className:"musicPlayer",children:[e.jsxs("div",{className:"playPauseContainer",children:[(p==null?void 0:p.type)=="radio"?p.coverUrl==""?e.jsx(ie,{className:"trackImage"}):e.jsx("img",{src:p.coverUrl,className:"trackImage"}):x.split("/").pop()==="null"?e.jsx(ie,{className:"trackImage"}):e.jsx("img",{src:x,className:"trackImage"}),e.jsx("div",{className:"playPauseButtons",onClick:y,children:e.jsx(ur,{style:{padding:"0px"}})})]}),!p||Object.keys(p).length===0?null:e.jsxs("div",{className:"trackinfos-parent",children:[e.jsxs("div",{className:"trackinfo-desktop",children:[e.jsx("span",{id:"songTitle",children:p.title}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{(p==null?void 0:p.type)!="radio"&&B(`/artists/${p.artistId}`)},children:p.artist}),e.jsx(ua,{})]}),e.jsx(_a,{}),e.jsxs("div",{className:"trackinfo-mobile",children:[e.jsx("span",{id:"songTitle",children:p.title}),e.jsx(Ht,{context:{mobile:!0}})]})]})]}),e.jsxs("div",{className:"mobile-gost",children:[e.jsx(dr,{id:"playlist-button",className:"buttonRound",onClick:()=>J()}),r&&e.jsx(Sa,{hideComponent:()=>d(!1)}),S<=1e-5?e.jsx(mr,{className:"buttonRound",onClick:()=>z()}):S<.5?e.jsx(hr,{className:"buttonRound",onClick:()=>z()}):e.jsx(fr,{id:"volume-button",className:"buttonRound",onClick:()=>z()}),f&&e.jsx(Ma,{hideComponent:()=>m(!1)}),e.jsx(es,{})]}),e.jsxs("div",{className:"headerRight",children:[!$&&e.jsxs("div",{className:"serach-button-div",onClick:O,children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"K"})}),e.jsx(Xe,{})]}),e.jsxs("div",{style:{position:"relative",padding:"5px",display:"flex",justifyContent:"center"},className:"upload-music-header",children:[C&&e.jsx(Ua,{percent:C,size:44,useText:!1,style:{position:"absolute",transform:"translate(-1px, -5.5px)"}}),e.jsx(Kt,{style:{zIndex:"10",position:"relative"},className:"addMusicButton buttonRound",onClick:X}),T&&e.jsxs("span",{style:{position:"absolute",bottom:"-30px",padding:"2px 7px",borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 0.7)",textAlign:"center"},children:[T.done,"/",T.total]})]}),e.jsx(Yr,{})]}),l&&e.jsx(ja,{uploadPercent:I,uploadFinished:ae,uploadProgress:E,isMinimize:k,setMinimized:N,closeOverlay:P})]})},Ba=()=>{const[t,s]=n.useState(null),[c,u]=n.useState(null),[l,a]=n.useState(null),[r,d]=n.useState(null);n.useEffect(()=>{const o=setInterval(f,5e3);return f(),()=>clearInterval(o)},[]);const f=()=>{try{fetch(`${b}/isResponding`).then(o=>{o.status===200?(r===!1&&m(),d(!0)):d(!1)}).catch(o=>{console.error("Fetch failed (e.g., CORS error):",o),d(!1)})}catch(o){console.error("Unexpected error:",o),d(!1)}},m=()=>{fetch(`${b}/read-write/stats`,{method:"GET"}).then(o=>o.json()).then(o=>{s(o)}).catch(o=>console.error("Error fetching stats:",o)),fetch(`${b}/read-write/serverStats`,{method:"GET"}).then(o=>o.json()).then(o=>{u(Gt(o.coversByteUsage+o.tracksByteUsage).readable),a({perent:(1-o.free/o.size)*100,total:Gt(o.size).readable,free:Gt(o.free).readable})}).catch(o=>console.error("Error fetching server stats:",o))};return n.useEffect(()=>{m()},[]),e.jsxs("div",{className:"stat-short",children:[e.jsxs("div",{className:"stat-short-category",children:[e.jsxs("p",{children:["Library size: ",c]}),e.jsxs("p",{children:["Free ",l==null?void 0:l.free," of ",l==null?void 0:l.total]}),e.jsx(ft,{percent:l==null?void 0:l.perent,total:l==null?void 0:l.total,style:{height:"10px"},fillColor:"var(--chill-purple)",initialising:!c})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"5px"},children:[e.jsx("div",{className:"server-status-sprite",style:{width:"10px",height:"10px",borderRadius:"10px",backgroundColor:r?"lightgreen":"red"}}),e.jsxs("p",{children:["Server is ",r?"online":"offline"]})]})]})},Da=()=>{const{openCommandBar:t}=wt();return e.jsxs("div",{className:"sidebar",children:[e.jsxs("nav",{children:[e.jsxs(at,{id:"nav-recent",to:"/home",children:[e.jsx(pr,{}),"Recent"]}),e.jsxs(at,{to:"/playlists",children:[e.jsx(gr,{}),"Playlists"]}),e.jsxs(at,{to:"/artists",children:[e.jsx(xr,{}),"Artists"]}),e.jsxs(at,{to:"/genres",children:[e.jsx(vr,{}),"Genres"]}),e.jsxs(at,{to:"/cooking",children:[e.jsx(lt,{}),"Cooking"]}),e.jsxs(at,{to:"/radio",children:[e.jsx(jr,{}),"Radio"]})]}),e.jsx(Ba,{}),e.jsxs("div",{className:"serach-button-div",onClick:t,style:{margin:"auto",marginBottom:"20px"},children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"SPACE"})}),e.jsx(yr,{})]})]})},Ga=()=>{const t=ye(),[s,c]=n.useState(!1);if(n.useEffect(()=>{(async()=>{if((await(await fetch(`${b}/auth/verifyToken`,{method:"POST",credentials:"include"})).json()).success){c(!1);return}t("/")})()},[t]),s)return e.jsx(Nt,{});const l=ht().pathname,a=["/home"];return e.jsxs("div",{className:"app-container",children:[e.jsx(Ot,{}),e.jsxs("div",{className:"content-container",page:a.includes(l)?l:"inside",children:[e.jsx(Da,{}),e.jsxs("div",{className:"content",children:[e.jsx(ys,{})," "]})]})]})},ts=({album:t,hideArtist:s=!1})=>{const c=ye(),[u,l]=n.useState([]),a=r=>{c(`/albums/${r}`)};return n.useEffect(()=>{t.artists&&l(JSON.parse(t.artists).map(r=>r.name))},[t]),e.jsxs("div",{className:"album-card",onClick:()=>a(t.id),children:[t.cover?e.jsx("img",{src:`${b}/covers/${t.cover}`,alt:`${qe(t.title,25)} cover`,className:"album-card-cover"}):e.jsx(ie,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:qe(t.title,40)}),!s&&e.jsx("p",{className:"album-artist",children:qe(u.toString().replace(/,/g,", "),25)||"No artist"})]})},ss=()=>{const{emit:t}=Le(),s=()=>{t("openAddMusic")};return e.jsxs("div",{className:"add-music-shortcut",children:[e.jsx("h2",{children:"Welcome to the Crystal Music Library !"}),e.jsxs("button",{onClick:s,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"15px",margin:"auto"},children:[e.jsx(Kt,{}),e.jsx("h3",{style:{margin:"2px"},children:"Add music"})]})]})},Va=({})=>{const[t,s]=n.useState([]),[c,u]=n.useState(!1),l=()=>{fetch(`${b}/read-write/albums`,{method:"GET",credentials:"include"}).then(r=>{if(r.status!==200){console.error("Error fetching albums");return}return r.json()}).then(r=>{s(r),u(!0)})};n.useEffect(()=>{l();const r=d=>{console.log("Music uploaded:",d.detail),l()};return window.addEventListener("musicUploaded",r),()=>{window.removeEventListener("musicUploaded",r)}},[]);const a=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});return e.jsx("div",{className:"home album-displayer","data-no-tracks":(t==null?void 0:t.length)==0&&c?"true":"false",children:c?(t==null?void 0:t.length)!==0?t.map(r=>e.jsx(ts,{album:r},r.id)):e.jsx(ss,{}):e.jsx(a,{})})},Ha=()=>e.jsx("p",{children:" Your albums"}),Fe={FETCHING:"fetching",SUCCESS:"success",REJECTED:"rejected",NONE:"none"},za=()=>{const t=n.useRef(Fe.NONE),[s,c]=n.useState(Fe.NONE),u=ye(),{emit:l}=Le(),a=async f=>{if(f.preventDefault(),!f.target.email.value||!f.target.password.value){alert("Please fill in all fields");return}const m=new FormData(f.target),o=await fetch(`${b}/auth/login`,{method:"POST",credentials:"include",body:m}),h=await o.json();o.ok?(localStorage.setItem("username",h.username),t.current=Fe.SUCCESS):t.current=Fe.REJECTED,d()},r=()=>{switch(s){case Fe.FETCHING:return e.jsx(Ls,{});case Fe.SUCCESS:return e.jsxs("div",{className:"loginFeedback",sucess:"true",children:[e.jsx(ut,{className:"successIcon"}),e.jsx("span",{children:"Logged in"})]});case Fe.REJECTED:return e.jsxs("div",{className:"loginFeedback",sucess:"false",children:[e.jsx(we,{className:"failIcon"}),e.jsx("span",{children:"Wrong credentials"})]});default:return null}},d=()=>{switch(c(t.current),t.current){case Fe.REJECTED:setTimeout(()=>{c(Fe.NONE)},1e3);break;case Fe.SUCCESS:setTimeout(()=>{l("login"),u("/home")},1e3);break}};return e.jsxs("div",{className:"authDiv",children:[e.jsx(es,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(ie,{}),e.jsx("h2",{children:"Login"}),e.jsx("p",{children:"We were not able to connect you, please login."}),e.jsxs("form",{onSubmit:a,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"password"}),e.jsx("button",{type:"submit",children:"Login "}),e.jsx("p",{children:"Don't have an account?"}),e.jsx("button",{onClick:()=>{u("/register")},children:"Register"})]}),e.jsx(r,{})]})},qa=[Ve("#f8be99"),Ve("#f495e9"),Ve("#bbfbdf"),Ve("#c4d3f8"),Ve("#edc9f9"),Ve("#909ef8"),Ve("#96ebf4")],Ft=60,jt=Ve("#242424"),_s=()=>{const[t,s]=n.useState([jt,jt]),c=n.useRef([]),u=n.useRef([jt,jt]),l=n.useRef(qa),a=n.useRef(0),r=n.useRef(0);n.useEffect(()=>(r.current=setInterval(f,1e3/Ft),()=>{clearInterval(r.current)}),[]);const d=()=>{const m=it.sample(l.current);return l.current.filter(o=>o.join(",")!=m.join(",")),m},f=()=>{a.current%Ft===0&&(c.current[0]&&c.current[0]!==jt&&l.current.push(...c.current),c.current=u.current,u.current=[d(),d()]),s(c.current.map((m,o)=>u.current[o].map((h,p)=>parseInt(Qe(m[p],h,a.current%Ft/Ft))))),a.current+=1};return e.jsx("div",{id:"background-img",style:{"--col1":hs(...t[0]),"--col2":hs(...t[1])}})},ot=Object.freeze({LOGIN:"login",REGISTER:"register",ANY_USER:"any_user",VERIF_TOKEN:"verif_token"}),Wa=()=>{const t=ye(),[s,c]=n.useState([]),[u,l]=n.useState(null),[a,r]=n.useState(!0);return n.useRef(null),n.useEffect(()=>{(async()=>{l(ot.ANY_USER);const m=await(await fetch(`${b}/auth/any-user`,{method:"GET"})).json();if(console.log("Parsed users",m),c(m),console.log(m),m===0){r(!1),l(ot.REGISTER);return}l(ot.VERIF_TOKEN);const h=await(await fetch(`${b}/auth/verifyToken`,{method:"POST",credentials:"include"})).json();if(r(!1),h.success){console.log("Token is valid"),t("/home");return}l(ot.LOGIN)})()},[t]),u===ot.REGISTER&&!a&&t("/register"),e.jsxs(e.Fragment,{children:[e.jsx(_s,{}),!a&&u===ot.LOGIN?e.jsx(za,{}):null]})},Bs=({index:t,track:s,playIconId:c,isSalad:u=null,onClick:l,showCover:a=!1})=>{const{title:r,track_number:d,rawDuration:f}=s,{playingTrack:m,openTrackActions:o}=he(),h=s.id,[p,x]=n.useState("null"),[S,y]=n.useState(!1),[O,k]=n.useState(!1),N=()=>{if(u){u(t);return}l(s.id)},T=()=>{switch(c){case 0:return e.jsx(wr,{className:"track-number",playing:"piano","data-show-cover":a});case 1:return e.jsx(Sr,{className:"track-number",playing:"vinyl","data-show-cover":a});case 2:return e.jsx(kr,{className:"track-number",playing:"piano","data-show-cover":a});case"salad":return e.jsx(lt,{className:"track-number",playing:"piano","data-show-cover":a})}};n.useEffect(()=>{y(s.is_favorite===1),a&&fetch(`${b}/read-write/trackCover/${s.id}`,{method:"GET"}).then(w=>w.json()).then(w=>{x(`${b}/covers/${w}`)})},[]);const E=w=>{w.stopPropagation(),fetch(`${b}/read-write/toggleFavorite/${s.id}/${!S}`,{method:"GET",credentials:"include"}).then($=>$.json()).then($=>{y($)})},C=()=>{k(!1)},I=w=>{w.stopPropagation(),k(!0),o({x:w.clientX,y:w.clientY},s,C,B)},B=w=>{y(w)};return e.jsxs("div",{className:"track-view","action-bar":O?"open":"",onClick:N,children:[S&&e.jsx(br,{className:"track-favorite"}),e.jsx(Pt,{className:"track-toggle-favorite",iconHovered:S?Vt:Nr,iconDefault:S?Vt:Ns,onClick:E}),a?p.split("/").pop()==="null"?null:e.jsx("img",{src:p,className:"track-mini-thumbnail"}):null,m===h?T():a?null:e.jsx("p",{className:"track-number",children:d}),e.jsx("p",{style:{flexGrow:"1",marginLeft:a?"45px":"35px"},children:r}),e.jsx(Ts,{className:"track-actions-dots",onClick:I}),e.jsx("p",{style:{paddingRight:"10px"},children:Qt(f).readable})]})},gs=({isPlaylist:t=!1})=>{const[s,c]=n.useState(null),[u,l]=n.useState([]),[a,r]=n.useState([]),[d,f]=n.useState([]),[m,o]=n.useState(0),{addContainerToQueue:h,playContainerSuffle:p,editAlbum:x,editPlaylist:S,linkNewContainer:y,getNextSongsFromAlbum:O,navigateBack:k}=he(),N=n.useRef(null),T=ye(),[E,C]=n.useState([]),I=t?$t().playlistId:$t().albumId,[B,w]=n.useState(null),$=n.useRef(null),{notifTypes:H,addNotification:_}=tt(),[P,J]=n.useState(!1),[z,ae]=n.useState(!1),[X,ne]=n.useState(!1);n.useEffect(()=>{ue()},[I,z]),n.useEffect(()=>{y({id:I,type:t?"playlist":"album",favPlaylist:P},ue)},[P]);const ue=()=>{fetch(`${b}/read-write/${t?"playlist":"album"}/${I}`,{method:"GET",credentials:"include"}).then(j=>{if(!j.ok)throw new Error("Network response was not ok");return j.json()}).then(j=>{o(Math.floor(Math.random()*3));const M=j.tracks.filter(Z=>(!X&&Z.is_favorite===1&&ne(!0),z?Z.is_favorite===1:!0));if(t){c(j.playlistInfos),l(M),f([j.owner,...j.collaborators]),J(j.isFavPlaylist);return}c(j.albumInfos);let Q=0;for(let Z=0;Z<M.length;Z++){const de=M[Z];de.disc>Q&&(M.splice(Z,0,{disc:de.disc,type:"disc"}),Q=de.disc)}l(M),r(j.genres),f(j.artists),J(!1)})},Te=async()=>await h(I,t?"playlist":"album",z),ke=async()=>{p(I,t?"playlist":"album",z)},Se=()=>{if(t){S(I);return}x(I)},be={TRACK:"track",ALBUM:"album",ARTIST:"artist",PLAYLIST:"playlist",GENRE:"genre"},Pe=j=>{switch(j){case"track":return e.jsx(Kt,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add album"})," ",e.jsx(kt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add artist's discography"})," ",e.jsx(Ar,{className:"action-bar-entry-tooltip-logo"})]});case"playlist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire playlist"})," ",e.jsx(Rr,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire genre"})," ",e.jsx(Cr,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},V=j=>{const M=j.target.value;if(M===""||M.trim().length===0){C([]);return}console.log(`${b}/read-write/search/${M}`),fetch(`${b}/read-write/search/${M}`,{method:"GET"}).then(Q=>{if(Q.ok)return Q.json();throw new Error("Error fetching search results")}).then(Q=>{var de,Ee,De,$e,G;const Z=[...(de=Q.tracks)==null?void 0:de.map(F=>({type:"track",...F})),...(Ee=Q.albums)==null?void 0:Ee.map(F=>({type:"album",...F})),...(De=Q.artists)==null?void 0:De.map(F=>({type:"artist",...F})),...($e=Q.genres)==null?void 0:$e.map(F=>({type:"genre",...F})),...(G=Q.playlists)==null?void 0:G.map(F=>({type:"playlist",...F})).filter(({id:F})=>F!==I)].map(F=>{const A=F.path,{trackPath:K,...re}=F;return{icon:()=>A?e.jsx("img",{className:"action-bar-entry-logo",src:`${b}/${F.type==="artist"?"artist":"covers"}/${A}`,alt:F.name}):e.jsx(ie,{className:"action-bar-entry-logo"}),tooltip:Pe,code:F.type==="artist"?be.ARTIST:F.type==="album"?be.ALBUM:F.type==="genre"?be.GENRE:F.type==="playlist"?be.PLAYLIST:be.TRACK,fileName:A,...re}});console.log(Z),C(Z)})},U=j=>{B||setTimeout(()=>{requestAnimationFrame(()=>{var M;(M=$.current)==null||M.focus()})},0)},oe=j=>{const M=new FormData;M.append("addRequest",JSON.stringify({playlistId:I,endpoint:j.code,entryId:j.id,addAllToFavorite:P||!1})),fetch(`${b}/read-write/addToPlaylist`,{method:"POST",credentials:"include",body:M}).then(Q=>Q.json()).then(Q=>{ue(),ce(),_("Added to playlist",H.INFO)})};n.useEffect(()=>{const j=M=>{N.current&&!N.current.contains(M.target)&&ce()};return document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j)}},[]);const ce=()=>{w(!1),$.current.value="",C([])},ve=j=>{O(j,z)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton",onClick:k,children:e.jsx(Ze,{})}),(s==null?void 0:s.cover)&&e.jsx("img",{src:`${b}/covers/${s.cover}`,className:"background-image",alt:"background"}),s&&u?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:s.title}),e.jsx("div",{className:"album-artists",children:d?d.map(j=>e.jsx("span",{className:"artist-name",onClick:()=>{T(`/${t?"users":"artists"}/${j.id}`)},children:j.name},j.id)):e.jsxs("span",{className:"artist-name",children:["Unknown ",t?"Members":"Artist"]})}),e.jsxs("div",{className:"album-content",children:[e.jsx("div",{className:"album-cover-genres",children:e.jsxs("div",{className:"album-cover-wrapper",children:[s.cover?e.jsx("img",{src:`${b}/covers/${s.cover}`,alt:`${s.title} cover`,className:"cover-image"}):e.jsx(ie,{className:"cover-image"}),e.jsx("div",{className:"genres-album-div",children:a.map((j,M)=>e.jsx("span",{className:"genre-album",onClick:()=>{T(`/genres/${j.genreId}`)},children:j.genreName},M))}),s.description&&e.jsx("p",{children:s.description})]})}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(me,{text:"Add to queue",icon:e.jsx(Jt,{}),onClick:Te}),e.jsx(me,{text:"Random",icon:e.jsx(mt,{}),onClick:ke}),!P&&e.jsx("button",{className:"button-with-callback",onClick:Se,children:e.jsx(Wt,{})}),!P&&X&&e.jsx("button",{className:"button-with-callback","data-is-active":z,onClick:()=>{ae(!z)},children:e.jsx(Tr,{})}),s.lossless===1&&e.jsxs("div",{className:"lossless",children:[e.jsx("span",{children:"Lossless"})," ",e.jsx(Er,{})]})]}),t&&e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:N,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",onClick:U,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Xe,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:V,placeholder:"Search for tracks, artists, genres, playlists to add.",ref:$,onFocus:()=>{w(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${B?"block":"none"}`},children:e.jsx(Be,{height:300,itemCount:E.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:j,style:M})=>e.jsx(St,{entry:E[j],style:{...M,width:" calc(100% - 20px)",marginTop:"10px"},onClick:oe},j)})})]})}),u.map((j,M)=>(j==null?void 0:j.type)==="disc"?e.jsx("span",{children:`Disc ${j.disc}`},`disc-${M}`):e.jsx(Bs,{track:j,onClick:ve,playIconId:m,showCover:t},j.id))]})]})]}):e.jsx(Nt,{text:"Loading album"})]})},Ka=({artist:t})=>{const s=ye(),c=u=>{s(`/artists/${u}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>c(t.id),children:[t.picture?e.jsx("img",{src:`${b}/covers/artists/${t.picture}`,alt:`${t.name} cover`,className:"artist-card-cover"}):e.jsx(ie,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},Ja=()=>{const[t,s]=n.useState([]),c=()=>{fetch(`${b}/read-write/artists`,{method:"GET",credentials:"include"}).then(u=>{if(u.status!==200){console.error("Error fetching artists");return}return u.json()}).then(u=>{s(u)})};return n.useEffect(()=>{c();const u=l=>{console.log("Music uploaded:",l.detail),c()};return window.addEventListener("musicUploaded",u),()=>{window.removeEventListener("musicUploaded",u)}},[]),e.jsx("div",{className:"home album-displayer",children:(t==null?void 0:t.length)!==0?t.map(u=>e.jsx(Ka,{artist:u},u.id)):e.jsx(ss,{})})},Ya=()=>{const[t,s]=n.useState(null),[c,u]=n.useState([]),{addArtistToQueue:l,shuffleArtistToQueue:a,editArtist:r,linkNewContainer:d,navigateBack:f}=he(),m=$t().artistId;n.useEffect(()=>{o(),d({id:m,type:"artist"},o)},[m]);const o=()=>{fetch(`${b}/read-write/artist/${m}`,{method:"GET",credentials:"include"}).then(x=>{if(!x.ok)throw new Error("Network response was not ok");return x.json()}).then(x=>{s(x.artistInfos),u(x.albums),console.log(x.artistInfos)})},h=async()=>await l(m),p=async()=>{a(m,!1)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton",onClick:f,children:e.jsx(Ze,{})}),t&&c?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"album-content",children:[t.picture?e.jsx("img",{src:`${b}/covers/artists/${t.picture}`,alt:`${t.name} cover`,className:"cover-image"}):e.jsx(ie,{className:"cover-image"}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(me,{text:"Add to queue",icon:e.jsx(Jt,{}),onClick:h}),e.jsx(me,{text:"Random",icon:e.jsx(mt,{}),onClick:p}),e.jsx(me,{icon:e.jsx(Wt,{}),onClick:async()=>{r(t.id)}})]}),e.jsx("div",{className:"album-displayer",children:c.map(x=>e.jsx(ts,{album:x,hideArtist:!0},x.id))})]})]})]}):e.jsx(Nt,{text:"Loading artist"})]})},Qa=()=>{const t=ye(),s=()=>{t("/home")};return e.jsxs("div",{className:"not-found",children:[e.jsx("h1",{children:"Where did you land..?"}),e.jsx("p",{children:"The adress you gave is not defined, but you can go back to library:"}),e.jsx("button",{className:"btn",onClick:s,children:"Go back to library"})]})},Xa=()=>{const[t,s]=n.useState("");n.useEffect(()=>{s(localStorage.getItem("username"))},[]);const c=ye();return e.jsxs("div",{className:"account-page",children:[e.jsx(Ot,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>c("/home"),children:e.jsx(Ze,{})}),e.jsxs("div",{className:"account-container",children:[e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:t}),e.jsx("p",{children:"Account information will be displayed here."})]}),e.jsx(ie,{})]})]})]})},Za=({active:t,setActive:s})=>e.jsx("div",{className:"toggle-button","data-is-active":t,onClick:c=>{c.stopPropagation(),s(!t)},children:e.jsx("div",{className:"toggle-button-active","data-is-active":t})}),ze=({stateChanged:t,min:s=0,max:c=0,ref:u})=>{const l=s===c&&c===0,a=d=>{const f=d.target.value;t(f)},r=d=>{console.log("blur");let f=parseFloat(d.target.value);isNaN(f)&&(f=s),l||(f=Math.min(c,Math.max(s,f))),d.target.value=f,t(f)};return l?e.jsx("input",{ref:u,type:"number",onBlur:r,onChange:a}):e.jsx("input",{min:s,ref:u,max:c,type:"number",onBlur:r,onChange:a})},eo=()=>{var S;const t=n.useRef(null),s=n.useRef(null),c=n.useRef(null),u=n.useRef(null),l=n.useRef(null),{FFTUserSetingsRef:a,fftConfigRef:r}=he(),d=y=>{a.current.bars=Math.floor(y),p()},f=y=>{a.current.cutoff=parseFloat(y),p()},m=y=>{a.current.scale=parseFloat(y),p()},o=y=>{a.current.contrast=parseFloat(y),p()},h=y=>{a.current.FPS=parseFloat(y),p()},p=()=>{const y=new FormData;y.append("FFT",JSON.stringify(a.current)),fetch(`${b}/config/user/send/FFT`,{method:"POST",credentials:"include",body:y})},x=async()=>{await fetch(`${b}/config/user/FFT`,{method:"GET",credentials:"include"}).then(y=>y.json()).then(y=>{a.current=y,t.current.value=a.current.bars,u.current.value=a.current.contrast,s.current.value=a.current.scale,l.current.value=a.current.cutoff,c.current.value=a.current.FPS})};return n.useEffect(()=>{x()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Number of bars"}),e.jsx(ze,{ref:t,stateChanged:d,min:1,max:(S=r.current)==null?void 0:S.fftSize})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"FPS (High number may cause strong battery usage)"}),e.jsx(ze,{ref:c,stateChanged:h})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Scale"}),e.jsx(ze,{ref:s,stateChanged:m})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Contrast"}),e.jsx(ze,{ref:u,stateChanged:o})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Cutoff"}),e.jsx(ze,{ref:l,stateChanged:f})]})]})},to={FFT:eo},so=({entryName:t,entryIcon:s,linkedSettingKey:c})=>{const[u,l]=n.useState(!1),a=n.useMemo(()=>to[c]||null,[c]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":u,onClick:r=>{r.stopPropagation(),l(!u)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:a&&u&&e.jsx(a,{})})]})},no=()=>{const[t,s]=n.useState(!1);n.useEffect(()=>{et(()=>{fetch(`${b}/auth/is-admin`,{method:"POST",credentials:"include"}).then(l=>l.json()).then(l=>{s(l)})})()},[]);const c=ye();return e.jsxs("div",{className:"account-page",children:[e.jsx(Ot,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>c("/home"),children:e.jsx(Ze,{})}),e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:"Settings page"}),e.jsx("p",{children:"A shinny list of fancy settings."}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(so,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Cs,{})})})]})]})]})},ro=({user:t,totalStorage:s})=>{const[c,u]=n.useState(0);return n.useEffect(()=>{fetch(`${b}/read-write/user-data-usage/${t.id}`,{method:"GET",credentials:"include"}).then(l=>l.json()).then(l=>{u(l)}).catch(l=>{console.error("Error fetching user storage data: ",l)})},[]),e.jsxs("div",{className:"user-account-infos-entry",children:[e.jsx("p",{children:t.username}),e.jsx("p",{children:t.email}),e.jsx("p",{children:t.role}),e.jsx(ft,{percent:Number(c/s*100).toFixed(2),fillColor:"var(--cool-green)",showPercent:!0,style:{maxWidth:"200px"}})]})},Ye={PENDING:"pending",RUNNING:"running",PAUSED:"paused",INACTIVE:"inactive"},xs=({jobName:t,description:s,jobKey:c,payload:u={},doneTotalView:l=null})=>{const[a,r]=n.useState(!1),[d,f]=n.useState(!0),[m,o]=n.useState(0),[h,p]=n.useState(!1),[x,S]=n.useState(null),y=n.useRef(null),O=(w=!0,$="",H=0)=>{var _=w;fetch(`${b}/jobs/status/${c}`,{method:"GET",credentials:"include"}).then(P=>P.json()).then(P=>{p(!1);let J=1e3;switch(P.status){case Ye.PENDING:p(!0),r(!0),f(!1),J=500;break;case Ye.INACTIVE:if($===Ye.RUNNING||$===Ye.PENDING){setTimeout(()=>{r(!1),o(0),S(null),O(!1,P.status)},2e3),o(100),S({done:H,total:H,working:0}),_=!1,console.log("Stop fast fetch job");return}r(!1);break;case Ye.PAUSED:f(!0),r(!0),J=500;break;case Ye.RUNNING:f(!1),r(!0),J=10;break}y.current&&(clearTimeout(y.current),y.current=null),_&&(y.current=setTimeout(()=>{var z;if(P.progress){const ae=P.progress.done/P.progress.total*100;o(ae),S(P.progress)}else S(null);O(!0,P.status,((z=P.progress)==null?void 0:z.total)??0)},J))})},k=()=>{fetch(`${b}/jobs/status/${c}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{O(w.status===Ye.RUNNING)})},N=()=>{const w=new FormData;w.append("payload",JSON.stringify(u)),fetch(`${b}/jobs/run/${c}`,{method:"POST",credentials:"include",body:w}).then($=>$.json()).then($=>{O(!0)})},T=()=>{fetch(`${b}/jobs/pause/${c}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{O(!1)})},E=()=>{fetch(`${b}/jobs/resume/${c}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{O(!0)})},C=()=>{fetch(`${b}/jobs/stop/${c}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{O(!1)})};n.useEffect(()=>(k(),()=>{y.current&&(console.log("Trying clearTimout"),clearTimeout(y.current),y.current=null)}),[]);const I=async()=>{if(a){d?E():T(),f(!d);return}N()},B=async()=>{C(),o(0)};return e.jsxs("div",{className:"backend-job",children:[e.jsx("h3",{children:t}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"baseline",flexWrap:"wrap"},children:[e.jsx(me,{text:a?d?"Resume":"Pause":"Run",icon:a?d?e.jsx(Ir,{}):e.jsx(Fr,{}):e.jsx(Lr,{}),onClick:I}),e.jsx(me,{text:"Stop",icon:e.jsx(Pr,{}),onClick:B}),e.jsx(ft,{style:{height:"25px",filter:`grayscale(${d&&a?.8:0})`},minWidth:"200px",percent:m,showPercent:!1,text:x?l.current?`${x.done}/${x.total}`:`Working: ${x.working} | Left : ${x.total-x.done}`:null,fillColor:"linear-gradient(90deg, rgb(187, 251, 223) 0%, rgb(198, 203, 253) 50%, rgb(239, 201, 249) 100%)",initialising:h,initialisingColor:"violet"})]}),e.jsx("p",{children:s}),e.jsx("div",{className:"job-status","data-running":d?"false":"true","data-status":a?h?"init":d?"stop":"run":"inactive",children:e.jsx("span",{children:a?h?"Initlialising":d?"Paused":"Running":"Inactive"})})]})},ao=()=>{const t=n.useRef(null),s=n.useRef(null),c=n.useRef(null),u=n.useRef(null),[l,a]=n.useState(!1),r=h=>{t.current.samples=Math.floor(h),m()},d=h=>{t.current.samplingInterval=1/Math.floor(h),m()},f=h=>{t.current.parallelCompute=Math.floor(h),m()},m=()=>{const h=new FormData;h.append("FFT",JSON.stringify(t.current)),fetch(`${b}/config/send/FFT`,{method:"POST",credentials:"include",body:h})},o=async()=>{await fetch(`${b}/config/FFT`,{method:"GET",credentials:"include"}).then(h=>h.json()).then(h=>{t.current=h}),a(t.current.useServerFFT),c.current.value=t.current.samples,s.current.value=Math.floor(1/t.current.samplingInterval),u.current.value=t.current.parallelCompute};return n.useEffect(()=>{o()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line",children:[e.jsx("span",{children:"Activate audio spectra computation"}),e.jsx(Za,{defaultValue:t.current,active:l,setActive:h=>{a(h),t.current&&(t.current.useServerFFT=h,m())}})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame definiton (power of 2)"}),e.jsx(ze,{ref:c,stateChanged:r,max:4096,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame per second"}),e.jsx(ze,{ref:s,stateChanged:d,max:120,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Number of parallel analyzed songs"}),e.jsx(ze,{ref:u,stateChanged:f,max:10,min:1})]})]})},oo={FFT:ao},co=({entryName:t,entryIcon:s,linkedSettingKey:c})=>{const[u,l]=n.useState(!1),a=n.useMemo(()=>oo[c]||null,[c]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":u,onClick:r=>{r.stopPropagation(),l(!u)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:a&&u&&e.jsx(a,{})})]})},io=()=>{const t=()=>localStorage.getItem("job-progress-view")?localStorage.getItem("job-progress-view")==="true":!0,[s,c]=n.useState(!1),[u,l]=n.useState([]),[a,r]=n.useState(0),d=n.useRef(t()),f=ye();n.useEffect(()=>{et(()=>{fetch(`${b}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{c(x)})})()},[]),n.useEffect(()=>{s.error||fetch(`${b}/auth/init-admin-pannel`,{method:"POST",credentials:"include"}).then(p=>p.json()).then(p=>{l(p.users),r(p.totalStorage)})},[s]);const m=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You are not an admin."})]}),o=p=>{const x=p===0;d.current=x,localStorage.setItem("job-progress-view",x)},h=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Admin pannel"}),e.jsx("p",{children:"Only for the true admins."}),e.jsxs("div",{className:"admin-category",children:[e.jsx($r,{}),e.jsx("h2",{children:"Users' storage usage"})]}),e.jsx("div",{className:"all-users-list",children:u.map(p=>e.jsx(ro,{user:p,totalStorage:a},p.id))}),e.jsxs("div",{className:"admin-category",children:[e.jsx(Or,{}),e.jsx("h2",{children:"Backend processes"}),e.jsx($s,{data:["Done/Total","Working/Remaining"],currentActive:t()?0:1,onClick:o})]}),e.jsxs("div",{className:"job-grid",children:[e.jsx(xs,{jobKey:"JOB_CD",jobName:"Recompute tracks number and CDs",description:"Reextract the metadatas of the songs to remap them to the correct CD or track number. Analyses lossless.",doneTotalView:d}),e.jsx(xs,{jobKey:"JOB_FFT",jobName:"Compute audio spectras",description:"Runs a fast Fourier transform on each audio files to extract the audio spectrum. The result is writen into .bin files. For a .flac audio of 41kHz, we expect 3Mb spectrum file.",payload:{completeLibrary:!0},doneTotalView:d})]}),e.jsxs("div",{className:"admin-category",children:[e.jsx(Mr,{}),e.jsx("h2",{children:"Configuration"})]}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(co,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Cs,{})})})]});return e.jsxs("div",{className:"account-page",children:[e.jsx(Ot,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>f("/home"),children:e.jsx(Ze,{})}),e.jsx("div",{className:"account-info",children:s?e.jsx(h,{}):e.jsx(m,{})})]})]})},lo=()=>{const[t,s]=n.useState(!0),c=ye(),u=async a=>{if(a.preventDefault(),!a.target.email.value||!a.target.password.value||!a.target.repeat_password.value||!a.target.name.value){alert("Please fill in all fields");return}if(a.target.password.value!==a.target.repeat_password.value){alert("Passwords do not match");return}const r=new FormData(a.target),d=await fetch(`${b}/auth/register`,{method:"POST",credentials:"include",body:r}),f=await d.json();d.ok?(alert("User registered successfully"),c("/home")):alert(f.error)};n.useEffect(()=>{fetch(`${b}/auth/any-user`,{method:"GET"}).then(a=>a.json()).then(a=>{s(a===0)})},[]);const l=()=>e.jsxs("div",{style:{marginBottom:"30px",display:"flex",flexDirection:"row",alignItems:"center",margin:"auto",gap:"20px"},children:[e.jsx("p",{style:{textWrap:"nowrap"},children:"Already an account?"}),e.jsx("button",{style:{width:"100%"},onClick:a=>{a.stopPropagation(),c("/")},children:"Login"})]});return e.jsxs("div",{className:"authDiv",children:[e.jsx(es,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(_s,{}),e.jsx(ie,{}),e.jsx("h2",{children:"Register"}),e.jsx("p",{children:t?`Welcome to the Crystal Music Library! Since you are the first 
            to show up here, we would like you to create the admin account.`:"Please fill the form to register as a new user."}),!t&&e.jsx(l,{}),e.jsxs("form",{onSubmit:u,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"new-password"}),e.jsx("label",{htmlFor:"repeat_password",children:"Confirm Password"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",name:"repeat_password",autoComplete:"password"}),e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",autoComplete:"name"}),e.jsx("button",{type:"submit",children:"Register"})]})]})},uo=()=>{const[t,s]=n.useState(null),{genreId:c}=$t(),{addContainerToQueue:u,playContainerSuffle:l,playContainer:a,navigateBack:r}=he();n.useEffect(()=>{fetch(`${b}/read-write/genre/${c}`,{method:"GET",credentials:"include"}).then(o=>{if(!o.ok)throw new Error("Network response was not ok");return o.json()}).then(o=>{s(o),console.log(o)})},[]);const d=async()=>{a(c,"genre")},f=async()=>{u(c,"genre")},m=async()=>{l(c,"genre")};return e.jsxs("div",{className:"genre-view",children:[e.jsx("button",{className:"roundButton",onClick:r,children:e.jsx(Ze,{})}),t?e.jsxs("div",{className:"genre-details",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"baseline",gap:"10px"},children:[e.jsx("h1",{style:{marginRight:"20px"},children:t.name}),e.jsx(me,{text:"Play",icon:e.jsx(qt,{}),onClick:d}),e.jsx(me,{text:"Random",icon:e.jsx(mt,{}),onClick:m}),e.jsx(me,{text:"Add to queue",icon:e.jsx(Jt,{}),onClick:f})]}),e.jsx("div",{className:"genre-albums album-displayer",children:t.albums.map(o=>e.jsx(ts,{album:o},o.id))})]}):e.jsx("p",{children:"Loading..."})]})},mo=({genre:t})=>{const s=ye(),[c,u]=n.useState([]),[l,a]=n.useState([]),r=n.useRef([]),d=n.useRef(l),f=n.useRef([]),m=p=>{var S;if(console.log("changed on",p),!((S=d.current)!=null&&S.length)==0)return;const x=document.getElementById(`genre-${t.id}-img-${p}`);x==null||x.setAttribute("data-hidden","true"),setTimeout(()=>{x&&(x.src=`${b}/covers/${d==null?void 0:d.current[p]}`),x==null||x.removeAttribute("data-hidden")},500)};n.useEffect(()=>(o(u),h(),[2e3,2500,3e3].forEach((x,S)=>{setTimeout(()=>m(S),x);const y=setInterval(()=>m(S),7e3);f.current.push(y)}),()=>{r.current.forEach(clearTimeout),r.current=[],f.current.forEach(clearInterval),f.current=[],d.current=[]}),[]);const o=p=>{fetch(`${b}/read-write/trackCoversGenre/${t.id}`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{p(x)})};n.useEffect(()=>{d.current=l},[l]);const h=()=>{o(a),setTimeout(h,5500)};return e.jsxs("div",{className:`genre-card ${t==null?void 0:t.puredName}`,onClick:()=>{s(`/genres/${t.id}`)},children:[c.map((p,x)=>e.jsx("div",{className:"img-pivot",style:{"--start-delay":`${3*(2-x)}`,"--start-angle":`${2-x}`,"--speed":"0.7","--scale":.4},children:e.jsx("img",{id:`genre-${t.id}-img-${x}`,className:"genre-img-cover",style:{"--scale":.7},src:`${b}/covers/${p}`})},x)),e.jsx("div",{className:"genre-name",children:e.jsx("p",{children:t.name})})]})},ho=[{name:"rock"},{name:"hiphop"},{name:"jazz"},{name:"edm"},{name:"house"},{name:"techno"},{name:"trance"},{name:"dubstep"},{name:"reggae"},{name:"ska"},{name:"country"},{name:"folk"},{name:"acoustic"},{name:"singer"},{name:"songwriter"},{name:"latin"},{name:"salsa"},{name:"reggaeton"},{name:"afrobeat"},{name:"jpop"},{name:"jpop"},{name:"lofi"},{name:"electronic"},{name:"indie"},{name:"alternative"},{name:"punk"},{name:"metal"},{name:"opera"},{name:"classical"},{name:"funk"},{name:"blues"},{name:"soul"},{name:"rnb"},{name:"chillhop"},{name:"ambiant"},{name:"soundtrack"},{name:"art-rock"},{name:"pop-rock"},{name:"breakcore"},{name:"worldwide"},{name:"rnb-soul"},{name:"hard-rock"},{name:"shoegaze"},{name:"indie-rock"},{name:"traditional"},{name:"anime"},{name:"pop"}],fo=new Rs(ho,{keys:["name"],threshold:.4}),po=t=>{const s=t.replace(/[^a-zA-Z ]/g," "),c=fo.search(s);return"genre-"+(c.length>0?c[0].item.name:"default")},go=({})=>{var r,d;const{subscribe:t}=Le(),[s,c]=n.useState([]),[u,l]=n.useState(()=>{const f=localStorage.getItem("CML_FinishedTutorials");return f&&JSON.parse(f).state[Re.GENRES]||!1}),a=()=>{fetch(`${b}/read-write/genres`,{method:"GET",credentials:"include"}).then(f=>f.json()).then(f=>{f.genres=f.genres.map(m=>({...m,puredName:po(m.name)})),c(f)})};return n.useEffect(()=>{et(()=>{a();const m=o=>{console.log("Music uploaded:",o.detail),a()};return t(`safe-finished-tutorial-${Re.GENRES}`,()=>{l(!0)}),window.addEventListener("musicUploaded",m),()=>{window.removeEventListener("musicUploaded",m)}})()},[]),e.jsx(e.Fragment,{children:((r=s==null?void 0:s.genres)==null?void 0:r.length)!==0?e.jsx("div",{className:"home genre-displayer",children:(d=s==null?void 0:s.genres)==null?void 0:d.map(f=>e.jsx(mo,{genre:f},f.id))}):(s==null?void 0:s.trackNum)>0?u?e.jsxs("div",{className:"info-line",id:"text-no-genre",children:[e.jsx("span",{children:"No genres found in the library."}),e.jsx(zt,{className:"info-button",onClick:()=>{l(!1)}})]}):e.jsx(Ms,{tutorialKey:Re.GENRES}):e.jsx(ss,{})})},xo=({playlist:t})=>{const s=ye(),c=u=>{s(`/playlists/${u}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>c(t.id),children:[t.cover?e.jsx("img",{src:`${b}/covers/${t.cover}`,alt:`${t.name} cover`,className:"artist-card-cover"}):e.jsx(ie,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},vo=()=>{const[t,s]=n.useState([]),{createNewPlaylist:c,setPlaylistAddedCallback:u}=he(),l=()=>{fetch(`${b}/read-write/playlists`,{method:"GET",credentials:"include"}).then(a=>a.json()).then(a=>s(a))};return n.useEffect(()=>{et(()=>{l(),u(l)})()},[]),e.jsxs("div",{children:[e.jsx(me,{className:"buttonRound",onClick:c,style:{marginBottom:"40px"},icon:e.jsx(Ur,{}),text:"Create a new playlist"}),e.jsx("div",{className:"album-displayer",children:t.map(a=>e.jsx(xo,{playlist:a},a.id))})]})},jo=()=>{const t=n.useRef(null),s=n.useRef(null),[c,u]=n.useState(!1),[l,a]=n.useState([]),{playAudioSalad:r,setSaladContext:d,saladContext:f,openTagWindow:m}=he(),[o,h]=n.useState([]),[p,x]=n.useState([]),{addNotification:S,notifTypes:y}=tt(),[O,k]=n.useState([]),[N,T]=n.useState(!1),[E,C]=n.useState(!1),I=n.useRef(null),B=n.useRef(null),[w,$]=n.useState("#aabbcc"),[H,_]=n.useState(!0),{subscribe:P}=Le(),[J,z]=n.useState(()=>{const V=localStorage.getItem("CML_FinishedTutorials");return V&&JSON.parse(V).state[Re.COOKING]||!1});n.useEffect(()=>{et(()=>{const U=oe=>{t.current&&!t.current.contains(oe.target)&&X()};return o.length===0&&h(f||[]),fetch(`${b}/read-write/mostUsedTags`,{method:"GET",credentials:"include"}).then(oe=>oe.json()).then(oe=>{const ce=oe.map(ve=>({...ve,type:ve.total,typeElem:"tag",icon:()=>e.jsx(bt,{color:ve.color}),tooltip:j=>e.jsx("span",{children:j})}));x(ce),a(ce)}),P(`safe-finished-tutorial-${Re.COOKING}`,()=>{z(!0)}),document.addEventListener("mousedown",U),document.addEventListener("touchstart",U),()=>{document.removeEventListener("mousedown",U),document.removeEventListener("touchstart",U)}})()},[]);const ae=V=>{const U=V.target.value;if(U===""||U.trim().length===0){a(p);return}fetch(`${b}/read-write/search/${U}/tags,salads`,{method:"GET"}).then(oe=>{if(oe.ok)return oe.json();throw new Error("Error fetching search results")}).then(oe=>{var ve,j;const ce=[...(ve=oe.tags)==null?void 0:ve.map(M=>({...M,typeElem:"tag",icon:()=>e.jsx(bt,{color:M.color})})),...(j=oe.salads)==null?void 0:j.map(M=>({...M,typeElem:"salad",icon:()=>e.jsx(lt,{color:M.color})}))];console.log(ce),a(ce)})},X=()=>{u(!1)},ne=V=>{h(U=>U.filter(oe=>oe.id!==V))},ue=V=>{X(),console.log(V),!o.find(U=>U.id===V.id)&&h(U=>[...U,V])},Te=async()=>{r(O.map(V=>V.id)),d(o)};n.useEffect(()=>{if(d(o),o.length===0){k([]),_(!0);return}_(o.findIndex(U=>U.typeElem==="salad")===-1);const V=new FormData;V.append("tags",JSON.stringify(o.filter(U=>U.typeElem==="tag").map(U=>U.id))),V.append("salads",JSON.stringify(o.filter(U=>U.typeElem==="salad").map(U=>U.id))),fetch(`${b}/read-write/getSalad`,{method:"POST",body:V}).then(U=>U.json()).then(U=>JSON.parse(U)).then(U=>{k(it.shuffle(U)),console.log("New tracks received",U),U.length>0?S("Salad received! Enjoy..",y.SALAD):S("This salad is empty.. No tracks found.",y.SALAD)})},[o]);const ke=async()=>{o.length!==0&&(T(!0),$(`${Is(Math.random().toFixed(4)*360,100,70.8)}`))},Se=()=>{if(!B.current.value||(T(!1),o.find(U=>U.typeElem==="salad")))return;const V=new FormData;V.append("salad",JSON.stringify({name:B.current.value,color:w,tags:o.map(U=>U.id)})),fetch(`${b}/read-write/newSalad`,{method:"POST",credentials:"include",body:V}).then(U=>U.json()).then(U=>{S("Salad saved!",y.SUCCESS),h([U])})},be=V=>{r(O.map(U=>U.id),V)},Pe=()=>{u(!0),s.current.value};return e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"info-button",id:"cooking-info",onClick:()=>{z(!1)}}),J?e.jsxs("div",{className:"cooking-div",children:[e.jsx("h2",{children:"Here select some tags and play the music!"}),e.jsxs("div",{className:"cooking-header",children:[e.jsx("div",{className:"action-bar",style:{margin:"auto"},ref:t,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",style:{zIndex:"2"},children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Xe,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:ae,placeholder:"Search some tags or salads..",ref:s,onFocus:Pe}),e.jsx("div",{className:"action-bar-results",style:{display:`${c?"block":"none"}`},children:e.jsx(Be,{height:300,itemCount:l.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:V,style:U})=>e.jsx(St,{entry:l[V],style:{...U,width:" calc(100% - 20px)",marginTop:"10px"},onClick:ue},V)})})]})}),e.jsx("button",{className:"open-tags-edit",onClick:m,children:e.jsx(_r,{})})]}),e.jsxs("div",{className:"cooking-selection",children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(me,{text:"Play the salad",icon:e.jsx(Br,{}),onClick:Te}),H&&e.jsx(me,{text:"Save this salad",icon:e.jsx(Dr,{}),onClick:ke})]}),e.jsx("div",{className:"cooking-tags",style:{marginBottom:"30px"},children:o.map(V=>e.jsxs("div",{className:"small-tag","data-prefix":V.typeElem==="salad",style:{backgroundColor:V.color},children:[V.typeElem==="salad"&&e.jsx(lt,{"data-prefix":"true"}),e.jsx("span",{children:V.name}),e.jsx(we,{onClick:()=>{ne(V.id)}})]},V.id))}),e.jsx("div",{className:"track-list",children:O.map((V,U)=>e.jsx(Bs,{index:U,isSalad:be,track:V,playIconId:"salad",showCover:!0},V.id))})]}),N?e.jsxs("div",{className:"edit-tag",style:{left:"calc(50% - 170px)",margin:"auto"},children:[e.jsx(we,{style:{cursor:"pointer"},onClick:()=>{T(!1)}}),e.jsx("input",{type:"text",placeholder:"Name your new salad.",ref:B}),e.jsx(Gr,{style:{cursor:"pointer"},id:"color-button",color:w,onClick:()=>{C(!E)}}),E&&e.jsxs("div",{ref:I,className:"edit-tag-picker",children:[" ",e.jsx(Yt,{color:w,onChange:$})]}),e.jsx(ut,{onClick:Se,style:{cursor:"pointer"}})]}):null]}):e.jsx(Ms,{tutorialKey:Re.COOKING})]})},vs=({radio:t})=>{const{playRadio:s,externalRadioInfos:c}=he();return e.jsxs("div",{className:"album-card",onClick:()=>{t.id?c.current=null:c.current=t,s(t.id?`radio-id:${t.id}`:`radio-url:${t.url}`)},children:[t.coverUrl?e.jsx("img",{src:`${b}/radio/favicon-proxy?url=${encodeURIComponent(t.coverUrl)}`,alt:`${qe(t.name,25)} cover`,className:"album-card-cover"}):e.jsx(ie,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:qe(t.name,40)})]})},yo=()=>{const[t,s]=n.useState(!1),[c,u]=n.useState([]),[l,a]=n.useState([]),r=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});n.useEffect(()=>{et(()=>{d()})()},[]);const d=async()=>{const h=await fetch(`${b}/radio/radios`,{method:"GET",credentials:"include"}).then(p=>p.json());s(!0),u(h),console.log("radios:",h)},f=()=>{},m=async()=>{const h=await fetch(`${b}/radio/stations`).then(x=>x.json()).then(x=>JSON.parse(x));console.log(h);const p=h.map(x=>({coverUrl:x.favicon,name:x.name,url:x.url_resolved}));a(p)},o=async()=>{window.open("https://www.radio-browser.info/tags","_blank").focus()};return e.jsxs("div",{className:"home",children:[e.jsx("h3",{children:"Recently heard"}),e.jsx("div",{className:"album-displayer","data-flat":"true","data-no-tracks":(c==null?void 0:c.length)==0&&t?"true":"false",children:t?(c==null?void 0:c.length)!==0?c.map(h=>e.jsx(vs,{radio:h},h.id)):null:e.jsx(r,{})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx("h3",{style:{marginRight:"20px"},children:"Discover"}),e.jsx(me,{text:"Filters",icon:e.jsx(Vr,{}),onClick:f}),e.jsx(me,{text:"Random",icon:e.jsx(mt,{}),onClick:m}),e.jsx(me,{text:"External search",icon:e.jsx(Hr,{}),onClick:o})]}),e.jsx("div",{className:"album-displayer",children:(l==null?void 0:l.length)!==0?l.map((h,p)=>e.jsx(vs,{radio:h},p)):null})]})},bo=()=>{const t=n.useRef(),s=n.useRef(null),{getFFTAtCurrentTime:c,fftConfigRef:u,globalAudioRef:l,FFTUserSetingsRef:a,fetchFFTUserSettings:r,colorOverride:d}=he(),f=n.useRef(0),m=o=>{var p,x;if(!s.current){t.current=requestAnimationFrame(m);return}const h=s.current.getContext("2d");if(h&&a.current&&d.current){if(o-f.current<1e3/a.current.FPS){t.current=requestAnimationFrame(m);return}f.current=o;const S=a.current.bars;h.clearRect(0,0,s.current.width,s.current.height);const y=c();if(!y){t.current=requestAnimationFrame(m);return}u.current.sampleRate/y.length;const O=Math.max(1,y.length/S),k=new Array(S);k.fill(0);for(let E=0;E<y.length;E++)k[Math.floor(E/O)]+=Number(y[E]);let N=s.current.width/S-1,T=0;for(let E=0;E<k.length;E++){const C=a.current.scale*Math.log2(k[E])*(S/5)*((p=l.current)==null?void 0:p.volume);if(((x=d.current)==null?void 0:x.length)>0){const I=Math.min(1,Math.max(0,C/a.current.scale/a.current.contrast/300));h.fillStyle=`rgb(
						${Qe(d.current[0][0],d.current[1][0],I)} 
						${Qe(d.current[0][1],d.current[1][1],I)}
						${Qe(d.current[0][2],d.current[1][2],I)}
						)`}else h.fillStyle=`rgb(${C/a.current.scale/a.current.contrast} 137 255)`;h.fillRect(T,s.current.height-C,N,C),T+=N+1}}t.current=requestAnimationFrame(m)};return n.useEffect(()=>{if(!u.current){cancelAnimationFrame(t.current),console.log("No FFT data to display, releasing anim frame.");return}t.current=requestAnimationFrame(m),console.log("FFT found, requested animation frame.")},[u.current]),n.useEffect(()=>(t.current=requestAnimationFrame(m),()=>cancelAnimationFrame(t.current)),[]),e.jsx("canvas",{ref:s,id:"fft-canvas",width:1900,height:1e3})},No=()=>{const{playingTrack:t}=he();return e.jsxs("div",{className:"content-with-fft",children:[e.jsx(ys,{})," ",t?e.jsx(bo,{}):null]})};var Lt=function(t,s){return t<s?-1:t>s?1:0},js=function(t){return t.reduce(function(s,c){return s+c},0)},ko=function(){function t(c){this.colors=c}var s=t.prototype;return s.palette=function(){return this.colors},s.map=function(c){return c},t}(),So=function(){function t(a,r,d){return(a<<10)+(r<<5)+d}function s(a){var r=[],d=!1;function f(){r.sort(a),d=!0}return{push:function(m){r.push(m),d=!1},peek:function(m){return d||f(),m===void 0&&(m=r.length-1),r[m]},pop:function(){return d||f(),r.pop()},size:function(){return r.length},map:function(m){return r.map(m)},debug:function(){return d||f(),r}}}function c(a,r,d,f,m,o,h){var p=this;p.r1=a,p.r2=r,p.g1=d,p.g2=f,p.b1=m,p.b2=o,p.histo=h}function u(){this.vboxes=new s(function(a,r){return Lt(a.vbox.count()*a.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function l(a,r){if(r.count()){var d=r.r2-r.r1+1,f=r.g2-r.g1+1,m=Math.max.apply(null,[d,f,r.b2-r.b1+1]);if(r.count()==1)return[r.copy()];var o,h,p,x,S=0,y=[],O=[];if(m==d)for(o=r.r1;o<=r.r2;o++){for(x=0,h=r.g1;h<=r.g2;h++)for(p=r.b1;p<=r.b2;p++)x+=a[t(o,h,p)]||0;y[o]=S+=x}else if(m==f)for(o=r.g1;o<=r.g2;o++){for(x=0,h=r.r1;h<=r.r2;h++)for(p=r.b1;p<=r.b2;p++)x+=a[t(h,o,p)]||0;y[o]=S+=x}else for(o=r.b1;o<=r.b2;o++){for(x=0,h=r.r1;h<=r.r2;h++)for(p=r.g1;p<=r.g2;p++)x+=a[t(h,p,o)]||0;y[o]=S+=x}return y.forEach(function(k,N){O[N]=S-k}),function(k){var N,T,E,C,I,B=k+"1",w=k+"2",$=0;for(o=r[B];o<=r[w];o++)if(y[o]>S/2){for(E=r.copy(),C=r.copy(),I=(N=o-r[B])<=(T=r[w]-o)?Math.min(r[w]-1,~~(o+T/2)):Math.max(r[B],~~(o-1-N/2));!y[I];)I++;for($=O[I];!$&&y[I-1];)$=O[--I];return E[w]=I,C[B]=E[w]+1,[E,C]}}(m==d?"r":m==f?"g":"b")}}return c.prototype={volume:function(a){var r=this;return r._volume&&!a||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(a){var r=this,d=r.histo;if(!r._count_set||a){var f,m,o,h=0;for(f=r.r1;f<=r.r2;f++)for(m=r.g1;m<=r.g2;m++)for(o=r.b1;o<=r.b2;o++)h+=d[t(f,m,o)]||0;r._count=h,r._count_set=!0}return r._count},copy:function(){var a=this;return new c(a.r1,a.r2,a.g1,a.g2,a.b1,a.b2,a.histo)},avg:function(a){var r=this,d=r.histo;if(!r._avg||a){var f,m,o,h,p=0,x=0,S=0,y=0;if(r.r1===r.r2&&r.g1===r.g2&&r.b1===r.b2)r._avg=[r.r1<<3,r.g1<<3,r.b1<<3];else{for(m=r.r1;m<=r.r2;m++)for(o=r.g1;o<=r.g2;o++)for(h=r.b1;h<=r.b2;h++)p+=f=d[t(m,o,h)]||0,x+=f*(m+.5)*8,S+=f*(o+.5)*8,y+=f*(h+.5)*8;r._avg=p?[~~(x/p),~~(S/p),~~(y/p)]:[~~(8*(r.r1+r.r2+1)/2),~~(8*(r.g1+r.g2+1)/2),~~(8*(r.b1+r.b2+1)/2)]}}return r._avg},contains:function(a){var r=this,d=a[0]>>3;return gval=a[1]>>3,bval=a[2]>>3,d>=r.r1&&d<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},u.prototype={push:function(a){this.vboxes.push({vbox:a,color:a.avg()})},palette:function(){return this.vboxes.map(function(a){return a.color})},size:function(){return this.vboxes.size()},map:function(a){for(var r=this.vboxes,d=0;d<r.size();d++)if(r.peek(d).vbox.contains(a))return r.peek(d).color;return this.nearest(a)},nearest:function(a){for(var r,d,f,m=this.vboxes,o=0;o<m.size();o++)((d=Math.sqrt(Math.pow(a[0]-m.peek(o).color[0],2)+Math.pow(a[1]-m.peek(o).color[1],2)+Math.pow(a[2]-m.peek(o).color[2],2)))<r||r===void 0)&&(r=d,f=m.peek(o).color);return f},forcebw:function(){var a=this.vboxes;a.sort(function(m,o){return Lt(js(m.color),js(o.color))});var r=a[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(a[0].color=[0,0,0]);var d=a.length-1,f=a[d].color;f[0]>251&&f[1]>251&&f[2]>251&&(a[d].color=[255,255,255])}},{quantize:function(a,r){if(!Number.isInteger(r)||r<1||r>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!a.length||r<2||r>256||!a.length||r<2||r>256)return!1;for(var d=[],f=new Set,m=0;m<a.length;m++){var o=a[m],h=o.join(",");f.has(h)||(f.add(h),d.push(o))}if(d.length<=r)return new ko(d);var p=function(N){var T,E=new Array(32768);return N.forEach(function(C){T=t(C[0]>>3,C[1]>>3,C[2]>>3),E[T]=(E[T]||0)+1}),E}(a);p.forEach(function(){});var x=function(N,T){var E,C,I,B=1e6,w=0,$=1e6,H=0,_=1e6,P=0;return N.forEach(function(J){(E=J[0]>>3)<B?B=E:E>w&&(w=E),(C=J[1]>>3)<$?$=C:C>H&&(H=C),(I=J[2]>>3)<_?_=I:I>P&&(P=I)}),new c(B,w,$,H,_,P,T)}(a,p),S=new s(function(N,T){return Lt(N.count(),T.count())});function y(N,T){for(var E,C=N.size(),I=0;I<1e3;){if(C>=T||I++>1e3)return;if((E=N.pop()).count()){var B=l(p,E),w=B[0],$=B[1];if(!w)return;N.push(w),$&&(N.push($),C++)}else N.push(E),I++}}S.push(x),y(S,.75*r);for(var O=new s(function(N,T){return Lt(N.count()*N.volume(),T.count()*T.volume())});S.size();)O.push(S.pop());y(O,r);for(var k=new u;O.size();)k.push(O.pop());return k}}}().quantize,Ds=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};Ds.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var ct=function(){};ct.prototype.getColor=function(t,s){return s===void 0&&(s=10),this.getPalette(t,5,s)[0]},ct.prototype.getPalette=function(t,s,c){var u=function(d){var f=d.colorCount,m=d.quality;if(f!==void 0&&Number.isInteger(f)){if(f===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");f=Math.max(f,2),f=Math.min(f,20)}else f=10;return(m===void 0||!Number.isInteger(m)||m<1)&&(m=10),{colorCount:f,quality:m}}({colorCount:s,quality:c}),l=new Ds(t),a=function(d,f,m){for(var o,h,p,x,S,y=d,O=[],k=0;k<f;k+=m)h=y[0+(o=4*k)],p=y[o+1],x=y[o+2],((S=y[o+3])===void 0||S>=125)&&(h>250&&p>250&&x>250||O.push([h,p,x]));return O}(l.getImageData().data,l.width*l.height,u.quality),r=So(a,u.colorCount);return r?r.palette():null},ct.prototype.getColorFromUrl=function(t,s,c){var u=this,l=document.createElement("img");l.addEventListener("load",function(){var a=u.getPalette(l,5,c);s(a[0],t)}),l.src=t},ct.prototype.getImageData=function(t,s){var c=new XMLHttpRequest;c.open("GET",t,!0),c.responseType="arraybuffer",c.onload=function(){if(this.status==200){var u=new Uint8Array(this.response);i=u.length;for(var l=new Array(i),a=0;a<u.length;a++)l[a]=String.fromCharCode(u[a]);var r=l.join(""),d=window.btoa(r);s("data:image/png;base64,"+d)}},c.send()},ct.prototype.getColorAsync=function(t,s,c){var u=this;this.getImageData(t,function(l){var a=document.createElement("img");a.addEventListener("load",function(){var r=u.getPalette(a,5,c);s(r[0],this)}),a.src=l})};const wo=()=>{const{fullScreenImage:t,requestNewFullScreenImage:s,playingTrack:c,toggleFullScreenView:u,colorOverride:l}=he(),a=n.useRef(null),r=n.useRef(null),d=n.useRef(null),f=n.useRef(null),m=n.useRef(null),o=n.useRef(!1),h=n.useRef(0),p=3,x=n.useRef(0),[S,y]=n.useState(!1),O=n.useRef([]),k=n.useRef(0),N=n.useRef(0),T=$=>{o.current?(a.current.src=URL.createObjectURL($),r.current.src=URL.createObjectURL($),m.current=a.current):(d.current.src=URL.createObjectURL($),f.current.src=URL.createObjectURL($),m.current=d.current),m.current.addEventListener("load",C)};n.useEffect(()=>{!c||!(a.current&&r.current)||((t==null?void 0:t.track)!==c?(o.current=!o.current,s().then($=>{T($.blob)})):T(t.blob))},[c]);const E=($,H)=>{$?(a.current.setAttribute("data-hidden",H),r.current.setAttribute("data-hidden",H)):(d.current.setAttribute("data-hidden",H),f.current.setAttribute("data-hidden",H))},C=()=>{E(o.current,!1),E(!o.current,!0),clearTimeout(k.current),k.current=setTimeout(()=>{o.current?d.current&&(d.current.src=null,f.current.src=null):a.current&&(a.current.src=null,r.current.src=null)},1100),I()},I=()=>{m.current.removeEventListener("load",C);let $=new ct;O.current=$.getPalette(m.current,10),B()},B=()=>{const $=it.shuffle(O.current);clearTimeout(N.current);const H=$.slice(0,2);l.current.length===0?l.current=H:w(H,0)},w=($,H)=>{l.current=l.current.map((_,P)=>_.map((J,z)=>parseInt(Qe(J,$[P][z],.1)))),!(H>150)&&(N.current=setTimeout(()=>{w($,H+1)},1e3/60))};return n.useEffect(()=>{var P,J;const $=()=>{h.current=0,S&&y(!1)},H=()=>{h.current++,h.current>=p?+y(!0):y(!1)},_=["mousemove","keydown","mousedown","touchstart","scroll"];return _.forEach(z=>{window.addEventListener(z,$)}),x.current=setInterval(H,1e3),(P=m.current)!=null&&P.complete&&((J=m.current)!=null&&J.src)&&I(),()=>{_.forEach(z=>{window.removeEventListener(z,$)}),clearInterval(x.current),clearTimeout(N.current),l.current=[]}},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"full-screen-header",children:[e.jsx("button",{className:"roundButton full-screen-back","data-inactive":S,onClick:u,children:e.jsx(Ze,{})}),e.jsx("button",{className:"roundButton full-screen-back","data-inactive":S,onClick:B,children:e.jsx(zr,{})})]}),e.jsx("div",{"data-inactive":S,className:"full-screen-audio-ctrl",children:e.jsx(Ht,{context:{mobile:!1}})}),c&&e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:r,crossOrigin:"anonymous",alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:a,crossOrigin:"anonymous",alt:"No tracks palying"})}),e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:f,crossOrigin:"anonymous",alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:d,crossOrigin:"anonymous",alt:"No tracks palying"})})]})]})};function To(){return e.jsx(Jr,{children:e.jsx(ea,{children:e.jsxs(la,{children:[" ",e.jsx(Oa,{children:e.jsxs(Dn,{children:[e.jsx(pe,{path:"/",element:e.jsx(Wa,{})}),e.jsx(pe,{path:"register",element:e.jsx(lo,{})}),e.jsx(pe,{element:e.jsx(No,{}),children:e.jsx(pe,{path:"full-screen",element:e.jsx(wo,{})})}),e.jsxs(pe,{element:e.jsx(Ga,{}),children:[e.jsx(pe,{path:"home",element:e.jsx(Va,{})}),e.jsx(pe,{path:"albums",element:e.jsx(Ha,{})}),e.jsx(pe,{path:"albums/:albumId",element:e.jsx(gs,{})}),e.jsx(pe,{path:"artists",element:e.jsx(Ja,{})}),e.jsx(pe,{path:"artists/:artistId",element:e.jsx(Ya,{})}),e.jsx(pe,{path:"genres",element:e.jsx(go,{})}),e.jsx(pe,{path:"genres/:genreId",element:e.jsx(uo,{})}),e.jsx(pe,{path:"playlists",element:e.jsx(vo,{})}),e.jsx(pe,{path:"playlists/:playlistId",element:e.jsx(gs,{isPlaylist:!0})}),e.jsx(pe,{path:"cooking",element:e.jsx(jo,{})}),e.jsx(pe,{path:"radio",element:e.jsx(yo,{})})]}),e.jsx(pe,{path:"account",element:e.jsx(Xa,{})}),e.jsx(pe,{path:"settings",element:e.jsx(no,{})}),e.jsx(pe,{path:"admin-pannel",element:e.jsx(io,{})}),e.jsx(pe,{path:"*",element:e.jsx(Qa,{})})]})})]})})})}Bn.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(Gn,{children:e.jsx(To,{})})}));
