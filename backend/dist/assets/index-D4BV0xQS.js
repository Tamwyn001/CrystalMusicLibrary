import{r as n,j as e}from"./react-DmLYqgKm.js";import{c as dr}from"./react-dom-DPPwivfB.js";import{u as me,a as Ve,L as st,O as Ls,b as $t,R as mr,c as ue,B as hr}from"./react-router-qw1pt6K9.js";import{I as fr,a as Ut,b as ot,c as ts,d as be,e as ct,f as pr,g as kt,h as it,i as $s,j as gr,k as xr,l as vr,m as jr,n as yr,o as yt,p as es,q as Os,r as Me,s as Ms,t as Us,u as br,v as _s,w as Nr,x as kr,y as Sr,z as Tr,A as ss,B as wr,C as Er,D as Rr,E as Cr,F as Bs,G as _t,H as Ar,J as Gs,K as Ir,L as Fr,M as Pr,N as Lr,O as ns,P as rs,Q as lt,R as $r,S as Ds,T as Vs,U as Jt,V as Or,W as Mr,X as Ur,Y as as,Z as _r,_ as Br,$ as Gr,a0 as Dr,a1 as Vr,a2 as Hr,a3 as qr,a4 as Hs,a5 as zr,a6 as Wr,a7 as Kr,a8 as Xe,a9 as Qr,aa as Jr,ab as Yr,ac as Xr,ad as Zr,ae as qs,af as ea,ag as ta,ah as sa,ai as na,aj as ra,ak as aa,al as oa,am as ca,an as ia,ao as la,ap as ua,aq as da,ar as ma,as as ha,at as fa,au as pa}from"./@tabler-C6Dpwwh0.js";import{F as Ie}from"./react-window-Dlc0x0tK.js";import{v as bt}from"./uuid-C6aID195.js";import{Z as os}from"./react-colorful-0uAH5Wqu.js";import{_ as vt}from"./lodash-e2SigP7W.js";import{p as ga}from"./music-metadata-CvBiwAZp.js";import{a as xa}from"./axios-C0Zqfgkc.js";import{F as zs}from"./fuse.js-Ch1WBRTM.js";import"./content-type-kkloIWN6.js";import"./scheduler-SPyfQU6S.js";import"./@babel-Cj2_JSWT.js";import"./memoize-one-CcMeOnPo.js";import"./strtok3-BXaumHbT.js";import"./peek-readable-BVp5v6zA.js";import"./file-type-BdA4k6lR.js";import"./token-types-D2R8hC8p.js";import"./ieee754-DcnkbHBT.js";import"./@tokenizer-Sx_RGPFW.js";import"./fflate-D0DoR3vL.js";import"./debug-Dqg9INeJ.js";import"./ms-CzQ2E3wO.js";import"./uint8array-extras-B1Dultle.js";import"./media-typer-Kaw9hxcp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))d(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(l){if(l.ep)return;l.ep=!0;const r=o(l);fetch(l.href,r)}})();const va=()=>{const t=window.location.hostname,s=window.location.port;return t==="localhost"||t.startsWith("127.0.0.1")?`http://localhost:${s}`:`http://${t}:${s}`},N=va(),Ws=n.createContext(),xe=()=>n.useContext(Ws),ja=({children:t})=>{const s=n.useRef(new Map),o=(l,r)=>(s.current.has(l)||s.current.set(l,new Set),s.current.get(l).add(r),()=>{var a;(a=s.current.get(l))==null||a.delete(r)}),d=(l,r)=>{s.current.has(l)&&s.current.get(l).forEach(a=>{a(r),console.log("called at",a)})};return e.jsx(Ws.Provider,{value:{emit:d,subscribe:o},children:t})},ya=()=>{const[t,s]=n.useState(!1),[o,d]=n.useState(!1),l=me(),r=n.useRef(null),{subscribe:a}=xe(),u=()=>{s(!t)},m=()=>{fetch(`${N}/auth/logout`,{method:"POST",credentials:"include"}).then(p=>{p.ok?l("/"):console.error("Logout failed")}).catch(p=>{console.error("Error:",p)})},h=()=>{l("/account")},c=()=>{l("/settings")};return n.useEffect(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{d(x)});const p=x=>{var v;if(r.current&&!r.current.contains(x.target)){if(((v=x.target.closest("svg"))==null?void 0:v.id)==="user-button")return;s(!1)}},f=a("action-bar-open",()=>{s(!1)});return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{f(),document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[]),e.jsxs("div",{className:"userDropdown",ref:r,children:[e.jsx(fr,{id:"user-button",className:"userImage buttonRound",onClick:u}),t&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"userAccount dropdownEntry",onClick:h,children:"Account"}),e.jsx("button",{className:"userSetting dropdownEntry",onClick:c,children:"Settings"}),o&&e.jsx("button",{className:"userSetting dropdownEntry",onClick:()=>{l("/admin-pannel")},children:"Admin pannel"}),e.jsx("button",{className:"userLogout dropdownEntry",onClick:m,children:"Logout"})]})]})},cs=t=>{var s=function(a){return("00"+a).slice(-2)};const o=Math.floor(t/3600),d=Math.floor(t%3600/60),l=s(Math.floor(t%60)),r=o>0?`${o}:${d}:${l}`:`${d}:${l}`;return{hours:o,minutes:d,seconds:l,readable:r}},Yt=t=>{const s=Math.floor(t/1024),o=Math.floor(s/1024),d=Math.floor(o/1024),l=Math.floor(d/1024),r=l>0?`${Number(t/1024/1024/1024/1024).toFixed(2)}TB`:d>0?`${Number(t/1024/1024/1024).toFixed(2)}GB`:o>0?`${Number(t/1024/1024).toFixed(2)}MB`:`${Number(t/1024).toFixed(2)}KB`;return{kb:s,mb:o,gb:d,tb:l,readable:r}},Ks=(t,s,o)=>{s/=100,o/=100;let d=(1-Math.abs(2*o-1))*s,l=d*(1-Math.abs(t/60%2-1)),r=o-d/2,a=0,u=0,m=0;return 0<=t&&t<60?(a=d,u=l,m=0):60<=t&&t<120?(a=l,u=d,m=0):120<=t&&t<180?(a=0,u=d,m=l):180<=t&&t<240?(a=0,u=l,m=d):240<=t&&t<300?(a=l,u=0,m=d):300<=t&&t<360&&(a=d,u=0,m=l),a=Math.round((a+r)*255).toString(16),u=Math.round((u+r)*255).toString(16),m=Math.round((m+r)*255).toString(16),a.length==1&&(a="0"+a),u.length==1&&(u="0"+u),m.length==1&&(m="0"+m),"#"+a+u+m},Ts=(t,s,o)=>(t=t.toString(16),s=s.toString(16),o=o.toString(16),t.length==1&&(t="0"+t),s.length==1&&(s="0"+s),o.length==1&&(o="0"+o),"#"+t+s+o),Be=t=>{let s=0,o=0,d=0;return t.length==4?(s="0x"+t[1]+t[1],o="0x"+t[2]+t[2],d="0x"+t[3]+t[3]):t.length==7&&(s="0x"+t[1]+t[2],o="0x"+t[3]+t[4],d="0x"+t[5]+t[6]),[parseInt(s),parseInt(o),parseInt(d)]},Je=(t,s,o)=>t+(s-t)*o,ba=(t,s,o,d,l)=>Je(d,l,(t-s)/(o-s)),Ye=(t,s)=>{var o=t??"";return o.length>s?o.substring(0,s-2)+"..":o},Na=(t="")=>{const s=["/","/register"];return new Promise(async o=>{const d=await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"}).then(async l=>l.ok?!0:(s.includes(t)||await fetch(`${N}/auth/logout`,{method:"POST",credentials:"include"}).then(r=>{r.ok?window.location.href="/":console.error("Logout failed")}),!1));o(d)})},Ue=(t,s="")=>async function(){await Na(s)&&t()},ka=t=>t.charAt(0).toUpperCase()+t.slice(1),ws=([t,s,o])=>{const d=[t,s,o].map(l=>(l/=255,l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4)));return .2126*d[0]+.7152*d[1]+.0722*d[2]},Sa=(t,s)=>{const o=ws(t),d=ws(s);return(Math.max(o,d)+.05)/(Math.min(o,d)+.05)},ne=({col1:t="#f9c58d",col2:s="#f492f0",className:o,style:d={},id:l=""})=>e.jsxs("svg",{id:l,viewBox:"0 0 512 512",style:{...d},className:o,xmlns:"http://www.w3.org/2000/svg",fill:"#000000",children:[e.jsxs("defs",{children:[e.jsx("mask",{id:"mask_logo",fill:"black",children:e.jsx("path",{fill:"white",d:"M116.215 17.404c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm64.326 12.87l-23.488 92.062h63.965l27.49-27.49-67.967-64.573zm228.147 25.958c0 20.214-20.216 40.428-40.43 40.428 20.214 0 40.43 20.214 40.43 40.428 0-20.214 20.213-40.428 40.427-40.428-20.214 0-40.428-20.214-40.428-40.428zm-150.022 53.913l-23.18 23.18L283.043 311h29.066l-53.443-200.855zm75.232 2.365l16.123 32.281 45.188 33.148-4.393-53.533-56.918-11.896zm-18.033 4.181l-26.685 38.121 10 37.586 33.38-42.283-16.695-33.424zm-160.672 23.645L172.42 206.4l21.988 12.623L239.043 311h25.365l-45.68-170.664h-63.535zm189.797 23.088l-40.03 50.703L330.737 311h.026l64.08-111.004-49.852-36.572zm122.352 5.834c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm-374.22 12.375l11.308 76.129 48.834-6.356 19.322-24.154-79.465-45.62zm346.995 53.793l-52.547 13.172L351.547 311h25.77l19.16-19.48 43.64-56.094zm-255.21 5.244l-17.403 21.75 25.77 48.58h25.761l-34.129-70.33zm-33.84 29.174l-39.005 5.074L148.145 311h24.751l-21.83-41.156zm-91.37 11.396c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zM137 329v30h238v-30H137zm32 48v78h16v-78h-16zm34 0v78h106v-78H203zm124 0v78h16v-78h-16zm-164.758 96l-30.119 16h247.754l-30.12-16H162.243z"})}),e.jsxs("linearGradient",{id:"grad_logo",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:t}),e.jsx("stop",{offset:"100%",stopColor:s})]})]}),e.jsx("rect",{x:"0",y:"0",width:"512",height:"512",fill:"url(#grad_logo)",mask:"url(#mask_logo)"})]}),ut=({entry:t,style:s,onClick:o,className:d=""})=>e.jsxs("div",{className:`action-bar-entry ${d}`,style:s,onClick:()=>{o(t)},children:[t.icon(),e.jsxs("span",{style:{flex:"1"},children:[" ",t.name]}),t.tooltip?t.tooltip(t.type):null]}),Qs=n.createContext(),nt={SUCCESS:"success",ERROR:"error",INFO:"info",SALAD:"salad",QUEUE:"queue"},Ta=({children:t})=>{const[s,o]=n.useState(null),[d,l]=n.useState(null),r=n.useRef(null),a=n.useRef([]),u=(h,c)=>{a.current.forEach(f=>clearTimeout(f)),a.current=[],l({message:h,state:c}),o(!0);const p=setTimeout(()=>{r.current&&(r.current.setAttribute("direction",""),r.current.offsetWidth,r.current.setAttribute("direction","hide"));const f=setTimeout(()=>{o(!1),l(null)},300);a.current.push(f)},2e3);a.current.push(p)};n.useEffect(()=>{d&&o(!0)},[d]),n.useEffect(()=>{!s||!r.current||r.current.setAttribute("direction","show")},[s]);const m=()=>{if(!s)return null;switch(d==null?void 0:d.state){case nt.SUCCESS:return e.jsx(ct,{className:"notification-icon"});case nt.ERROR:return e.jsx(be,{className:"notification-icon"});case nt.INFO:return e.jsx(ts,{className:"notification-icon"});case nt.SALAD:return e.jsx(ot,{className:"notification-icon"});case nt.QUEUE:return e.jsx(Ut,{className:"notification-icon"});default:return null}};return e.jsxs(Qs.Provider,{value:{notifTypes:nt,addNotification:u},children:[t,d?e.jsx("div",{ref:r,className:"notification-parent",id:"notification-parent",children:e.jsxs("div",{className:"notification","is-open":d?"true":"false",children:[e.jsx(m,{}),e.jsx("span",{children:d.message})]})}):null]})},Fe=()=>n.useContext(Qs),wa=({onClose:t,track:s})=>{const[o,d]=n.useState(!1),l=n.useRef(null),r=n.useRef(null),[a,u]=n.useState([]),[m,h]=n.useState(null),[c,p]=n.useState(""),{addNotification:f,notifTypes:x}=Fe(),v=P=>{if(P.preventDefault(),c==""&&!m){t(!1);return}fetch(`${N}/read-write/moveTrackToAlbum/${c?"true/"+c:"false/"+m.id}/${s.id}`).then(b=>b.json()).then(b=>{f(`Track ${s.title} moved to 
            ${c||m.name}.`,x.INFO),t(!0)})},y=P=>{h(null),p(P.target.value)},O=P=>{const{tooltip:b,...F}=P;k(),h(F),p("")};n.useEffect(()=>{const P=b=>{r.current&&!r.current.contains(b.target)&&k()};return document.addEventListener("mousedown",P),document.addEventListener("touchstart",P),()=>{document.removeEventListener("mousedown",P),document.removeEventListener("touchstart",P)}},[]);const k=()=>{d(!1),l.current.value="",u([])},R=()=>e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Move to album"})," "]}),U=P=>{const b=P.target.value;if(b===""||b.trim().length===0){u([]);return}console.log(`${N}/read-write/search/${b}/${["albums"]}`),fetch(`${N}/read-write/search/${b}/${["albums"]}`,{method:"GET",credentials:"include"}).then(F=>F.json()).then(F=>{u([...F.albums].map(I=>{const S=I.path,{trackPath:M,...J}=I;return{icon:()=>S?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/covers/${S}`,alt:I.name}):e.jsx(ne,{className:"action-bar-entry-logo"}),tooltip:R,...J}}))})};return e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:null,children:[e.jsx("h2",{children:"Move track to another album"}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:v,children:[e.jsx("label",{htmlFor:"newAlbum",style:c?{}:{opacity:"0.5"},children:"New album name"}),e.jsx("input",{type:"text",style:c?{}:{opacity:"0.5"},id:"newAlbum",placeholder:"Enter album name",onChange:y}),e.jsx("label",{htmlFor:"existingAlbum",style:c?{opacity:"0.5"}:{},children:"Existing album"}),e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:r,style:c?{opacity:"0.5"}:{},children:e.jsxs("div",{className:"action-bar-research",style:{transform:"translateX(15px)"},id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(pr,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:U,placeholder:"Search the album you want to move the track to.",ref:l,onFocus:()=>{d(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Ie,{height:300,itemCount:a.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:P,style:b})=>e.jsx(ut,{entry:a[P],style:{...b,width:" calc(100% - 20px)",marginTop:"10px"},onClick:O},P)})})]})}),m?e.jsxs("div",{style:{height:"90px",alignItems:"center",display:"flex",gap:"10px"},children:[m!=null&&m.icon?m.icon():null,m.name]}):null,e.jsx("input",{type:"submit",value:"Submit"})]})]})})},Js=()=>e.jsxs("div",{className:"three-points-loader",children:[e.jsx("div",{className:"point point1"}),e.jsx("div",{className:"point point2"}),e.jsx("div",{className:"point point3"})]}),oe=({onClick:t,text:s,icon:o,style:d,id:l=""})=>{const[r,a]=n.useState(!1),u=()=>{a(!0),t().then(()=>{a(!1)})},m=()=>r?e.jsx(Js,{}):e.jsxs(e.Fragment,{children:[o,s]});return e.jsx("button",{className:"button-with-callback",id:l,style:{...d},onClick:u,children:e.jsx(m,{})})},Ea=({applyCanges:t,albumClass:s})=>{var b,F;const[o,d]=n.useState({visible:!1}),[l,r]=n.useState(null),[a,u]=n.useState("2000-00-00"),[m,h]=n.useState(null),[c,p]=n.useState(!1),{deleteAlbum:f}=ae(),{notifTypes:x,addNotification:v}=Fe();if(!s)return null;n.useEffect(()=>{s&&(r(s.coverURL),u(s.year))},[s]);const y=()=>{const I=document.getElementById("editAlbumInfos"),S=I.artistName.value.split(",").map(G=>G.trim()),M=I.genre.value.split(",").map(G=>G.trim()).map(G=>G.charAt(0).toUpperCase()+G.slice(1)).filter(G=>G!="");if(!(I.albumName.value!==s.name||s.artist.toString()!==S.toString()||s.year!==I.releaseDate.value||s.genre.toString()!==M.toString()||s.description!==I.description.value||m||c)){t(null);return}s.name=I.albumName.value,s.artist=S,s.year=I.releaseDate.value,s.genre=M,s.description=I.description.value;const{tracks:_,coverURL:T,...V}=s;console.log(V),t(V,m)},O=I=>{const S=I.target.files[0];S&&(s.ext=S.name.split(".").pop(),r(URL.createObjectURL(S)),h(S))},k=I=>{d({visible:!o.visible,...I})},R=I=>{console.log(I),!c&&I&&p(!0),d({visible:!1})},U=async()=>{v("Comming soon :)",x.INFO)},P=async()=>{f(!1,{name:s.name,id:s.id})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(ne,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:O})]}),e.jsx("button",{className:"roundButton",onClick:()=>y(),children:"Apply"}),e.jsx(oe,{onClick:U,text:"Delete for me",icon:e.jsx(it,{}),style:{marginTop:"auto"}}),e.jsx(oe,{onClick:P,text:"Remove from library",icon:e.jsx(it,{})})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(b=s.artist)==null?void 0:b.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",value:a,onChange:I=>{u(I.target.value)}})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(F=s.genre)==null?void 0:F.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Ie,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:I,style:S})=>e.jsxs("div",{style:S,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[I].title}),e.jsx($s,{className:"trackIcon",onClick:()=>{k(s.tracks[I])}})]},I)})})]}),o.visible&&e.jsx(wa,{onClose:R,track:{id:o.id,title:o.title}})]})})},Es=({closeOverlay:t,applyCanges:s,editPlaylistClass:o})=>{const[d,l]=n.useState(null),[r,a]=n.useState(null),[u,m]=n.useState(o||{id:bt()}),[h,c]=n.useState([]),[p,f]=n.useState([]);n.useEffect(()=>{u&&l(u.coverUR),u.collaborators&&f(u.collaborators)},[u]);const x=()=>{const k=document.getElementById("editAlbumInfos");if(!(k.playlistName.value!==u.name||u.description!==k.description.value||r||u.collaborators.map(F=>!p.includes(F)).filter(F=>F))){s(null);return}u.name=k.playlistName.value,u.description=k.description.value,u.collaborators=p.map(F=>F.id);const{tracks:U,coverURL:P,...b}=u;console.log(b),s(b,r)},v=k=>{const R=k.target.files[0];R&&(u.ext=R.name.split(".").pop(),l(URL.createObjectURL(R)),a(R))};n.useEffect(()=>{fetch(`${N}/auth/collaborators`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{console.log(k),c(k)})},[]);const y=k=>{const R=k.target.value;p.includes(R)||R==="pickUsers"||(f(U=>[...U,h.find(P=>P.id==R)]),k.target.value="pickUsers")};n.useEffect(()=>{console.log(p)});const O=k=>{f(p.filter(R=>R.id!=k))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsx(be,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[d?e.jsx("img",{id:"coverPicture",src:d,style:{width:"100%"}}):e.jsx(ne,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:v})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"playlistName",children:"Playlist name"}),e.jsx("input",{type:"text",id:"playlistName",placeholder:"Enter playlist name",defaultValue:u.name?u.name:""}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",style:{height:"80px",paddingTop:"10px",paddingBottom:"10px"},placeholder:"Enter description",defaultValue:u==null?void 0:u.description})]}),e.jsx("label",{htmlFor:"new-collab",children:"Add collaborators"}),e.jsxs("select",{onChange:y,children:[e.jsx("option",{value:"pickUsers",children:"Pick users"},"root"),h.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),e.jsx("label",{children:"Collaborators:"}),e.jsx("div",{children:p==null?void 0:p.map(k=>e.jsxs("div",{children:[e.jsx("span",{children:k==null?void 0:k.name}),e.jsx(gr,{className:"buttonRound",onClick:()=>{O(k.id)}})]},k==null?void 0:k.id))})]})]})})};function Ra(){const{innerWidth:t,innerHeight:s}=window;return{width:t,height:s}}const Ca=({trackY:t,track:s,isFav:o})=>{const[d,l]=n.useState(Ra()),{onClicTrackActionEntry:r,trackActionTypes:a}=ae(),[u,m]=n.useState(!1),h=n.useRef(null),[c,p]=n.useState(null),f=Ve(),[x,v]=n.useState(()=>window.innerWidth<820);return n.useEffect(()=>{const y=O=>{h.current&&!h.current.contains(O.target)&&r(a.NONE)};return document.addEventListener("mousedown",y),document.addEventListener("touchstart",y),m(f.pathname.includes("playlist")),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("touchstart",y)}},[]),n.useEffect(()=>{const y=u?250:180;p(Math.min(t,d.height-y))},[u]),c&&e.jsxs("div",{className:"track-actions-div",ref:h,style:{height:"fit-content",top:c},children:[e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TOP_QUEUE,s)},children:[e.jsx("span",{children:"Front queue"})," ",e.jsx(xr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.END_QUEUE,s)},children:[e.jsx("span",{children:"Back queue"})," ",e.jsx(vr,{})]}),u&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.GOTO_ALBUM,s)},children:[e.jsx("span",{children:"View album"})," ",e.jsx(jr,{})]}),u&&!o&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_PLAYLIST,s)},children:[e.jsx("span",{children:"Delete from playlist"})," ",e.jsx(yr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TAGS,s)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(yt,{})]}),x&&s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_FAVORITES,s)},children:[e.jsx("span",{children:"Remove from favorite"})," ",e.jsx(es,{})]}):null,x&&!s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.ADD_TO_FAVORITES,s)},children:[e.jsx("span",{children:"Add to favorites"})," ",e.jsx(Os,{})]}):null]})},gt={name:"Create a new tag",icon:()=>e.jsx(Ms,{}),isAction:!0},Aa=({track:t,apply:s})=>{const o=n.useRef(null),[d,l]=n.useState(!1),[r,a]=n.useState([gt]),[u,m]=n.useState("#aabbcc"),[h,c]=n.useState(!1),p=n.useRef(null),f=n.useRef(null),[x,v]=n.useState([]),[y,O]=n.useState(null),[k,R]=n.useState(null),[U,P]=n.useState([]),b=n.useRef(),F=_=>{const T=_.target.value;if(R(T),T===""||T.trim().length===0){a([gt]);return}fetch(`${N}/read-write/search/${T}/tags`,{method:"GET",credentials:"include"}).then(V=>{if(V.ok)return V.json();throw new Error("Error fetching search results")}).then(V=>{var ee;const G=(ee=V.tags)==null?void 0:ee.map(X=>({...X,icon:()=>e.jsx(yt,{color:X.color}),isAction:!1})),D={name:`${gt.name}: ${T}`,icon:gt.icon,isAction:gt.isAction};G.splice(0,0,D),a(G)})},I=()=>{l(!1)},S=_=>{if(I(),_.isAction){O("new"),m(`${Ks(Math.random().toFixed(4)*360,100,70.8)}`);return}x.find(T=>T.id===_.id)||(P(T=>T.filter(V=>V!==_.id)),v(T=>[...T,_]))};n.useEffect(()=>{y==="new"&&(f.current.focus(),f.current.value=k||"",b.current.value="")},[y]),n.useEffect(()=>{const _=T=>{var V;if(p.current&&!p.current.contains(T.target)){if(((V=T.target.closest("svg"))==null?void 0:V.id)==="color-button")return;c(!1)}if(o.current&&!o.current.contains(T.target)){I();return}};return document.addEventListener("mousedown",_),document.addEventListener("touchstart",_),fetch(`${N}/read-write/trackTags/${t.id}`,{method:"GET"}).then(T=>T.json()).then(T=>{v(T)}),()=>{document.removeEventListener("mousedown",_),document.removeEventListener("touchstart",_)}},[]);const M=()=>{const _=f.current.value;_!==""&&y==="new"&&v(T=>[...T,{name:_,color:u,id:bt(),isNew:!0}]),O(null)},J=(_,T)=>{const V=x.filter(G=>!(G.isNew===_&&G.id===T));v(V),_||P(G=>[...G,T])};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",style:{height:"500px",flexDirection:"column"},children:[e.jsx(be,{className:"buttonRound closeOverlay",onClick:()=>{s(null)}}),e.jsxs("h3",{children:["Editing tags for track ",t.title]}),e.jsx("div",{className:"action-bar",style:{margin:"10px auto"},ref:o,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Me,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:F,placeholder:"Search some tags..",ref:b,onFocus:()=>{l(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${d?"block":"none"}`},children:e.jsx(Ie,{height:300,itemCount:r.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:_,style:T})=>e.jsx(ut,{entry:r[_],style:{...T,width:" calc(100% - 20px)",marginTop:"10px"},onClick:S},_)})})]})}),y?e.jsxs("div",{className:"edit-tag",children:[e.jsx(Ms,{style:{paddingRight:"30px"}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:f}),e.jsx(Us,{id:"color-button",color:u,onClick:()=>{c(!h)}}),h&&e.jsxs("div",{ref:p,className:"edit-tag-picker",children:[" ",e.jsx(os,{color:u,onChange:m})]}),e.jsx(ct,{onClick:M})]}):null,e.jsx("div",{className:"track-tags-div",children:x.map((_,T)=>e.jsxs("div",{className:"small-tag",style:{backgroundColor:_.color},children:[e.jsx("span",{children:_.name})," ",e.jsx(be,{onClick:()=>{J(_.isNew,_.id)}})]},`${_.isNew}-${_.id}`))}),e.jsx("button",{style:{marginTop:"auto"},onClick:()=>{s({current:x,deleted:U},t.id)},children:"Apply"})]})})},Ia=()=>{const{closeTagWindow:t}=ae(),[s,o]=n.useState(0),[d,l]=n.useState([]),[r,a]=n.useState([]),[u,m]=n.useState(!1),[h,c]=n.useState("#aabbcc"),[p,f]=n.useState(null),x=n.useRef(null),v=n.useRef(null),{addNotification:y,notifTypes:O}=Fe(),[k,R]=n.useState(null);n.useEffect(()=>{U(),P()},[]);const U=()=>{fetch(`${N}/read-write/getAllUserTags`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{l(S)})},P=()=>{fetch(`${N}/read-write/getAllUserSalads`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{a(S)})},b=S=>{f(S),c(S.color)},F=()=>{const S={id:p.id,name:x.current.value,color:h},M=new FormData;M.append(s===0?"tag":"salad",JSON.stringify(S)),fetch(`${N}/read-write/${s===0?"applyTagModifications":"applySaladModifications"}`,{method:"POST",credentials:"include",body:M}).then(J=>J.json()).then(J=>{s===0?U():P(),y("Tag updated.",O.SUCCESS)}),f(null)},I=()=>{fetch(`${N}/read-write/delete/${k.type}/${k.id}`,{method:"DELETE",credentials:"include"}).then(S=>S.json()).then(S=>{s===0?U():P(),f(null),R(null),y("Tag deleted.",O.SUCCESS)})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"tag-edtior-container",children:[e.jsx(be,{className:"buttonRound closeOverlay",onClick:t}),e.jsxs("div",{className:"cooking-selection",style:{marginTop:"40px"},children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(oe,{text:"Edit tags",icon:e.jsx(br,{}),onClick:async()=>{o(0)}}),e.jsx(oe,{text:"Edit salads",icon:e.jsx(ot,{}),onClick:async()=>{o(1)}})]}),e.jsxs("div",{className:"edit-tags-content",children:[e.jsx(Ie,{className:"albumTrackList",height:250,itemCount:s===0?d.length:r.length,itemSize:35,width:"100%",children:({index:S,style:M})=>e.jsxs("div",{style:M,className:"album-wrapping-track",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:s===0?d[S].color:r[S].color}}),e.jsx("span",{children:s===0?d[S].name:r[S].name}),e.jsx(_s,{className:"trackIcon",onClick:()=>{b(s===0?{...d[S],type:"tag"}:{...r[S],type:"salad"})}})]},S)}),p?e.jsxs("div",{className:"edit-tag",style:{left:"-20px",margin:"auto"},children:[e.jsx(be,{style:{cursor:"pointer"},onClick:()=>{f(null)}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:x,defaultValue:p.name}),e.jsx(Us,{style:{cursor:"pointer"},id:"color-button",color:h,onClick:()=>{m(!u)}}),u&&e.jsxs("div",{ref:v,className:"edit-tag-picker",children:[" ",e.jsx(os,{color:h,onChange:c})]}),e.jsx(ct,{onClick:F,style:{cursor:"pointer"}}),e.jsx(it,{style:{cursor:"pointer"},onClick:()=>{R(p)}})]}):null,k?e.jsxs("div",{className:"deletion-confirmation",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:k.color,width:"50px"}}),e.jsxs("p",{children:["Confirm deletion of the ",k.type," ",k.name,"?"]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{R(null)},children:e.jsx(Nr,{})}),e.jsx("button",{onClick:()=>{I()},children:e.jsx(ct,{})})]})]}):null]})]})]})})},Fa=({applyChanges:t,artist:s})=>{const[o,d]=n.useState(null),[l,r]=n.useState("2000-00-00"),[a,u]=n.useState(null);if(!s)return null;n.useEffect(()=>{s&&(d(s.picture),r(s.active_from))},[s]);const m=()=>{const c=document.getElementById("editArtistInfos"),p=s.active_from??"",f=c.activeFrom.value??"",x=s.name??"",v=c.artistName.value??"",y=s.bio??"",O=c.bio.value??"";if(!(x!=v||p!=f||y!=O||a)){t(null);return}s.name=c.artistName.value,s.active_from=c.activeFrom.value,s.bio=c.bio.value;const{picture:R,...U}=s;console.log(U,a),t(U,a)},h=c=>{const p=c.target.files[0];p&&(s.ext=p.name.split(".").pop(),d(URL.createObjectURL(p)),u(p))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(ne,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:h})]}),e.jsx("button",{className:"roundButton",onClick:m,children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editArtistInfos",children:[e.jsx("label",{htmlFor:"artistName",children:"Artist name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("div",{className:"albumType",children:e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"activeFrom",children:"Active since"}),e.jsx("input",{type:"date",id:"activeFrom",value:l,onChange:c=>{r(c.target.value)}})]})}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",placeholder:"Enter biography",defaultValue:s.bio})]})]})]})})};var Pt=function(t,s){return t<s?-1:t>s?1:0},Rs=function(t){return t.reduce(function(s,o){return s+o},0)},Pa=function(){function t(o){this.colors=o}var s=t.prototype;return s.palette=function(){return this.colors},s.map=function(o){return o},t}(),La=function(){function t(r,a,u){return(r<<10)+(a<<5)+u}function s(r){var a=[],u=!1;function m(){a.sort(r),u=!0}return{push:function(h){a.push(h),u=!1},peek:function(h){return u||m(),h===void 0&&(h=a.length-1),a[h]},pop:function(){return u||m(),a.pop()},size:function(){return a.length},map:function(h){return a.map(h)},debug:function(){return u||m(),a}}}function o(r,a,u,m,h,c,p){var f=this;f.r1=r,f.r2=a,f.g1=u,f.g2=m,f.b1=h,f.b2=c,f.histo=p}function d(){this.vboxes=new s(function(r,a){return Pt(r.vbox.count()*r.vbox.volume(),a.vbox.count()*a.vbox.volume())})}function l(r,a){if(a.count()){var u=a.r2-a.r1+1,m=a.g2-a.g1+1,h=Math.max.apply(null,[u,m,a.b2-a.b1+1]);if(a.count()==1)return[a.copy()];var c,p,f,x,v=0,y=[],O=[];if(h==u)for(c=a.r1;c<=a.r2;c++){for(x=0,p=a.g1;p<=a.g2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[t(c,p,f)]||0;y[c]=v+=x}else if(h==m)for(c=a.g1;c<=a.g2;c++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[t(p,c,f)]||0;y[c]=v+=x}else for(c=a.b1;c<=a.b2;c++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.g1;f<=a.g2;f++)x+=r[t(p,f,c)]||0;y[c]=v+=x}return y.forEach(function(k,R){O[R]=v-k}),function(k){var R,U,P,b,F,I=k+"1",S=k+"2",M=0;for(c=a[I];c<=a[S];c++)if(y[c]>v/2){for(P=a.copy(),b=a.copy(),F=(R=c-a[I])<=(U=a[S]-c)?Math.min(a[S]-1,~~(c+U/2)):Math.max(a[I],~~(c-1-R/2));!y[F];)F++;for(M=O[F];!M&&y[F-1];)M=O[--F];return P[S]=F,b[I]=P[S]+1,[P,b]}}(h==u?"r":h==m?"g":"b")}}return o.prototype={volume:function(r){var a=this;return a._volume&&!r||(a._volume=(a.r2-a.r1+1)*(a.g2-a.g1+1)*(a.b2-a.b1+1)),a._volume},count:function(r){var a=this,u=a.histo;if(!a._count_set||r){var m,h,c,p=0;for(m=a.r1;m<=a.r2;m++)for(h=a.g1;h<=a.g2;h++)for(c=a.b1;c<=a.b2;c++)p+=u[t(m,h,c)]||0;a._count=p,a._count_set=!0}return a._count},copy:function(){var r=this;return new o(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(r){var a=this,u=a.histo;if(!a._avg||r){var m,h,c,p,f=0,x=0,v=0,y=0;if(a.r1===a.r2&&a.g1===a.g2&&a.b1===a.b2)a._avg=[a.r1<<3,a.g1<<3,a.b1<<3];else{for(h=a.r1;h<=a.r2;h++)for(c=a.g1;c<=a.g2;c++)for(p=a.b1;p<=a.b2;p++)f+=m=u[t(h,c,p)]||0,x+=m*(h+.5)*8,v+=m*(c+.5)*8,y+=m*(p+.5)*8;a._avg=f?[~~(x/f),~~(v/f),~~(y/f)]:[~~(8*(a.r1+a.r2+1)/2),~~(8*(a.g1+a.g2+1)/2),~~(8*(a.b1+a.b2+1)/2)]}}return a._avg},contains:function(r){var a=this,u=r[0]>>3;return gval=r[1]>>3,bval=r[2]>>3,u>=a.r1&&u<=a.r2&&gval>=a.g1&&gval<=a.g2&&bval>=a.b1&&bval<=a.b2}},d.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var a=this.vboxes,u=0;u<a.size();u++)if(a.peek(u).vbox.contains(r))return a.peek(u).color;return this.nearest(r)},nearest:function(r){for(var a,u,m,h=this.vboxes,c=0;c<h.size();c++)((u=Math.sqrt(Math.pow(r[0]-h.peek(c).color[0],2)+Math.pow(r[1]-h.peek(c).color[1],2)+Math.pow(r[2]-h.peek(c).color[2],2)))<a||a===void 0)&&(a=u,m=h.peek(c).color);return m},forcebw:function(){var r=this.vboxes;r.sort(function(h,c){return Pt(Rs(h.color),Rs(c.color))});var a=r[0].color;a[0]<5&&a[1]<5&&a[2]<5&&(r[0].color=[0,0,0]);var u=r.length-1,m=r[u].color;m[0]>251&&m[1]>251&&m[2]>251&&(r[u].color=[255,255,255])}},{quantize:function(r,a){if(!Number.isInteger(a)||a<1||a>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!r.length||a<2||a>256||!r.length||a<2||a>256)return!1;for(var u=[],m=new Set,h=0;h<r.length;h++){var c=r[h],p=c.join(",");m.has(p)||(m.add(p),u.push(c))}if(u.length<=a)return new Pa(u);var f=function(R){var U,P=new Array(32768);return R.forEach(function(b){U=t(b[0]>>3,b[1]>>3,b[2]>>3),P[U]=(P[U]||0)+1}),P}(r);f.forEach(function(){});var x=function(R,U){var P,b,F,I=1e6,S=0,M=1e6,J=0,_=1e6,T=0;return R.forEach(function(V){(P=V[0]>>3)<I?I=P:P>S&&(S=P),(b=V[1]>>3)<M?M=b:b>J&&(J=b),(F=V[2]>>3)<_?_=F:F>T&&(T=F)}),new o(I,S,M,J,_,T,U)}(r,f),v=new s(function(R,U){return Pt(R.count(),U.count())});function y(R,U){for(var P,b=R.size(),F=0;F<1e3;){if(b>=U||F++>1e3)return;if((P=R.pop()).count()){var I=l(f,P),S=I[0],M=I[1];if(!S)return;R.push(S),M&&(R.push(M),b++)}else R.push(P),F++}}v.push(x),y(v,.75*a);for(var O=new s(function(R,U){return Pt(R.count()*R.volume(),U.count()*U.volume())});v.size();)O.push(v.pop());y(O,a);for(var k=new d;O.size();)k.push(O.pop());return k}}}().quantize,Ys=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};Ys.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var at=function(){};at.prototype.getColor=function(t,s){return s===void 0&&(s=10),this.getPalette(t,5,s)[0]},at.prototype.getPalette=function(t,s,o){var d=function(u){var m=u.colorCount,h=u.quality;if(m!==void 0&&Number.isInteger(m)){if(m===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");m=Math.max(m,2),m=Math.min(m,20)}else m=10;return(h===void 0||!Number.isInteger(h)||h<1)&&(h=10),{colorCount:m,quality:h}}({colorCount:s,quality:o}),l=new Ys(t),r=function(u,m,h){for(var c,p,f,x,v,y=u,O=[],k=0;k<m;k+=h)p=y[0+(c=4*k)],f=y[c+1],x=y[c+2],((v=y[c+3])===void 0||v>=125)&&(p>250&&f>250&&x>250||O.push([p,f,x]));return O}(l.getImageData().data,l.width*l.height,d.quality),a=La(r,d.colorCount);return a?a.palette():null},at.prototype.getColorFromUrl=function(t,s,o){var d=this,l=document.createElement("img");l.addEventListener("load",function(){var r=d.getPalette(l,5,o);s(r[0],t)}),l.src=t},at.prototype.getImageData=function(t,s){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){if(this.status==200){var d=new Uint8Array(this.response);i=d.length;for(var l=new Array(i),r=0;r<d.length;r++)l[r]=String.fromCharCode(d[r]);var a=l.join(""),u=window.btoa(a);s("data:image/png;base64,"+u)}},o.send()},at.prototype.getColorAsync=function(t,s,o){var d=this;this.getImageData(t,function(l){var r=document.createElement("img");r.addEventListener("load",function(){var a=d.getPalette(r,5,o);s(a[0],this)}),r.src=l})};const jt=({iconHovered:t,iconDefault:s,onClick:o=null,className:d="",id:l=""})=>{const[r,a]=n.useState(!1);return e.jsx("div",{style:o?{background:"rgba(0,0,0,0)"}:{},className:d,id:l,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:o,children:r?e.jsx(t,{}):e.jsx(s,{})})},Ot=({context:t})=>{const{isPlaying:s,toggleTrackPaused:o,playNextSong:d,playPreviousSong:l}=ae(),r=m=>{m.stopPropagation(),o()},a=m=>{m.stopPropagation(),d()},u=m=>{m.stopPropagation(),l()};return e.jsxs("div",{className:"audio-controls","data-mobile-context":t.mobile,"data-preserv-width":t.preserv,children:[!t.mobile||t.maximize?e.jsx(jt,{iconHovered:Sr,iconDefault:kr,onClick:u}):null,e.jsx(jt,{iconHovered:s?wr:Er,iconDefault:s?Tr:ss,onClick:r}),!(t.radio&&t.mobile)&&e.jsx(jt,{iconHovered:Cr,iconDefault:Rr,onClick:a})]})},Xs=n.memo(({index:t,style:s,data:o})=>{const{playQueue:d,cacheRef:l,jumpToQueueTrack:r,queuePointer:a}=o,u=d[t],[m,h]=n.useState(!!l.current[u]);let c=l.current[u];c||(c={title:"Loading...",cover:"loading"}),n.useEffect(()=>{m||(l.current[u]=c,fetch(`${N}/read-write/shortTrackInfos/${u}`,{credentials:"include"}).then(f=>f.json()).then(f=>{l.current[u]=f,h(!0)}))},[m,u]);const p={...s,width:"calc(100% - 15px)",height:"47.5px"};return e.jsxs("div",{className:"music-queue-entry",style:p,"is-passed":`${t<a}`,"is-selected":`${t===a}`,onClick:()=>r(t),children:[c.cover?e.jsx("img",{src:`${N}/covers/${c.cover}`,className:"track-image-small"}):e.jsx(ne,{className:"track-image-small"}),e.jsx("span",{className:"track-title",children:c.title})]})},(t,s)=>t.data.playQueue[t.data.queuePointer]===s.data.playQueue[s.data.queuePointer]),$a=50,Oa=0,Cs=n.memo(({title:t,radio:s,artist:o,artistId:d,isMinimal:l,fn:r})=>{const a=me(),[u,m]=n.useState(!0);return n.useEffect(()=>{m(!0);const h=setTimeout(()=>m(!1),500);return()=>clearTimeout(h)},[t]),e.jsxs("div",{className:"mobile-view-track-artist",style:{"--item-align":l?"left":"center"},children:[e.jsx("span",{id:"songTitle","data-from-minimal":l,"data-new":u,children:t}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{s||(r&&r(),a(`/artists/${d}`))},children:o})]})},(t,s)=>t.title===s.title&&t.artist===s.artist&&t.artistId===s.artistId&&t.radio===s.radio),As=5,Ma=()=>{var H;const{currentTrackData:t,trackCoverUrl:s,setTrackMobileView:o,toggleTrackFavorite:d,playQueue:l,jumpToQueueTrack:r,queuePointer:a,playLibraryShuffle:u,isPlaying:m,getFFTAtCurrentTime:h,fftConfigRef:c,songRawPalette:p,recomputeColors:f,requestNewFullScreenImage:x}=ae(),{addNotification:v}=Fe(),y=n.useRef(new Map),O=n.useRef(null),[k,R]=n.useState(!1),[U,P]=n.useState((t==null?void 0:t.isFav)||!1),b=n.useRef(null),F=n.useRef(0),I=n.useRef(0),S=n.useRef(null),M=n.useRef(null),J=n.useRef(0),_=n.useRef(null),T=n.useRef(null),V=n.useRef(null),G=n.useRef(!1),D=n.useRef(null);n.useEffect(()=>{t&&P(t.isFav)},[t]),n.useEffect(()=>{s&&(console.log("request"),x().then($=>{console.log("received",$),D.current.src=URL.createObjectURL($.blob),D.current.addEventListener("load",je)}))},[s]);const ee=async()=>{t&&d(t.id,!U,P)},X=$=>{if($-J.current<1e3/30||!(_.current&&T.current&&V.current)){M.current=requestAnimationFrame(X);return}J.current=$;const se=h();let pe=se.subarray(Math.floor(se.length*.3),Math.floor(se.length*.6));const ce=Math.max(1,pe.length/As),L=new Array(As).fill(0);for(let C=0;C<pe.length;C++)L[Math.floor(C/ce)]+=Number(se[C])/100;for(let C=0;C<L.length;C++)L[C]=Math.min(100,Math.max(L[C],0));const W=3;_.current.style.setProperty("--strength-1",`${L[1]/W}%`),_.current.style.setProperty("--strength-2",`${L[2]/W}%`),T.current.style.setProperty("--strength-1",`${L[3]/W}%`),T.current.style.setProperty("--strength-2",`${L[4]/W}%`),V.current.style.setProperty("--strength-1",`${L[0]/W}%`),M.current=requestAnimationFrame(X)},le=()=>{b.current.setAttribute("data-shift-back","true"),b.current.style.translate=`0px ${window.screen.height*.8}px`,b.current.setAttribute("data-fade-out","true"),console.log("clearing from close"),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{o(!1),b.current.setAttribute("data-fade-out","true"),b.current.setAttribute("data-shift-back","false"),S.current=null},200)},ve=$=>{F.current=$.touches[0].clientY,I.current=0,S.current&&(console.log("clearing from touch start"),clearTimeout(S.current),S.current=null),b.current.setAttribute("data-shift-back","false")},ge=$=>{F.current&&b.current&&($.preventDefault(),!(I.current<-40)&&(I.current=$.touches[0].clientY-F.current,b.current.style.translate=`0px ${I.current}px`))},re=$=>{(I.current||0)<90?(b.current.setAttribute("data-shift-back","true"),b.current.style.translate="0px 0px",console.log("clearing from touch end"),S.current=setTimeout(()=>{b.current.setAttribute("data-shift-back","false"),S.current=null},300)):le()},fe=$=>{$.stopPropagation(),$.preventDefault()};n.useEffect(()=>{if(!c.current){cancelAnimationFrame(M.current),console.log("No FFT data to display, releasing anim frame.");return}M.current=requestAnimationFrame(X),console.log("FFT found, requested animation frame.")},[c.current]),n.useEffect(()=>{var $;console.log("New paellette",p.current),(($=p.current)==null?void 0:$.length)>0&&(_.current.style.setProperty("--c-1",`rgb(${p.current[1].join(",")})`),_.current.style.setProperty("--c-2",`rgb(${p.current[2].join(",")})`),T.current.style.setProperty("--c-1",`rgb(${p.current[3].join(",")})`),T.current.style.setProperty("--c-2",`rgb(${p.current[4].join(",")})`),V.current.style.setProperty("--c-1",`rgb(${p.current[0].join(",")})`))},[p.current]),n.useEffect(()=>{var pe,ce;const $=window.matchMedia("(min-width: 820px)"),se=L=>{G.current=L.matches,M.current=requestAnimationFrame(X),console.log("Canvas hidden?",G.current)};return se($),(pe=D.current)!=null&&pe.complete&&((ce=D.current)!=null&&ce.src)&&f(D),$.addEventListener("change",se),()=>{$.removeEventListener("change",se)}},[]);const je=()=>{console.log("recomputing"),f(D,()=>{}),D.current.removeEventListener("load",je)};return e.jsx("div",{id:"track-mobile-view",ref:b,onTouchStart:ve,onTouchMove:ge,onTouchEnd:re,children:e.jsxs("div",{id:"track-mobile-view-content","data-minimize":k,children:[e.jsx("div",{className:"grad",id:"grad1",ref:_}),e.jsx("div",{className:"grad",id:"grad2",ref:T}),e.jsx("div",{className:"grad",id:"grad3",ref:V}),e.jsxs("div",{id:"floating-audio-state","data-minimize":k,children:[e.jsx("div",{id:"track-mobile-down",onTouchEnd:le,children:e.jsx("div",{})}),(t==null?void 0:t.type)=="radio"?t.coverUrl==""?e.jsx(ne,{className:"trackImage","data-playing":m}):e.jsx("img",{ref:D,crossOrigin:"anonymous",src:t.coverUrl,"data-playing":m,className:"trackImage"}):s.split("/").pop()==="null"?e.jsx(ne,{className:"trackImage","data-playing":m}):e.jsx("img",{ref:D,className:"trackImage",crossOrigin:"anonymous","data-playing":m}),t?e.jsx(Cs,{title:t.title,artist:t.artist,artistId:t.artistId,radio:t.type==="radio",isMinimal:!0,fn:le}):null]}),k?l.length>0?e.jsx("div",{id:"music-queue",ref:O,onTouchMove:fe,children:e.jsx(Ie,{height:((H=O.current)==null?void 0:H.offsetHeight)||Oa,itemCount:l.length,itemSize:$a,width:"100%",itemData:{playQueue:l,cacheRef:y,jumpToQueueTrack:r,queuePointer:a},children:Xs})}):e.jsx("p",{id:"no-items-in-queue",children:"No items in the queue"}):null,e.jsxs("div",{id:"fixed-audio-state",children:[t?e.jsx(Cs,{title:t.title,artist:t.artist,artistId:t.artistId,radio:t.type==="radio",isMinimal:!1,fn:le}):null,e.jsx(en,{}),e.jsx(Ot,{context:{mobile:!0,maximize:!0}}),e.jsxs("div",{className:"track-list-header",children:[l.length>0?e.jsx(oe,{text:"",icon:U?e.jsx(Bs,{}):e.jsx(_t,{}),onClick:ee}):e.jsx(oe,{text:"",icon:e.jsx(Ar,{}),onClick:u}),e.jsx(oe,{text:"",icon:e.jsx(Gs,{}),onClick:async()=>{R(!k)}})]})]})]})})},Zs=n.createContext(void 0),Oe={TOP_QUEUE:"top_queue",END_QUEUE:"end_queue",TAGS:"tags",GOTO_ALBUM:"goto_album",REMOVE_FROM_PLAYLIST:"remove_from_playlist",ADD_TO_FAVORITES:"add_to_favs",REMOVE_FROM_FAVORITES:"remove_from_favs",NONE:"none"},Ua=()=>{const t=Ve(),s=n.useRef({pointer:0,history:new Array(6).fill(null)});return n.useEffect(()=>{const{pointer:o,history:d}=s.current,l=(o-1+d.length)%d.length;d[l]!==t.pathname&&(d[o]=t.pathname,s.current.pointer=(o+1)%d.length)},[t]),s.current},_a=({children:t})=>{const[s,o]=n.useState(""),[d,l]=n.useState(!1),[r,a]=n.useState({}),[u,m]=n.useState(0),h=n.useRef(null),c=n.useRef(null),p=n.useRef(null),[f,x]=n.useState([]),[v,y]=n.useState("null"),O=g=>`${g}`!="null"?`${N}/read-write/music/${g}`:null,[k,R]=n.useState(-1),U=n.useRef(f),P=n.useRef(k),[b,F]=n.useState(null),[I,S]=n.useState(null),{emit:M,subscribe:J}=xe(),_=n.useRef(null),[T,V]=n.useState(null),G=n.useRef(null),{addNotification:D,notifTypes:ee}=Fe(),X=me(),[le,ve]=n.useState(null),[ge,re]=n.useState(null),[fe,je]=n.useState(null),H=n.useRef("A"),$=n.useRef(null),[se,pe]=n.useState(5),[ce,L]=n.useState(!1),[W,C]=n.useState(()=>{const g=parseFloat(localStorage.getItem("volume"));return isNaN(g)?1:Math.min(1,Math.max(0,g))}),[z,w]=n.useState(!1),[B,Y]=n.useState(!1),Z=n.useRef(null),de=n.useRef(null),q=n.useRef(null),ye=n.useRef(null),_e=n.useRef(0),He=n.useRef(null),he=n.useRef(null),Tt=n.useRef(0),mt=n.useRef(null),wt=n.useRef(0),Gt=n.useRef(0),qe=5,Et=n.useRef(""),ms=n.useRef(null),hs=n.useRef(0),ht=n.useRef({lastAudioTime:0,lastPerformanceNow:0}),Ze=n.useRef(null),cn=.1,ft=n.useRef(!1),Dt=Ve(),et=n.useRef(""),ln=n.useRef([]),pt=n.useRef({track:"",pairs:[]}),fs=n.useRef(null),Vt=Ua(),[Rt,ps]=n.useState(!1),Ht=n.useRef(null),qt=n.useRef(null),gs=n.useRef([]),un=()=>{var g,j,E,A,K,te,ie,Ne;c.current=new Audio,c.current.setAttribute("source","A"),c.current.addEventListener("error",ke=>{if(c.current.src.includes("spoof"))return;const Se=c.current.error;if(Se&&(console.warn("Audio error occurred: code",Se.code),Se.code===4&&s)){const ze=`${N}/radio/spoof/${encodeURIComponent(c.current.src)}`;c.current.src=ze,D("Audio stream not reachable from browser. Streaming from backend..",ee.INFO),l(!0),c.current.play();const We=new EventSource(`${N}/radio/trackStream/${encodeURIComponent(c.current.src)}`);We.onmessage=Ee=>{console.log(Ee);const Re=JSON.parse(Ee.data);console.log("Now playing:",Re.metadata.StreamTitle);const $e=Re.metadata.adw_ad=="true"?`Advertisment - ${(Number(Re.metadata.durationMilliseconds)/1e3).toFixed(1)}s`:Re.metadata.StreamTitle;a(Ke=>({...Ke,title:$e}))},We.addEventListener("error",Ee=>{console.warn("Metadata stream error",Ee)})}}),c.current.addEventListener("canplay",()=>{console.log("Stream is playable!")}),p.current=new Audio,p.current.setAttribute("source","B");for(const ke of[c,p])ke.current.crossOrigin="anonymous",ke.current.playsInline=!0,ke.current.setAttribute("webkit-playsinline",""),ke.current.volume=parseFloat(localStorage.getItem("volume"))*.75||.5;(g=c.current)==null||g.addEventListener("timeupdate",At),(j=p.current)==null||j.addEventListener("timeupdate",At),(E=c.current)==null||E.addEventListener("playing",Ct),(A=p.current)==null||A.addEventListener("playing",Ct),(K=c.current)==null||K.addEventListener("play",tt),(te=c.current)==null||te.addEventListener("pause",vs),(ie=p.current)==null||ie.addEventListener("play",tt),(Ne=p.current)==null||Ne.addEventListener("pause",vs),zt(),console.log("Audio graph setted up")},dn=()=>{var g,j,E,A,K,te,ie,Ne,ke,Se,ze,We,Ee,Re,$e,Ke;console.log("Audio graph destructed"),(g=c.current)==null||g.pause(),c.current=null,(j=p.current)==null||j.pause(),p.current=null,(E=c.current)==null||E.removeEventListener("timeupdate",Pe),(A=c.current)==null||A.removeEventListener("ended",Le),(K=c.current)==null||K.removeEventListener("error"),(te=c.current)==null||te.removeEventListener("canplay"),(ie=p.current)==null||ie.removeEventListener("timeupdate",Pe),(Ne=p.current)==null||Ne.removeEventListener("ended",Le),(ke=c.current)==null||ke.removeEventListener("timeupdate",At),(Se=p.current)==null||Se.removeEventListener("timeupdate",At),(ze=c.current)==null||ze.removeEventListener("playing",Ct),(We=p.current)==null||We.removeEventListener("playing",Ct),(Ee=c.current)==null||Ee.removeEventListener("play",tt),(Re=c.current)==null||Re.removeEventListener("pause",tt),($e=p.current)==null||$e.removeEventListener("play",tt),(Ke=p.current)==null||Ke.removeEventListener("pause",tt)},zt=()=>{var g,j;(g=c.current)==null||g.pause(),c.current.src=null,c.current.currentTime=0,(j=p.current)==null||j.pause(),p.current.src=null,p.current.currentTime=0,h.current=null,H.current="A",c.current.removeEventListener("timeupdate",Pe),c.current.removeEventListener("ended",Le),p.current.removeEventListener("timeupdate",Pe),p.current.removeEventListener("ended",Le)},Ct=()=>{he.current&&(console.log("Record start playing",h.current.currentTime),ht.current.lastAudioTime=h.current.currentTime,ht.current.lastPerformanceNow=performance.now())},xs=()=>{const g=h.current;!g||g.paused||Math.abs(g.currentTime-Ns())>cn&&bs()},mn=()=>(setTimeout(xs,200),setInterval(xs,5e3)),tt=()=>{he.current&&(bs(),Ze.current&&clearInterval(Ze.current),Ze.current=mn())},vs=()=>{Ze.current&&(clearInterval(Ze.current),Ze.current=null)},At=()=>{if(!he.current||!h.current)return;const g=h.current.currentTime;if(Math.abs(g-hs.current)>1){M("on-seek-song",g);const j=Math.round(1/he.current.interval),E=qe*j,A=Math.floor(g*j);console.log("Seeking chunk",A,E,j,qe),Tt.current=0,Gt.current=A,ys(Et.current,A,A+E)}else fn(Et.current,g);hs.current=g};n.useEffect(()=>{r&&r.type!=="radio"&&It()},[r]);const It=()=>{const g=f.length<=k+1;$.current&&clearTimeout($.current),!(g||!h.current)&&(console.log("Transition rescheduled, timesout in ",r.rawDuration,h.current.currentTime,se,r.rawDuration-h.current.currentTime-se),$.current=setTimeout(()=>{H.current=H.current==="A"?"B":"A",js(k+1)},Math.min(r.rawDuration-h.current.currentTime-se)*1e3,0))},js=async g=>{const j=f.length<=g;if(R(g),h.current=H.current==="A"?c.current:p.current,f[g].startsWith("radio-")){let A={};if(f[g].startsWith("radio-id")){const te=f[g].split("radio-id:")[1];A=await fetch(`${N}/radio/${te}`).then(ie=>ie.json()),console.log(A),He.current=null,a({type:"radio",artist:A.name,...A,duration:"0-",uuid:te})}else{A.url=f[g].split("radio-url:")[1],console.log(He.current);const{name:te,...ie}=He.current,Ne={artist:te,...ie};a({type:"radio",...Ne,duration:"0-"})}h.current.src=A.url;const K=new EventSource(`${N}/radio/trackStream/${encodeURIComponent(A.url)}`);K.onmessage=te=>{console.log(te);const ie=JSON.parse(te.data);console.log("Now playing:",ie.metadata.StreamTitle),a(Ne=>({...Ne,title:ie.metadata.StreamTitle}))},o(""),K.addEventListener("error",te=>{console.warn("Metadata stream error",te)}),ks(),p.current.removeEventListener("timeupdate",Pe),p.current.removeEventListener("ended",Le),l(!0),h.current.play();return}He.current=null;const E=f[g];if(await fetch(`${N}/read-write/trackInfos/${E}`,{method:"GET"}).then(A=>A.json()).then(A=>{A.duration=cs(A.rawDuration),a(A)}),h.current.currentTime=0,await fetch(`${N}/read-write/fftConfig/${E}`,{method:"GET",credentials:"include"}).then(async A=>{if(Tt.current=0,Gt.current=0,wt.current=0,!A.ok){he.current=null;return}const K=await A.json();he.current=JSON.parse(K),console.log(he.current);const te=he.current.fftSize*1,ie=qe/he.current.interval;mt.current=new Int16Array(ie*te),console.log("New buffer!")}),h.current.src!==O(E))h.current.src=O(E);else{m(0);return}h.current.play(),clearTimeout(q.current),o(E),Et.current=E,l(!0),Rn(E),console.log("Fading in",h.current),H.current==="A"?(j?Ft(p,null):(Ft(p,c),c.current.addEventListener("timeupdate",Pe),c.current.addEventListener("ended",Le)),p.current.removeEventListener("timeupdate",Pe),p.current.removeEventListener("ended",Le)):H.current==="B"&&(j?Ft(c,null):(Ft(c,p),p.current.addEventListener("timeupdate",Pe),p.current.addEventListener("ended",Le)),c.current.removeEventListener("timeupdate",Pe),c.current.removeEventListener("ended",Le))},ys=async(g,j,E)=>{if(!he.current)return mt.current=null,null;const A=he.current.fftSize*1*2,K=A*j,te=A*E,ie=await fetch(`${N}/read-write/fft/${g}`,{headers:{Range:`bytes=${K}-${te-1}`}});if(!ie.ok&&ie.status!==206){console.error("Failed to stream FFT data");return}wt.current=Math.floor(E);const Ne=await ie.arrayBuffer(),ke=new Int16Array(Ne),Se=he.current.fftSize*1,ze=ke.length/Se,We=he.current.interval,Ee=qe/We;let Re=Tt.current;for(let $e=0;$e<ze;$e++){const Ke=$e*Se,ur=(Re+$e)%Ee;mt.current.set(ke.subarray(Ke,Ke+Se),ur*Se)}Tt.current=(Re+ze)%Ee},bs=()=>{ht.current.lastAudioTime=h.current.currentTime,ht.current.lastPerformanceNow=performance.now()},hn=()=>{const{lastAudioTime:g,lastPerformanceNow:j}=ht.current,E=(performance.now()-j)/1e3;return g+E},Ns=()=>h.current.paused?h.current.currentTime:hn(),fn=(g,j)=>{const E=Math.round(1/he.current.interval),A=Math.floor(j*E),K=Math.floor(wt.current)-A,te=E*qe;te-K<1||ys(g,Math.floor(wt.current),te+A)},pn=()=>{const g=Math.round(1/he.current.interval),E=Math.floor(Ns()*g)-Gt.current,A=qe*g;return E%A},gn=()=>{if(!he.current||!mt.current)return null;const g=he.current.fftSize*1,j=pn();if(j===null)return null;const A=Math.floor(qe/he.current.interval)*g,K=j*g,te=K+g;return te>A?null:mt.current.slice(K,te)},ks=()=>{q!=null&&q.current&&clearInterval(q.current)};n.useEffect(()=>{console.log("Changed inteval ref:",q.current)},[q.current]);const Ft=(g,j)=>{q.current&&clearInterval(q.current);const E=150;let A=0;console.log("Init fadeout for:",j.current),q.current=setInterval(()=>{const K=Math.min(1,Math.max(0,A*E/(se*1e3)));j.current.volume=K*_e.current,g.current&&(g.current.volume=(1-K)*_e.current),K>=1&&(clearInterval(q.current),q.current=null,j.current&&(g.current.pause(),g.current.src=null)),A++},E)},Pe=()=>{var g;return m((g=h.current)==null?void 0:g.currentTime)},Le=()=>{f.length>0&&f.length<=k+1&&Wt()};n.useEffect(()=>{!ce||k===-1||f.length===0||(zt(),console.log("init Autoplay",f,k,ce,c.current,p.current),js(k),L(!1))},[f,k,ce]),n.useEffect(()=>{P.current=k},[k]),n.useEffect(()=>{U.current=f},[f]);const xn=()=>{var g,j;if(!h.current&&U.current.length>0){R(0),L(!0);return}if(d)(g=h.current)==null||g.pause(),l(!1),clearTimeout($.current),clearInterval(q.current);else{if(l(!0),k===-1&&f.length!==0){R(0);return}(j=h.current)==null||j.play(),It()}},vn=(g,j=!1)=>{fetch(`${N}/read-write/nextSongs/${le.type}/${le.id}/${j}`,{method:"GET",credentials:"include"}).then(E=>E.json()).then(E=>{x(E),console.log(E),R(E.findIndex(A=>A===g)),L(!0)})},jn=g=>{x([g]),R(0),L(!0)},yn=()=>{if(h.current.currentTime>5||k===0){h.current.currentTime=0,It();return}R(k-1),L(!0)},bn=(g,j,E=!1)=>{L(!1),fetch(`${N}/read-write/nextSongs/${j}/${g}/${E}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(A),R(0),L(!0)})},Nn=(g,j,E=!1)=>{L(!1),fetch(`${N}/read-write/nextSongs/${j}/${g}/${E}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(K=>[...K,...A]),D("Queued!",ee.QUEUE)})},kn=(g,j,E=!1)=>{console.log(`${N}/read-write/nextSongs/${j}/${g}/${E}`),fetch(`${N}/read-write/nextSongs/${j}/${g}/${E}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(vt.shuffle(A)),L(!0),R(0)})},Sn=(g=!1)=>{const j=g?U.current:f,E=g?P.current:k;j.length<=E+1&&(Wt(),console.log("stop")),R(E+1),L(!0)},Wt=()=>{zt(),m(0),l(!1),a(null),L(!1),R(-1),y("null"),x([]),o(""),Et.current="",console.log("No more songs in the queue"),clearInterval(q.current),clearTimeout($.current),ks()},Tn=g=>{if(g<0||g>100)return;const j=g/100*h.current.duration;h.current.currentTime=j,m(j),It()},wn=g=>{h.current.currentTime+g>h.current.duration?h.current.currentTime=h.current.duration:h.current.currentTime+g<0?h.current.currentTime=0:h.current.currentTime+=g,m(h.current.currentTime)},En=g=>{g<0||g>=f.length||(L(!0),R(g))},Rn=g=>{fetch(`${N}/read-write/trackCover/${g}`,{method:"GET"}).then(j=>j.json()).then(j=>{y(`${N}/covers/${j}`)})},Cn=()=>{Wt(),x([]),R(-1)},Kt=()=>{fetch(`${N}/config/user/FFT`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{ms.current=g})};n.useEffect(()=>{C(parseFloat(localStorage.getItem("volume"))||.5),un(),Dt.pathname==="/full-screen"&&(et.current="",ft.current=!0),Kt();const g=J("login",Kt);return()=>{dn(),g()}},[]);const An=async g=>{const j=await fetch(`${N}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!j.ok)throw new Error("Network response was not ok");const A=(await j.json()).map(K=>K.id);x(K=>[...K,...A])},In=async g=>{const j=await fetch(`${N}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!j.ok)throw new Error("Network response was not ok");const A=(await j.json()).map(K=>K.id);x(vt.shuffle(A)),L(!0),R(0)},Fn=async()=>{fetch(`${N}/read-write/all-songs`,{method:"GET"}).then(g=>g.json()).then(g=>{x(vt.shuffle(g)),L(!0),R(0),D("Playing the library in shuffle",ee.INFO)})},Pn=g=>{console.log("Editing album",g),fetch(`${N}/read-write/album/${g}`,{method:"GET",credentials:"include"}).then(j=>j.json()).then(j=>{const{albumInfos:E,genres:A,tracks:K,artists:te}=j;F({id:g,coverURL:`${N}/covers/${E.cover}`,tracks:K,type:"album",name:E.title,artist:te.map(ie=>ie.name),year:E.release_date,description:E.description,genre:A.map(ie=>ie.genreName)})})},Ln=g=>{fetch(`${N}/read-write/playlist/${g}/true`,{method:"GET",credentials:"include"}).then(j=>j.json()).then(j=>{const{playlistInfos:E,collaborators:A}=j;F({id:E.id,type:"playlist",coverURL:E.cover?`${N}/covers/${E.cover}`:null,name:E.title,description:E.description,collaborators:A})})};n.useEffect(()=>{const g=Math.min(1,Math.max(0,W));q.current||$n(g.toFixed(4)*.75),_e.current=g.toFixed(4)*.75,localStorage.setItem("volume",g)},[W]);const $n=g=>{ye.current&&clearInterval(ye.current);let j=0;const E=16,A=c.current.volume;ye.current=setInterval(()=>{const K=Je(A,g,j*E/300);c.current.volume=K,p.current.volume=K,(g-A>0?K>=g:K<=g)&&(clearInterval(ye.current),ye.current=null),j++},E)},On=(g,j=null)=>{if(!g){console.log("No changes made"),S(null);return}const E=new FormData;E.append("artist",JSON.stringify(g)),j&&E.append("coverArtist",j),fetch(`${N}/read-write/editContainer/artist`,{method:"POST",credentials:"include",body:E}).then(()=>{S(null),_.current()})},Mn=g=>{fetch(`${N}/read-write/artist/${g}/true`,{method:"GET",credentials:"include"}).then(j=>j.json()).then(j=>{S({id:j.id,picture:`${N}/covers/artists/${j.picture}`,name:j.name,bio:j.bio,active_from:j.active_from})})},Ss=(g,j=null)=>{if(!g){console.log("No changes made"),F(null);return}const E=new FormData;E.append(`${g.type}`,JSON.stringify(g)),j&&E.append("cover",j),fetch(`${N}/read-write/editContainer/${g.type}`,{method:"POST",credentials:"include",body:E}).then(()=>{F(null),_.current()})},Un=async(g,j)=>{const E=g?"/forMe":"";(await fetch(`${N}/read-write/delete/album/${j.id}${E}`,{method:"DELETE",credentials:"include"}).then(K=>K.json())).success&&(D(`Album ${j.name} deleted.`,ee.SUCCESS),F(null),X("/home"))},_n=async()=>{w(!0)},Bn=(g,j)=>{console.log("sending playlist",g);const E=new FormData;E.append("playlist",JSON.stringify(g)),j&&(E.append("cover",j),console.log(j)),fetch(`${N}/read-write/newPlaylist`,{method:"POST",credentials:"include",body:E}).then(()=>{w(!1),Z.current()})},Gn=g=>{R(0),x([g]),L(!0)},Dn=()=>{w(!1)},Vn=()=>{F(null)},Hn=(g,j,E,A)=>{V({track:j,position:g}),G.current&&G.current(),G.current=E,de.current=A},qn=()=>{V(null),G.current&&G.current()},zn=(g,j,E=null)=>{switch(qn(),g){case Oe.NONE:return;case Oe.TOP_QUEUE:Kn(j);break;case Oe.END_QUEUE:Qn(j);break;case Oe.GOTO_ALBUM:Wn(j);break;case Oe.REMOVE_FROM_PLAYLIST:Jn(j);break;case Oe.TAGS:re(j),D("Avaliable soon :)",ee.INFO);break;case Oe.ADD_TO_FAVORITES:console.log(j),Qt(j.id,!0,de.current);break;case Oe.REMOVE_FROM_FAVORITES:Qt(j.id,!0,de.current);break}},Wn=g=>{fetch(`${N}/read-write/trackAlbumId/${g.id}`,{method:"GET"}).then(j=>j.json()).then(j=>{X(`albums/${j}`)})},Kn=g=>{const j=f;j.splice(k+1,0,g.id),x(j),D(`${g.title} playing next.`,ee.SUCCESS)},Qn=g=>{const j=f;j.push(g.id),x(j),D(`${g.title} playing at the end.`,ee.INFO)},Jn=g=>{fetch(`${N}/read-write/deleteTrackFromPlaylist/${le.id}/${g.id}`,{method:"DELETE",credentials:"include"}).then(j=>j.json()).then(j=>{_.current(),D(`${g.title} removed.`,ee.SUCCESS)})},Yn=(g,j)=>{_.current=j,ve(g)},Xn=(g,j)=>{if(re(null),!g)return;const E=new FormData;E.append("current",JSON.stringify(g.current)),E.append("deleted",JSON.stringify(g.deleted)),fetch(`${N}/read-write/changeTrackTags/${j}`,{method:"POST",credentials:"include",body:E}).then(A=>A.json()).then(A=>{D("Tags upated!",ee.SUCCESS)})},Zn=async(g=[],j)=>{g.length!==0&&(x(g),R(j||0),L(!0))},er=()=>{Y(!0)},tr=()=>{Y(!1)},sr=()=>{ft.current=!ft.current,ft.current&&(et.current=Dt.pathname),console.log(et.current),X(ft.current?"/full-screen":et.current&&et.current!=="/full-screen"?et.current:"/home")},nr=()=>new Promise(g=>{fetch(`${N}/read-write/getSongMetaDataCover/${s}`,{method:"GET",credentials:"include"}).then(j=>j.blob()).then(j=>{fs.current={track:s,blob:j},g({track:s,blob:j})})}),rr=g=>{h.current&&(h.current.currentTime+=(g?1:-1)*10)},ar=()=>{const{history:g,pointer:j}=Vt;if(g.every(te=>te===null)){X("/home");return}let E=(j-2+g.length)%g.length,A=g[E],K=0;for(;(!A||A==="/full-screen")&&K<g.length||A===Dt.pathname;)E=(E-1+g.length)%g.length,A=g[E],K++;Vt.pointer=E,X(A||"/home")},or=()=>{(r==null?void 0:r.type)==="radio"&&fetch(`${N}/radio/addToFavs/${r.uuid}`,{method:"POST",credentials:"include"}).then(async g=>({json:await g.json(),ok:g.ok})).then(g=>{D(g.json.message,ee.INFO),console.log(g),g.ok&&M("refetch-known-radios")}).catch(g=>{D("An error occured, you may check server logs."+g.code,ee.ERROR)})},cr=(g,j)=>{var K,te;if(((K=pt.current)==null?void 0:K.track)===s&&((te=pt.current)==null?void 0:te.pairs.length)>0){j();return}const A=new at().getPalette(g.current,10);gs.current=A,ir(A),console.log("recomputed"),console.log(pt.current),j()},ir=g=>{const j=[];for(let E=0;E<g.length;E++)for(let A=E+1;A<g.length;A++)j.push({c1:g[E],c2:g[A],contrast:Sa(g[E],g[A])});pt.current={track:s,pairs:j.sort((E,A)=>E.contrast-A.contrast)}},lr=()=>{window.screen.width<820&&ps(!0)};n.useEffect(()=>{Ht.current&&qt.current&&(Ht.current.style.display=Rt?"none":"flex",qt.current.style.display=Rt?"none":"flex")},[Rt]);const Qt=async(g,j,E)=>{fetch(`${N}/read-write/toggleFavorite/${g}/${j}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{E(A),console.log(r.id,g),r.id===g&&(r.isFav=A)})};return e.jsxs(Zs.Provider,{value:{songRawPalette:gs,currentDisplayedPage:qt,mobileMusicPlayRef:Ht,toggleTrackFavorite:Qt,setTrackMobileView:ps,openTrackMobileView:lr,recomputeColors:cr,songPalette:pt,skipAudioSeconds:rr,toggleCurrentRadioToFavorites:or,externalRadioInfos:He,playRadio:Gn,navigateBack:ar,history:Vt,colorOverride:ln,requestNewFullScreenImage:nr,fullScreenImage:fs.current,toggleFullScreenView:sr,fetchFFTUserSettings:Kt,FFTUserSetingsRef:ms,fftConfigRef:he,getFFTAtCurrentTime:gn,deleteAlbum:Un,editArtist:Mn,playContainer:bn,closeTagWindow:tr,openTagWindow:er,saladContext:fe,setSaladContext:je,playAudioSalad:Zn,linkNewContainer:Yn,trackActionTypes:Oe,onClicTrackActionEntry:zn,openTrackActions:Hn,getNextSongsFromAlbum:vn,currentTrackData:r,currentTime:u,isPlaying:d,toggleTrackPaused:xn,playNextSong:Sn,trackCoverUrl:v,playPreviousSong:yn,playingTrack:s,jumpTrackSeconds:wn,jumpToPercent:Tn,addContainerToQueue:Nn,playContainerSuffle:kn,playQueue:f,queuePointer:k,jumpToQueueTrack:En,deleteQueue:Cn,addArtistToQueue:An,shuffleArtistToQueue:In,playTrackNoQueue:jn,playLibraryShuffle:Fn,setVolume:C,volume:W,editAlbum:Pn,editPlaylist:Ln,createNewPlaylist:_n,globalAudioRef:h,setPlaylistAddedCallback:g=>{Z.current=g}},children:[t,b?b.type==="album"?e.jsx(Ea,{applyCanges:Ss,albumClass:b}):b.type==="playlist"?e.jsx(Es,{closeOverlay:Vn,editPlaylistClass:b,applyCanges:Ss}):null:null,I&&e.jsx(Fa,{applyChanges:On,artist:I}),z&&e.jsx(Es,{closeOverlay:Dn,applyCanges:Bn}),T?e.jsx(Ca,{isFav:(le==null?void 0:le.favPlaylist)||!1,trackY:T.position.y,track:T.track}):null,ge&&e.jsx(Aa,{apply:Xn,track:ge}),B&&e.jsx(Ia,{}),Rt&&e.jsx(Ma,{})]})},ae=()=>{const t=n.useContext(Zs);if(t===void 0)throw new Error("useAudioPlayer must be used within an AudioPlayerProvider");return t},dt=n.memo(({percent:t,text:s=null,showPercent:o=!1,isMarquee:d=!1,fillColor:l="#fffdff",style:r={},initialising:a=!1,initialisingColor:u="white",onClickPercentage:m=null,minWidth:h=0})=>{const c=n.useRef(null),p=f=>{if(a||!m)return;const x=f.currentTarget,v=x.getBoundingClientRect().x,y=f.clientX;m((y-v)/x.clientWidth*100)};return n.useEffect(()=>{c.current&&c.current.style.setProperty("--progress",`${t}%`)},[t]),e.jsxs("div",{className:"progressBar",style:{...r,minWidth:h},onClick:p,children:[e.jsx("div",{className:"progressFill",ref:c,style:{background:l,...r}}),a&&e.jsx("div",{className:"progressFill",init:"init",style:{backgroundColor:u,opacity:.5,...r}}),o&&e.jsx("span",{className:"progressPercent",children:t+"%"}),s&&e.jsx("span",{className:"progressPercent",style:{margin:"auto"},children:s})]})},(t,s)=>t.text===s.text&&t.initialising===s.initialising&&t.percent===s.percent),en=({})=>{const{currentTrackData:t,currentTime:s,jumpToPercent:o}=ae();return!t||Object.keys(t).length===0?null:e.jsx("div",{className:"songProgress",children:e.jsxs("div",{children:[e.jsx("span",{id:"time-elapsed",children:cs(s).readable}),e.jsx(dt,{percent:s/t.rawDuration*100,showPercent:!1,fillColor:"var(--violet-web-color)",style:{height:"10px"},onClickPercentage:o}),e.jsx("span",{id:"time-remaining",children:t.duration.readable})]})})},Ba=n.memo(({id:t,isActive:s,setActive:o,contextName:d})=>e.jsx("div",{className:"index",id:`${d}-index_${t}`,onClick:()=>o(t),"data-active":s?"active":"","data-clickable":!!o}),(t,s)=>t.id===s.id&&t.isActive===s.isActive&&t.contextName===s.contextName),is=({context:t,active:s,setActive:o})=>e.jsx("div",{className:`activeIndex-container ${t.name}`,children:Array.from({length:t.length},(d,l)=>e.jsx(Ba,{id:l,isActive:s===l,setActive:o,contextName:t.name},l))}),tn=n.memo(function({currentActive:s,onClick:o,data:d}){const[l,r]=n.useState(s);n.useEffect(()=>{r(s)},[s]);const a=u=>{r(u),o==null||o(u)};return e.jsx("div",{className:"job-view-div",children:d.map((u,m)=>e.jsx("div",{className:"cornered-button","data-active":l===m,onClick:()=>{a(m)},children:u},m))})}),Ga=({fromFile:t,setFromFile:s,tracksSelected:o,initMetadataFetching:d})=>{const[l,r]=n.useState(!1),[a,u]=n.useState(""),m=c=>{r(!0),c.target.files&&(console.log("New tracks"),o(Array.from(c.target.files)),c.target.files=null)},h=c=>{u(c.target.value)};return e.jsxs("div",{className:"addMusicSource",children:[e.jsxs("div",{className:"add-audio-source-selection",children:[e.jsx("p",{children:"Select the source: "}),e.jsx(tn,{currentActive:t?0:1,onClick:c=>{s(c==0)},data:["From file","From URL"]})]}),t?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Select files from a local storage."}),e.jsxs("div",{className:"add-music-input",children:[e.jsxs("label",{htmlFor:"files",className:"file-select",children:[e.jsx(Ir,{}),e.jsx("span",{children:"Select file"})]}),e.jsx("input",{id:"files",multiple:!0,type:"file",accept:"audio/*",onChange:m})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Link to a radio steam."}),e.jsxs("div",{className:"add-music-input",children:[e.jsx("input",{type:"text",placeholder:"Enter URL",onChange:h}),e.jsx(oe,{onClick:async()=>{d(a)},text:"Resolve",icon:e.jsx(Fr,{})})]})]}),l&&e.jsx("p",{children:"Hold a sec'.. The metadata fetch is about to beggin."})]})},Nt=({text:t,progressBar:s={useProgressBar:!1}})=>e.jsxs("div",{className:"loading-container",children:[e.jsx("h3",{children:t}),s.useProgressBar?e.jsx(dt,{percent:s.percent,showPercent:s.showPercent,isMarquee:s.isMarquee,fillColor:s.fillColor,style:{height:"25px"}}):e.jsx("p",{children:"Loading..."})]}),Da=({addNewMusic:t})=>e.jsx("div",{className:"album-card",context:"add",children:e.jsx(Pr,{strokeWidth:.7,className:"album-card-cover",onClick:t})}),Va=({album:t,deleteAlbum:s,editAlbum:o})=>e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(it,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t.uuid)}),e.jsx(_s,{className:"album-card-overview-button",use:"edit",onClick:()=>o(t.uuid)}),e.jsxs("div",{className:"album-card-overview-button",use:"song-count",children:[e.jsx(Lr,{className:"song-count-icon"}),e.jsx("span",{children:t.tracks.length})]}),e.jsx("img",{src:t.coverURL,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Ye(t.name,25)}),e.jsx("p",{className:"album-artist",children:Ye(t.artist.join(","),25)||"No artist"})]}),Ha=({radio:t,deleteRadio:s})=>(console.log(t),e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(it,{className:"album-card-overview-button",use:"delete",onClick:()=>s(t[0])}),e.jsx("img",{src:t[1].favicon==""?null:t[1].favicon,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Ye(t[1].name,25)})]})),qa=({albums:t,radios:s,deleteRadio:o,addNewMusic:d,deleteAlbum:l,editAlbum:r,publish:a})=>{const u=t.map((c,p)=>e.jsx(Va,{album:c,deleteAlbum:l,editAlbum:r},`alb-${p}`)),m=[...s].map((c,p)=>e.jsx(Ha,{radio:c,deleteRadio:o},`rad-${p}`)),h=[...u,...m];return console.log("rerun"),h.push(e.jsx(Da,{addNewMusic:d},-1)),e.jsxs("div",{className:"albums-overview",children:[e.jsx("div",{className:"album-overview-container",children:h.reverse()}),(t.length>0||s.size>0)&&e.jsx("button",{className:"roundButton",id:"publish-to-library",onClick:a,children:"Publish to library"})]})},za=({track:t,onClose:s})=>{const{albums:o,moveTrackToNewAlbum:d,moveTrackToAlbum:l,editingAlbum:r,setEditingAlbum:a}=Ja(),[u,m]=n.useState(""),[h,c]=n.useState(!1),p=n.useRef(null),f=v=>{v.preventDefault(),!u&&v.target.existingAlbum.value?l(t,v.target.existingAlbum.value):u!==""&&d(t,u),h&&a(null),s()},x=v=>{m(v.target.value)};return n.useEffect(()=>{o.find(({uuid:y})=>y===r).tracks.length===1?c(!0):c(!1);const v=y=>{var O;if(p.current&&!p.current.contains(y.target)){if(((O=y.target.closest("svg"))==null?void 0:O.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",v),document.addEventListener("touchstart",v),()=>{document.removeEventListener("mousedown",v),document.removeEventListener("touchstart",v)}},[]),e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:p,children:[e.jsx("h2",{children:"Move track to another album"}),h&&e.jsx("p",{className:"last-track-notify",children:"Last track of the album, if you move it, the current album will be deleted."}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:f,children:[e.jsx("label",{htmlFor:"newAlbum",children:"New album name"}),e.jsx("input",{type:"text",id:"newAlbum",placeholder:"Enter album name",onChange:x}),e.jsx("label",{htmlFor:"existingAlbum",children:"Existing album"}),e.jsx("select",{id:"existingAlbum",onChange:()=>m(""),children:o.map((v,y)=>v.uuid===r?null:e.jsx("option",{value:v.uuid,children:v.name},y))}),e.jsx("input",{type:"submit",value:"Submit"})]})]})})},Wa=({setEditUid:t,albumClass:s})=>{var c,p;const[o,d]=n.useState({visible:!1,track:null}),[l,r]=n.useState(null),a=n.useRef(null);if(!s)return null;n.useEffect(()=>{s&&r(s.coverURL)},[s]);const u=()=>{const f=a.current;s.name=f.albumName.value,s.artist=f.artistName.value.split(",").map(v=>v.trim()),s.year=f.releaseDate.value;const x=f.genre.value.split(",").map(v=>v.trim()).map(v=>v.charAt(0).toUpperCase()+v.slice(1));s.genre=x.filter(v=>v!=""),s.description=f.description.value,t(null)},m=f=>{const x=f.target.files[0];x&&r(s.setCoverFromFile(x))},h=f=>{d({visible:!o.visible,track:f})};return e.jsxs("div",{className:"albumWrapping",children:[e.jsxs("div",{className:"albumCover",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(ne,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(kt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:m})]}),e.jsx("button",{className:"roundButton go-back",onClick:()=>u(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",ref:a,children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(c=s.artist)==null?void 0:c.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",defaultValue:s.year})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(p=s.genre)==null?void 0:p.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Ie,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:f,style:x})=>e.jsxs("div",{style:x,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[f].title}),e.jsx($s,{className:"trackIcon",onClick:()=>{h(s.tracks[f])}})]},f)})})]}),o.visible&&e.jsx(za,{onClose:()=>{d({visible:!1})},track:o.track})]})};class Is{constructor(s,o,d,l,r){this.name=s,this.artist=o,this.year=d,this.tracks=[],this.setCover(l),this.uuid=r}setCover(s){!s||this.coverURL||(this.coverData=s.data,this.coverMime=s.format,this.coverURL=URL.createObjectURL(new Blob([this.coverData],{type:this.coverMime})),this.ext=this.coverMime.split("/")[1],this.sourceIsBinary=!0)}setCoverFromFile(s){return this.coverURL=URL.createObjectURL(s),this.coverFile=s,console.log("Setting cover from file: ",s),this.ext=s.type.split("/")[1],this.coverURL}addTrack(s){s&&(this.tracks.push(s),s.album=this)}removeTrack(s){s&&(this.tracks=this.tracks.filter(o=>o.id!==s.id),s.album=null)}getPuredData(){return{name:this.name,artists:this.artist,year:this.year,uuid:this.uuid,ext:this.ext}}getPuredCover(){if(!this.sourceIsBinary)return this.coverFile?(console.log("Using file reference for cover: "+album.coverFile),this.coverFile):null;if(console.log("Using binary reference for cover: ",this.uuid),!this.coverData||this.coverData.length===0)return console.log("returned no cover at",this.uuid),null;const s=new Uint8Array(this.coverData),o=new Blob([s],{type:this.coverMime});return new File([o],`${this.uuid}.${this.coverMime.split("/").pop()}`,{type:this.coverMime})}}class Ka{constructor(s){this.id=bt(),this.file=s,this.album=null,this.albumName="",this.artists=[],this.title=s.name,this.no=1,this.duration=0,this.year=2003,this.picture=null}setPicture(s){this.picture=s}setAdditionalData(s="",o="",d=1,l=0,r=2e3,a=[]){this.title=o,this.no=d,this.duration=l,this.year=r,this.artists=a,this.albumName=s}setAlbum(s){this.album=s}getUrl(){return URL.createObjectURL(this.file)}getArtists(){return this.artists?this.artists.map(s=>s.trim()):["Unknown artist"]}getPuredTrackMeta(){return{albumUuid:this.album.uuid,duration:this.duration,no:this.no,year:this.year,title:this.title,id:this.id}}}const sn=n.createContext(),Qa=({closeOverlay:t,uploadPercent:s,uploadProgress:o,uploadFinished:d,isMinimize:l,setMinimized:r})=>{const[a,u]=n.useState(!0),[m,h]=n.useState(0),[c,p]=n.useState(0),[f,x]=n.useState(0),[v,y]=n.useState([]),[O,k]=n.useState(!1),[R,U]=n.useState(null),[P,b]=n.useState(0),[F,I]=n.useState(0),[S,M]=n.useState(""),{addNotification:J,notifTypes:_}=Fe(),[T,V]=n.useState(new Map),G=n.useRef([]),D=n.useRef([]),{emit:ee}=xe(),X=n.useRef(null),le=async C=>{if(C.length===0)return;x(C.length);const z=C.map(w=>new Ka(w));X.current=z,ve()},ve=async()=>{const C=await fe(),z=C.length>0?X.current.filter(w=>!C.includes(w.id)):X.current;console.log("Valid new tracks",z),G.current=[...G.current,...z],X.current=null,re()},ge=()=>{D.current=D.current.filter(C=>C.tracks.length>0),k(!0),y(D.current)};n.useEffect(()=>{console.log("New albums ",v),!O&&(p(0),h(2))},[v]);const re=()=>{function C(z){return D.current.find(w=>w.name===z)}for(const z of G.current){const w=C(z.albumName);if(w)w.addTrack(z);else{const B=bt(),Y=new Is(z.albumName,z.getArtists(),z.year,z.picture,B);D.current.push(Y),Y.addTrack(z)}}y(D.current)},fe=async(C="")=>{if(!a){if(!C)return;console.log("Fetching meta at source",C);const w=await fetch(`${N}/radio/metadata/${encodeURIComponent(C)}`,{method:"GET"}).then(Z=>Z.json());if(w)J("Radio found! "+w[0].name,_.INFO);else{J("No radio found..",_.ERROR);return}const B=w[0];console.log(B);const Y=T;Y.set(B.stationuuid,{url:B.url_resolved,favicon:B.favicon,name:B.name}),V(Y),h(2);return}h(1);const z=[];return await Promise.all(X.current.map(async w=>{var Y,Z,de;const B=await ga(w.file).catch(q=>{console.error("error at",file,q),J(`Track ${w.title} seems corrupted, retry without it.`,_.ERROR)});if(!B){z.push(w.id);return}w.setAdditionalData(B.common.album||B.common.title,B.common.title||w.file.name,((Y=B.common.track)==null?void 0:Y.no)||0,B.format.duration||0,B.common.year,B.common.artists.map(q=>q.split(",")).flat(1).map(q=>q.trim())),w.setPicture((de=(Z=B.common)==null?void 0:Z.picture)==null?void 0:de[0]),p(q=>q+1)})),z},je=C=>{const z=new Map([...T].filter(([w,B])=>w!=C));V(z)},H=C=>{G.current=G.current.filter(z=>z.album.uuid!==C),console.log("Deleted album, remaining tracks",G.current),D.current=D.current.filter(z=>z.uuid!==C),k(!1),y(D.current)},$=C=>{U(C)};n.useEffect(()=>{if(R===null||v.length===0){h(2);return}h(3)},[R]);const se=(C,z)=>{const w=bt();console.log("Moving track: "+C.id+NaN+R+" to album: "+w),C.album.removeTrack(C);const B=new Is(z,C.getArtists(),C.year,C.picture,z);D.current.push(B),B.addTrack(C),ge(),J(`Track ${C.title.substring(0,60)} got moved to album ${z}.`,_.INFO)},pe=(C,z)=>{console.log("Moving track: "+C.id+NaN+R+" to album: "+z),C.album.removeTrack(C);const w=D.current.find(B=>B.uuid===z);w.addTrack(C),ge(),J(`Track ${C.title.substring(0,60)} got moved to album ${w.name}.`,_.INFO)},ce=async()=>{if(console.log("Publishing tracks: ",G.current),console.log("Publishing radios: ",T),T.keys().forEach(async C=>{const z=new FormData;console.log(T.get(C)),z.append("radioData",JSON.stringify({uuid:C,...T.get(C)}));const w=await fetch(`${N}/radio/newRadio`,{method:"POST",credentials:"include",body:z}).then(B=>B.json());console.log(w)}),G.current.length>0){h(4);for(const w of D.current){let B=new FormData;B.append("album",JSON.stringify(w.getPuredData()));const Y=w.getPuredCover();Y&&B.append("cover",Y);const Z=await fetch(`${N}/read-write/upload`,{method:"POST",body:B,credentials:"include"});if(!Z.ok)throw console.error("Error uploading albums:",Z.statusText),new Error("Error uploading albums");B=null,console.log("Album uploaded: "+w.name)}D.current.forEach(w=>{w.coverURL&&(URL.revokeObjectURL(w.coverURL),w.coverURL=null)});let C=G.current.reduce((w,B)=>w+B.file.size,0);b((C/1024/1024).toFixed(1));let z=0;for(const w of G.current){let B=new FormData;B.append("trackMeta",JSON.stringify(w.getPuredTrackMeta())),B.append("music",w.file),M(w.title),o({done:z,total:G.current.length}),await xa({method:"POST",data:B,withCredentials:!0,url:"/upload",baseURL:`${N}/read-write`,onUploadProgress:Y=>{const{total:Z,loaded:de}=Y,q=Z/1e6,ye=de/1e6;s(ye/q);const _e=ye/q*100;I(_e.toFixed(2))}}).catch(Y=>{console.error("Error uploading track:",Y)}).finally(()=>{z++}),B=null}}console.log("Upload finished"),d(),setTimeout(()=>{D.current=null,G.current=null,p(0),y([]);const C=T;C.clear(),V(C),h(0),U(null),I(0),ee("musicUploaded")},750)},L=()=>{if(m!==4){t();return}r(!0)},W=()=>{switch(m){case 0:return e.jsx(Ga,{fromFile:a,setFromFile:u,tracksSelected:le,initMetadataFetching:fe});case 1:return e.jsx(Nt,{text:`Fetching metadatas.. ${f?c+"/"+f:"-/-"}`});case 2:return e.jsx(qa,{albums:v,addNewMusic:()=>h(0),deleteAlbum:H,editAlbum:$,publish:ce,radios:T,deleteRadio:je});case 3:return e.jsx(Wa,{setEditUid:U,albumClass:v.find(C=>C.uuid===R)});case 4:return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(Nt,{text:`Publishing ${S} ${P}Mb..`,progressBar:{useProgressBar:!0,showPercent:!0,isMarquee:!1,percent:Number(F),fillColor:"var(--cool-green)"}}),e.jsx("p",{children:"You can close this overlay, the upload will continue. :)"})]});default:return e.jsx("div",{className:"addMusicSource",children:e.jsx("p",{children:"Not implemented yet"})})}};return e.jsx("div",{className:"addMusicRoot","data-minimized":l,children:e.jsx("div",{className:"addMusicContainer",children:e.jsxs(sn.Provider,{value:{albums:v,moveTrackToNewAlbum:se,editingAlbum:R,moveTrackToAlbum:pe,setEditingAlbum:U},children:[e.jsx(be,{className:"buttonRound closeOverlay",onClick:L}),e.jsx("h2",{children:"Add Music"}),e.jsx(is,{context:{name:"AddMusic",length:5},active:m,setActive:h}),e.jsx(W,{})]})})})},Ja=()=>n.useContext(sn),Ya=50,Xa=({hideComponent:t})=>{const{playQueue:s,deleteQueue:o,jumpToQueueTrack:d,queuePointer:l}=ae(),r=n.useRef(null),{subscribe:a}=xe(),u=n.useRef(new Map),[m,h]=n.useState(0);n.useEffect(()=>{const p=x=>{var v;if(r.current&&!r.current.contains(x.target)){if(((v=x.target.closest("svg"))==null?void 0:v.id)==="playlist-button")return;t()}},f=a("action-bar-open",()=>{t()});return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{f(),document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[]),n.useEffect(()=>{var p;h(((p=r.current)==null?void 0:p.offsetHeight)||0)},[r.current]);const c=p=>{p.stopPropagation(),p.preventDefault()};return e.jsxs("div",{className:"music-queue",ref:r,onTouchMove:c,children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Music Queue"}),s.length>0&&e.jsx(it,{className:"buttonRound",id:"queue-trash",onClick:o})]}),s.length>0?e.jsx(Ie,{height:m,itemCount:s.length,itemSize:Ya,width:"100%",itemData:{playQueue:s,cacheRef:u,jumpToQueueTrack:d,queuePointer:l},children:Xs}):e.jsx("p",{children:"No items in the queue"})]})},Za=n.memo(({payload:t})=>{const[s,o]=n.useState(!1);return e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Open a song's dropdown"}),e.jsxs("div",{id:"tuto-0-cooking-container",children:[e.jsx(ne,{className:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-cooking-songs-container",children:[e.jsxs("div",{className:"tuto-cooking-0-song-skeleton","data-target":!0,children:[e.jsx(ns,{id:"tuto-cooking-dots",onClick:()=>{o(!s)}}),s&&e.jsxs("div",{id:"tuto-0-cooking-dropdown",children:[e.jsxs("div",{className:"tuto-cooking-0-action-skeleton track-action-entry","data-target":"true",onClick:()=>{t(1)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(yt,{})]}),e.jsx("div",{className:"tuto-cooking-0-action-skeleton"})]})]}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"})]})]})]})}),eo=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Here you can remove and add tags:"}),e.jsxs("div",{id:"tuto-tags-1",children:[e.jsxs("div",{className:"tuto-search-skeleton",children:[e.jsx(Me,{}),e.jsx("span",{id:"animated-write-span",children:"140BPM, roses, gaming, 2010s"}),e.jsx("div",{className:"blinking-cursor"})]}),e.jsxs("div",{id:"tuto-tags",children:[e.jsxs("div",{className:"small-tag",children:["Evening",e.jsx(be,{})]}),e.jsxs("div",{className:"small-tag",children:["Chill",e.jsx(be,{})]}),e.jsxs("div",{className:"small-tag",children:["Friends",e.jsx(be,{})]}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:"Got it!"})]})]})]})),to=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Cooking lets you play all the tracks mataching the tags:"}),e.jsx("div",{id:"tuto-tags-salad",children:e.jsxs("div",{id:"tuto-tags",children:[e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#a79cf5"}})]})}),e.jsxs("div",{id:"tuto-song-list",children:[e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}})}),e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})}),e.jsxs("div",{className:"tuto-tag-song-skeleton",children:[e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})]})]}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]})),so=[Za,eo,to],no=n.memo(()=>{const{onTutoialFinished:t}=St(),[s,o]=n.useState(0),d=so[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{t(we.COOKING)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Manage tags and cook salads"}),e.jsx(is,{context:{name:"tutorial",length:3},active:s,setActive:o}),e.jsx(d,{payload:r[s]})]})}),ro=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Pick an album:"}),e.jsxs("div",{id:"tuto-genre-albums-container",children:[e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(ne,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]}),e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{t(1)},children:[e.jsx(ne,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]})]})]})),ao=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Edit the desired album:"}),e.jsxs("div",{id:"tuto-genre-0-lib",children:[e.jsx(ne,{id:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsxs("div",{id:"tuto-genre-0-header",children:[e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"tuto-target",onClick:()=>{t(2)},children:e.jsx(rs,{})})]}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"})]})]})]})),oo=n.memo(({payload:t})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Change the genre:"}),e.jsxs("div",{id:"tuto-genre-1-lib",children:[e.jsxs("div",{id:"tuto-genre-1-logo-btn",children:[e.jsx(ne,{id:"tuto-genre-logo"}),e.jsx("button",{className:"tuto-target",onClick:t,children:"Got it!"})]}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton","data-target":!0,children:e.jsx("span",{children:"Genre"})}),e.jsxs("div",{className:"tuto-genre-1-input-skeleton tuto-target","data-target":!0,children:[e.jsx("span",{id:"animated-write-span",children:"Rock, Breakcore, Soundtrack, .."}),e.jsx("div",{className:"blinking-cursor"})]})]})]})]})),co=[ro,ao,oo],io=n.memo(()=>{const{onTutoialFinished:t}=St(),[s,o]=n.useState(0),d=co[s]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{t(we.GENRES)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Add genre to albums"}),e.jsx(is,{context:{name:"tutorial",length:3},active:s,setActive:o}),e.jsx(d,{payload:r[s]})]})}),we={GENRES:"genres",COOKING:"cooking"},ls=new Map;ls.set(we.GENRES,io);ls.set(we.COOKING,no);const nn=({tutorialKey:t=we.GENRES})=>{const s=ls.get(t)??(()=>e.jsx("div",{children:"Not found"}));return e.jsx("div",{className:"page-overlay-blur",children:e.jsx(s,{})})},rn=n.createContext(),Q={SEARCH:"search",OPEN_ACTION_BAR:"open_action_bar",CLOSE_ACTION_BAR:"close_action_bar",PLAY_SONG:"play_song",OPEN_ALBUM:"open_album",OPEN_ARTIST:"open_artist",PLAY_LIBRARY_RANDOM:"play_library_random",TOGGLE_PLAY_PAUSE:"toggle_play_pause",OPEN_SETTINGS:"open_settings",VOLUME_UP:"volume_up",VOLUME_DOWN:"volume_down",OPEN_GENRE:"open_genre",TOGGLE_FULL_SCREEN:"toggle_full_screen",SKIP_PLUS:"skip_plus",SKIP_MINUS:"skip_minus"},Ge=[{name:"Search",code:Q.SEARCH,description:"Search for a song, an album, a genra, an artist",key:"k",modifier:"ctrl",keywords:["search","find","look for","seek","search for","find for","look for for","seek for"],icon:()=>e.jsx(Me,{className:"action-bar-current-logo"})},{name:"open action bar",code:Q.OPEN_ACTION_BAR,description:"Give a command",key:" ",modifier:"ctrl",keywords:[]},{name:"Play the library in shuffle",code:Q.PLAY_LIBRARY_RANDOM,description:"",key:"r",modifier:"ctrl",keywords:["play","shuffle","random","library","all","all songs","all albums","all artists"],icon:()=>e.jsx(lt,{className:"action-bar-current-logo"})},{name:"Toggle Play pause",code:Q.TOGGLE_PLAY_PAUSE,description:"",key:" ",modifier:"",icon:()=>e.jsx(lt,{className:"action-bar-current-logo"})},{name:"Open settings",code:Q.OPEN_SETTINGS,description:"",key:"p",modifier:"ctrl",keywords:["settings","configuration","config","preferences","options"],icon:()=>e.jsx($r,{className:"action-bar-current-logo"})},{name:"Volume up",code:Q.VOLUME_UP,description:"",key:"ArrowUp",modifier:"",keywords:[],icon:()=>{}},{name:"Volume down",code:Q.VOLUME_DOWN,description:"",key:"ArrowDown",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:Q.SKIP_PLUS,description:"",key:"ArrowRight",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:Q.SKIP_MINUS,description:"",key:"ArrowLeft",modifier:"",keywords:[],icon:()=>{}},{name:"Toggle color theme",code:Q.TOGGLE_THEME,description:"Toggles the app dark or light theme.",key:"t",modifier:"ctrl",keywords:["dark","light","color","theme","color-theme","toggle"],icon:()=>e.jsx(Ds,{className:"action-bar-current-logo"})},{name:"Toggle full screen",code:Q.TOGGLE_FULL_SCREEN,description:"Toggles the full screen mode.",key:"",modifier:"",keywords:["bars","wallpaper","full-screen","fft","spectrum","toggle"],icon:()=>e.jsx(Vs,{className:"action-bar-current-logo"})}],lo=new zs(Ge,{keys:["keywords"],threshold:.3}),Te={DARK:"dark",LIGHT:"light"},uo=({children:t})=>{const s=n.useRef([]),[o,d]=n.useState(!1),l=n.useRef(o),[r,a]=n.useState(null),[u,m]=n.useState(!1),[h,c]=n.useState(null),[p,f]=n.useState(""),[x,v]=n.useState([]),[y,O]=n.useState(null),{playTrackNoQueue:k,playLibraryShuffle:R,toggleTrackPaused:U,setVolume:P,volume:b,toggleFullScreenView:F,skipAudioSeconds:I}=ae(),S=n.useRef(b),M=me(),J=Ve(),_=n.useRef(null),T=n.useRef(null),{addNotification:V,notifTypes:G}=Fe(),[D,ee]=n.useState(()=>{const w=localStorage.getItem("CML_theme");return w?w===Te.LIGHT?(document.documentElement.classList.remove("dark"),Te.LIGHT):(document.documentElement.classList.add("dark"),Te.DARK):(localStorage.setItem("CML_theme",Te.LIGHT),Te.LIGHT)}),{emit:X,subscribe:le}=xe();n.useEffect(()=>{window.addEventListener("keydown",ge),H();const w=B=>{_.current&&!_.current.contains(B.target)&&C()};return document.addEventListener("mousedown",w),document.addEventListener("touchstart",w),()=>{document.removeEventListener("mousedown",w),document.removeEventListener("touchstart",w),window.removeEventListener("keydown",ge),s.current=[]}},[]),n.useEffect(()=>{var w;h&&f(((w=h.description)==null?void 0:w.toString())||"")},[h]);const ve=w=>{const B=localStorage.getItem("CML_FinishedTutorials"),Y=B?JSON.parse(B):{state:{}};Y.state[w]=!0,localStorage.setItem("CML_FinishedTutorials",JSON.stringify(Y)),X(`safe-finished-tutorial-${w}`)},ge=w=>{if(w.key=="Escape"&&l.current){C();return}if(w.key=="Escape"&&J.pathname==="/full-screen"){F();return}if(w.key=="Control"||h||!(w.ctrlKey||w.altKey||w.metaKey)&&(document.activeElement.nodeName==="INPUT"||document.activeElement.nodeName==="TEXTAREA"))return;const B=Ge.find(Y=>w.key===Y.key?!Y.modifier||Y.modifier===""?!0:{ctrl:w.ctrlKey,shift:w.shiftKey,alt:w.altKey,meta:w.metaKey}[Y.modifier]:!1);B&&(c(B),s.current.forEach(Y=>{Y.code===B.code&&(Y.callback(w),w.preventDefault())}))},re=(w,B)=>{const Y={callback:w,code:B};s.current.push(Y)},fe=n.useRef(U);fe.current=U;const je=()=>{Ue(()=>{d(!0),a(null),v($()),T.current="command",c(Ge[1])},J.pathname)()};n.useEffect(()=>{S.current=b,V(`Volume : ${(b*100).toFixed(0)} %`,G.INFO)},[b]);const H=()=>{re(()=>{if(T.current==="command"){C();return}je()},Q.OPEN_ACTION_BAR),re(()=>{C()},Q.CLOSE_ACTION_BAR),re(()=>{if(T.current==="search"){C();return}d(!0),a(Q.SEARCH),T.current="search"},Q.SEARCH),re(()=>{fe.current()},Q.TOGGLE_PLAY_PAUSE),re(()=>{M("/settings")},Q.OPEN_SETTINGS),re(()=>{P(Math.min(Math.max(S.current+.1,0),1))},Q.VOLUME_UP),re(()=>{P(Math.min(Math.max(S.current-.1,0),1))},Q.VOLUME_DOWN),re(()=>{I(!0)},Q.SKIP_PLUS),re(()=>{I(!1)},Q.SKIP_MINUS)};n.useEffect(()=>{o&&document.getElementById("actionbar-searchbar").focus(),l.current=o},[o]),n.useEffect(()=>{switch(r){case Q.SEARCH:m(!0),O(()=>e.jsx("div",{className:"action-bar-logo-container",children:e.jsx(Me,{className:"action-bar-current-logo"})}));break;default:m(!0),O(null)}},[r]);const $=()=>[Ge[0],Ge[2],Ge[4]],se=w=>{var Z;const B=w.target.value;if(B===""){v($());return}if(r===Q.SEARCH){ce(B);return}const Y=(Z=lo.search(B))==null?void 0:Z.map(de=>de.item).filter(de=>{var q;return((q=de.keywords)==null?void 0:q.length)>0});v(Y)},pe=w=>{switch(w){case"track":return e.jsx(ss,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View album"})," ",e.jsx(Jt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View artist"})," ",e.jsx(Jt,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View genre"})," ",e.jsx(Jt,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},ce=async w=>{w===""||w.trim().length===0||fetch(`${N}/read-write/search/${w}`,{method:"GET",credentials:"include"}).then(B=>{if(B.ok)return B.json();throw new Error("Error fetching search results")}).then(B=>{const Y=[...B.tracks.map(Z=>({type:"track",...Z})),...B.albums.map(Z=>({type:"album",...Z})),...B.artists.map(Z=>({type:"artist",...Z})),...B.genres.map(Z=>({type:"genre",...Z}))].map(Z=>{const de=Z.path,q=Z.id,{trackPath:ye,..._e}=Z;return{icon:()=>de?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${Z.type==="artist"?"artist":"covers"}/${de}`,alt:Z.name}):e.jsx(ne,{className:"action-bar-entry-logo"}),tooltip:pe,code:Z.type==="artist"?Q.OPEN_ARTIST:Z.type==="album"?Q.OPEN_ALBUM:Z.type==="genre"?Q.OPEN_GENRE:Q.PLAY_SONG,fileName:de,trackName:q,..._e}});v(Y)})},L=w=>{switch(w.code){case Q.SEARCH:d(!0),a(Q.SEARCH),c(Ge[0]),T.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),v([]);break;case Q.CLOSE_ACTION_BAR:C();break;case Q.PLAY_SONG:console.log("Playing song",w),k(w.trackName),C();break;case Q.OPEN_ALBUM:C(),M(`/albums/${w.id}`);break;case Q.OPEN_ARTIST:C(),M(`/artists/${w.id}`);break;case Q.OPEN_GENRE:console.log("Opening genre",w),C(),M(`/genres/${w.id}`);break;case Q.PLAY_LIBRARY_RANDOM:R(),C();break;case Q.OPEN_SETTINGS:C(),M("/settings");break;case Q.TOGGLE_THEME:W(),C();break;case Q.TOGGLE_FULL_SCREEN:F(),C();break}},W=()=>{D===Te.DARK?(document.documentElement.classList.remove("dark"),localStorage.setItem("CML_theme",Te.LIGHT)):(document.documentElement.classList.add("dark"),localStorage.setItem("CML_theme",Te.DARK)),ee(D===Te.DARK?Te.LIGHT:Te.DARK)},C=()=>{d(!1),a(null),T.current=null,v([])},z=()=>{d(!0),a(Q.SEARCH),c(Ge[0]),T.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),v([])};return n.useEffect(()=>{o&&X("action-bar-open")},[o]),e.jsx(rn.Provider,{value:{commandCodes:Q,openCommandBar:je,openSearchBar:z,colorTheme:D,toggleColorTheme:W,onTutoialFinished:ve},children:e.jsxs("div",{className:"action-bar-app-parent",children:[t,o&&e.jsx("div",{className:"global-action-bar",children:e.jsx("div",{className:"action-bar",ref:_,"data-search-mode":r===Q.SEARCH,children:e.jsxs("div",{className:"action-bar-research",children:[y||null,e.jsx("input",{type:"text",id:"actionbar-searchbar",className:"searchbar",onChange:se,placeholder:p}),e.jsx("div",{className:"action-bar-results",children:e.jsx(Ie,{height:300,itemCount:x.length,itemSize:50,width:"calc(100% - 0px)",children:({index:w,style:B})=>e.jsx(ut,{entry:x[w],style:B,onClick:L,className:"from-global-bar"},w)})})]})})})]})})},St=()=>{const t=n.useContext(rn);if(!t)throw new Error("useGlobalActionBar must be used within a GlobalActionBar provider");return t},mo=({onClosed:t,hideComponent:s})=>{const{setVolume:o,volume:d}=ae(),l=n.useRef(null),{subscribe:r}=xe();return n.useEffect(()=>{const a=m=>{var h;if(l.current&&!l.current.contains(m.target)){if(((h=m.target.closest("svg"))==null?void 0:h.id)==="volume-button")return;s()}},u=r("action-bar-open",()=>{s()});return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),()=>{u(),document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[]),e.jsx("div",{ref:l,className:"volume-bar",children:e.jsx(dt,{onClickPercentage:a=>{console.log("change volume"),o(a/100)},style:{height:"10px"},fillColor:"rgb(118, 173, 206)",percent:d*100})})},ho=({percent:t,size:s=120,strokeWidth:o=10,useText:d=!0,style:l,color:r="rgb(130, 119, 196)"})=>{const a=(s-o)/2,u=2*Math.PI*a,m=u*(1-t);return e.jsxs("div",{className:"radial-container",style:{width:s,height:s,...l},children:[e.jsxs("svg",{width:s,height:s,children:[e.jsx("circle",{className:"radial-bg",stroke:"#e6e6e6",strokeWidth:o,fill:"none",cx:s/2,cy:s/2,r:a}),e.jsx("circle",{className:"radial-progress",stroke:r,strokeWidth:o,fill:"none",cx:s/2,cy:s/2,r:a,strokeDasharray:u,strokeDashoffset:m})]}),e.jsx("div",{className:"radial-label",children:d&&e.jsxs("span",{children:[Math.round(t),"%"]})})]})},fo=({fps:t=45})=>{const s=n.useRef(),o=n.useRef(null),{getFFTAtCurrentTime:d,fftConfigRef:l,globalAudioRef:r,FFTUserSetingsRef:a,fetchFFTUserSettings:u,colorOverride:m,currentTrackData:h}=ae(),c=n.useRef(0),p=n.useRef(!1),f=x=>{var y;if((h==null?void 0:h.type)=="radio"||p.current){cancelAnimationFrame(s.current);return}if(!o.current){s.current=requestAnimationFrame(f);return}const v=o.current.getContext("2d");if(v&&a.current){if(x-c.current<1e3/t){s.current=requestAnimationFrame(f);return}c.current=x;const O=5;v.clearRect(0,0,o.current.width,o.current.height);const k=d();if(!k){s.current=requestAnimationFrame(f);return}let R=k.subarray(Math.floor(k.length*.3),Math.floor(k.length*.6));const U=Math.max(1,R.length/O),P=new Array(O);P.fill(0);for(let I=0;I<R.length;I++)P[Math.floor(I/U)]+=Number(k[I]);let b=o.current.width/O-5,F=0;v.strokeStyle="#ffffff",v.fillStyle="#ffffff";for(let I=0;I<P.length;I++){const S=ba(Math.log2(P[I])*(O/5),5,25,0,1),M=Math.max(10,Math.min(80*S*((y=r.current)==null?void 0:y.volume),o.current.height-10));v.beginPath(),v.roundRect(2+F,(o.current.height-M)/2,b,M,7),v.fill(),v.stroke(),F+=b+5}}s.current=requestAnimationFrame(f)};return n.useEffect(()=>{if(!l.current){cancelAnimationFrame(s.current),console.log("No FFT data to display, releasing anim frame.");return}s.current=requestAnimationFrame(f),console.log("FFT found, requested animation frame.")},[l.current]),n.useEffect(()=>{const x=window.matchMedia("(max-width: 820px)"),v=y=>{p.current=y.matches,s.current=requestAnimationFrame(f),console.log("Canvas hidden?",p.current)};return v(x),x.addEventListener("change",v),()=>{x.removeEventListener("change",v)}},[]),e.jsx("canvas",{ref:o,id:"fft-canvas-small",className:"in-song-header",width:50,height:50})},Mt=({useText:t=!1,style:s={},className:o=""})=>{const d=n.useRef(null),{colorTheme:l,toggleColorTheme:r}=St();return n.useEffect(()=>{d.current.setAttribute("data-color-theme",l)},[l]),e.jsxs("div",{style:s,className:`color-theme-btn ${o}`,children:[e.jsx(Ds,{id:"color-theme-svg",ref:d,className:"buttonRound",onClick:r}),t&&e.jsx("span",{children:ka(l.toString())})]})},Bt=()=>{const[t,s]=n.useState(!1),[o,d]=n.useState(!1),[l,r]=n.useState(!1),[a,u]=n.useState(!1),[m,h]=n.useState(!1),[c,p]=n.useState({col1:"#000",col2:"#000"}),{currentTrackData:f,trackCoverUrl:x,volume:v,toggleFullScreenView:y,toggleCurrentRadioToFavorites:O,openTrackMobileView:k,mobileMusicPlayRef:R}=ae(),{openSearchBar:U}=St(),[P,b]=n.useState(!1),[F,I]=n.useState(null),[S,M]=n.useState(null),J=me(),{subscribe:_}=xe();n.useRef(null);const[T,V]=n.useState(Ve().pathname==="/admin-pannel"),G=()=>{r(!0)};n.useEffect(()=>{const re=_("openAddMusic",G);return()=>{re()}},[]);const D=()=>{r(!1),M(null),I(null)};function ee(){u(!a)}function X(){h(!m)}n.useEffect(()=>{const re=[{col1:"#ffa585",col2:"#ffeda0"},{col1:"#9bf8f4",col2:"#6f7bf7"}];p(re[Math.floor(Math.random()*re.length)])},[]);const le=()=>{b(!1),D()},ve=()=>{if(!F){l?(D(),console.log("deactivate")):(G(),console.log("activate"));return}b(document.getElementsByClassName("addMusicContainer")[0]==null),console.log("toggle")},ge=re=>{re.stopPropagation(),y()};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header__logo",onClick:()=>J("/home"),children:[e.jsx(ne,{col1:c.col1,col2:c.col2}),e.jsx("h1",{children:"CML"})]}),e.jsx(Ot,{context:{mobile:!1}}),e.jsxs("div",{className:"musicPlayer",ref:R,onClick:k,children:[e.jsxs("div",{className:"playPauseContainer",children:[(f==null?void 0:f.type)=="radio"?f.coverUrl==""?e.jsx(ne,{className:"trackImage"}):e.jsx("img",{src:f.coverUrl,className:"trackImage"}):x.split("/").pop()==="null"?e.jsx(ne,{className:"trackImage"}):e.jsx("img",{src:x,className:"trackImage"}),e.jsx("div",{className:"playPauseButtons",onClick:ge,children:e.jsx(Vs,{style:{padding:"0px"}})})]}),!f||Object.keys(f).length===0?null:e.jsxs("div",{className:"trackinfos-parent",children:[e.jsxs("div",{className:"trackinfo-desktop",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{(f==null?void 0:f.type)!="radio"&&J(`/artists/${f.artistId}`)},children:f.artist}),e.jsx(en,{})]}),(f==null?void 0:f.type)==="radio"?e.jsx(jt,{id:"add-radio-fav",iconHovered:Bs,iconDefault:_t,onClick:O}):e.jsx(fo,{}),e.jsxs("div",{className:"trackinfo-mobile",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx(Ot,{context:{mobile:!0,radio:(f==null?void 0:f.type)==="radio",preserv:!0}})]})]})]}),e.jsxs("div",{className:"mobile-gost",children:[e.jsx(Gs,{id:"playlist-button",className:"buttonRound",onClick:()=>ee()}),a&&e.jsx(Xa,{hideComponent:()=>u(!1)}),v<=1e-5?e.jsx(Or,{className:"buttonRound",onClick:()=>X()}):v<.5?e.jsx(Mr,{className:"buttonRound",onClick:()=>X()}):e.jsx(Ur,{id:"volume-button",className:"buttonRound",onClick:()=>X()}),m&&e.jsx(mo,{hideComponent:()=>h(!1)}),e.jsx(Mt,{})]}),e.jsxs("div",{className:"headerRight",children:[e.jsx(Mt,{className:"desktop-ghost"}),!T&&e.jsxs("div",{className:"serach-button-div",onClick:U,children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"K"})}),e.jsx(Me,{})]}),e.jsxs("div",{style:{position:"relative",padding:"5px",display:"flex",justifyContent:"center"},className:"upload-music-header",children:[S&&e.jsx(ho,{percent:S,size:44,useText:!1,style:{position:"absolute",transform:"translate(-1px, -5.5px)"}}),e.jsx(as,{style:{zIndex:"10",position:"relative"},className:"addMusicButton buttonRound",onClick:ve}),F&&e.jsxs("span",{id:"upload-progress-tiny",children:[F.done,"/",F.total]})]}),e.jsx(ya,{})]}),l&&e.jsx(Qa,{uploadPercent:M,uploadFinished:le,uploadProgress:I,isMinimize:P,setMinimized:b,closeOverlay:D})]})},po=()=>{const[t,s]=n.useState(null),[o,d]=n.useState(null),[l,r]=n.useState(null),[a,u]=n.useState(null);n.useEffect(()=>{const c=setInterval(m,5e3);return m(),()=>clearInterval(c)},[]);const m=()=>{try{fetch(`${N}/isResponding`).then(c=>{c.status===200?(a===!1&&h(),u(!0)):u(!1)}).catch(c=>{console.error("Fetch failed (e.g., CORS error):",c),u(!1)})}catch(c){console.error("Unexpected error:",c),u(!1)}},h=()=>{fetch(`${N}/read-write/stats`,{method:"GET"}).then(c=>c.json()).then(c=>{s(c)}).catch(c=>console.error("Error fetching stats:",c)),fetch(`${N}/read-write/serverStats`,{method:"GET"}).then(c=>c.json()).then(c=>{d(Yt(c.coversByteUsage+c.tracksByteUsage).readable),r({perent:(1-c.free/c.size)*100,total:Yt(c.size).readable,free:Yt(c.free).readable})}).catch(c=>console.error("Error fetching server stats:",c))};return n.useEffect(()=>{h()},[]),e.jsxs("div",{className:"stat-short",children:[e.jsxs("div",{className:"stat-short-category",children:[e.jsxs("p",{children:["Library size: ",o]}),e.jsxs("p",{children:["Free ",l==null?void 0:l.free," of ",l==null?void 0:l.total]}),e.jsx(dt,{percent:(l==null?void 0:l.perent)||0,total:l==null?void 0:l.total,style:{height:"10px"},fillColor:"var(--chill-purple)",initialising:!o})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"5px"},children:[e.jsx("div",{className:"server-status-sprite",style:{width:"10px",height:"10px",borderRadius:"10px",backgroundColor:a?"lightgreen":"red"}}),e.jsxs("p",{children:["Server is ",a?"online":"offline"]})]})]})},go=()=>{const{openCommandBar:t}=St();return e.jsxs("div",{className:"sidebar",children:[e.jsxs("nav",{children:[e.jsxs(st,{id:"nav-recent",to:"/home",children:[e.jsx(_r,{}),"Recent"]}),e.jsxs(st,{to:"/playlists",children:[e.jsx(Br,{}),"Playlists"]}),e.jsxs(st,{to:"/artists",children:[e.jsx(Gr,{}),"Artists"]}),e.jsxs(st,{to:"/genres",children:[e.jsx(Dr,{}),"Genres"]}),e.jsxs(st,{to:"/cooking",children:[e.jsx(ot,{}),"Cooking"]}),e.jsxs(st,{to:"/radio",children:[e.jsx(Vr,{}),"Radio"]})]}),e.jsx(po,{}),e.jsxs("div",{className:"serach-button-div",onClick:t,style:{margin:"auto",marginBottom:"20px"},children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"SPACE"})}),e.jsx(Hr,{})]})]})},Xt=n.memo(({path:t,display:s,Icon:o})=>{const d=me(),l=Ve();return e.jsxs("div",{className:"mobile-shortcut-entry","data-active":l.pathname===t,onClick:()=>{d(t)},children:[e.jsx(o,{}),e.jsx("span",{children:s})]})}),xo=()=>e.jsxs("div",{id:"mobile-shortcut",children:[e.jsx(Xt,{path:"/home",display:"Home",Icon:qr}),e.jsx(Xt,{path:"/radio",display:"Radio",Icon:Hs}),e.jsx(Xt,{path:"/Search",display:"Search",Icon:Me})]}),vo=()=>{const t=me(),[s,o]=n.useState(!1),{currentDisplayedPage:d}=ae();if(n.useEffect(()=>{(async()=>{if((await(await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"})).json()).success){o(!1);return}t("/")})()},[t]),s)return e.jsx(Nt,{});const r=Ve().pathname,a=["/home"];return e.jsxs("div",{className:"app-container",children:[e.jsx(Bt,{}),e.jsxs("div",{className:"content-container",ref:d,page:a.includes(r)?r:"inside",children:[e.jsx(go,{}),e.jsxs("div",{className:"content",children:[e.jsx(Ls,{})," "]}),e.jsx(xo,{})]})]})},us=({album:t,hideArtist:s=!1})=>{const o=me(),[d,l]=n.useState([]),[r,a]=n.useState(!1),u=n.useRef(null),m=h=>{o(`/albums/${h}`)};return n.useEffect(()=>{t.artists&&l(JSON.parse(t.artists).map(h=>h.name))},[t]),e.jsxs("div",{className:"album-card",onClick:()=>m(t.id),children:[t.cover?e.jsxs("div",{className:"",children:[!r&&e.jsx("div",{className:"skeleton-loader-album"}),e.jsx("img",{className:"album-card-cover",ref:u,src:`${N}/covers/${t.cover}`,onLoad:()=>a(!0),alt:t.title,style:{display:r?"block":"none"}})]}):e.jsx(ne,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Ye(t.title,40)}),!s&&e.jsx("p",{className:"album-artist",children:Ye(d.toString().replace(/,/g,", "),25)||"No artist"})]})},ds=()=>{const{emit:t}=xe(),s=()=>{t("openAddMusic")};return e.jsxs("div",{className:"add-music-shortcut",children:[e.jsx("h2",{children:"Welcome to the Crystal Music Library !"}),e.jsxs("button",{onClick:s,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"15px",margin:"auto"},children:[e.jsx(as,{}),e.jsx("h3",{style:{margin:"2px"},children:"Add music"})]})]})},jo=({})=>{const[t,s]=n.useState([]),[o,d]=n.useState(!1),{subscribe:l}=xe(),r=()=>{fetch(`${N}/read-write/albums`,{method:"GET",credentials:"include"}).then(u=>{if(u.status!==200){console.error("Error fetching albums");return}return u.json()}).then(u=>{s(u),d(!0)})};n.useEffect(()=>{Ue(()=>{r()})();const m=l("musicUploaded",r);return()=>{m()}},[]);const a=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});return e.jsx("div",{className:"home album-displayer","data-no-tracks":(t==null?void 0:t.length)==0&&o?"true":"false",children:o?(t==null?void 0:t.length)!==0?t.map(u=>e.jsx(us,{album:u},u.id)):e.jsx(ds,{}):e.jsx(a,{})})},yo=()=>e.jsx("p",{children:" Your albums"}),Ce={FETCHING:"fetching",SUCCESS:"success",REJECTED:"rejected",NONE:"none"},bo=()=>{const t=n.useRef(Ce.NONE),[s,o]=n.useState(Ce.NONE),d=me(),{emit:l}=xe(),r=async m=>{if(m.preventDefault(),!m.target.email.value||!m.target.password.value){alert("Please fill in all fields");return}const h=new FormData(m.target),c=await fetch(`${N}/auth/login`,{method:"POST",credentials:"include",body:h}),p=await c.json();c.ok?(localStorage.setItem("username",p.username),t.current=Ce.SUCCESS):t.current=Ce.REJECTED,u()},a=()=>{switch(s){case Ce.FETCHING:return e.jsx(Js,{});case Ce.SUCCESS:return e.jsxs("div",{className:"loginFeedback",sucess:"true",children:[e.jsx(ct,{className:"successIcon"}),e.jsx("span",{children:"Logged in"})]});case Ce.REJECTED:return e.jsxs("div",{className:"loginFeedback",sucess:"false",children:[e.jsx(be,{className:"failIcon"}),e.jsx("span",{children:"Wrong credentials"})]});default:return null}},u=()=>{switch(o(t.current),t.current){case Ce.REJECTED:setTimeout(()=>{o(Ce.NONE)},1e3);break;case Ce.SUCCESS:setTimeout(()=>{l("login"),d("/home")},1e3);break}};return e.jsxs("div",{className:"authDiv",children:[e.jsx(Mt,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(ne,{}),e.jsx("h2",{children:"Login"}),e.jsx("p",{children:"We were not able to connect you, please login."}),e.jsxs("form",{onSubmit:r,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"password"}),e.jsx("button",{type:"submit",children:"Login "}),e.jsx("p",{children:"Don't have an account?"}),e.jsx("button",{onClick:()=>{d("/register")},children:"Register"})]}),e.jsx(a,{})]})},No=[Be("#f8be99"),Be("#f495e9"),Be("#bbfbdf"),Be("#c4d3f8"),Be("#edc9f9"),Be("#909ef8"),Be("#96ebf4")],Lt=60,xt=Be("#242424"),an=()=>{const[t,s]=n.useState([xt,xt]),o=n.useRef([]),d=n.useRef([xt,xt]),l=n.useRef(No),r=n.useRef(0),a=n.useRef(0);n.useEffect(()=>(a.current=setInterval(m,1e3/Lt),()=>{clearInterval(a.current)}),[]);const u=()=>{const h=vt.sample(l.current);return l.current.filter(c=>c.join(",")!=h.join(",")),h},m=()=>{r.current%Lt===0&&(o.current[0]&&o.current[0]!==xt&&l.current.push(...o.current),o.current=d.current,d.current=[u(),u()]),s(o.current.map((h,c)=>d.current[c].map((p,f)=>parseInt(Je(h[f],p,r.current%Lt/Lt))))),r.current+=1};return e.jsx("div",{id:"background-img",style:{"--col1":Ts(...t[0]),"--col2":Ts(...t[1])}})},rt=Object.freeze({LOGIN:"login",REGISTER:"register",ANY_USER:"any_user",VERIF_TOKEN:"verif_token"}),ko=()=>{const t=me(),[s,o]=n.useState([]),[d,l]=n.useState(null),[r,a]=n.useState(!0);return n.useRef(null),n.useEffect(()=>{(async()=>{l(rt.ANY_USER);const h=await(await fetch(`${N}/auth/any-user`,{method:"GET"})).json();if(console.log("Parsed users",h),o(h),console.log(h),h===0){a(!1),l(rt.REGISTER);return}l(rt.VERIF_TOKEN);const p=await(await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"})).json();if(a(!1),p.success){console.log("Token is valid"),t("/home");return}l(rt.LOGIN)})()},[t]),d===rt.REGISTER&&!r&&t("/register"),e.jsxs(e.Fragment,{children:[e.jsx(an,{}),!r&&d===rt.LOGIN?e.jsx(bo,{}):null]})},on=({index:t,track:s,playIconId:o,isSalad:d=null,onClick:l,showCover:r=!1})=>{const{title:a,track_number:u,rawDuration:m}=s,{playingTrack:h,openTrackActions:c,toggleTrackFavorite:p}=ae(),f=s.id,[x,v]=n.useState("null"),[y,O]=n.useState(!1),[k,R]=n.useState(!1),U=()=>{if(d){d(t);return}l(s.id)},P=()=>{switch(o){case 0:return e.jsx(Kr,{className:"track-number",playing:"piano","data-show-cover":r});case 1:return e.jsx(Wr,{className:"track-number",playing:"vinyl","data-show-cover":r});case 2:return e.jsx(Hs,{className:"track-number",playing:"piano","data-show-cover":r});case"salad":return e.jsx(ot,{className:"track-number",playing:"piano","data-show-cover":r})}};n.useEffect(()=>{O(s.is_favorite===1),r&&fetch(`${N}/read-write/trackCover/${s.id}`,{method:"GET"}).then(M=>M.json()).then(M=>{v(`${N}/covers/${M}`)})},[]);const b=M=>{M.stopPropagation(),p(s.id,!y,O)},F=()=>{R(!1)},I=M=>{M.stopPropagation(),R(!0),c({x:M.clientX,y:M.clientY},s,F,S)},S=M=>{O(M)};return e.jsxs("div",{className:"track-view","action-bar":k?"open":"",onClick:U,children:[y&&e.jsx(_t,{className:"track-favorite"}),e.jsx(jt,{className:"track-toggle-favorite",iconHovered:y?es:zr,iconDefault:y?es:Os,onClick:b}),r?x.split("/").pop()==="null"?null:e.jsx("img",{src:x,className:"track-mini-thumbnail"}):null,h===f?P():r?null:e.jsx("p",{className:"track-number",children:u}),e.jsx("p",{className:"track-name",style:{"--margin":r?"45px":"35px"},children:a}),e.jsx(ns,{className:"track-actions-dots",onClick:I}),e.jsx("p",{className:"track-length",children:cs(m).readable})]})},Fs=({isPlaylist:t=!1})=>{const[s,o]=n.useState(null),[d,l]=n.useState([]),[r,a]=n.useState([]),[u,m]=n.useState([]),[h,c]=n.useState(0),{addContainerToQueue:p,playContainerSuffle:f,editAlbum:x,editPlaylist:v,linkNewContainer:y,getNextSongsFromAlbum:O,navigateBack:k}=ae(),R=n.useRef(null),U=me(),[P,b]=n.useState([]),F=t?$t().playlistId:$t().albumId,[I,S]=n.useState(null),M=n.useRef(null),{notifTypes:J,addNotification:_}=Fe(),[T,V]=n.useState(!1),[G,D]=n.useState(!1),[ee,X]=n.useState(!1);n.useEffect(()=>{le()},[F,G]),n.useEffect(()=>{y({id:F,type:t?"playlist":"album",favPlaylist:T},le)},[T]);const le=()=>{fetch(`${N}/read-write/${t?"playlist":"album"}/${F}`,{method:"GET",credentials:"include"}).then(L=>{if(!L.ok)throw new Error("Network response was not ok");return L.json()}).then(L=>{c(Math.floor(Math.random()*3));const W=L.tracks.filter(z=>(!ee&&z.is_favorite===1&&X(!0),G?z.is_favorite===1:!0));if(t){o(L.playlistInfos),l(W),m([L.owner,...L.collaborators]),V(L.isFavPlaylist);return}o(L.albumInfos);let C=0;for(let z=0;z<W.length;z++){const w=W[z];w.disc>C&&(W.splice(z,0,{disc:w.disc,type:"disc"}),C=w.disc)}l(W),a(L.genres),m(L.artists),V(!1)})},ve=async()=>await p(F,t?"playlist":"album",G),ge=async()=>{f(F,t?"playlist":"album",G)},re=()=>{if(t){v(F);return}x(F)},fe={TRACK:"track",ALBUM:"album",ARTIST:"artist",PLAYLIST:"playlist",GENRE:"genre"},je=L=>{switch(L){case"track":return e.jsx(as,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add album"})," ",e.jsx(kt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add artist's discography"})," ",e.jsx(Zr,{className:"action-bar-entry-tooltip-logo"})]});case"playlist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire playlist"})," ",e.jsx(Xr,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire genre"})," ",e.jsx(Yr,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},H=L=>{const W=L.target.value;if(W===""||W.trim().length===0){b([]);return}console.log(`${N}/read-write/search/${W}`),fetch(`${N}/read-write/search/${W}`,{method:"GET",credentials:"include"}).then(C=>{if(C.ok)return C.json();throw new Error("Error fetching search results")}).then(C=>{var w,B,Y,Z,de;const z=[...(w=C.tracks)==null?void 0:w.map(q=>({type:"track",...q})),...(B=C.albums)==null?void 0:B.map(q=>({type:"album",...q})),...(Y=C.artists)==null?void 0:Y.map(q=>({type:"artist",...q})),...(Z=C.genres)==null?void 0:Z.map(q=>({type:"genre",...q})),...(de=C.playlists)==null?void 0:de.map(q=>({type:"playlist",...q})).filter(({id:q})=>q!==F)].map(q=>{const ye=q.path,{trackPath:_e,...He}=q;return{icon:()=>ye?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${q.type==="artist"?"artist":"covers"}/${ye}`,alt:q.name}):e.jsx(ne,{className:"action-bar-entry-logo"}),tooltip:je,code:q.type==="artist"?fe.ARTIST:q.type==="album"?fe.ALBUM:q.type==="genre"?fe.GENRE:q.type==="playlist"?fe.PLAYLIST:fe.TRACK,fileName:ye,...He}});console.log(z),b(z)})},$=L=>{I||setTimeout(()=>{requestAnimationFrame(()=>{var W;(W=M.current)==null||W.focus()})},0)},se=L=>{const W=new FormData;W.append("addRequest",JSON.stringify({playlistId:F,endpoint:L.code,entryId:L.id,addAllToFavorite:T||!1})),fetch(`${N}/read-write/addToPlaylist`,{method:"POST",credentials:"include",body:W}).then(C=>C.json()).then(C=>{le(),pe(),_("Added to playlist",J.INFO)})};n.useEffect(()=>{const L=W=>{R.current&&!R.current.contains(W.target)&&pe()};return document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L)}},[]);const pe=()=>{S(!1),M.current.value="",b([])},ce=L=>{O(L,G)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:k,children:e.jsx(Xe,{})}),(s==null?void 0:s.cover)&&e.jsx("img",{src:`${N}/covers/${s.cover}`,className:"background-image",alt:"background"}),s&&d?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:s.title}),e.jsx("div",{className:"album-artists",children:u?u.map(L=>e.jsx("span",{className:"artist-name",onClick:()=>{U(`/${t?"users":"artists"}/${L.id}`)},children:L.name},L.id)):e.jsxs("span",{className:"artist-name",children:["Unknown ",t?"Members":"Artist"]})}),e.jsxs("div",{className:"album-content",children:[e.jsx("div",{className:"album-cover-genres",children:e.jsxs("div",{className:"album-cover-wrapper",children:[s.cover?e.jsx("img",{src:`${N}/covers/${s.cover}`,alt:`${s.title} cover`,className:"cover-image"}):e.jsx(ne,{className:"cover-image"}),e.jsx("div",{className:"genres-album-div",children:r.map((L,W)=>e.jsx("span",{className:"genre-album",onClick:()=>{U(`/genres/${L.genreId}`)},children:L.genreName},W))}),s.description&&e.jsx("p",{children:s.description})]})}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(oe,{text:"Add to queue",icon:e.jsx(Ut,{}),onClick:ve}),e.jsx(oe,{text:"Random",icon:e.jsx(lt,{}),onClick:ge}),!T&&e.jsx("button",{className:"button-with-callback",onClick:re,children:e.jsx(rs,{})}),!T&&ee&&e.jsx("button",{className:"button-with-callback","data-is-active":G,onClick:()=>{D(!G)},children:e.jsx(Qr,{})}),s.lossless===1&&e.jsxs("div",{className:"lossless",children:[e.jsx("span",{children:"Lossless"})," ",e.jsx(Jr,{})]})]}),t&&e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:R,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",onClick:$,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Me,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:H,placeholder:"Search for tracks, artists, genres, playlists to add.",ref:M,onFocus:()=>{S(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${I?"block":"none"}`},children:e.jsx(Ie,{height:300,itemCount:P.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:L,style:W})=>e.jsx(ut,{entry:P[L],style:{...W,width:" calc(100% - 20px)",marginTop:"10px"},onClick:se},L)})})]})}),d.map((L,W)=>(L==null?void 0:L.type)==="disc"?e.jsx("span",{children:`Disc ${L.disc}`},`disc-${W}`):e.jsx(on,{track:L,onClick:ce,playIconId:h,showCover:t},L.id))]})]})]}):e.jsx(Nt,{text:"Loading album"})]})},So=({artist:t})=>{const s=me(),[o,d]=n.useState(!1),l=r=>{s(`/artists/${r}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>l(t.id),children:[t.picture?e.jsxs(e.Fragment,{children:[!o&&e.jsx("div",{className:"skeleton-loader-album"}),e.jsx("img",{src:`${N}/covers/artists/${t.picture}`,alt:`${t.name} cover`,onLoad:()=>d(!0),className:"artist-card-cover"})]}):e.jsx(ne,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},To=()=>{const[t,s]=n.useState([]),{subscribe:o}=xe(),d=()=>{fetch(`${N}/read-write/artists`,{method:"GET",credentials:"include"}).then(l=>{if(l.status!==200){console.error("Error fetching artists");return}return l.json()}).then(l=>{s(l)})};return n.useEffect(()=>{Ue(()=>{d()})();const r=o("musicUploaded",d);return()=>{r()}},[]),e.jsx("div",{className:`home ${(t==null?void 0:t.length)!==0?"album-displayer":""}`,children:(t==null?void 0:t.length)!==0?t.map(l=>e.jsx(So,{artist:l},l.id)):e.jsx(ds,{})})},wo=()=>{const[t,s]=n.useState(null),[o,d]=n.useState([]),{addArtistToQueue:l,shuffleArtistToQueue:r,editArtist:a,linkNewContainer:u,navigateBack:m}=ae(),h=$t().artistId;n.useEffect(()=>{c(),u({id:h,type:"artist"},c)},[h]);const c=()=>{fetch(`${N}/read-write/artist/${h}`,{method:"GET",credentials:"include"}).then(x=>{if(!x.ok)throw new Error("Network response was not ok");return x.json()}).then(x=>{s(x.artistInfos),d(x.albums),console.log(x.artistInfos)})},p=async()=>await l(h),f=async()=>{r(h,!1)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:m,children:e.jsx(Xe,{})}),t&&o?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"album-content",children:[t.picture?e.jsx("img",{src:`${N}/covers/artists/${t.picture}`,alt:`${t.name} cover`,className:"cover-image"}):e.jsx(ne,{className:"cover-image"}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(oe,{text:"Add to queue",icon:e.jsx(Ut,{}),onClick:p}),e.jsx(oe,{text:"Random",icon:e.jsx(lt,{}),onClick:f}),e.jsx(oe,{icon:e.jsx(rs,{}),onClick:async()=>{a(t.id)}})]}),e.jsx("div",{className:"album-displayer",children:o.map(x=>e.jsx(us,{album:x,hideArtist:!0},x.id))})]})]})]}):e.jsx(Nt,{text:"Loading artist"})]})},Eo=()=>{const t=me(),s=()=>{t("/home")};return e.jsxs("div",{className:"not-found",children:[e.jsx("h1",{children:"Where did you land..?"}),e.jsx("p",{children:"The adress you gave is not defined, but you can go back to library:"}),e.jsx("button",{className:"btn",onClick:s,children:"Go back to library"})]})},Ro=()=>{const[t,s]=n.useState("");n.useEffect(()=>{s(localStorage.getItem("username"))},[]);const o=me();return e.jsxs("div",{className:"account-page",children:[e.jsx(Bt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Xe,{})}),e.jsxs("div",{className:"account-container",children:[e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:t}),e.jsx("p",{children:"Account information will be displayed here."})]}),e.jsx(ne,{})]})]})]})},Co=({active:t,setActive:s})=>e.jsx("div",{className:"toggle-button","data-is-active":t,onClick:o=>{o.stopPropagation(),s(!t)},children:e.jsx("div",{className:"toggle-button-active","data-is-active":t})}),De=({stateChanged:t,min:s=0,max:o=0,ref:d})=>{const l=s===o&&o===0,r=u=>{const m=u.target.value;t(m)},a=u=>{console.log("blur");let m=parseFloat(u.target.value);isNaN(m)&&(m=s),l||(m=Math.min(o,Math.max(s,m))),u.target.value=m,t(m)};return l?e.jsx("input",{ref:d,type:"number",onBlur:a,onChange:r}):e.jsx("input",{min:s,ref:d,max:o,type:"number",onBlur:a,onChange:r})},Ao=()=>{var v;const t=n.useRef(null),s=n.useRef(null),o=n.useRef(null),d=n.useRef(null),l=n.useRef(null),{FFTUserSetingsRef:r,fftConfigRef:a}=ae(),u=y=>{r.current.bars=Math.floor(y),f()},m=y=>{r.current.cutoff=parseFloat(y),f()},h=y=>{r.current.scale=parseFloat(y),f()},c=y=>{r.current.contrast=parseFloat(y),f()},p=y=>{r.current.FPS=parseFloat(y),f()},f=()=>{const y=new FormData;y.append("FFT",JSON.stringify(r.current)),fetch(`${N}/config/user/send/FFT`,{method:"POST",credentials:"include",body:y})},x=async()=>{await fetch(`${N}/config/user/FFT`,{method:"GET",credentials:"include"}).then(y=>y.json()).then(y=>{r.current=y,t.current.value=r.current.bars,d.current.value=r.current.contrast,s.current.value=r.current.scale,l.current.value=r.current.cutoff,o.current.value=r.current.FPS})};return n.useEffect(()=>{x()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Number of bars"}),e.jsx(De,{ref:t,stateChanged:u,min:1,max:(v=a.current)==null?void 0:v.fftSize})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"FPS (High number may cause strong battery usage)"}),e.jsx(De,{ref:o,stateChanged:p})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Scale"}),e.jsx(De,{ref:s,stateChanged:h})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Contrast"}),e.jsx(De,{ref:d,stateChanged:c})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Cutoff"}),e.jsx(De,{ref:l,stateChanged:m})]})]})},Io={FFT:Ao},Fo=({entryName:t,entryIcon:s,linkedSettingKey:o})=>{const[d,l]=n.useState(!1),r=n.useMemo(()=>Io[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":d,onClick:a=>{a.stopPropagation(),l(!d)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:r&&d&&e.jsx(r,{})})]})},Po=()=>{const[t,s]=n.useState(!1);n.useEffect(()=>{Ue(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(l=>l.json()).then(l=>{s(l)})})()},[]);const o=me();return e.jsxs("div",{className:"account-page",children:[e.jsx(Bt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Xe,{})}),e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:"Settings page"}),e.jsx("p",{children:"A shinny list of fancy settings."}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Fo,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(qs,{})})})]})]})]})},Lo=({user:t,totalStorage:s})=>{const[o,d]=n.useState(0);return n.useEffect(()=>{fetch(`${N}/read-write/user-data-usage/${t.id}`,{method:"GET",credentials:"include"}).then(l=>l.json()).then(l=>{d(l)}).catch(l=>{console.error("Error fetching user storage data: ",l)})},[]),e.jsxs("div",{className:"user-account-infos-entry",children:[e.jsx("p",{children:t.username}),e.jsx("p",{children:t.email}),e.jsx("p",{children:t.role}),e.jsx(dt,{percent:Number(o/s*100).toFixed(2),fillColor:"var(--cool-green)",showPercent:!0,style:{maxWidth:"200px"}})]})},Qe={PENDING:"pending",RUNNING:"running",PAUSED:"paused",INACTIVE:"inactive"},Zt=({jobName:t,description:s,jobKey:o,payload:d={},doneTotalView:l=null})=>{const[r,a]=n.useState(!1),[u,m]=n.useState(!0),[h,c]=n.useState(0),[p,f]=n.useState(!1),[x,v]=n.useState(null),y=n.useRef(null),O=(S=!0,M="",J=0)=>{var _=S;fetch(`${N}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{f(!1);let V=1e3;switch(T.status){case Qe.PENDING:f(!0),a(!0),m(!1),V=500;break;case Qe.INACTIVE:if(M===Qe.RUNNING||M===Qe.PENDING){setTimeout(()=>{a(!1),c(0),v(null),O(!1,T.status)},2e3),c(100),v({done:J,total:J,working:0}),_=!1,console.log("Stop fast fetch job");return}a(!1);break;case Qe.PAUSED:m(!0),a(!0),V=500;break;case Qe.RUNNING:m(!1),a(!0),V=10;break}y.current&&(clearTimeout(y.current),y.current=null),_&&(y.current=setTimeout(()=>{var G;if(T.progress){const D=T.progress.done/T.progress.total*100;c(D),v(T.progress)}else v(null);O(!0,T.status,((G=T.progress)==null?void 0:G.total)??0)},V))})},k=()=>{fetch(`${N}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{O(S.status===Qe.RUNNING)})},R=()=>{const S=new FormData;S.append("payload",JSON.stringify(d)),fetch(`${N}/jobs/run/${o}`,{method:"POST",credentials:"include",body:S}).then(M=>M.json()).then(M=>{O(!0)})},U=()=>{fetch(`${N}/jobs/pause/${o}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{O(!1)})},P=()=>{fetch(`${N}/jobs/resume/${o}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{O(!0)})},b=()=>{fetch(`${N}/jobs/stop/${o}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{O(!1)})};n.useEffect(()=>(k(),()=>{y.current&&(console.log("Trying clearTimout"),clearTimeout(y.current),y.current=null)}),[]);const F=async()=>{if(r){u?P():U(),m(!u);return}R()},I=async()=>{b(),c(0)};return e.jsxs("div",{className:"backend-job",children:[e.jsx("h3",{children:t}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"baseline",flexWrap:"wrap"},children:[e.jsx(oe,{text:r?u?"Resume":"Pause":"Run",icon:r?u?e.jsx(ea,{}):e.jsx(ta,{}):e.jsx(sa,{}),onClick:F}),e.jsx(oe,{text:"Stop",icon:e.jsx(na,{}),onClick:I}),e.jsx(dt,{style:{height:"25px",filter:`grayscale(${u&&r?.8:0})`},minWidth:"200px",percent:h,showPercent:!1,text:x?l.current?`${x.done}/${x.total}`:`Working: ${x.working} | Left : ${x.total-x.done}`:null,fillColor:"linear-gradient(90deg, rgb(187, 251, 223) 0%, rgb(198, 203, 253) 50%, rgb(239, 201, 249) 100%)",initialising:p,initialisingColor:"violet"})]}),e.jsx("p",{children:s}),e.jsx("div",{className:"job-status","data-running":u?"false":"true","data-status":r?p?"init":u?"stop":"run":"inactive",children:e.jsx("span",{children:r?p?"Initlialising":u?"Paused":"Running":"Inactive"})})]})},$o=()=>{const t=n.useRef(null),s=n.useRef(null),o=n.useRef(null),d=n.useRef(null),[l,r]=n.useState(!1),a=p=>{t.current.samples=Math.floor(p),h()},u=p=>{t.current.samplingInterval=1/Math.floor(p),h()},m=p=>{t.current.parallelCompute=Math.floor(p),h()},h=()=>{const p=new FormData;p.append("FFT",JSON.stringify(t.current)),fetch(`${N}/config/send/FFT`,{method:"POST",credentials:"include",body:p})},c=async()=>{await fetch(`${N}/config/FFT`,{method:"GET",credentials:"include"}).then(p=>p.json()).then(p=>{t.current=p}),r(t.current.useServerFFT),o.current.value=t.current.samples,s.current.value=Math.floor(1/t.current.samplingInterval),d.current.value=t.current.parallelCompute};return n.useEffect(()=>{c()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line",children:[e.jsx("span",{children:"Activate audio spectra computation"}),e.jsx(Co,{defaultValue:t.current,active:l,setActive:p=>{r(p),t.current&&(t.current.useServerFFT=p,h())}})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame definiton (power of 2)"}),e.jsx(De,{ref:o,stateChanged:a,max:4096,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame per second"}),e.jsx(De,{ref:s,stateChanged:u,max:120,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Number of parallel analyzed songs"}),e.jsx(De,{ref:d,stateChanged:m,max:10,min:1})]})]})},Oo={FFT:$o},Mo=({entryName:t,entryIcon:s,linkedSettingKey:o})=>{const[d,l]=n.useState(!1),r=n.useMemo(()=>Oo[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":d,onClick:a=>{a.stopPropagation(),l(!d)},children:[s,e.jsx("span",{children:t})]}),e.jsx("div",{className:"admin-setting-content",children:r&&d&&e.jsx(r,{})})]})},Uo=()=>{const t=()=>localStorage.getItem("job-progress-view")?localStorage.getItem("job-progress-view")==="true":!0,[s,o]=n.useState(!1),[d,l]=n.useState([]),[r,a]=n.useState(0),u=n.useRef(t()),m=me();n.useEffect(()=>{Ue(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{o(x)})})()},[]),n.useEffect(()=>{s.error||fetch(`${N}/auth/init-admin-pannel`,{method:"POST",credentials:"include"}).then(f=>f.json()).then(f=>{l(f.users),a(f.totalStorage)})},[s]);const h=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You are not an admin."})]}),c=f=>{const x=f===0;u.current=x,localStorage.setItem("job-progress-view",x)},p=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Admin pannel"}),e.jsx("p",{children:"Only for the true admins."}),e.jsxs("div",{className:"admin-category",children:[e.jsx(ra,{}),e.jsx("h2",{children:"Users' storage usage"})]}),e.jsx("div",{className:"all-users-list",children:d.map(f=>e.jsx(Lo,{user:f,totalStorage:r},f.id))}),e.jsxs("div",{className:"admin-category",children:[e.jsx(aa,{}),e.jsx("h2",{children:"Backend processes"}),e.jsx(tn,{data:["Done/Total","Working/Remaining"],currentActive:t()?0:1,onClick:c})]}),e.jsxs("div",{className:"job-grid",children:[e.jsx(Zt,{jobKey:"JOB_CD",jobName:"Recompute tracks number and CDs",description:"Reextract the metadatas of the songs to remap them to the correct CD or track number. Analyses lossless.",doneTotalView:u}),e.jsx(Zt,{jobKey:"JOB_FFT",jobName:"Compute audio spectras",description:"Runs a fast Fourier transform on each audio files to extract the audio spectrum. The result is writen into .bin files. For a .flac audio of 41kHz, we expect 3Mb spectrum file.",payload:{completeLibrary:!0},doneTotalView:u}),e.jsx(Zt,{jobKey:"JOB_LYRICS",jobName:"Fetch all lyrics",description:"Accesses the API of lrclib to fetch lyrics. This may take verious time depending on the need to further serivices if the track is not found.",payload:{mode:"all_library"},doneTotalView:u})]}),e.jsxs("div",{className:"admin-category",children:[e.jsx(oa,{}),e.jsx("h2",{children:"Configuration"})]}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Mo,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(qs,{})})})]});return e.jsxs("div",{className:"account-page",children:[e.jsx(Bt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>m("/home"),children:e.jsx(Xe,{})}),e.jsx("div",{className:"account-info",children:s?e.jsx(p,{}):e.jsx(h,{})})]})]})},_o=()=>{const[t,s]=n.useState(!0),o=me(),d=async r=>{if(r.preventDefault(),!r.target.email.value||!r.target.password.value||!r.target.repeat_password.value||!r.target.name.value){alert("Please fill in all fields");return}if(r.target.password.value!==r.target.repeat_password.value){alert("Passwords do not match");return}const a=new FormData(r.target),u=await fetch(`${N}/auth/register`,{method:"POST",credentials:"include",body:a}),m=await u.json();u.ok?(alert("User registered successfully"),o("/home")):alert(m.error)};n.useEffect(()=>{fetch(`${N}/auth/any-user`,{method:"GET"}).then(r=>r.json()).then(r=>{s(r===0)})},[]);const l=()=>e.jsxs("div",{style:{marginBottom:"30px",display:"flex",flexDirection:"row",alignItems:"center",margin:"auto",gap:"20px"},children:[e.jsx("p",{style:{textWrap:"nowrap"},children:"Already an account?"}),e.jsx("button",{style:{width:"100%"},onClick:r=>{r.stopPropagation(),o("/")},children:"Login"})]});return e.jsxs("div",{className:"authDiv",children:[e.jsx(Mt,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(an,{}),e.jsx(ne,{}),e.jsx("h2",{children:"Register"}),e.jsx("p",{children:t?`Welcome to the Crystal Music Library! Since you are the first 
            to show up here, we would like you to create the admin account.`:"Please fill the form to register as a new user."}),!t&&e.jsx(l,{}),e.jsxs("form",{onSubmit:d,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"new-password"}),e.jsx("label",{htmlFor:"repeat_password",children:"Confirm Password"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",name:"repeat_password",autoComplete:"password"}),e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",autoComplete:"name"}),e.jsx("button",{type:"submit",children:"Register"})]})]})},Bo=()=>{const[t,s]=n.useState(null),{genreId:o}=$t(),{addContainerToQueue:d,playContainerSuffle:l,playContainer:r,navigateBack:a}=ae();n.useEffect(()=>{fetch(`${N}/read-write/genre/${o}`,{method:"GET",credentials:"include"}).then(c=>{if(!c.ok)throw new Error("Network response was not ok");return c.json()}).then(c=>{s(c),console.log(c)})},[]);const u=async()=>{r(o,"genre")},m=async()=>{d(o,"genre")},h=async()=>{l(o,"genre")};return e.jsxs("div",{className:"genre-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:a,children:e.jsx(Xe,{})}),t?e.jsxs("div",{className:"genre-details",children:[e.jsx("h1",{children:t.name}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(oe,{text:"Play",icon:e.jsx(ss,{}),onClick:u}),e.jsx(oe,{text:"Random",icon:e.jsx(lt,{}),onClick:h}),e.jsx(oe,{text:"Add to queue",icon:e.jsx(Ut,{}),onClick:m})]}),e.jsx("div",{className:"genre-albums album-displayer",children:t.albums.map(c=>e.jsx(us,{album:c},c.id))})]}):e.jsx("p",{children:"Loading..."})]})},Go=({genre:t})=>{const s=me(),[o,d]=n.useState([]),[l,r]=n.useState([]),a=n.useRef([]),u=n.useRef(l),m=n.useRef([]),h=f=>{var v;if(console.log("changed on",f),!((v=u.current)!=null&&v.length)==0)return;const x=document.getElementById(`genre-${t.id}-img-${f}`);x==null||x.setAttribute("data-hidden","true"),setTimeout(()=>{x&&(x.src=`${N}/covers/${u==null?void 0:u.current[f]}`),x==null||x.removeAttribute("data-hidden")},500)};n.useEffect(()=>(c(d),p(),[2e3,2500,3e3].forEach((x,v)=>{setTimeout(()=>h(v),x);const y=setInterval(()=>h(v),7e3);m.current.push(y)}),()=>{a.current.forEach(clearTimeout),a.current=[],m.current.forEach(clearInterval),m.current=[],u.current=[]}),[]);const c=f=>{fetch(`${N}/read-write/trackCoversGenre/${t.id}`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{f(x)})};n.useEffect(()=>{u.current=l},[l]);const p=()=>{c(r),setTimeout(p,5500)};return e.jsxs("div",{className:`genre-card ${t==null?void 0:t.puredName}`,onClick:()=>{s(`/genres/${t.id}`)},children:[e.jsx("div",{className:"card-pivot-origin",children:o.map((f,x)=>e.jsx("div",{className:"img-pivot",style:{"--start-delay":`${3*(2-x)}`,"--start-angle":`${2-x}`,"--speed":"0.7","--scale":.4},children:e.jsx("img",{id:`genre-${t.id}-img-${x}`,className:"genre-img-cover",style:{"--scale":.7},src:`${N}/covers/${f}`})},x))}),e.jsx("div",{className:"genre-name",children:e.jsx("p",{children:t.name})})]})},Do=[{name:"rock"},{name:"hiphop"},{name:"jazz"},{name:"edm"},{name:"house"},{name:"techno"},{name:"trance"},{name:"dubstep"},{name:"reggae"},{name:"ska"},{name:"country"},{name:"folk"},{name:"acoustic"},{name:"singer"},{name:"songwriter"},{name:"latin"},{name:"salsa"},{name:"reggaeton"},{name:"afrobeat"},{name:"jpop"},{name:"jpop"},{name:"lofi"},{name:"electronic"},{name:"indie"},{name:"alternative"},{name:"punk"},{name:"metal"},{name:"opera"},{name:"classical"},{name:"funk"},{name:"blues"},{name:"soul"},{name:"rnb"},{name:"chillhop"},{name:"ambiant"},{name:"soundtrack"},{name:"art-rock"},{name:"pop-rock"},{name:"breakcore"},{name:"worldwide"},{name:"rnb-soul"},{name:"hard-rock"},{name:"shoegaze"},{name:"indie-rock"},{name:"traditional"},{name:"anime"},{name:"pop"}],Vo=new zs(Do,{keys:["name"],threshold:.4}),Ho=t=>{const s=t.replace(/[^a-zA-Z ]/g," "),o=Vo.search(s);return"genre-"+(o.length>0?o[0].item.name:"default")},qo=({})=>{var a,u;const{subscribe:t}=xe(),[s,o]=n.useState([]),[d,l]=n.useState(()=>{const m=localStorage.getItem("CML_FinishedTutorials");return m&&JSON.parse(m).state[we.GENRES]||!1}),r=()=>{fetch(`${N}/read-write/genres`,{method:"GET",credentials:"include"}).then(m=>m.json()).then(m=>{m.genres=m.genres.map(h=>({...h,puredName:Ho(h.name)})),o(m)})};return n.useEffect(()=>{const m=t(`safe-finished-tutorial-${we.GENRES}`,()=>{l(!0)}),h=t("musicUploaded",r);return Ue(()=>{r()})(),()=>{h(),m()}},[]),e.jsx(e.Fragment,{children:((a=s==null?void 0:s.genres)==null?void 0:a.length)!==0?e.jsx("div",{className:"home genre-displayer",children:(u=s==null?void 0:s.genres)==null?void 0:u.map(m=>e.jsx(Go,{genre:m},m.id))}):(s==null?void 0:s.trackNum)>0?d?e.jsxs("div",{className:"info-line",id:"text-no-genre",children:[e.jsx("span",{children:"No genres found in the library."}),e.jsx(ts,{className:"info-button",onClick:()=>{l(!1)}})]}):e.jsx(nn,{tutorialKey:we.GENRES}):e.jsx(ds,{})})},zo=({playlist:t})=>{const s=me(),o=d=>{s(`/playlists/${d}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>o(t.id),children:[t.cover?e.jsx("img",{src:`${N}/covers/${t.cover}`,alt:`${t.name} cover`,className:"artist-card-cover"}):e.jsx(ne,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:t.name})]})},Wo=()=>{const[t,s]=n.useState([]),{createNewPlaylist:o,setPlaylistAddedCallback:d}=ae(),l=()=>{fetch(`${N}/read-write/playlists`,{method:"GET",credentials:"include"}).then(r=>r.json()).then(r=>s(r))};return n.useEffect(()=>{Ue(()=>{l(),d(l)})()},[]),e.jsxs("div",{children:[e.jsx(oe,{className:"buttonRound",id:"new-playlist",onClick:o,icon:e.jsx(ca,{}),text:"Create a new playlist"}),e.jsx("div",{className:"album-displayer",children:t.map(r=>e.jsx(zo,{playlist:r},r.id))})]})},Ko=()=>{const t=n.useRef(null),s=n.useRef(null),[o,d]=n.useState(!1),[l,r]=n.useState([]),{playAudioSalad:a,setSaladContext:u,saladContext:m,openTagWindow:h}=ae(),[c,p]=n.useState([]),[f,x]=n.useState([]),{addNotification:v,notifTypes:y}=Fe(),[O,k]=n.useState([]),[R,U]=n.useState(!1),[P,b]=n.useState(!1),F=n.useRef(null),I=n.useRef(null),[S,M]=n.useState("#aabbcc"),[J,_]=n.useState(!0),{subscribe:T}=xe(),[V,G]=n.useState(()=>{const H=localStorage.getItem("CML_FinishedTutorials");return H&&JSON.parse(H).state[we.COOKING]||!1});n.useEffect(()=>{const H=ce=>{t.current&&!t.current.contains(ce.target)&&ee()},$=()=>{G(!0)};let se=T(`safe-finished-tutorial-${we.COOKING}`,$);return Ue(()=>{c.length===0&&p(m||[]),fetch(`${N}/read-write/mostUsedTags`,{method:"GET",credentials:"include"}).then(ce=>ce.json()).then(ce=>{const L=ce.map(W=>({...W,type:W.total,typeElem:"tag",icon:()=>e.jsx(yt,{color:W.color}),tooltip:C=>e.jsx("span",{children:C})}));x(L),r(L)}),document.addEventListener("mousedown",H),document.addEventListener("touchstart",H)})(),()=>{se(),document.removeEventListener("mousedown",H),document.removeEventListener("touchstart",H)}},[]);const D=H=>{const $=H.target.value;if($===""||$.trim().length===0){r(f);return}fetch(`${N}/read-write/search/${$}/tags,salads`,{method:"GET",credentials:"include"}).then(se=>{if(se.ok)return se.json();throw new Error("Error fetching search results")}).then(se=>{var ce,L;const pe=[...(ce=se.tags)==null?void 0:ce.map(W=>({...W,typeElem:"tag",icon:()=>e.jsx(yt,{color:W.color})})),...(L=se.salads)==null?void 0:L.map(W=>({...W,typeElem:"salad",icon:()=>e.jsx(ot,{color:W.color})}))];console.log(pe),r(pe)})},ee=()=>{d(!1)},X=H=>{p($=>$.filter(se=>se.id!==H))},le=H=>{ee(),console.log(H),!c.find($=>$.id===H.id)&&p($=>[...$,H])},ve=async()=>{a(O.map(H=>H.id)),u(c)};n.useEffect(()=>{if(u(c),c.length===0){k([]),_(!0);return}_(c.findIndex($=>$.typeElem==="salad")===-1);const H=new FormData;H.append("tags",JSON.stringify(c.filter($=>$.typeElem==="tag").map($=>$.id))),H.append("salads",JSON.stringify(c.filter($=>$.typeElem==="salad").map($=>$.id))),fetch(`${N}/read-write/getSalad`,{method:"POST",body:H}).then($=>$.json()).then($=>JSON.parse($)).then($=>{k(vt.shuffle($)),console.log("New tracks received",$),$.length>0?v("Salad received! Enjoy..",y.SALAD):v("This salad is empty.. No tracks found.",y.SALAD)})},[c]);const ge=async()=>{c.length!==0&&(U(!0),M(`${Ks(Math.random().toFixed(4)*360,100,70.8)}`))},re=()=>{if(!I.current.value||(U(!1),c.find($=>$.typeElem==="salad")))return;const H=new FormData;H.append("salad",JSON.stringify({name:I.current.value,color:S,tags:c.map($=>$.id)})),fetch(`${N}/read-write/newSalad`,{method:"POST",credentials:"include",body:H}).then($=>$.json()).then($=>{v("Salad saved!",y.SUCCESS),p([$])})},fe=H=>{a(O.map($=>$.id),H)},je=()=>{d(!0),s.current.value};return e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"info-button",id:"cooking-info",onClick:()=>{G(!1)}}),V?e.jsxs("div",{className:"cooking-div",children:[e.jsx("h2",{children:"Here select some tags and play the music!"}),e.jsxs("div",{className:"cooking-header",children:[e.jsx("div",{className:"action-bar",style:{margin:"auto"},ref:t,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",style:{zIndex:"2"},children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Me,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:D,placeholder:"Search some tags or salads..",ref:s,onFocus:je}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Ie,{height:300,itemCount:l.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:H,style:$})=>e.jsx(ut,{entry:l[H],style:{...$,width:" calc(100% - 20px)",marginTop:"10px"},onClick:le},H)})})]})}),e.jsx("button",{className:"open-tags-edit",onClick:h,children:e.jsx(ia,{})})]}),e.jsxs("div",{className:"cooking-selection",children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(oe,{text:"Play salad",icon:e.jsx(la,{}),onClick:ve}),J&&e.jsx(oe,{text:"Save salad",icon:e.jsx(ua,{}),onClick:ge})]}),e.jsx("div",{className:"cooking-tags",style:{marginBottom:"30px"},children:c.map(H=>e.jsxs("div",{className:"small-tag","data-prefix":H.typeElem==="salad",style:{backgroundColor:H.color},children:[H.typeElem==="salad"&&e.jsx(ot,{"data-prefix":"true"}),e.jsx("span",{children:H.name}),e.jsx(be,{onClick:()=>{X(H.id)}})]},H.id))}),e.jsx("div",{className:"track-list",children:O.map((H,$)=>e.jsx(on,{index:$,isSalad:fe,track:H,playIconId:"salad",showCover:!0},H.id))})]}),R?e.jsxs("div",{className:"edit-tag",style:{left:"calc(50% - 170px)",margin:"auto"},children:[e.jsx(be,{style:{cursor:"pointer"},onClick:()=>{U(!1)}}),e.jsx("input",{type:"text",placeholder:"Name your new salad.",ref:I}),e.jsx(da,{style:{cursor:"pointer"},id:"color-button",color:S,onClick:()=>{b(!P)}}),P&&e.jsxs("div",{ref:F,className:"edit-tag-picker",children:[" ",e.jsx(os,{color:S,onChange:M})]}),e.jsx(ct,{onClick:re,style:{cursor:"pointer"}})]}):null]}):e.jsx(nn,{tutorialKey:we.COOKING})]})},Ps=({radio:t})=>{const{playRadio:s,externalRadioInfos:o}=ae();return e.jsxs("div",{className:"album-card",onClick:()=>{t.id?o.current=null:o.current=t,s(t.id?`radio-id:${t.id}`:`radio-url:${t.url}`)},children:[t.coverUrl?e.jsx("img",{src:`${N}/radio/favicon-proxy?url=${encodeURIComponent(t.coverUrl)}`,alt:`${Ye(t.name,25)} cover`,className:"album-card-cover"}):e.jsx(ne,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Ye(t.name,40)})]})},Qo=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]}),Jo=()=>{const[t,s]=n.useState(!1),[o,d]=n.useState([]),[l,r]=n.useState([]),{subscribe:a}=xe(),{addNotification:u,notifTypes:m}=Fe();n.useEffect(()=>{const x=a("refetch-known-radios",h);return Ue(()=>{h()})(),()=>{x()}},[]);const h=async()=>{const x=await fetch(`${N}/radio/radios`,{method:"GET",credentials:"include"}).then(y=>y.json());s(!0);const v=(x==null?void 0:x.length)>0?x.map(y=>({...y,uuid:y.id})):[];d(v)},c=async()=>{u("Comming soon! :)",m.INFO)},p=async()=>{const v=(await fetch(`${N}/radio/stations`).then(y=>y.json()).then(y=>JSON.parse(y))).map(y=>({coverUrl:y.favicon,name:y.name,url:y.url_resolved,uuid:y.stationuuid}));r(v)},f=async()=>{window.open("https://www.radio-browser.info/tags","_blank").focus()};return e.jsxs("div",{className:"home",id:"radio-page",children:[e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(_t,{}),e.jsx("h3",{children:"Favorite radios"})]}),e.jsx("div",{className:"album-displayer",id:"fav-radios","data-flat":"true","data-no-tracks":(o==null?void 0:o.length)==0&&t?"true":"false",children:t?(o==null?void 0:o.length)>0?o.map(x=>e.jsx(Ps,{radio:x},x.id)):null:e.jsx(Qo,{})}),e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(ma,{}),e.jsx("h3",{style:{marginRight:"20px"},children:"Discover"})]}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(oe,{text:"Filters",icon:e.jsx(ha,{}),onClick:c}),e.jsx(oe,{text:"Random",icon:e.jsx(lt,{}),onClick:p}),e.jsx(oe,{text:"External search",icon:e.jsx(fa,{}),onClick:f})]}),e.jsx("div",{className:"album-displayer",children:(l==null?void 0:l.length)!==0?l.map((x,v)=>e.jsx(Ps,{radio:x},v)):null})]})},Yo=()=>{const t=n.useRef(),s=n.useRef(null),{getFFTAtCurrentTime:o,fftConfigRef:d,globalAudioRef:l,FFTUserSetingsRef:r,fetchFFTUserSettings:a,colorOverride:u,currentTrackData:m}=ae(),h=n.useRef(0),c=p=>{var x,v;if((m==null?void 0:m.type)=="radio"){cancelAnimationFrame(t.current);return}if(!s.current){t.current=requestAnimationFrame(c);return}const f=s.current.getContext("2d");if(f&&r.current&&u.current){if(p-h.current<1e3/r.current.FPS){t.current=requestAnimationFrame(c);return}h.current=p;const y=r.current.bars;f.clearRect(0,0,s.current.width,s.current.height);const O=o();if(!O){t.current=requestAnimationFrame(c);return}d.current.sampleRate/O.length;const k=Math.max(1,O.length/y),R=new Array(y);R.fill(0);for(let b=0;b<O.length;b++)R[Math.floor(b/k)]+=Number(O[b]);let U=s.current.width/y-1,P=0;for(let b=0;b<R.length;b++){const F=r.current.scale*Math.log2(R[b])*(y/5)*((x=l.current)==null?void 0:x.volume);if(((v=u.current)==null?void 0:v.length)>0){const I=Math.min(1,Math.max(0,F/r.current.scale/r.current.contrast/300));f.fillStyle=`rgb(
						${Je(u.current[0][0],u.current[1][0],I)} 
						${Je(u.current[0][1],u.current[1][1],I)}
						${Je(u.current[0][2],u.current[1][2],I)}
						)`}else f.fillStyle=`rgb(${F/r.current.scale/r.current.contrast} 137 255)`;f.fillRect(P,s.current.height-F,U,F),P+=U+1}}t.current=requestAnimationFrame(c)};return n.useEffect(()=>{if(!d.current){cancelAnimationFrame(t.current),console.log("No FFT data to display, releasing anim frame.");return}t.current=requestAnimationFrame(c),console.log("FFT found, requested animation frame.")},[d.current]),n.useEffect(()=>(t.current=requestAnimationFrame(c),()=>{cancelAnimationFrame(t.current)}),[]),e.jsx("canvas",{ref:s,id:"fft-canvas",width:1900,height:1e3})},Xo=()=>{const{playingTrack:t}=ae();return e.jsxs("div",{className:"content-with-fft",children:[e.jsx(Ls,{})," ",t?e.jsx(Yo,{}):null]})},Zo=t=>{const s=/^\[(\d{1,2}):(\d{1,2}\.\d{1,2})\][ \t]*(.*)$/gm;return[...t.matchAll(s)].map(o=>({time:Number(o[1])*60+Number(o[2]),lyric:o[3]}))},ec=()=>{const{currentTrackData:t,currentTime:s}=ae(),{subscribe:o}=xe(),d=n.useRef(!1),l=n.useRef(null),r=n.useRef(0),a=n.useRef(0),[u,m]=n.useState(null);n.useEffect(()=>{t.lyrics&&(l.current=Zo(t.lyrics),m({previous:[],current:"",next:l.current.slice(0,2).map(c=>c.lyric)}))},[t.lyrics]);const h=c=>{d.current=!0;const p=l.current.findIndex(f=>f.time>c);m({previous:l.current[p-2].lyrics,current:l.current[p-1].lyric,next:l.current.slice(p,p+2).map(f=>f.lyric)}),r.current=c,a.current=p};return n.useEffect(()=>{const c=o("on-seek-song",h);return h(s),()=>{c()}},[]),n.useEffect(()=>{if(!t.lyrics)return;if(d.current){d.current=!1;return}const c=a.current;s>=l.current[c].time&&(m({previous:u?u.current:"",current:l.current[c].lyric,next:l.current.slice(c+1,c+3).map(p=>p.lyric)}),a.current=c+1),r.current=s},[s]),e.jsxs("div",{id:"track-lyrics-div",children:[e.jsx("span",{className:"off-lyrics",children:u==null?void 0:u.previous}),e.jsx("span",{className:"in-lyrics",children:u==null?void 0:u.current}),u==null?void 0:u.next.map(c=>e.jsx("span",{className:"off-lyrics",children:c}))]})},tc=()=>{const{fullScreenImage:t,currentTrackData:s,requestNewFullScreenImage:o,playingTrack:d,toggleFullScreenView:l,colorOverride:r,recomputeColors:a,songPalette:u}=ae(),m=n.useRef(null),h=n.useRef(null),c=n.useRef(null),p=n.useRef(null),f=n.useRef(null),x=n.useRef(!1),v=n.useRef(0),y=3,O=n.useRef(0),[k,R]=n.useState(!1);n.useRef([]);const U=n.useRef(0),P=n.useRef(0),b=n.useRef(0),F=T=>{x.current?(m.current.src=URL.createObjectURL(T),h.current.src=URL.createObjectURL(T),f.current=m.current):(c.current.src=URL.createObjectURL(T),p.current.src=URL.createObjectURL(T),f.current=c.current),f.current.addEventListener("load",M)};n.useEffect(()=>{if(m.current&&h.current){if((s==null?void 0:s.type)=="radio"){if(s.coverUrl){const T=`${N}/radio/favicon-proxy?url=${encodeURIComponent(s.coverUrl)}`;x.current?(m.current.src=T,h.current.src=T,f.current=m.current):(c.current.src=T,p.current.src=T,f.current=c.current)}return}d&&((t==null?void 0:t.track)!==d?(x.current=!x.current,o().then(T=>{F(T.blob)})):F(t.blob))}},[s,d]);const I=(T,V)=>{T?(m.current.setAttribute("data-hidden",V),h.current.setAttribute("data-hidden",V)):(c.current.setAttribute("data-hidden",V),p.current.setAttribute("data-hidden",V))},S=()=>{m.current.removeEventListener("load",M),J()},M=()=>{var T;(T=f.current)!=null&&T.src&&(I(x.current,!1),I(!x.current,!0),clearTimeout(U.current),U.current=setTimeout(()=>{x.current?c.current&&(c.current.src=null,p.current.src=null):m.current&&(m.current.src=null,h.current.src=null)},1100),a(f,S))},J=()=>{const T=u.current.pairs.length||0;if(T===0)return;const V=u.current.pairs[T-1-b.current%T],G=[V.c1,V.c2];b.current+=1,clearTimeout(P.current),r.current.length===0?r.current=G:_(G,0)},_=(T,V)=>{r.current=r.current.map((G,D)=>G.map((ee,X)=>parseInt(Je(ee,T[D][X],.1)))),!(V>150)&&(P.current=setTimeout(()=>{_(T,V+1)},1e3/60))};return n.useEffect(()=>{var D,ee;const T=()=>{v.current=0,R(!1)},V=()=>{v.current++,v.current>=y?+R(!0):R(!1)},G=["mousemove","keydown","mousedown","touchstart","scroll"];return G.forEach(X=>{window.addEventListener(X,T)}),O.current=setInterval(V,1e3),(D=f.current)!=null&&D.complete&&((ee=f.current)!=null&&ee.src)&&a(m,S),()=>{G.forEach(X=>{window.removeEventListener(X,T)}),clearInterval(O.current),clearTimeout(P.current),r.current=[]}},[]),e.jsxs("div",{id:"full-screen-page",children:[e.jsxs("div",{className:"full-screen-header",children:[e.jsx("button",{className:"roundButton full-screen-back go-back","data-inactive":k,onClick:l,children:e.jsx(Xe,{})}),e.jsx("button",{className:"roundButton full-screen-back","data-inactive":k,onClick:J,children:e.jsx(pa,{})})]}),e.jsx(ec,{}),e.jsx("div",{"data-inactive":k,className:"full-screen-audio-ctrl",children:e.jsx(Ot,{context:""})}),(d||(s==null?void 0:s.type)=="radio")&&e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:h,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:m,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"})}),e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:p,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:c,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"})})]})]})};function sc(t=[]){const s=Ve();n.useEffect(()=>{t.includes(s.pathname)?(document.documentElement.classList.add("scroll-enabled"),document.body.classList.add("scroll-enabled")):(document.documentElement.classList.remove("scroll-enabled"),document.body.classList.remove("scroll-enabled"))},[s,t])}const Ae={TRACK:"track",PLAYLIST:"playlist",ALBUM:"album",GENRE:"genre",ARTIST:"artist"},nc=()=>{const t=n.useRef(null),[s,o]=n.useState(!1),[d,l]=n.useState([]),{openTrackActions:r,playTrackNoQueue:a}=ae(),u=me(),m=f=>{const x=f.target.value;if(x===""||x.trim().length===0){l([]);return}console.log(`${N}/read-write/search/${x}`),fetch(`${N}/read-write/search/${x}`,{method:"GET",credentials:"include"}).then(v=>{if(v.ok)return v.json();throw new Error("Error fetching search results")}).then(v=>{var O,k,R,U,P;const y=[...(O=v.tracks)==null?void 0:O.map(b=>({type:"track",...b})),...(k=v.albums)==null?void 0:k.map(b=>({type:"album",...b})),...(R=v.artists)==null?void 0:R.map(b=>({type:"artist",...b})),...(U=v.genres)==null?void 0:U.map(b=>({type:"genre",...b})),...(P=v.playlists)==null?void 0:P.map(b=>({type:"playlist",...b}))].map(b=>{const F=b.path,{trackPath:I,...S}=b,M=b.type==="artist"?Ae.ARTIST:b.type==="album"?Ae.ALBUM:b.type==="genre"?Ae.GENRE:b.type==="playlist"?Ae.PLAYLIST:Ae.TRACK;return{icon:()=>F?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${b.type==="artist"?"artist":"covers"}/${F}`,alt:b.name}):e.jsx(ne,{className:"action-bar-entry-logo"}),tooltip:()=>e.jsx(ns,{onClick:J=>{h(J,{code:M,id:b.id})}}),code:M,fileName:F,...S}});console.log(y),l(y)})},h=(f,x)=>{r({x:f.clientX,y:f.clientY},x,()=>{},()=>{})},c=f=>{s||setTimeout(()=>{requestAnimationFrame(()=>{var x;(x=t.current)==null||x.focus()})},0)},p=f=>{switch(f.code){case Ae.TRACK:a(f.id);break;case Ae.ALBUM:u(`/albums/${f.id}`);break;case Ae.ARTIST:u(`/artists/${f.id}`);break;case Ae.GENRE:u(`/genres/${f.id}`);break;case Ae.PLAYLIST:u(`/playlists/${f.id}`);break}};return e.jsx("div",{className:"action-bar",id:"researchbar",children:e.jsxs("div",{className:"action-bar-research",onClick:c,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Me,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:m,placeholder:"Search for tracks, artists, genres, playlists..",ref:t,onFocus:()=>{o(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${s?"block":"none"}`},children:d.map((f,x)=>e.jsx(ut,{entry:f,className:"from-search-bar",onClick:p},x))})]})})},rc=()=>(sc(["/","/register","/settings","/admin-pannel"]),e.jsx(ja,{children:e.jsx(Ta,{children:e.jsxs(_a,{children:[" ",e.jsx(uo,{children:e.jsxs(mr,{children:[e.jsx(ue,{path:"/",element:e.jsx(ko,{})}),e.jsx(ue,{path:"register",element:e.jsx(_o,{})}),e.jsx(ue,{element:e.jsx(Xo,{}),children:e.jsx(ue,{path:"full-screen",element:e.jsx(tc,{})})}),e.jsxs(ue,{element:e.jsx(vo,{}),children:[e.jsx(ue,{path:"home",element:e.jsx(jo,{})}),e.jsx(ue,{path:"albums",element:e.jsx(yo,{})}),e.jsx(ue,{path:"albums/:albumId",element:e.jsx(Fs,{})}),e.jsx(ue,{path:"artists",element:e.jsx(To,{})}),e.jsx(ue,{path:"artists/:artistId",element:e.jsx(wo,{})}),e.jsx(ue,{path:"genres",element:e.jsx(qo,{})}),e.jsx(ue,{path:"genres/:genreId",element:e.jsx(Bo,{})}),e.jsx(ue,{path:"playlists",element:e.jsx(Wo,{})}),e.jsx(ue,{path:"playlists/:playlistId",element:e.jsx(Fs,{isPlaylist:!0})}),e.jsx(ue,{path:"cooking",element:e.jsx(Ko,{})}),e.jsx(ue,{path:"radio",element:e.jsx(Jo,{})}),e.jsx(ue,{path:"search",element:e.jsx(nc,{})})]}),e.jsx(ue,{path:"account",element:e.jsx(Ro,{})}),e.jsx(ue,{path:"settings",element:e.jsx(Po,{})}),e.jsx(ue,{path:"admin-pannel",element:e.jsx(Uo,{})}),e.jsx(ue,{path:"*",element:e.jsx(Eo,{})})]})})]})})}));dr.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(hr,{children:e.jsx(rc,{})})}));
