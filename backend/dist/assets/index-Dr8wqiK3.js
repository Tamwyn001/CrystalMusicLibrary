import{r as t,j as e}from"./react-DmLYqgKm.js";import{c as jn}from"./react-dom-DPPwivfB.js";import{u as xe,a as ht,L as Qe,O as ss,b as St,R as yn,c as fe,B as bn}from"./react-router-C4BYJpcq.js";import{I as Nn,a as et,b as Sn,c as Ce,d as tt,e as kn,f as ft,g as st,h as ns,i as wn,j as Tn,k as En,l as Cn,m as Rn,n as kt,o as $t,p as rs,q as rt,r as as,s as cs,t as An,u as os,v as In,w as Fn,x as $n,y as Pn,z as Ln,A as On,B as Mn,C as Un,D as Lt,E as _n,F as Bn,G as Dn,H as Gn,J as nt,K as Vn,L as It,M as Hn,N as Wn,O as zn,P as qn,Q as Jn,R as Ot,S as Yn,T as Kn,U as Qn,V as Xn,W as Zn,X as er,Y as tr,Z as sr,_ as nr,$ as rr,a0 as ar,a1 as cr,a2 as He,a3 as Mt,a4 as is,a5 as or,a6 as ir,a7 as lr,a8 as ur,a9 as dr,aa as ls,ab as mr,ac as hr,ad as fr,ae as pr,af as gr,ag as xr,ah as vr,ai as jr,aj as yr,ak as br,al as Nr,am as Sr,an as kr,ao as wr,ap as Tr}from"./@tabler-DmHM51rH.js";import{_ as ut}from"./lodash-BhRqD2di.js";import{F as Le}from"./react-window-Dlc0x0tK.js";import{v as dt}from"./uuid-C6aID195.js";import{Z as Ut}from"./react-colorful-0uAH5Wqu.js";import{p as Er}from"./music-metadata-CvBiwAZp.js";import{a as Cr}from"./axios-xsH4HHeE.js";import{u as Rr}from"./react-intersection-observer-BjkFkzMn.js";import{u as Ar}from"./color-thief-4CsBcpPW.js";import"./content-type-kkloIWN6.js";import"./scheduler-SPyfQU6S.js";import"./cookie--_YQFYBD.js";import"./@babel-Cj2_JSWT.js";import"./memoize-one-CcMeOnPo.js";import"./strtok3-BXaumHbT.js";import"./peek-readable-BVp5v6zA.js";import"./file-type-BdA4k6lR.js";import"./token-types-D2R8hC8p.js";import"./ieee754-DcnkbHBT.js";import"./@tokenizer-Sx_RGPFW.js";import"./fflate-D0DoR3vL.js";import"./debug-Dqg9INeJ.js";import"./ms-CzQ2E3wO.js";import"./uint8array-extras-B1Dultle.js";import"./media-typer-Kaw9hxcp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function c(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=c(o);fetch(o.href,r)}})();const Ir=()=>{const n=window.location.hostname,s=window.location.port;return n==="localhost"||n.startsWith("127.0.0.1")?`http://localhost:${s}`:`http://${n}:${s}`},v=Ir(),Fr=()=>{const[n,s]=t.useState(!1),[c,i]=t.useState(!1),o=xe();function r(){s(!n)}const l=()=>e.jsx(Nn,{className:"userImage buttonRound",onClick:r}),u=()=>{fetch(`${v}/auth/logout`,{method:"POST",credentials:"include"}).then(a=>{a.ok?o("/"):console.error("Logout failed")}).catch(a=>{console.error("Error:",a)})},p=()=>{o("/account")},f=()=>{o("/settings")};return t.useEffect(()=>{fetch(`${v}/auth/is-admin`,{method:"POST",credentials:"include"}).then(a=>a.json()).then(a=>{i(a)})},[]),e.jsxs("div",{className:"userDropdown",children:[e.jsx(l,{}),n&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"userAccount dropdownEntry",onClick:p,children:"Account"}),e.jsx("button",{className:"userSetting dropdownEntry",onClick:f,children:"Settings"}),c&&e.jsx("button",{className:"userSetting dropdownEntry",onClick:()=>{o("/admin-pannel")},children:"Admin pannel"}),e.jsx("button",{className:"userLogout dropdownEntry",onClick:u,children:"Logout"})]})]})},_t=n=>{var s=function(l){return("00"+l).slice(-2)};const c=Math.floor(n/3600),i=Math.floor(n%3600/60),o=s(Math.floor(n%60)),r=c>0?`${c}:${i}:${o}`:`${i}:${o}`;return{hours:c,minutes:i,seconds:o,readable:r}},Ft=n=>{const s=Math.floor(n/1024),c=Math.floor(s/1024),i=Math.floor(c/1024),o=Math.floor(i/1024),r=o>0?`${Number(n/1024/1024/1024/1024).toFixed(2)}TB`:i>0?`${Number(n/1024/1024/1024).toFixed(2)}GB`:c>0?`${Number(n/1024/1024).toFixed(2)}MB`:`${Number(n/1024).toFixed(2)}KB`;return{kb:s,mb:c,gb:i,tb:o,readable:r}},us=(n,s,c)=>{s/=100,c/=100;let i=(1-Math.abs(2*c-1))*s,o=i*(1-Math.abs(n/60%2-1)),r=c-i/2,l=0,u=0,p=0;return 0<=n&&n<60?(l=i,u=o,p=0):60<=n&&n<120?(l=o,u=i,p=0):120<=n&&n<180?(l=0,u=i,p=o):180<=n&&n<240?(l=0,u=o,p=i):240<=n&&n<300?(l=o,u=0,p=i):300<=n&&n<360&&(l=i,u=0,p=o),l=Math.round((l+r)*255).toString(16),u=Math.round((u+r)*255).toString(16),p=Math.round((p+r)*255).toString(16),l.length==1&&(l="0"+l),u.length==1&&(u="0"+u),p.length==1&&(p="0"+p),"#"+l+u+p},Ze=(n,s,c)=>n+(s-n)*c,$r=(n,s,c,i,o)=>Ze(i,o,(n-s)/(c-s)),Ue=(n,s)=>{var c=n??"";return c.length>s?c.substring(0,s-2)+"..":c},Pr=()=>new Promise(async n=>{const s=await fetch(`${v}/auth/verifyToken`,{method:"POST",credentials:"include"}).then(async c=>c.ok?!0:(await fetch(`${v}/auth/logout`,{method:"POST",credentials:"include"}).then(i=>{i.ok?window.location.href="/":console.error("Logout failed")}),!1));n(s)}),pt=n=>async function(){Pr()&&n()},pe=({col1:n="#f9c58d",col2:s="#f492f0",className:c})=>e.jsxs("svg",{viewBox:"0 0 512 512",className:c,xmlns:"http://www.w3.org/2000/svg",fill:"#000000",children:[e.jsxs("defs",{children:[e.jsx("mask",{id:"mask_logo",fill:"black",children:e.jsx("path",{fill:"white",d:"M116.215 17.404c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm64.326 12.87l-23.488 92.062h63.965l27.49-27.49-67.967-64.573zm228.147 25.958c0 20.214-20.216 40.428-40.43 40.428 20.214 0 40.43 20.214 40.43 40.428 0-20.214 20.213-40.428 40.427-40.428-20.214 0-40.428-20.214-40.428-40.428zm-150.022 53.913l-23.18 23.18L283.043 311h29.066l-53.443-200.855zm75.232 2.365l16.123 32.281 45.188 33.148-4.393-53.533-56.918-11.896zm-18.033 4.181l-26.685 38.121 10 37.586 33.38-42.283-16.695-33.424zm-160.672 23.645L172.42 206.4l21.988 12.623L239.043 311h25.365l-45.68-170.664h-63.535zm189.797 23.088l-40.03 50.703L330.737 311h.026l64.08-111.004-49.852-36.572zm122.352 5.834c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm-374.22 12.375l11.308 76.129 48.834-6.356 19.322-24.154-79.465-45.62zm346.995 53.793l-52.547 13.172L351.547 311h25.77l19.16-19.48 43.64-56.094zm-255.21 5.244l-17.403 21.75 25.77 48.58h25.761l-34.129-70.33zm-33.84 29.174l-39.005 5.074L148.145 311h24.751l-21.83-41.156zm-91.37 11.396c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zM137 329v30h238v-30H137zm32 48v78h16v-78h-16zm34 0v78h106v-78H203zm124 0v78h16v-78h-16zm-164.758 96l-30.119 16h247.754l-30.12-16H162.243z"})}),e.jsxs("linearGradient",{id:"grad_logo",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:n}),e.jsx("stop",{offset:"100%",stopColor:s})]})]}),e.jsx("rect",{x:"0",y:"0",width:"512",height:"512",fill:"url(#grad_logo)",mask:"url(#mask_logo)"})]}),gt=({entry:n,style:s,onClick:c})=>e.jsxs("div",{className:"action-bar-entry",style:s,onClick:()=>{c(n)},children:[n.icon(),e.jsxs("span",{style:{flex:"1"},children:[" ",n.name]}),n.tooltip?n.tooltip(n.type):null]}),ds=t.createContext(),it={SUCCESS:"success",ERROR:"error",INFO:"info",SALAD:"salad"},Lr=({children:n})=>{const[s,c]=t.useState(null),[i,o]=t.useState(null),r=t.useRef(null),l=t.useRef([]),u=(f,a)=>{l.current.forEach(h=>clearTimeout(h)),l.current=[],o({message:f,state:a}),c(!0);const m=setTimeout(()=>{r.current&&(r.current.setAttribute("direction",""),r.current.offsetWidth,r.current.setAttribute("direction","hide"));const h=setTimeout(()=>{c(!1),o(null)},300);l.current.push(h)},2e3);l.current.push(m)};t.useEffect(()=>{i&&c(!0)},[i]),t.useEffect(()=>{!s||!r.current||r.current.setAttribute("direction","show")},[s]);const p=()=>{if(!s)return null;switch(i==null?void 0:i.state){case it.SUCCESS:return e.jsx(tt,{className:"notification-icon"});case it.ERROR:return e.jsx(Ce,{className:"notification-icon"});case it.INFO:return e.jsx(Sn,{className:"notification-icon"});case it.SALAD:return e.jsx(et,{className:"notification-icon"});default:return null}};return e.jsxs(ds.Provider,{value:{notifTypes:it,addNotification:u},children:[n,i?e.jsx("div",{ref:r,className:"notification-parent",id:"notification-parent",children:e.jsxs("div",{className:"notification","is-open":i?"true":"false",children:[e.jsx(p,{}),e.jsx("span",{children:i.message})]})}):null]})},We=()=>t.useContext(ds),Or=({onClose:n,track:s})=>{const[c,i]=t.useState(!1),o=t.useRef(null),r=t.useRef(null),[l,u]=t.useState([]),[p,f]=t.useState(null),[a,m]=t.useState(""),{addNotification:h,notifTypes:x}=We(),S=C=>{if(C.preventDefault(),a==""&&!p){n(!1);return}fetch(`${v}/read-write/moveTrackToAlbum/${a?"true/"+a:"false/"+p.id}/${s.id}`).then(I=>I.json()).then(I=>{h(`Track ${s.title} moved to 
            ${a||p.name}.`,x.INFO),n(!0)})},y=C=>{f(null),m(C.target.value)},_=C=>{const{tooltip:I,...$}=C;b(),f($),m("")};t.useEffect(()=>{const C=I=>{r.current&&!r.current.contains(I.target)&&b()};return document.addEventListener("mousedown",C),document.addEventListener("touchstart",C),()=>{document.removeEventListener("mousedown",C),document.removeEventListener("touchstart",C)}},[]);const b=()=>{i(!1),o.current.value="",u([])},N=()=>e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Move to album"})," "]}),E=C=>{const I=C.target.value;if(I===""||I.trim().length===0){u([]);return}console.log(`${v}/read-write/search/${I}/${["albums"]}`),fetch(`${v}/read-write/search/${I}/${["albums"]}`,{method:"GET"}).then($=>$.json()).then($=>{u([...$.albums].map(B=>{const w=B.path,{trackPath:O,...G}=B;return{icon:()=>w?e.jsx("img",{className:"action-bar-entry-logo",src:`${v}/covers/${w}`,alt:B.name}):e.jsx(pe,{className:"action-bar-entry-logo"}),tooltip:N,...G}}))})};return e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:null,children:[e.jsx("h2",{children:"Move track to another album"}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:S,children:[e.jsx("label",{htmlFor:"newAlbum",style:a?{}:{opacity:"0.5"},children:"New album name"}),e.jsx("input",{type:"text",style:a?{}:{opacity:"0.5"},id:"newAlbum",placeholder:"Enter album name",onChange:y}),e.jsx("label",{htmlFor:"existingAlbum",style:a?{opacity:"0.5"}:{},children:"Existing album"}),e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:r,style:a?{opacity:"0.5"}:{},children:e.jsxs("div",{className:"action-bar-research",style:{transform:"translateX(15px)"},id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(kn,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:E,placeholder:"Search the album you want to move the track to.",ref:o,onFocus:()=>{i(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${c?"block":"none"}`},children:e.jsx(Le,{height:300,itemCount:l.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:C,style:I})=>e.jsx(gt,{entry:l[C],style:{...I,width:" calc(100% - 20px)",marginTop:"10px"},onClick:_},C)})})]})}),p?e.jsxs("div",{style:{height:"90px",alignItems:"center",display:"flex",gap:"10px"},children:[p!=null&&p.icon?p.icon():null,p.name]}):null,e.jsx("input",{type:"submit",value:"Submit"})]})]})})},ms=()=>e.jsxs("div",{className:"three-points-loader",children:[e.jsx("div",{className:"point point1"}),e.jsx("div",{className:"point point2"}),e.jsx("div",{className:"point point3"})]}),me=({onClick:n,text:s,icon:c,style:i})=>{const[o,r]=t.useState(!1),l=()=>{r(!0),n().then(()=>{r(!1)})},u=()=>o?e.jsx(ms,{}):e.jsxs(e.Fragment,{children:[c,s]});return e.jsx("button",{className:"button-with-callback",style:{...i},onClick:l,children:e.jsx(u,{})})},Mr=({applyCanges:n,albumClass:s})=>{var b,N;const[c,i]=t.useState({visible:!1}),[o,r]=t.useState(null),[l,u]=t.useState("2000-00-00"),[p,f]=t.useState(null),[a,m]=t.useState(!1),{deleteAlbum:h}=le();if(!s)return null;t.useEffect(()=>{s&&(r(s.coverURL),u(s.year))},[s]);const x=()=>{const E=document.getElementById("editAlbumInfos"),C=E.artistName.value.split(",").map(G=>G.trim()),I=E.genre.value.split(",").map(G=>G.trim()).map(G=>G.charAt(0).toUpperCase()+G.slice(1)).filter(G=>G!="");if(!(E.albumName.value!==s.name||s.artist.toString()!==C.toString()||s.year!==E.releaseDate.value||s.genre.toString()!==I.toString()||s.description!==E.description.value||p||a)){n(null);return}s.name=E.albumName.value,s.artist=C,s.year=E.releaseDate.value,s.genre=I,s.description=E.description.value;const{tracks:B,coverURL:w,...O}=s;console.log(O),n(O,p)},S=E=>{const C=E.target.files[0];C&&(s.ext=C.name.split(".").pop(),r(URL.createObjectURL(C)),f(C))},y=E=>{i({visible:!c.visible,...E})},_=E=>{console.log(E),!a&&E&&m(!0),i({visible:!1})};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(pe,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(ft,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:S})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"}),e.jsx(me,{onClick:async()=>{h(!0,{name:s.name,id:s.id})},text:"Delete for me",icon:e.jsx(st,{}),style:{marginTop:"auto"}}),e.jsx(me,{onClick:async()=>{h(!1,{name:s.name,id:s.id})},text:"Remove from library",icon:e.jsx(st,{})})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(b=s.artist)==null?void 0:b.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",value:l,onChange:E=>{u(E.target.value)}})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(N=s.genre)==null?void 0:N.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Le,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:E,style:C})=>e.jsxs("div",{style:C,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[E].title}),e.jsx(ns,{className:"trackIcon",onClick:()=>{y(s.tracks[E])}})]},E)})})]}),c.visible&&e.jsx(Or,{onClose:_,track:{id:c.id,title:c.title}})]})})},Xt=({closeOverlay:n,applyCanges:s,editPlaylistClass:c})=>{const[i,o]=t.useState(null),[r,l]=t.useState(null),[u,p]=t.useState(c||{id:dt()}),[f,a]=t.useState([]),[m,h]=t.useState([]);t.useEffect(()=>{u&&o(u.coverURL),u.collaborators&&h(u.collaborators)},[u]);const x=()=>{const b=document.getElementById("editAlbumInfos");if(!(b.playlistName.value!==u.name||u.description!==b.description.value||r||u.collaborators.map($=>!m.includes($)).filter($=>$))){s(null);return}u.name=b.playlistName.value,u.description=b.description.value,u.collaborators=m.map($=>$.id);const{tracks:E,coverURL:C,...I}=u;console.log(I),s(I,r)},S=b=>{const N=b.target.files[0];N&&(u.ext=N.name.split(".").pop(),o(URL.createObjectURL(N)),l(N))};t.useEffect(()=>{fetch(`${v}/auth/collaborators`,{method:"GET",credentials:"include"}).then(b=>b.json()).then(b=>{console.log(b),a(b)})},[]);const y=b=>{const N=b.target.value;m.includes(N)||N==="pickUsers"||(h(E=>[...E,f.find(C=>C.id==N)]),b.target.value="pickUsers")};t.useEffect(()=>{console.log(m)});const _=b=>{h(m.filter(N=>N.id!=b))};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsx(Ce,{className:"buttonRound closeOverlay",onClick:n}),e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[i?e.jsx("img",{id:"coverPicture",src:i,style:{width:"100%"}}):e.jsx(pe,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(ft,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:S})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"playlistName",children:"Playlist name"}),e.jsx("input",{type:"text",id:"playlistName",placeholder:"Enter playlist name",defaultValue:u==null?void 0:u.name}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",style:{height:"80px",paddingTop:"10px",paddingBottom:"10px"},placeholder:"Enter description",defaultValue:u==null?void 0:u.description})]}),e.jsx("label",{htmlFor:"new-collab",children:"Add collaborators"}),e.jsxs("select",{onChange:y,children:[e.jsx("option",{value:"pickUsers",children:"Pick users"},"root"),f.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]}),e.jsx("label",{children:"Collaborators:"}),e.jsx("div",{children:m==null?void 0:m.map(b=>e.jsxs("div",{children:[e.jsx("span",{children:b==null?void 0:b.name}),e.jsx(wn,{className:"buttonRound",onClick:()=>{_(b.id)}})]},b==null?void 0:b.id))})]})]})})};function Ur(){const{innerWidth:n,innerHeight:s}=window;return{width:n,height:s}}const _r=({trackY:n,track:s,isFav:c})=>{const[i,o]=t.useState(Ur()),{onClicTrackActionEntry:r,trackActionTypes:l}=le(),[u,p]=t.useState(!1),f=t.useRef(null),[a,m]=t.useState(null),h=ht(),[x,S]=t.useState(()=>window.innerWidth<714);return t.useEffect(()=>{const y=_=>{f.current&&!f.current.contains(_.target)&&r(l.NONE)};return document.addEventListener("mousedown",y),document.addEventListener("touchstart",y),p(h.pathname.includes("playlist")),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("touchstart",y)}},[]),t.useEffect(()=>{const y=u?250:180;m(Math.min(n,i.height-y))},[u]),a&&e.jsxs("div",{className:"track-actions-div",ref:f,style:{height:"fit-content",top:a},children:[e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.TOP_QUEUE,s)},children:[e.jsx("span",{children:"Front queue"})," ",e.jsx(Tn,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.END_QUEUE,s)},children:[e.jsx("span",{children:"Back queue"})," ",e.jsx(En,{})]}),u&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.GOTO_ALBUM,s)},children:[e.jsx("span",{children:"View album"})," ",e.jsx(Cn,{})]}),u&&!c&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.REMOVE_FROM_PLAYLIST,s)},children:[e.jsx("span",{children:"Delete from playlist"})," ",e.jsx(Rn,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.TAGS,s)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(kt,{})]}),x&&s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.REMOVE_FROM_FAVORITES,s)},children:[e.jsx("span",{children:"Remove from favorite"})," ",e.jsx($t,{})]}):null,x&&!s.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(l.ADD_TO_FAVORITES,s)},children:[e.jsx("span",{children:"Add to favorites"})," ",e.jsx(rs,{})]}):null]})},lt={name:"Create a new tag",icon:()=>e.jsx(as,{}),isAction:!0},Br=({track:n,apply:s})=>{const c=t.useRef(null),[i,o]=t.useState(!1),[r,l]=t.useState([lt]),[u,p]=t.useState("#aabbcc"),[f,a]=t.useState(!1),m=t.useRef(null),h=t.useRef(null),[x,S]=t.useState([]),[y,_]=t.useState(null),[b,N]=t.useState(null),[E,C]=t.useState([]),I=t.useRef(),$=L=>{const P=L.target.value;if(N(P),P===""||P.trim().length===0){l([lt]);return}fetch(`${v}/read-write/search/${P}/tags`,{method:"GET"}).then(K=>{if(K.ok)return K.json();throw new Error("Error fetching search results")}).then(K=>{var X;const D=(X=K.tags)==null?void 0:X.map(re=>({...re,icon:()=>e.jsx(kt,{color:re.color}),isAction:!1})),ce={name:`${lt.name}: ${P}`,icon:lt.icon,isAction:lt.isAction};D.splice(0,0,ce),l(D)})},B=()=>{o(!1)},w=L=>{if(B(),L.isAction){_("new"),p(`${us(Math.random().toFixed(4)*360,100,70.8)}`);return}x.find(P=>P.id===L.id)||(C(P=>P.filter(K=>K!==L.id)),S(P=>[...P,L]))};t.useEffect(()=>{y==="new"&&(h.current.focus(),h.current.value=b||"",I.current.value="")},[y]),t.useEffect(()=>{const L=P=>{var K;if(m.current&&!m.current.contains(P.target)){if(((K=P.target.closest("svg"))==null?void 0:K.id)==="color-button")return;a(!1)}if(c.current&&!c.current.contains(P.target)){B();return}};return document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),fetch(`${v}/read-write/trackTags/${n.id}`,{method:"GET"}).then(P=>P.json()).then(P=>{S(P)}),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L)}},[]);const O=()=>{const L=h.current.value;L!==""&&y==="new"&&S(P=>[...P,{name:L,color:u,id:dt(),isNew:!0}]),_(null)},G=(L,P)=>{const K=x.filter(D=>!(D.isNew===L&&D.id===P));S(K),L||C(D=>[...D,P])};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"albumWrapping-library",style:{height:"400px",flexDirection:"column"},children:[e.jsx(Ce,{className:"buttonRound closeOverlay",onClick:()=>{s(null)}}),e.jsxs("h3",{children:["Editing tags for track ",n.title]}),e.jsx("div",{className:"action-bar",style:{margin:"10px auto"},ref:c,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(rt,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:$,placeholder:"Search some tags..",ref:I,onFocus:()=>{o(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${i?"block":"none"}`},children:e.jsx(Le,{height:300,itemCount:r.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:L,style:P})=>e.jsx(gt,{entry:r[L],style:{...P,width:" calc(100% - 20px)",marginTop:"10px"},onClick:w},L)})})]})}),y?e.jsxs("div",{className:"edit-tag",children:[e.jsx(as,{style:{paddingRight:"30px"}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:h}),e.jsx(cs,{id:"color-button",color:u,onClick:()=>{a(!f)}}),f&&e.jsxs("div",{ref:m,className:"edit-tag-picker",children:[" ",e.jsx(Ut,{color:u,onChange:p})]}),e.jsx(tt,{onClick:O})]}):null,e.jsx("div",{className:"track-tags-div",children:x.map((L,P)=>e.jsxs("div",{className:"small-tag",style:{backgroundColor:L.color},children:[e.jsx("span",{children:L.name})," ",e.jsx(Ce,{onClick:()=>{G(L.isNew,L.id)}})]},`${L.isNew}-${L.id}`))}),e.jsx("button",{style:{marginTop:"auto"},onClick:()=>{s({current:x,deleted:E},n.id)},children:"Apply"})]})})},Dr=()=>{const{closeTagWindow:n}=le(),[s,c]=t.useState(0),[i,o]=t.useState([]),[r,l]=t.useState([]),[u,p]=t.useState(!1),[f,a]=t.useState("#aabbcc"),[m,h]=t.useState(null),x=t.useRef(null),S=t.useRef(null),{addNotification:y,notifTypes:_}=We(),[b,N]=t.useState(null);t.useEffect(()=>{E(),C()},[]);const E=()=>{fetch(`${v}/read-write/getAllUserTags`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{o(w)})},C=()=>{fetch(`${v}/read-write/getAllUserSalads`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{l(w)})},I=w=>{h(w),a(w.color)},$=()=>{const w={id:m.id,name:x.current.value,color:f},O=new FormData;O.append(s===0?"tag":"salad",JSON.stringify(w)),fetch(`${v}/read-write/${s===0?"applyTagModifications":"applySaladModifications"}`,{method:"POST",credentials:"include",body:O}).then(G=>G.json()).then(G=>{s===0?E():C(),y("Tag updated.",_.SUCCESS)}),h(null)},B=()=>{fetch(`${v}/read-write/delete/${b.type}/${b.id}`,{method:"DELETE",credentials:"include"}).then(w=>w.json()).then(w=>{s===0?E():C(),h(null),N(null),y("Tag deleted.",_.SUCCESS)})};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"tag-edtior-container",children:[e.jsx(Ce,{className:"buttonRound closeOverlay",onClick:n}),e.jsxs("div",{className:"cooking-selection",style:{marginTop:"40px"},children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(me,{text:"Edit tags",icon:e.jsx(An,{}),onClick:async()=>{c(0)}}),e.jsx(me,{text:"Edit salads",icon:e.jsx(et,{}),onClick:async()=>{c(1)}})]}),e.jsxs("div",{className:"edit-tags-content",children:[e.jsx(Le,{className:"albumTrackList",height:250,itemCount:s===0?i.length:r.length,itemSize:35,width:"100%",children:({index:w,style:O})=>e.jsxs("div",{style:O,className:"album-wrapping-track",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:s===0?i[w].color:r[w].color}}),e.jsx("span",{children:s===0?i[w].name:r[w].name}),e.jsx(os,{className:"trackIcon",onClick:()=>{I(s===0?{...i[w],type:"tag"}:{...r[w],type:"salad"})}})]},w)}),m?e.jsxs("div",{className:"edit-tag",style:{left:"-20px",margin:"auto"},children:[e.jsx(Ce,{style:{cursor:"pointer"},onClick:()=>{h(null)}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:x,defaultValue:m.name}),e.jsx(cs,{style:{cursor:"pointer"},id:"color-button",color:f,onClick:()=>{p(!u)}}),u&&e.jsxs("div",{ref:S,className:"edit-tag-picker",children:[" ",e.jsx(Ut,{color:f,onChange:a})]}),e.jsx(tt,{onClick:$,style:{cursor:"pointer"}}),e.jsx(st,{style:{cursor:"pointer"},onClick:()=>{N(m)}})]}):null,b?e.jsxs("div",{className:"deletion-confirmation",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:b.color,width:"50px"}}),e.jsxs("p",{children:["Confirm deletion of the ",b.type," ",b.name,"?"]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{N(null)},children:e.jsx(In,{})}),e.jsx("button",{onClick:()=>{B()},children:e.jsx(tt,{})})]})]}):null]})]})]})})},Gr=({applyChanges:n,artist:s})=>{const[c,i]=t.useState(null),[o,r]=t.useState("2000-00-00"),[l,u]=t.useState(null);if(!s)return null;t.useEffect(()=>{s&&(i(s.picture),r(s.active_from))},[s]);const p=()=>{const a=document.getElementById("editArtistInfos"),m=s.active_from??"",h=a.activeFrom.value??"",x=s.name??"",S=a.artistName.value??"",y=s.bio??"",_=a.bio.value??"";if(!(x!=S||m!=h||y!=_||l)){n(null);return}s.name=a.artistName.value,s.active_from=a.activeFrom.value,s.bio=a.bio.value;const{picture:N,...E}=s;console.log(E,l),n(E,l)},f=a=>{const m=a.target.files[0];m&&(s.ext=m.name.split(".").pop(),i(URL.createObjectURL(m)),u(m))};return e.jsx("div",{className:"albumWrapping-library-container",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[c?e.jsx("img",{id:"coverPicture",src:c,style:{width:"100%"}}):e.jsx(pe,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(ft,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:f})]}),e.jsx("button",{className:"roundButton",onClick:p,children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editArtistInfos",children:[e.jsx("label",{htmlFor:"artistName",children:"Artist name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("div",{className:"albumType",children:e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"activeFrom",children:"Active since"}),e.jsx("input",{type:"date",id:"activeFrom",value:o,onChange:a=>{r(a.target.value)}})]})}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",placeholder:"Enter biography",defaultValue:s.bio})]})]})]})})},hs=t.createContext(),wt=()=>t.useContext(hs),Vr=({children:n})=>{const s=t.useRef({}),c=(o,r)=>(s.current[o]||(s.current[o]=[]),s.current[o].push(r),console.log("registered",o,r),()=>{s.current[o]=s.current[o].filter(l=>l!=r)}),i=(o,r)=>{s.current[o]&&s.current[o].forEach(l=>{l(r),console.log("called at",l)})};return e.jsx(hs.Provider,{value:{emit:i,subscribe:c},children:n})},fs=t.createContext(void 0),Pe={TOP_QUEUE:"top_queue",END_QUEUE:"end_queue",TAGS:"tags",GOTO_ALBUM:"goto_album",REMOVE_FROM_PLAYLIST:"remove_from_playlist",ADD_TO_FAVORITES:"add_to_favs",REMOVE_FROM_FAVORITES:"remove_from_favs",NONE:"none"},Hr=()=>{const n=ht(),s=t.useRef({pointer:0,history:new Array(6).fill(null)});return t.useEffect(()=>{const{pointer:c,history:i}=s.current,o=(c-1+i.length)%i.length;i[o]!==n.pathname&&(i[c]=n.pathname,s.current.pointer=(c+1)%i.length)},[n]),s.current},Wr=({children:n})=>{const[s,c]=t.useState(""),[i,o]=t.useState(!1),[r,l]=t.useState({}),[u,p]=t.useState(0),f=t.useRef(null),a=t.useRef(null),m=t.useRef(null),[h,x]=t.useState([]),[S,y]=t.useState("null"),_=d=>`${d}`!="null"?`${v}/read-write/music/${d}`:null,[b,N]=t.useState(-1),E=t.useRef(h),C=t.useRef(b),[I,$]=t.useState(null),[B,w]=t.useState(null),{emit:O,subscribe:G}=wt(),L=t.useRef(null),[P,K]=t.useState(null),D=t.useRef(null),{addNotification:ce,notifTypes:X}=We(),re=xe(),[ue,ke]=t.useState(null),[oe,V]=t.useState(null),[j,z]=t.useState(null),ee=t.useRef("A"),Y=t.useRef(null),[de,ve]=t.useState(5),[Re,F]=t.useState(!1),[te,ge]=t.useState(()=>{const d=parseFloat(localStorage.getItem("volume"));return isNaN(d)?.5:Math.min(1,Math.max(0,d))}),[ye,Ne]=t.useState(!1),[ze,_e]=t.useState(!1),Be=t.useRef(null),M=t.useRef(null),R=t.useRef(null),T=t.useRef(null),W=t.useRef(0),q=t.useRef(null),se=t.useRef(0),Q=t.useRef(null),J=t.useRef(0),U=t.useRef(0),ae=5,je=t.useRef(""),qe=t.useRef(null),Gt=t.useRef(0),ct=t.useRef({lastAudioTime:0,lastPerformanceNow:0}),Je=t.useRef(null),bs=.1,ot=t.useRef(!1),xt=ht(),Ye=t.useRef(""),Ns=t.useRef([]),Vt=t.useRef(null),Et=Hr(),Ss=()=>{var d,g,k,A,H,ne,ie,Se;a.current=new Audio,a.current.setAttribute("source","A"),a.current.addEventListener("error",he=>{if(a.current.src.includes("spoof"))return;const be=a.current.error;if(be&&(console.warn("Audio error occurred: code",be.code),be.code===4&&s)){const Fe=`${v}/radio/spoof/${encodeURIComponent(a.current.src)}`;a.current.src=Fe,ce("Audio stream not reachable from browser. Streaming from backend..",X.INFO),o(!0),a.current.play();const De=new EventSource(`${v}/radio/trackStream/${encodeURIComponent(a.current.src)}`);De.onmessage=we=>{console.log(we);const Te=JSON.parse(we.data);console.log("Now playing:",Te.metadata.StreamTitle);const $e=Te.metadata.adw_ad=="true"?`Advertisment - ${(Number(Te.metadata.durationMilliseconds)/1e3).toFixed(1)}s`:Te.metadata.StreamTitle;l(Ge=>({...Ge,title:$e}))},De.addEventListener("error",we=>{console.warn("Metadata stream error",we)})}}),a.current.addEventListener("canplay",()=>{console.log("Stream is playable!")}),m.current=new Audio,m.current.setAttribute("source","B");for(const he of[a,m])he.current.crossOrigin="anonymous",he.current.playsInline=!0,he.current.setAttribute("webkit-playsinline",""),he.current.volume=parseFloat(localStorage.getItem("volume"))*.75||.5;(d=a.current)==null||d.addEventListener("timeupdate",jt),(g=m.current)==null||g.addEventListener("timeupdate",jt),(k=a.current)==null||k.addEventListener("playing",vt),(A=m.current)==null||A.addEventListener("playing",vt),(H=a.current)==null||H.addEventListener("play",Ke),(ne=a.current)==null||ne.addEventListener("pause",Wt),(ie=m.current)==null||ie.addEventListener("play",Ke),(Se=m.current)==null||Se.addEventListener("pause",Wt),Ct(),console.log("Audio graph setted up")},ks=()=>{var d,g,k,A,H,ne,ie,Se,he,be,Fe,De,we,Te,$e,Ge;console.log("Audio graph destructed"),(d=a.current)==null||d.pause(),a.current=null,(g=m.current)==null||g.pause(),m.current=null,(k=a.current)==null||k.removeEventListener("timeupdate",Ae),(A=a.current)==null||A.removeEventListener("ended",Ie),(H=a.current)==null||H.removeEventListener("error"),(ne=a.current)==null||ne.removeEventListener("canplay"),(ie=m.current)==null||ie.removeEventListener("timeupdate",Ae),(Se=m.current)==null||Se.removeEventListener("ended",Ie),(he=a.current)==null||he.removeEventListener("timeupdate",jt),(be=m.current)==null||be.removeEventListener("timeupdate",jt),(Fe=a.current)==null||Fe.removeEventListener("playing",vt),(De=m.current)==null||De.removeEventListener("playing",vt),(we=a.current)==null||we.removeEventListener("play",Ke),(Te=a.current)==null||Te.removeEventListener("pause",Ke),($e=m.current)==null||$e.removeEventListener("play",Ke),(Ge=m.current)==null||Ge.removeEventListener("pause",Ke)},Ct=()=>{var d,g;(d=a.current)==null||d.pause(),a.current.src=null,a.current.currentTime=0,(g=m.current)==null||g.pause(),m.current.src=null,m.current.currentTime=0,f.current=null,ee.current="A",a.current.removeEventListener("timeupdate",Ae),a.current.removeEventListener("ended",Ie),m.current.removeEventListener("timeupdate",Ae),m.current.removeEventListener("ended",Ie)},vt=()=>{q.current&&(console.log("Record start playing",f.current.currentTime),ct.current.lastAudioTime=f.current.currentTime,ct.current.lastPerformanceNow=performance.now())},Ht=()=>{const d=f.current;!d||d.paused||Math.abs(d.currentTime-Yt())>bs&&Jt()},ws=()=>(setTimeout(Ht,200),setInterval(Ht,5e3)),Ke=()=>{q.current&&(Jt(),Je.current&&clearInterval(Je.current),Je.current=ws())},Wt=()=>{Je.current&&(clearInterval(Je.current),Je.current=null)},jt=()=>{if(!q.current)return;const d=f.current.currentTime;if(Math.abs(d-Gt.current)>1){const g=1/q.current.interval,k=ae*g,A=Math.floor(d*g);se.current=0,U.current=A,qt(je.current,A,A+k)}else Es(je.current,d);Gt.current=d};t.useEffect(()=>{r&&r.type!=="radio"&&yt()},[r]);const yt=()=>{const d=h.length<=b+1;Y.current&&clearTimeout(Y.current),!(d||!f.current)&&(console.log("Transition rescheduled, timesout in ",r.rawDuration,f.current.currentTime,de,r.rawDuration-f.current.currentTime-de),Y.current=setTimeout(()=>{ee.current=ee.current==="A"?"B":"A",zt(b+1)},Math.min(r.rawDuration-f.current.currentTime-de)*1e3,0))},zt=async d=>{const g=h.length<=d;if(N(d),f.current=ee.current==="A"?a.current:m.current,h[d].startsWith("url:")){console.log(h[d]);const ne=h[d].slice(4),ie=await fetch(`${v}/radio/${ne}`).then(he=>he.json());console.log(ie),f.current.src=ie.url,l({type:"radio",artist:ie.name,...ie,duration:"0-"});const Se=new EventSource(`${v}/radio/trackStream/${encodeURIComponent(ie.url)}`);Se.onmessage=he=>{console.log(he);const be=JSON.parse(he.data);console.log("Now playing:",be.metadata.StreamTitle),l(Fe=>({...Fe,title:be.metadata.StreamTitle}))},Se.addEventListener("error",he=>{console.warn("Metadata stream error",he)}),Kt(),m.current.removeEventListener("timeupdate",Ae),m.current.removeEventListener("ended",Ie),o(!0),f.current.play();return}const k=h[d].split("."),A=k.length!=0?k[0]:h[d];await fetch(`${v}/read-write/trackInfos/${A}`,{method:"GET"}).then(ne=>ne.json()).then(ne=>{ne.duration=_t(ne.rawDuration),l(ne)});const H=h[d];if(f.current.currentTime=0,await fetch(`${v}/read-write/fftConfig/${A}`,{method:"GET",credentials:"include"}).then(async ne=>{if(se.current=0,U.current=0,J.current=0,!ne.ok){q.current=null;return}const ie=await ne.json();q.current=JSON.parse(ie);const Se=q.current.fftSize*1,he=ae/q.current.interval;Q.current=new Int16Array(he*Se),console.log("New buffer!")}),f.current.src!==_(H))f.current.src=_(H);else{p(0);return}f.current.play(),clearTimeout(R.current),c(H),je.current=H,o(!0),Ds(H),console.log("Fading in",f.current),ee.current==="A"?(g?bt(m,null):(bt(m,a),a.current.addEventListener("timeupdate",Ae),a.current.addEventListener("ended",Ie)),m.current.removeEventListener("timeupdate",Ae),m.current.removeEventListener("ended",Ie)):ee.current==="B"&&(g?bt(a,null):(bt(a,m),m.current.addEventListener("timeupdate",Ae),m.current.addEventListener("ended",Ie)),a.current.removeEventListener("timeupdate",Ae),a.current.removeEventListener("ended",Ie))},qt=async(d,g,k)=>{if(!q.current)return null;const A=q.current.fftSize*1*2,H=A*g,ne=A*k,ie=await fetch(`${v}/read-write/fft/${d}`,{headers:{Range:`bytes=${H}-${ne-1}`}});if(!ie.ok&&ie.status!==206)throw new Error("Failed to stream FFT data");J.current=k;const Se=await ie.arrayBuffer(),he=new Int16Array(Se),be=q.current.fftSize*1,Fe=he.length/be,De=q.current.interval,we=ae/De;let Te=se.current;for(let $e=0;$e<Fe;$e++){const Ge=$e*be,vn=(Te+$e)%we;Q.current.set(he.subarray(Ge,Ge+be),vn*be)}se.current=(Te+Fe)%we},Jt=()=>{ct.current.lastAudioTime=f.current.currentTime,ct.current.lastPerformanceNow=performance.now()},Ts=()=>{const{lastAudioTime:d,lastPerformanceNow:g}=ct.current,k=(performance.now()-g)/1e3;return d+k},Yt=()=>f.current.paused?f.current.currentTime:Ts(),Es=(d,g)=>{const k=1/q.current.interval,A=Math.floor(g*k),H=J.current-A,ne=k*ae;ne-H<1||qt(d,J.current,ne+A)},Cs=()=>{const d=1/q.current.interval,k=Math.floor(Yt()*d)-U.current,A=ae*d;return k%A},Rs=()=>{if(!q.current||!Q.current)return null;const d=q.current.fftSize*1,g=Cs();if(g===null)return null;const A=Math.floor(ae/q.current.interval)*d,H=g*d,ne=H+d;return ne>A?null:Q.current.slice(H,ne)},Kt=()=>{R!=null&&R.current&&clearInterval(R.current)};t.useEffect(()=>{console.log("Changed inteval ref:",R.current)},[R.current]);const bt=(d,g)=>{R.current&&clearInterval(R.current);const k=150;let A=0;console.log("Init fadeout for:",g.current),R.current=setInterval(()=>{const H=Math.min(1,Math.max(0,A*k/(de*1e3)));g.current.volume=H*W.current,d.current&&(d.current.volume=(1-H)*W.current),H>=1&&(clearInterval(R.current),R.current=null,g.current&&(d.current.pause(),d.current.src=null)),A++},k)},Ae=()=>{var d;return p((d=f.current)==null?void 0:d.currentTime)},Ie=()=>{h.length>0&&h.length<=b+1&&Rt()};t.useEffect(()=>{!Re||b===-1||h.length===0||(Ct(),console.log("init Autoplay",h,b,Re,a.current,m.current),zt(b),F(!1))},[h,b,Re]),t.useEffect(()=>{C.current=b},[b]),t.useEffect(()=>{E.current=h},[h]);const As=()=>{if(!f.current&&E.current.length>0){N(0),F(!0);return}if(i)f.current.pause(),o(!1),clearTimeout(Y.current),clearInterval(R.current);else{if(o(!0),b===-1&&h.length!==0){N(0);return}f.current.play(),yt()}},Is=(d,g=!1)=>{fetch(`${v}/read-write/nextSongs/${ue.type}/${ue.id}/${g}`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{x(k),console.log(k),N(k.findIndex(A=>A===d)),F(!0)})},Fs=d=>{x([d]),N(0),F(!0)},$s=()=>{if(f.current.currentTime>5||b===0){f.current.currentTime=0,yt();return}N(b-1),F(!0)},Ps=(d,g,k=!1)=>{F(!1),fetch(`${v}/read-write/nextSongs/${g}/${d}/${k}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(A),N(0),F(!0)})},Ls=(d,g,k=!1)=>{F(!1),fetch(`${v}/read-write/nextSongs/${g}/${d}/${k}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(H=>[...H,...A])})},Os=(d,g,k=!1)=>{console.log(`${v}/read-write/nextSongs/${g}/${d}/${k}`),fetch(`${v}/read-write/nextSongs/${g}/${d}/${k}`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{x(ut.shuffle(A)),F(!0),N(0)})},Ms=(d=!1)=>{const g=d?E.current:h,k=d?C.current:b;g.length<=k+1&&(Rt(),console.log("stop")),N(k+1),F(!0)},Rt=()=>{Ct(),p(0),o(!1),l(null),F(!1),N(-1),y("null"),x([]),c(""),je.current="",console.log("No more songs in the queue"),clearInterval(R.current),clearTimeout(Y.current),Kt()},Us=d=>{if(d<0||d>100)return;const g=d/100*f.current.duration;f.current.currentTime=g,p(g),yt()},_s=d=>{f.current.currentTime+d>f.current.duration?f.current.currentTime=f.current.duration:f.current.currentTime+d<0?f.current.currentTime=0:f.current.currentTime+=d,p(f.current.currentTime)},Bs=d=>{d<0||d>=h.length||(F(!0),N(d))},Ds=d=>{fetch(`${v}/read-write/trackCover/${d}`,{method:"GET"}).then(g=>g.json()).then(g=>{y(`${v}/covers/${g}`)})},Gs=()=>{Rt(),x([]),N(-1)},At=()=>{fetch(`${v}/config/user/FFT`,{method:"GET",credentials:"include"}).then(d=>d.json()).then(d=>{qe.current=d})};t.useEffect(()=>{ge(parseFloat(localStorage.getItem("volume"))||.5),Ss(),console.log("mount",xt.pathname),xt.pathname==="/full-screen"&&(Ye.current="",ot.current=!0),At();const d=G("login",()=>{console.warn("login triggered!"),At()});return()=>{ks(),d()}},[]);const Vs=async d=>{const g=await fetch(`${v}/read-write/artist-all-tracks/${d}`,{method:"GET",credentials:"include"});if(!g.ok)throw new Error("Network response was not ok");const A=(await g.json()).map(H=>H.id);x(H=>[...H,...A])},Hs=async d=>{const g=await fetch(`${v}/read-write/artist-all-tracks/${d}`,{method:"GET",credentials:"include"});if(!g.ok)throw new Error("Network response was not ok");const A=(await g.json()).map(H=>H.id);x(ut.shuffle(A)),F(!0),N(0)},Ws=async()=>{fetch(`${v}/read-write/all-songs`,{method:"GET"}).then(d=>d.json()).then(d=>{x(ut.shuffle(d)),F(!0),N(0)})},zs=d=>{console.log("Editing album",d),fetch(`${v}/read-write/album/${d}`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{const{albumInfos:k,genres:A,tracks:H,artists:ne}=g;$({id:d,coverURL:`${v}/covers/${k.cover}`,tracks:H,type:"album",name:k.title,artist:ne.map(ie=>ie.name),year:k.release_date,description:k.description,genre:A.map(ie=>ie.genreName)})})},qs=d=>{fetch(`${v}/read-write/playlist/${d}/true`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{const{playlistInfos:k,collaborators:A}=g;$({id:k.id,type:"playlist",coverURL:`${v}/covers/${k.cover}`,name:k.title,description:k.description,collaborators:A})})};t.useEffect(()=>{const d=Math.min(1,Math.max(0,te));R.current||Js(d.toFixed(4)*.75),W.current=d.toFixed(4)*.75,localStorage.setItem("volume",d)},[te]);const Js=d=>{T.current&&clearInterval(T.current);let g=0;const k=16,A=a.current.volume;T.current=setInterval(()=>{const H=Ze(A,d,g*k/300);a.current.volume=H,m.current.volume=H,(d-A>0?H>=d:H<=d)&&(clearInterval(T.current),T.current=null),g++},k)},Ys=(d,g=null)=>{if(!d){console.log("No changes made"),w(null);return}const k=new FormData;k.append("artist",JSON.stringify(d)),g&&k.append("coverArtist",g),fetch(`${v}/read-write/editContainer/artist`,{method:"POST",credentials:"include",body:k}).then(()=>{w(null),L.current()})},Ks=d=>{fetch(`${v}/read-write/artist/${d}/true`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{w({id:g.id,picture:`${v}/covers/artists/${g.picture}`,name:g.name,bio:g.bio,active_from:g.active_from})})},Qt=(d,g=null)=>{if(!d){console.log("No changes made"),$(null);return}const k=new FormData;k.append(`${d.type}`,JSON.stringify(d)),g&&k.append("cover",g),fetch(`${v}/read-write/editContainer/${d.type}`,{method:"POST",credentials:"include",body:k}).then(()=>{$(null),L.current()})},Qs=async(d,g)=>{const k=d?"/forMe":"";(await fetch(`${v}/read-write/delete/album/${g.id}${k}`,{method:"DELETE",credentials:"include"}).then(H=>H.json())).success&&(ce(`Album ${g.name} deleted.`,X.SUCCESS),$(null),re("/home"))},Xs=async()=>{Ne(!0)},Zs=(d,g)=>{console.log("sending playlist",d);const k=new FormData;k.append("playlist",JSON.stringify(d)),g&&(k.append("cover",g),console.log(g)),fetch(`${v}/read-write/newPlaylist`,{method:"POST",credentials:"include",body:k}).then(()=>{Ne(!1),Be.current()})},en=d=>{N(0),x([`url:${d}`]),F(!0)},tn=()=>{Ne(!1)},sn=(d,g,k,A)=>{K({track:g,position:d}),D.current&&D.current(),D.current=k,M.current=A},nn=()=>{K(null),D.current&&D.current()},rn=(d,g,k=null)=>{switch(nn(),d){case Pe.NONE:return;case Pe.TOP_QUEUE:cn(g);break;case Pe.END_QUEUE:on(g);break;case Pe.GOTO_ALBUM:an(g);break;case Pe.REMOVE_FROM_PLAYLIST:ln(g);break;case Pe.TAGS:V(g),ce("Avaliable soon :)",X.INFO);break;case Pe.ADD_TO_FAVORITES:fetch(`${v}/read-write/toggleFavorite/${g.id}/true`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{M.current(A)});break;case Pe.REMOVE_FROM_FAVORITES:fetch(`${v}/read-write/toggleFavorite/${g.id}/false`,{method:"GET",credentials:"include"}).then(A=>A.json()).then(A=>{M.current(A)});break}},an=d=>{fetch(`${v}/read-write/trackAlbumId/${d.id}`,{method:"GET"}).then(g=>g.json()).then(g=>{re(`albums/${g}`)})},cn=d=>{const g=h;g.splice(b+1,0,d.id),x(g),ce(`${d.title} playing next.`,X.SUCCESS)},on=d=>{const g=h;g.push(d.id),x(g),ce(`${d.title} playing at the end.`,X.INFO)},ln=d=>{fetch(`${v}/read-write/deleteTrackFromPlaylist/${ue.id}/${d.id}`,{method:"DELETE",credentials:"include"}).then(g=>g.json()).then(g=>{L.current(),ce(`${d.title} removed.`,X.SUCCESS)})},un=(d,g)=>{L.current=g,ke(d)},dn=(d,g)=>{if(V(null),!d)return;const k=new FormData;k.append("current",JSON.stringify(d.current)),k.append("deleted",JSON.stringify(d.deleted)),fetch(`${v}/read-write/changeTrackTags/${g}`,{method:"POST",credentials:"include",body:k}).then(A=>A.json()).then(A=>{ce("Tags upated!",X.SUCCESS)})},mn=async(d=[],g)=>{d.length!==0&&(x(d),N(g||0),F(!0))},hn=()=>{_e(!0)},fn=()=>{_e(!1)},pn=()=>{ot.current=!ot.current,ot.current&&(Ye.current=xt.pathname),console.log(Ye.current),re(ot.current?"/full-screen":Ye.current&&Ye.current!=="/full-screen"?Ye.current:"/home")},gn=()=>new Promise(d=>{fetch(`${v}/read-write/getSongMetaDataCover/${s}`,{method:"GET",credentials:"include"}).then(g=>g.blob()).then(g=>{Vt.current={track:s,blob:g},d({track:s,blob:g})})}),xn=()=>{const{history:d,pointer:g}=Et;if(d.every(ne=>ne===null)){re("/home");return}let k=(g-2+d.length)%d.length,A=d[k],H=0;for(;(!A||A==="/full-screen")&&H<d.length||A===xt.pathname;)k=(k-1+d.length)%d.length,A=d[k],H++;Et.pointer=k,re(A||"/home")};return e.jsxs(fs.Provider,{value:{navigateBack:xn,history:Et,colorOverride:Ns,requestNewFullScreenImage:gn,fullScreenImage:Vt.current,toggleFullScreenView:pn,fetchFFTUserSettings:At,FFTUserSetingsRef:qe,fftConfigRef:q,getFFTAtCurrentTime:Rs,deleteAlbum:Qs,editArtist:Ks,playRadio:en,playContainer:Ps,closeTagWindow:fn,openTagWindow:hn,saladContext:j,setSaladContext:z,playAudioSalad:mn,linkNewContainer:un,trackActionTypes:Pe,onClicTrackActionEntry:rn,openTrackActions:sn,getNextSongsFromAlbum:Is,currentTrackData:r,currentTime:u,isPlaying:i,toggleTrackPaused:As,playNextSong:Ms,trackCoverUrl:S,playPreviousSong:$s,playingTrack:s,jumpTrackSeconds:_s,jumpToPercent:Us,addContainerToQueue:Ls,playContainerSuffle:Os,playQueue:h,queuePointer:b,jumpToQueueTrack:Bs,deleteQueue:Gs,addArtistToQueue:Vs,shuffleArtistToQueue:Hs,playTrackNoQueue:Fs,playLibraryShuffle:Ws,setVolume:ge,volume:te,editAlbum:zs,editPlaylist:qs,createNewPlaylist:Xs,globalAudioRef:f,setPlaylistAddedCallback:d=>{Be.current=d}},children:[n,I?I.type==="album"?e.jsx(Mr,{applyCanges:Qt,albumClass:I}):I.type==="playlist"?e.jsx(Xt,{editPlaylistClass:I,applyCanges:Qt}):null:null,B&&e.jsx(Gr,{applyChanges:Ys,artist:B}),ye&&e.jsx(Xt,{closeOverlay:tn,applyCanges:Zs}),P?e.jsx(_r,{isFav:ue.favPlaylist,trackY:P.position.y,track:P.track}):null,oe&&e.jsx(Br,{apply:dn,track:oe}),ze&&e.jsx(Dr,{})]})},le=()=>{const n=t.useContext(fs);if(n===void 0)throw new Error("useAudioPlayer must be used within an AudioPlayerProvider");return n},at=({percent:n,text:s=null,showPercent:c=!1,isMarquee:i=!1,fillColor:o="#fffdff",style:r={},initialising:l=!1,initialisingColor:u="white",onClickPercentage:p=null,filter:f="",minWidth:a=0})=>{const m=h=>{if(l||!p)return;const x=h.currentTarget,S=x.getBoundingClientRect().x,y=h.clientX;p((y-S)/x.clientWidth*100)};return e.jsxs("div",{className:"progressBar",style:{...r,minWidth:a},onClick:m,children:[e.jsx("div",{className:"progressFill",style:{width:`${n}%`,background:`${o}`,...r}}),l?e.jsx("div",{className:"progressFill",init:"init",style:{backgroundColor:u,opacity:"0.5",...r}}):null,c&&e.jsx("span",{className:"progressPercent",style:{color:"black"},children:n+"%"}),s&&e.jsx("span",{className:"progressPercent",style:{color:"black",margin:"auto"},children:s})]})},zr=()=>{const{currentTrackData:n,currentTime:s,jumpToPercent:c}=le();if(!n||Object.keys(n).length===0)return null;const i=()=>e.jsxs("div",{children:[e.jsx("span",{children:_t(s).readable}),e.jsx(at,{percent:s/n.rawDuration*100,showPercent:!1,fillColor:"var(--violet-web-color)",style:{height:"10px"},onClickPercentage:c}),e.jsx("span",{children:n.duration.readable})]}),o=()=>null;return e.jsx("div",{className:"songProgress",children:(n==null?void 0:n.type)=="radio"?e.jsx(o,{}):e.jsx(i,{})})},qr=({context:n,active:s,setActive:c})=>{const i=r=>{const l=s===r?"active":"";return e.jsx("div",{className:"index",id:n.name+"-index_"+r,onClick:()=>c(r),active:l},r)};let o=[];for(let r=0;r<n.length;r++)o.push(i(r));return e.jsx("div",{className:"activeIndex-container "+n.name,children:o})},ps=t.memo(function({currentActive:s,onClick:c,data:i}){const[o,r]=t.useState(s);t.useEffect(()=>{r(s)},[s]);const l=u=>{r(u),c==null||c(u)};return e.jsx("div",{className:"job-view-div",children:i.map((u,p)=>e.jsx("div",{className:"cornered-button","data-active":o===p,onClick:()=>{l(p)},children:u},p))})}),Jr=({fromFile:n,setFromFile:s,tracksSelected:c,initMetadataFetching:i})=>{const[o,r]=t.useState(!1),[l,u]=t.useState(""),p=a=>{r(!0),a.target.files&&(console.log("New tracks"),c(Array.from(a.target.files)),a.target.files=null)},f=a=>{u(a.target.value)};return e.jsxs("div",{className:"addMusicSource",children:[e.jsxs("div",{className:"add-audio-source-selection",children:[e.jsx("p",{children:"Select the source: "}),e.jsx(ps,{currentActive:n?0:1,onClick:a=>{s(a==0)},data:["From file","From URL"]})]}),n?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Select files from a local storage."}),e.jsxs("div",{className:"add-music-input",children:[e.jsxs("label",{for:"files",className:"file-select",children:[e.jsx(Fn,{}),e.jsx("span",{children:"Select file"})]}),e.jsx("input",{id:"files",multiple:!0,type:"file",accept:"audio/*",onChange:p})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Link to a radio steam."}),e.jsxs("div",{className:"add-music-input",children:[e.jsx("input",{type:"text",placeholder:"Enter URL",onChange:f}),e.jsx(me,{onClick:async()=>{i(l)},text:"Resolve",icon:e.jsx($n,{})})]})]}),o&&e.jsx("p",{children:"Hold a sec'.. The metadata fetch is about to beggin."})]})},mt=({text:n,progressBar:s={useProgressBar:!1}})=>e.jsxs("div",{className:"loading-container",children:[e.jsx("h2",{children:n}),s.useProgressBar?e.jsx(at,{percent:s.percent,showPercent:s.showPercent,isMarquee:s.isMarquee,fillColor:s.fillColor,style:{height:"25px"}}):e.jsx("p",{children:"Loading..."})]}),Yr=({addNewMusic:n})=>e.jsx("div",{className:"album-card",context:"add",children:e.jsx(Pn,{strokeWidth:.7,className:"album-card-cover",onClick:n})}),Kr=({album:n,deleteAlbum:s,editAlbum:c})=>e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(st,{className:"album-card-overview-button",use:"delete",onClick:()=>s(n.uuid)}),e.jsx(os,{className:"album-card-overview-button",use:"edit",onClick:()=>c(n.uuid)}),e.jsxs("div",{className:"album-card-overview-button",use:"song-count",children:[e.jsx(Ln,{className:"song-count-icon"}),e.jsx("span",{children:n.tracks.length})]}),e.jsx("img",{src:n.coverURL,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Ue(n.name,25)}),e.jsx("p",{className:"album-artist",children:Ue(n.artist.join(","),25)||"No artist"})]}),Qr=({radio:n,deleteRadio:s})=>(console.log(n),e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(st,{className:"album-card-overview-button",use:"delete",onClick:()=>s(n[0])}),e.jsx("img",{src:n[1].favicon==""?null:n[1].favicon,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Ue(n[1].name,25)})]})),Xr=({albums:n,radios:s,deleteRadio:c,addNewMusic:i,deleteAlbum:o,editAlbum:r,publish:l})=>{const u=n.map((a,m)=>e.jsx(Kr,{album:a,deleteAlbum:o,editAlbum:r},`alb-${m}`)),p=[...s].map((a,m)=>e.jsx(Qr,{radio:a,deleteRadio:c},`rad-${m}`)),f=[...u,...p];return console.log("rerun"),f.push(e.jsx(Yr,{addNewMusic:i},-1)),e.jsxs("div",{className:"albums-overview",children:[e.jsx("div",{className:"album-overview-container",children:f.reverse()}),(n.length>0||s.size>0)&&e.jsx("button",{className:"roundButton",onClick:l,children:"Publish to library"})]})},Zr=({track:n,onClose:s})=>{const{albums:c,moveTrackToNewAlbum:i,moveTrackToAlbum:o,editingAlbum:r,setEditingAlbum:l}=sa(),[u,p]=t.useState(""),[f,a]=t.useState(!1),m=t.useRef(null),h=S=>{S.preventDefault(),!u&&S.target.existingAlbum.value?o(n,S.target.existingAlbum.value):u!==""&&i(n,u),f&&l(null),s()},x=S=>{p(S.target.value)};return t.useEffect(()=>{c.find(({uuid:y})=>y===r).tracks.length===1?a(!0):a(!1);const S=y=>{var _;if(m.current&&!m.current.contains(y.target)){if(((_=y.target.closest("svg"))==null?void 0:_.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",S),document.addEventListener("touchstart",S),()=>{document.removeEventListener("mousedown",S),document.removeEventListener("touchstart",S)}},[]),e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:m,children:[e.jsx("h2",{children:"Move track to another album"}),f&&e.jsx("p",{className:"last-track-notify",children:"Last track of the album, if you move it, the current album will be deleted."}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:h,children:[e.jsx("label",{htmlFor:"newAlbum",children:"New album name"}),e.jsx("input",{type:"text",id:"newAlbum",placeholder:"Enter album name",onChange:x}),e.jsx("label",{htmlFor:"existingAlbum",children:"Existing album"}),e.jsx("select",{id:"existingAlbum",onChange:()=>p(""),children:c.map((S,y)=>S.uuid===r?null:e.jsx("option",{value:S.uuid,children:S.name},y))}),e.jsx("input",{type:"submit",value:"Submit"})]})]})})},ea=({setEditUid:n,albumClass:s})=>{var f,a;const[c,i]=t.useState({visible:!1}),[o,r]=t.useState(null);if(!s)return null;t.useEffect(()=>{s&&r(s.coverURL)},[s]);const l=()=>{const m=document.getElementById("editAlbumInfos");s.name=m.albumName.value,s.artist=m.artistName.value.split(",").map(h=>h.trim()),s.year=m.releaseDate.value,s.genre=m.genre.value.split(",").map(h=>h.trim()).map(h=>h.charAt(0).toUpperCase()+h.slice(1)),s.description=m.description.value,console.log(s.genre),n(null)},u=m=>{const h=m.target.files[0];h&&r(s.setCoverFromFile(h))},p=m=>{i({visible:!c.visible,...m})};return e.jsxs("div",{className:"albumWrapping",children:[e.jsxs("div",{className:"albumCover",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(pe,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(ft,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:u})]}),e.jsx("button",{className:"roundButton",onClick:()=>l(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:s.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(f=s.artist)==null?void 0:f.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",defaultValue:s.year})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(a=s.genre)==null?void 0:a.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:s.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Le,{className:"albumTrackList",height:250,itemCount:s.tracks.length,itemSize:35,width:"100%",children:({index:m,style:h})=>e.jsxs("div",{style:h,className:"album-wrapping-track",children:[e.jsx("span",{children:s.tracks[m].name}),e.jsx(ns,{className:"trackIcon",onClick:()=>{p(s.tracks[m])}})]},m)})})]}),c.visible&&e.jsx(Zr,{onClose:()=>{i({visible:!1})},track:{id:c.id,name:c.name}})]})};class Zt{constructor(s,c,i,o,r,l){this.name=s,this.artist=c,this.year=i,this.tracks=o,this.setCover(r),this.uuid=l}setCover(s){!s||this.coverURL||(this.coverData=s.data,this.coverMime=s.format,this.coverURL=URL.createObjectURL(new Blob([this.coverData],{type:this.coverMime})),this.ext=this.coverMime.split("/")[1],this.sourceIsBinary=!0)}setCoverFromFile(s){return this.coverURL=URL.createObjectURL(s),this.coverFile=s,console.log("Setting cover from file: ",s),this.ext=s.type.split("/")[1],this.coverURL}}const gs=t.createContext(),ta=({closeOverlay:n,uploadPercent:s,uploadProgress:c,uploadFinished:i,isMinimize:o,setMinimized:r})=>{const[l,u]=t.useState(!0),[p,f]=t.useState(0),[a,m]=t.useState([]),[h,x]=t.useState(0),[S,y]=t.useState(0),[_,b]=t.useState([]),[N,E]=t.useState([]),[C,I]=t.useState(!1),[$,B]=t.useState("xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx"),[w,O]=t.useState(0),[G,L]=t.useState(0),[P,K]=t.useState(""),{addNotification:D,notifTypes:ce}=We(),[X,re]=t.useState([]),[ue,ke]=t.useState(new Map);let oe=!1;const V=t.useRef(!1),j=t.useRef(null),z=async M=>{if(console.log("Tracks selected: ",M),M.length===0)return;y(M.length),m(T=>[...T,...M]),j.current=M;const R=[];for(let T=0;T<M.length;T++)R.push({id:dt()});V.current=!0,re(T=>[...T,...R])};t.useEffect(()=>{V.current&&(V.current=!1,ee())},[X]),t.useEffect(()=>{console.log("To add tracks",a)},[a]);const ee=async()=>{const M=await Re();if(M)ve(M);else{const R=j.current.length;console.log(a.length,R),re(X.filter((T,W)=>W<X.length-R)),m(a.filter((T,W)=>W<a.length-R)),x(0),f(2)}j.current=null},Y=M=>{const R=M.filter(({tracks:T})=>T.length>0);I(!0),E(R)};t.useEffect(()=>{console.log("Reconstructing albums... ",N),!C&&(x(0),f(2))},[N]);const de=M=>{var q;function R(se,Q){return Q.findIndex(J=>J.name===se)}let T=[],W=X;for(let se=0;se<M.length;se++){let Q=M[se];const J=X.length-M.length+se,U=R(Q.common.album,T),ae={id:X[J].id,name:Q.common.title||X[J].title};if(U===-1){const je=dt();T.push(new Zt(Q.common.album,Q.common.artist?Q.common.artist.split(",").map(qe=>qe.trim()):["Unknown artist"],Q.common.year,[ae],(q=Q.common.picture)==null?void 0:q[0],je)),W[J].albumUuid=je}else T[U].tracks.push(ae),W[J].albumUuid=T[U].uuid}return b(se=>[...se,...M]),re(W),T},ve=M=>{const R=de(M);setTimeout(()=>{I(!1),E(T=>[...T,...R])},400)},Re=async(M="")=>{if(!l){if(!M)return;console.log("Fetching meta at source",M);const Q=await fetch(`${v}/radio/metadata/${encodeURIComponent(M)}`,{method:"GET"}).then(ae=>ae.json());if(Q)D("Radio found! "+Q[0].name,ce.INFO);else{D("No radio found..",ce.ERROR);return}const J=Q[0];console.log(J);const U=ue;U.set(J.stationuuid,{url:J.url_resolved,favicon:J.favicon,name:J.name}),ke(U),f(2);return}const R=j.current;f(1);const T=[],W=X,q=X.length-R.length;let se=!1;return await Promise.all(R.map(async(Q,J)=>{var je;const U=await Er(Q).catch(qe=>{console.log("error at",Q,qe),D(`Track ${Q.name} seems corrupted, retry without it.`,ce.ERROR)});if(!U){se=!0;return}let ae=W[J+q];U.common.title||(U.common.title=Q.name,console.log("No title found, using filename: "+Q.name),ae.title=Q.name),U.common.album||(U.common.album=U.common.title,ae.album=U.common.title),ae.duration=U.format.duration,ae.year=U.common.year,ae.no=((je=U.common.track)==null?void 0:je.no)||0,ae.title=U.common.title,T.splice(J,0,U),x(T.length)})),se?null:(re(W),T)},F=M=>{const R=new Map([...ue].filter(([T,W])=>T!=M));ke(R)},te=M=>{oe=!0;let R=X;const T=N.find(U=>U.uuid===M).tracks.map(U=>U.id);let W=a;const q=R.filter(U=>!T.includes(U.id)),Q=R.map((U,ae)=>T.includes(U.id)?null:ae).filter(U=>U!==null).map(U=>W[U]);m(Q),re(q);const J=N.filter(U=>U.uuid!==M);I(!1),E(J)},ge=M=>{B(M)};t.useEffect(()=>{if($===null||N.length===0){f(2);return}f(3)},[$]);const ye=(M,R)=>{let T=X;const{id:W,name:q}=M,se=dt();console.log("Moving track: "+W+NaN+$+" to album: "+se),T=T.map(U=>(U.id===W&&(U.albumUuid=se),U));let Q=N.map(U=>(U.uuid===$&&(U.tracks=U.tracks.filter(ae=>ae.id!==W)),U));const J=new Zt(R,["Unknown artist"],"",[{id:W,name:q}],null,se);Q.push(J),re(T),Y(Q),D(`Track ${q.substring(0,60)} got moved to album ${R}.`,ce.INFO)},Ne=(M,R)=>{let T=X;const{id:W,name:q}=M;console.log("Moving track: "+W+NaN+$+" to album: "+R);const se=N.find(J=>J.uuid===R).name;T=T.map(J=>(J.id===W&&(J.albumUuid=R),J));let Q=N.map(J=>(J.uuid===R?J.tracks.push({id:W,name:q}):J.uuid===$&&(J.tracks=J.tracks.filter(U=>U.id!==W)),J));re(T),Y(Q),D(`Track ${q.substring(0,60)} got moved to album ${se}.`,ce.INFO)},ze=async()=>{if(oe){console.log("Deleting, aborting publish");return}if(console.log("Publishing tracks: ",a),console.log("Publishing radios: ",ue),ue.keys().forEach(async M=>{const R=new FormData;console.log(ue.get(M)),R.append("radioData",JSON.stringify({uuid:M,...ue.get(M)}));const T=await fetch(`${v}/radio/newRadio`,{method:"POST",credentials:"include",body:R}).then(W=>W.json());console.log(T)}),a.length>0){f(4);const M=N.map(T=>{if(!T.sourceIsBinary)return T.coverFile?(console.log("Using file reference for cover: "+T.coverFile),T.coverFile):null;if(console.log("Using binary reference for cover: ",T.uuid),!T.coverData||T.coverData.length===0)return console.log("returned no cover at",T.uuid),null;const W=new Uint8Array(T.coverData),q=new Blob([W],{type:T.coverMime});return new File([q],`${T.uuid}.${T.coverMime.split("/").pop()}`,{type:T.coverMime})});for(let T=0;T<N.length;T++){let W=new FormData;const{coverURL:q,sourceIsBinary:se,tracks:Q,coverFile:J,coverData:U,...ae}=N[T];W.append("album",JSON.stringify({...ae})),M[T]&&W.append("cover",M[T]);const je=await fetch(`${v}/read-write/upload`,{method:"POST",body:W,credentials:"include"});if(!je.ok)throw console.error("Error uploading albums:",je.statusText),new Error("Error uploading albums");W=null,console.log("Album uploaded: "+N[T].name)}N.forEach(T=>{T.coverURL&&(URL.revokeObjectURL(T.coverURL),T.coverURL=null)});let R=a.reduce((T,W)=>T+W.size,0);O((R/1024/1024).toFixed(1));for(let T=0;T<a.length;T++){const W=a[T];let q=new FormData;q.append("trackMeta",JSON.stringify(X[T])),q.append("music",W),K(W.name),c({done:T,total:a.length}),await Cr({method:"POST",data:q,withCredentials:!0,url:"/upload",baseURL:`${v}/read-write`,onUploadProgress:se=>{const{total:Q,loaded:J}=se,U=Q/1e6,ae=J/1e6;s(ae/U);const je=ae/U*100;L(je.toFixed(2))}}).then(()=>{}).catch(se=>{console.error("Error uploading track:",se)}),q=null}}console.log("Upload finished"),i(),setTimeout(()=>{m([]),b([]),x(0),E([]);const M=ue;M.clear(),ke(M),f(0),B("xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx"),L(0),console.log("Closing overlay");const R=new CustomEvent("musicUploaded",{});window.dispatchEvent(R),n()},750)},_e=()=>{if(p!==4){n();return}r(!0)};t.useEffect(()=>{oe&&(oe=!1)},[a]);const Be=()=>{switch(p){case 0:return e.jsx(Jr,{fromFile:l,setFromFile:u,tracksSelected:z,initMetadataFetching:Re});case 1:return e.jsx(mt,{text:`Fetching metadata... ${S?h+"/"+S:"-/-"}`});case 2:return e.jsx(Xr,{albums:N,addNewMusic:()=>f(0),deleteAlbum:te,editAlbum:ge,publish:ze,radios:ue,deleteRadio:F});case 3:return e.jsx(ea,{setEditUid:B,albumClass:N.find(M=>M.uuid===$)});case 4:return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(mt,{text:`Publishing ${P} ${w}Mb..`,progressBar:{useProgressBar:!0,showPercent:!0,isMarquee:!1,percent:Number(G),fillColor:"var(--cool-green)"}}),e.jsx("p",{children:"You can close this overlay, the upload will continue. :)"})]});default:return e.jsx("div",{className:"addMusicSource",children:e.jsx("p",{children:"Not implemented yet"})})}};return e.jsx("div",{className:"addMusicContainer",style:o?{display:"none"}:{},children:e.jsxs(gs.Provider,{value:{albums:N,moveTrackToNewAlbum:ye,editingAlbum:$,moveTrackToAlbum:Ne,setEditingAlbum:B},children:[e.jsx(Ce,{className:"buttonRound closeOverlay",onClick:_e}),e.jsx("h2",{children:"Add Music"}),e.jsx(qr,{context:{name:"AddMusic",length:5},active:p,setActive:null}),e.jsx(Be,{})]})})},sa=()=>t.useContext(gs),Nt=({iconHovered:n,iconDefault:s,onClick:c=null,className:i})=>{const[o,r]=t.useState(!1);return e.jsx("div",{style:c?{background:"rgba(0,0,0,0)"}:{},className:`${i}`,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),onClick:c,children:o?e.jsx(n,{}):e.jsx(s,{})})},Pt=({context:n})=>{const{isPlaying:s,toggleTrackPaused:c,playNextSong:i,playPreviousSong:o,jumpTrackSeconds:r}=le();return e.jsxs("div",{className:"audio-controls",context:n.mobile?"mobile":"desktop",children:[n.mobile?null:e.jsx(Nt,{iconHovered:Mn,iconDefault:On,onClick:o}),e.jsx(Nt,{iconHovered:s?_n:Bn,iconDefault:s?Un:Lt,onClick:c}),e.jsx(Nt,{iconHovered:Gn,iconDefault:Dn,onClick:i})]})},na=({index:n,trackId:s,style:c})=>{const{getTrack:i,setTrack:o}=aa(),[r,l]=t.useState(i(s)||null),{jumpToQueueTrack:u,queuePointer:p}=le(),{ref:f,inView:a}=Rr({threshold:.1,triggerOnce:!0});t.useEffect(()=>{a&&!r&&fetch(`${v}/read-write/shortTrackInfos/${s}`,{method:"GET",credentials:"include"}).then(x=>{if(!x.ok)throw new Error("Network response was not ok");return x.json()}).then(x=>{l(x),o(s,x)})},[a,s,r,o]);const m=(r==null?void 0:r.title)??null,h=(r==null?void 0:r.cover)??null;return e.jsxs("div",{className:"music-queue-entry",style:{...c,overflow:"hidden"},"is-passed":`${n<p}`,"is-selected":`${n===p}`,ref:f,onClick:()=>u(n),children:[h?e.jsx("img",{src:`${v}/covers/${h}`,ralt:`${m} cover`,className:"track-image-small"}):e.jsx(pe,{className:"track-image-small"}),e.jsxs("p",{className:"track-title",style:{whiteSpace:"nowrap"},children:[n," ",m]})]})},xs=t.createContext(),ra=({hideComponent:n})=>{const{playQueue:s,deleteQueue:c}=le(),i=t.useRef(null),[o,r]=t.useState(new Map),l=t.useCallback(a=>o.get(a),[o]),u=t.useCallback((a,m)=>{r(h=>new Map(h).set(a,m))},[]);return t.useEffect(()=>{const a=m=>{var h;if(i.current&&!i.current.contains(m.target)){if(((h=m.target.closest("svg"))==null?void 0:h.id)==="playlist-button")return;n()}};return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[]),e.jsx("div",{className:"music-queue",ref:i,children:e.jsxs(xs.Provider,{value:{getTrack:l,setTrack:u},children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Music Queue"}),s.length>0&&e.jsx(st,{className:"buttonRound",onClick:c,style:{position:"absolute",right:"25px"}})]}),s.length>0?e.jsx(Le,{height:600,itemCount:s.length,itemSize:60,width:"100%",children:({index:a,style:m})=>e.jsx(na,{style:m,index:a,trackId:s[a]},s[a])}):e.jsx("p",{children:"No items in the queue"})]})})},aa=()=>t.useContext(xs),vs=t.createContext(),Z={SEARCH:"search",OPEN_ACTION_BAR:"open_action_bar",CLOSE_ACTION_BAR:"close_action_bar",PLAY_SONG:"play_song",OPEN_ALBUM:"open_album",OPEN_ARTIST:"open_artist",PLAY_LIBRARY_RANDOM:"play_library_random",TOGGLE_PLAY_PAUSE:"toggle_play_pause",OPEN_SETTINGS:"open_settings",VOLUME_UP:"volume_up",VOLUME_DOWN:"volume_down",OPEN_GENRE:"open_genre"},Oe=[{name:"Search",code:Z.SEARCH,description:"Search for a song, an album, a genra, an artist",key:"k",modifier:"ctrl",keywords:["search","find","look for","seek","search for","find for","look for for","seek for"],icon:()=>e.jsx(rt,{className:"action-bar-current-logo"})},{name:"open action bar",code:Z.OPEN_ACTION_BAR,description:"Give a command",key:" ",modifier:"ctrl",keywords:[]},{name:"Play the library in shuffle",code:Z.PLAY_LIBRARY_RANDOM,description:"",key:"r",modifier:"ctrl",keywords:["play","shuffle","random","library","all","all songs","all albums","all artists"],icon:()=>e.jsx(nt,{className:"action-bar-current-logo"})},{name:"Toggle Play pause",code:Z.TOGGLE_PLAY_PAUSE,description:"",key:" ",modifier:"",keywords:["pause","play","toggle","play/pause","play pause"],icon:()=>e.jsx(nt,{className:"action-bar-current-logo"})},{name:"Open settings",code:Z.OPEN_SETTINGS,description:"",key:"p",modifier:"ctrl",keywords:["settings","configuration","config","preferences","options"],icon:()=>e.jsx(Vn,{className:"action-bar-current-logo"})},{name:"Volume up",code:Z.VOLUME_UP,description:"",key:"ArrowUp",modifier:"",keywords:[],icon:()=>{}},{name:"Volume down",code:Z.VOLUME_DOWN,description:"",key:"ArrowDown",modifier:"",keywords:[],icon:()=>{}}],ca=({children:n})=>{const s=t.useRef([]),[c,i]=t.useState(!1),o=t.useRef(c),[r,l]=t.useState(null),[u,p]=t.useState(!1),[f,a]=t.useState(null),[m,h]=t.useState([]),[x,S]=t.useState(null),{playTrackNoQueue:y,playLibraryShuffle:_,toggleTrackPaused:b,setVolume:N,volume:E}=le(),C=t.useRef(E),I=xe(),$=t.useRef(null),B=t.useRef(null),{addNotification:w,notifTypes:O}=We();t.useEffect(()=>{window.addEventListener("keydown",G),D();const j=z=>{$.current&&!$.current.contains(z.target)&&oe()};return document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j),window.removeEventListener("keydown",G),s.current=[]}},[]);const G=j=>{if(j.key=="Escape"&&o.current){oe();return}if(j.key=="Control"||f||!(j.ctrlKey||j.altKey||j.metaKey)&&(document.activeElement.nodeName==="INPUT"||document.activeElement.nodeName==="TEXTAREA"))return;const z=Oe.find(ee=>j.key===ee.key?!ee.modifier||ee.modifier===""?!0:{ctrl:j.ctrlKey,shift:j.shiftKey,alt:j.altKey,meta:j.metaKey}[ee.modifier]:!1);z&&(a(z),s.current.forEach(ee=>{ee.code===z.code&&(ee.callback(j),j.preventDefault())}))},L=(j,z)=>{const ee={callback:j,code:z};s.current.push(ee)},P=t.useRef(b);P.current=b;const K=()=>{i(!0),l(null),h(ce()),B.current="command",a(Oe[1])};t.useEffect(()=>{C.current=E,w(`Volume : ${(E*100).toFixed(0)} %`,O.INFO)},[E]);const D=()=>{L(()=>{if(B.current==="command"){oe();return}K()},Z.OPEN_ACTION_BAR),L(()=>{oe()},Z.CLOSE_ACTION_BAR),L(()=>{if(B.current==="search"){oe();return}i(!0),l(Z.SEARCH),B.current="search"},Z.SEARCH),L(()=>{P.current()},Z.TOGGLE_PLAY_PAUSE),L(()=>{I("/settings")},Z.OPEN_SETTINGS),L(()=>{N(Math.min(Math.max(C.current+.1,0),1))},Z.VOLUME_UP),L(()=>{N(Math.min(Math.max(C.current-.1,0),1))},Z.VOLUME_DOWN)};t.useEffect(()=>{c&&document.getElementById("actionbar-searchbar").focus(),o.current=c},[c]),t.useEffect(()=>{switch(r){case Z.SEARCH:p(!0),S(()=>e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(rt,{className:"action-bar-current-logo"})," "]}));break;default:p(!0),S(null)}},[r]);const ce=()=>[Oe[0],Oe[2],Oe[4]],X=j=>{const z=j.target.value;if(z===""){h(ce());return}if(r===Z.SEARCH){ue(z);return}const ee=Oe.filter(Y=>{var de;return((de=Y.keywords)==null?void 0:de.length)>0&&Y.keywords.some(ve=>ve.includes(z))});h(ee)},re=j=>{switch(j){case"track":return e.jsx(Lt,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View album"})," ",e.jsx(It,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View artist"})," ",e.jsx(It,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View genre"})," ",e.jsx(It,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},ue=async j=>{console.log("action bar seacrh"),!(j===""||j.trim().length===0)&&(console.log(`${v}/read-write/search/${j}`),fetch(`${v}/read-write/search/${j}`,{method:"GET"}).then(z=>{if(z.ok)return z.json();throw new Error("Error fetching search results")}).then(z=>{const ee=[...z.tracks.map(Y=>({type:"track",...Y})),...z.albums.map(Y=>({type:"album",...Y})),...z.artists.map(Y=>({type:"artist",...Y})),...z.genres.map(Y=>({type:"genre",...Y}))].map(Y=>{const de=Y.path,ve=Y.id,{trackPath:Re,...F}=Y;return{icon:()=>de?e.jsx("img",{className:"action-bar-entry-logo",src:`${v}/${Y.type==="artist"?"artist":"covers"}/${de}`,alt:Y.name}):e.jsx(pe,{className:"action-bar-entry-logo"}),tooltip:re,code:Y.type==="artist"?Z.OPEN_ARTIST:Y.type==="album"?Z.OPEN_ALBUM:Y.type==="genre"?Z.OPEN_GENRE:Z.PLAY_SONG,fileName:de,trackName:ve,...F}});h(ee)}))},ke=j=>{switch(j.code){case Z.SEARCH:i(!0),l(Z.SEARCH),a(Oe[0]),B.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),h([]);break;case Z.CLOSE_ACTION_BAR:oe();break;case Z.PLAY_SONG:console.log("Playing song",j),y(j.trackName),oe();break;case Z.OPEN_ALBUM:oe(),I(`/albums/${j.id}`);break;case Z.OPEN_ARTIST:oe(),I(`/artists/${j.id}`);break;case Z.OPEN_GENRE:console.log("Opening genre",j),oe(),I(`/genres/${j.id}`);break;case Z.PLAY_LIBRARY_RANDOM:w("Playing the library in shuffle",O.INFO),_(),oe();break;case Z.OPEN_SETTINGS:oe(),I("/settings");break}},oe=()=>{i(!1),l(null),B.current=null,h([])},V=()=>{i(!0),l(Z.SEARCH),a(Oe[0]),B.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),h([])};return e.jsx(vs.Provider,{value:{commandCodes:Z,openCommandBar:K,openSearchBar:V},children:e.jsxs("div",{className:"action-bar-app-parent",children:[n,c&&e.jsx("div",{className:"global-action-bar",children:e.jsx("div",{className:"action-bar",ref:$,children:e.jsxs("div",{className:"action-bar-research",children:[x||null,e.jsx("input",{type:"text",id:"actionbar-searchbar",className:"searchbar",onChange:X,placeholder:`${f.description}`}),e.jsx("div",{className:"action-bar-results",children:e.jsx(Le,{height:300,itemCount:m.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:j,style:z})=>e.jsx(gt,{entry:m[j],style:{...z,width:" calc(100% - 20px)",marginTop:"10px"},onClick:ke},j)})})]})})})]})})},js=()=>{const n=t.useContext(vs);if(!n)throw new Error("useGlobalActionBar must be used within a GlobalActionBar provider");return n},oa=({onClosed:n,hideComponent:s})=>{const{setVolume:c,volume:i}=le(),o=t.useRef(null);return t.useEffect(()=>{const r=l=>{var u;if(o.current&&!o.current.contains(l.target)){if(((u=l.target.closest("svg"))==null?void 0:u.id)==="volume-button")return;s()}};return document.addEventListener("mousedown",r),document.addEventListener("touchstart",r),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r)}},[]),e.jsx("div",{ref:o,className:"volume-bar",children:e.jsx(at,{onClickPercentage:r=>{console.log("change volume"),c(r/100)},style:{height:"10px"},fillColor:"rgb(118, 173, 206)",percent:i*100})})},ia=({percent:n,size:s=120,strokeWidth:c=10,useText:i=!0,style:o,color:r="rgb(130, 119, 196)"})=>{const l=(s-c)/2,u=2*Math.PI*l,p=u*(1-n);return e.jsxs("div",{className:"radial-container",style:{width:s,height:s,...o},children:[e.jsxs("svg",{width:s,height:s,children:[e.jsx("circle",{className:"radial-bg",stroke:"#e6e6e6",strokeWidth:c,fill:"none",cx:s/2,cy:s/2,r:l}),e.jsx("circle",{className:"radial-progress",stroke:r,strokeWidth:c,fill:"none",cx:s/2,cy:s/2,r:l,strokeDasharray:u,strokeDashoffset:p})]}),e.jsx("div",{className:"radial-label",children:i&&e.jsxs("span",{children:[Math.round(n),"%"]})})]})},la=({fps:n=45})=>{const s=t.useRef(),c=t.useRef(null),{getFFTAtCurrentTime:i,fftConfigRef:o,globalAudioRef:r,FFTUserSetingsRef:l,fetchFFTUserSettings:u,colorOverride:p}=le(),f=t.useRef(0),a=m=>{var x;if(!c.current){s.current=requestAnimationFrame(a);return}const h=c.current.getContext("2d");if(h&&l.current){if(m-f.current<1e3/n){s.current=requestAnimationFrame(a);return}f.current=m;const S=5;h.clearRect(0,0,c.current.width,c.current.height);const y=i();if(!y){s.current=requestAnimationFrame(a);return}let _=y.subarray(Math.floor(y.length*.3),Math.floor(y.length*.6));const b=Math.max(1,_.length/S),N=new Array(S);N.fill(0);for(let I=0;I<_.length;I++)N[Math.floor(I/b)]+=Number(y[I]);let E=c.current.width/S-5,C=0;h.strokeStyle="#ffffff",h.fillStyle="#ffffff";for(let I=0;I<N.length;I++){const $=$r(Math.log2(N[I])*(S/5),5,25,0,1),B=Math.max(10,Math.min(80*$*((x=r.current)==null?void 0:x.volume),c.current.height-10));h.beginPath(),h.roundRect(2+C,(c.current.height-B)/2,E,B,7),h.fill(),h.stroke(),C+=E+5}}s.current=requestAnimationFrame(a)};return t.useEffect(()=>{if(!o.current){cancelAnimationFrame(s.current),console.log("No FFT data to display, releasing anim frame.");return}s.current=requestAnimationFrame(a),console.log("FFT found, requested animation frame.")},[o.current]),t.useEffect(()=>(s.current=requestAnimationFrame(a),()=>cancelAnimationFrame(s.current)),[]),e.jsx("canvas",{ref:c,id:"fft-canvas-small",width:60,height:50})},Tt=()=>{const[n,s]=t.useState(!1),[c,i]=t.useState(!1),[o,r]=t.useState(!1),[l,u]=t.useState(!1),[p,f]=t.useState(!1),[a,m]=t.useState({col1:"#000",col2:"#000"}),{currentTrackData:h,trackCoverUrl:x,volume:S,toggleFullScreenView:y}=le(),{openSearchBar:_}=js(),[b,N]=t.useState(!1),[E,C]=t.useState(null),[I,$]=t.useState(null),B=xe(),{subscribe:w}=wt(),[O,G]=t.useState(ht().pathname==="/admin-pannel"),L=()=>{r(!0)};t.useEffect(()=>{const re=w("openAddMusic",L);return()=>{re()}},[]);const P=()=>{r(!1),$(null),C(null)};function K(){u(!l)}function D(){f(!p)}t.useEffect(()=>{const re=[{col1:"#ffa585",col2:"#ffeda0"},{col1:"#9bf8f4",col2:"#6f7bf7"}];m(re[Math.floor(Math.random()*re.length)])},[]);const ce=()=>{},X=()=>{if(!E){o?(P(),console.log("deactivate")):(L(),console.log("activate"));return}N(document.getElementsByClassName("addMusicContainer")[0]==null),console.log("toggle")};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header__logo",onClick:()=>B("/home"),children:[e.jsx(pe,{col1:a.col1,col2:a.col2}),e.jsx("h1",{children:"CML"})]}),e.jsx(Pt,{context:{mobile:!1}}),e.jsxs("div",{className:"musicPlayer",children:[e.jsxs("div",{className:"playPauseContainer",children:[(h==null?void 0:h.type)=="radio"?h.coverUrl==""?e.jsx(pe,{className:"trackImage"}):e.jsx("img",{src:h.coverUrl,className:"trackImage"}):x.split("/").pop()==="null"?e.jsx(pe,{className:"trackImage"}):e.jsx("img",{src:x,className:"trackImage"}),e.jsx("div",{className:"playPauseButtons",onClick:y,children:e.jsx(Hn,{style:{padding:"0px"}})})]}),!h||Object.keys(h).length===0?null:e.jsxs("div",{className:"trackinfos-parent",children:[e.jsxs("div",{className:"trackinfo-desktop",children:[e.jsx("span",{id:"songTitle",children:h.title}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{(h==null?void 0:h.type)!="radio"&&B(`/artists/${h.artistId}`)},children:h.artist}),e.jsx(zr,{})]}),e.jsx(la,{}),e.jsxs("div",{className:"trackinfo-mobile",children:[e.jsx("span",{id:"songTitle",children:h.title}),e.jsx(Pt,{context:{mobile:!0}})]})]})]}),e.jsxs("div",{className:"mobile-gost",children:[e.jsx(Wn,{id:"playlist-button",className:"buttonRound",onClick:()=>K()}),l&&e.jsx(ra,{hideComponent:()=>u(!1)}),S<=1e-5?e.jsx(zn,{className:"buttonRound",onClick:()=>D()}):S<.5?e.jsx(qn,{className:"buttonRound",onClick:()=>D()}):e.jsx(Jn,{id:"volume-button",className:"buttonRound",onClick:()=>D()}),p&&e.jsx(oa,{hideComponent:()=>f(!1)})]}),e.jsxs("div",{className:"headerRight",children:[!O&&e.jsxs("div",{className:"serach-button-div",onClick:_,children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"K"})}),e.jsx(rt,{})]}),e.jsxs("div",{style:{position:"relative",padding:"5px",display:"flex",justifyContent:"center"},className:"upload-music-header",children:[I&&e.jsx(ia,{percent:I,size:44,useText:!1,style:{position:"absolute",transform:"translate(-1px, -5.5px)"}}),e.jsx(Ot,{style:{zIndex:"10",position:"relative"},className:"addMusicButton buttonRound",onClick:X}),E&&e.jsxs("span",{style:{position:"absolute",bottom:"-30px",padding:"2px 7px",borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 0.7)",textAlign:"center"},children:[E.done,"/",E.total]})]}),e.jsx(Fr,{})]}),o&&e.jsx(ta,{uploadPercent:$,uploadFinished:ce,uploadProgress:C,isMinimize:b,setMinimized:N,closeOverlay:P})]})},ua=()=>{const[n,s]=t.useState(null),[c,i]=t.useState(null),[o,r]=t.useState(null),[l,u]=t.useState(null);t.useEffect(()=>{const a=setInterval(p,5e3);return p(),()=>clearInterval(a)},[]);const p=()=>{try{fetch(`${v}/isResponding`).then(a=>{a.status===200?(l===!1&&f(),u(!0)):u(!1)}).catch(a=>{console.error("Fetch failed (e.g., CORS error):",a),u(!1)})}catch(a){console.error("Unexpected error:",a),u(!1)}},f=()=>{fetch(`${v}/read-write/stats`,{method:"GET"}).then(a=>a.json()).then(a=>{s(a)}).catch(a=>console.error("Error fetching stats:",a)),fetch(`${v}/read-write/serverStats`,{method:"GET"}).then(a=>a.json()).then(a=>{i(Ft(a.coversByteUsage+a.tracksByteUsage).readable),r({perent:(1-a.free/a.size)*100,total:Ft(a.size).readable,free:Ft(a.free).readable})}).catch(a=>console.error("Error fetching server stats:",a))};return t.useEffect(()=>{f()},[]),e.jsxs("div",{className:"stat-short",children:[e.jsxs("div",{className:"stat-short-category",children:[e.jsxs("p",{children:["Library size: ",c]}),e.jsxs("p",{children:["Free ",o==null?void 0:o.free," of ",o==null?void 0:o.total]}),e.jsx(at,{percent:o==null?void 0:o.perent,total:o==null?void 0:o.total,style:{height:"10px"},fillColor:"var(--chill-purple)",initialising:!c})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"5px"},children:[e.jsx("div",{className:"server-status-sprite",style:{width:"10px",height:"10px",borderRadius:"10px",backgroundColor:l?"lightgreen":"red"}}),e.jsxs("p",{children:["Server is ",l?"online":"offline"]})]})]})},da=()=>{const{openCommandBar:n}=js();return e.jsxs("div",{className:"sidebar",children:[e.jsxs("nav",{children:[e.jsxs(Qe,{id:"nav-recent",to:"/home",children:[e.jsx(Yn,{}),"Recent"]}),e.jsxs(Qe,{to:"/playlists",children:[e.jsx(Kn,{}),"Playlists"]}),e.jsxs(Qe,{to:"/artists",children:[e.jsx(Qn,{}),"Artists"]}),e.jsxs(Qe,{to:"/genres",children:[e.jsx(Xn,{}),"Genres"]}),e.jsxs(Qe,{to:"/cooking",children:[e.jsx(et,{}),"Cooking"]}),e.jsxs(Qe,{to:"/radio",children:[e.jsx(Zn,{}),"Radio"]})]}),e.jsx(ua,{}),e.jsxs("div",{className:"serach-button-div",onClick:n,style:{margin:"auto",marginBottom:"20px"},children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"SPACE"})}),e.jsx(er,{})]})]})},ma=()=>{const n=t.useRef(),s=t.useRef(null),{getFFTAtCurrentTime:c,fftConfigRef:i,globalAudioRef:o,FFTUserSetingsRef:r,fetchFFTUserSettings:l,colorOverride:u}=le(),p=t.useRef(0),f=a=>{var h,x;if(!s.current){n.current=requestAnimationFrame(f);return}const m=s.current.getContext("2d");if(m&&r.current&&u.current){if(a-p.current<1e3/r.current.FPS){n.current=requestAnimationFrame(f);return}p.current=a;const S=r.current.bars;m.clearRect(0,0,s.current.width,s.current.height);const y=c();if(!y){n.current=requestAnimationFrame(f);return}i.current.sampleRate/y.length;const _=Math.max(1,y.length/S),b=new Array(S);b.fill(0);for(let C=0;C<y.length;C++)b[Math.floor(C/_)]+=Number(y[C]);let N=s.current.width/S-1,E=0;for(let C=0;C<b.length;C++){const I=r.current.scale*Math.log2(b[C])*(S/5)*((h=o.current)==null?void 0:h.volume);if(((x=u.current)==null?void 0:x.length)>0){const $=Math.min(1,Math.max(0,I/r.current.scale/r.current.contrast/300));m.fillStyle=`rgb(
						${Ze(u.current[0][0],u.current[1][0],$)} 
						${Ze(u.current[0][1],u.current[1][1],$)}
						${Ze(u.current[0][2],u.current[1][2],$)}
						)`}else m.fillStyle=`rgb(${I/r.current.scale/r.current.contrast} 137 255)`;m.fillRect(E,s.current.height-I,N,I),E+=N+1}}n.current=requestAnimationFrame(f)};return t.useEffect(()=>{if(!i.current){cancelAnimationFrame(n.current),console.log("No FFT data to display, releasing anim frame.");return}n.current=requestAnimationFrame(f),console.log("FFT found, requested animation frame.")},[i.current]),t.useEffect(()=>(n.current=requestAnimationFrame(f),()=>cancelAnimationFrame(n.current)),[]),e.jsx("canvas",{ref:s,id:"fft-canvas",width:1900,height:1e3})},ha=()=>{const n=xe(),[s,c]=t.useState(!1);if(t.useEffect(()=>{(async()=>{if((await(await fetch(`${v}/auth/verifyToken`,{method:"POST",credentials:"include"})).json()).success){c(!1);return}n("/")})()},[n]),s)return e.jsx(mt,{});const o=ht().pathname,r=["/home"];return e.jsxs("div",{className:"app-container",children:[e.jsx(Tt,{}),e.jsxs("div",{className:"content-container",page:r.includes(o)?o:"inside",children:[e.jsx(da,{}),e.jsxs("div",{className:"content",children:[e.jsx(ss,{})," "]})]})]})},Bt=({album:n,hideArtist:s=!1})=>{const c=xe(),[i,o]=t.useState([]),r=l=>{c(`/albums/${l}`)};return t.useEffect(()=>{n.artists&&o(JSON.parse(n.artists).map(l=>l.name))},[n]),e.jsxs("div",{className:"album-card",onClick:()=>r(n.id),children:[n.cover?e.jsx("img",{src:`${v}/covers/${n.cover}`,alt:`${Ue(n.title,25)} cover`,className:"album-card-cover"}):e.jsx(pe,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Ue(n.title,40)}),!s&&e.jsx("p",{className:"album-artist",children:Ue(i.toString().replace(/,/g,", "),25)||"No artist"})]})},Dt=()=>{const{emit:n}=wt(),s=()=>{n("openAddMusic")};return e.jsxs("div",{className:"add-music-shortcut",children:[e.jsx("h2",{children:"Welcome to the Crystal Music Library! "}),e.jsxs("button",{onClick:s,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"15px",margin:"auto"},children:[e.jsx(Ot,{}),e.jsx("h3",{style:{margin:"2px"},children:"Add music"})]})]})},fa=({})=>{const[n,s]=t.useState([]),[c,i]=t.useState(!1),o=()=>{fetch(`${v}/read-write/albums`,{method:"GET",credentials:"include"}).then(l=>{if(l.status!==200){console.error("Error fetching albums");return}return l.json()}).then(l=>{s(l),i(!0)})};t.useEffect(()=>{o();const l=u=>{console.log("Music uploaded:",u.detail),o()};return window.addEventListener("musicUploaded",l),()=>{window.removeEventListener("musicUploaded",l)}},[]);const r=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});return e.jsx("div",{className:"home album-displayer","data-no-tracks":(n==null?void 0:n.length)==0&&c?"true":"false",children:c?(n==null?void 0:n.length)!==0?n.map(l=>e.jsx(Bt,{album:l},l.id)):e.jsx(Dt,{}):e.jsx(r,{})})},pa=()=>e.jsx("p",{children:" Your albums"}),ga=()=>{const[n,s]=t.useState(!0),c=xe(),i=async r=>{if(r.preventDefault(),!r.target.email.value||!r.target.password.value||!r.target.repeat_password.value||!r.target.name.value){alert("Please fill in all fields");return}if(r.target.password.value!==r.target.repeat_password.value){alert("Passwords do not match");return}const l=new FormData(r.target),u=await fetch(`${v}/auth/register`,{method:"POST",credentials:"include",body:l}),p=await u.json();u.ok?(alert("User registered successfully"),c("/home")):alert(p.error)};t.useEffect(()=>{fetch(`${v}/auth/any-user`,{method:"GET"}).then(r=>r.json()).then(r=>{s(r===0)})},[]);const o=()=>e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsx("p",{children:"Already an account?"}),e.jsx("button",{style:{width:"100%"},onClick:()=>{c("/")},children:"Login"})]});return e.jsxs("div",{className:"authDiv",children:[e.jsx(pe,{}),e.jsx("h1",{children:"Register"}),e.jsx("p",{children:n?`Welcome to the crystal_Music Library! Since you are the first 
            to show up here, we would like you to create the admin account.`:"Please fill the form to register as a new user."}),e.jsxs("form",{onSubmit:i,children:[!n&&e.jsx(o,{}),e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"new-password"}),e.jsx("label",{htmlFor:"repeat_password",children:"Confirm Password"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",name:"repeat_password",autoComplete:"password"}),e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",autoComplete:"name"}),e.jsx("button",{type:"submit",children:"Register"})]})]})},Ee={FETCHING:"fetching",SUCCESS:"success",REJECTED:"rejected",NONE:"none"},xa=()=>{const n=t.useRef(Ee.NONE),[s,c]=t.useState(Ee.NONE),i=xe(),{emit:o}=wt(),r=async p=>{if(p.preventDefault(),!p.target.email.value||!p.target.password.value){alert("Please fill in all fields");return}const f=new FormData(p.target),a=await fetch(`${v}/auth/login`,{method:"POST",credentials:"include",body:f}),m=await a.json();a.ok?(localStorage.setItem("username",m.username),n.current=Ee.SUCCESS):n.current=Ee.REJECTED,u()},l=()=>{switch(s){case Ee.FETCHING:return e.jsx(ms,{});case Ee.SUCCESS:return e.jsxs("div",{className:"loginFeedback",sucess:"true",children:[e.jsx(tt,{className:"successIcon"}),e.jsx("span",{children:"Logged in"})]});case Ee.REJECTED:return e.jsxs("div",{className:"loginFeedback",sucess:"false",children:[e.jsx(Ce,{className:"failIcon"}),e.jsx("span",{children:"Wrong credentials"})]});default:return null}},u=()=>{switch(c(n.current),n.current){case Ee.REJECTED:setTimeout(()=>{c(Ee.NONE)},1e3);break;case Ee.SUCCESS:setTimeout(()=>{o("login"),i("/home")},1e3);break}};return e.jsxs("div",{className:"authDiv",children:[e.jsx(pe,{}),e.jsx("h1",{children:"Login"}),e.jsx("p",{children:"We were not able to connect you, please login."}),e.jsxs("form",{onSubmit:r,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"password"}),e.jsx("button",{type:"submit",children:"Login "}),e.jsx("p",{children:"Don't have an account?"}),e.jsx("button",{onClick:()=>{i("/register")},children:"Register"})]}),e.jsx(l,{})]})},Xe=Object.freeze({LOGIN:"login",REGISTER:"register",ANY_USER:"any_user",VERIF_TOKEN:"verif_token"}),va=()=>{const n=xe(),[s,c]=t.useState([]),[i,o]=t.useState(null),[r,l]=t.useState(!0);return t.useEffect(()=>{(async()=>{o(Xe.ANY_USER);const f=await(await fetch(`${v}/auth/any-user`,{method:"GET"})).json();if(console.log("Parsed users",f),c(f),console.log(f),f===0){l(!1),o(Xe.REGISTER);return}o(Xe.VERIF_TOKEN);const m=await(await fetch(`${v}/auth/verifyToken`,{method:"POST",credentials:"include"})).json();if(l(!1),m.success){console.log("Token is valid"),n("/home");return}o(Xe.LOGIN)})()},[n]),r?null:i===Xe.LOGIN?e.jsx(xa,{}):(i===Xe.REGISTER&&n("/register"),null)},ys=({index:n,track:s,playIconId:c,isSalad:i=null,onClick:o,showCover:r=!1})=>{const{title:l,track_number:u,rawDuration:p}=s,{playingTrack:f,openTrackActions:a}=le(),m=s.id,[h,x]=t.useState("null"),[S,y]=t.useState(!1),[_,b]=t.useState(!1),N=()=>{if(i){i(n);return}o(s.id)},E=()=>{switch(c){case 0:return e.jsx(cr,{className:"track-number",playing:"piano","data-show-cover":r});case 1:return e.jsx(ar,{className:"track-number",playing:"vinyl","data-show-cover":r});case 2:return e.jsx(rr,{className:"track-number",playing:"piano","data-show-cover":r});case"salad":return e.jsx(et,{className:"track-number",playing:"piano","data-show-cover":r})}};t.useEffect(()=>{y(s.is_favorite===1),r&&fetch(`${v}/read-write/trackCover/${s.id}`,{method:"GET"}).then(w=>w.json()).then(w=>{x(`${v}/covers/${w}`)})},[]);const C=w=>{w.stopPropagation(),fetch(`${v}/read-write/toggleFavorite/${s.id}/${!S}`,{method:"GET",credentials:"include"}).then(O=>O.json()).then(O=>{y(O)})},I=()=>{b(!1)},$=w=>{w.stopPropagation(),b(!0),a({x:w.clientX,y:w.clientY},s,I,B)},B=w=>{y(w)};return e.jsxs("div",{className:"track-view","action-bar":_?"open":"",onClick:N,children:[S&&e.jsx(tr,{className:"track-favorite"}),e.jsx(Nt,{className:"track-toggle-favorite",iconHovered:S?$t:sr,iconDefault:S?$t:rs,onClick:C}),r?h.split("/").pop()==="null"?null:e.jsx("img",{src:h,className:"track-mini-thumbnail"}):null,f===m?E():r?null:e.jsx("p",{className:"track-number",children:u}),e.jsx("p",{style:{flexGrow:"1",marginLeft:r?"45px":"35px"},children:l}),e.jsx(nr,{className:"track-actions-dots",onClick:$}),e.jsx("p",{style:{paddingRight:"10px"},children:_t(p).readable})]})},es=({isPlaylist:n=!1})=>{const[s,c]=t.useState(null),[i,o]=t.useState([]),[r,l]=t.useState([]),[u,p]=t.useState([]),[f,a]=t.useState(0),{addContainerToQueue:m,playContainerSuffle:h,editAlbum:x,editPlaylist:S,linkNewContainer:y,getNextSongsFromAlbum:_,navigateBack:b}=le(),N=t.useRef(null),E=xe(),[C,I]=t.useState([]),$=n?St().playlistId:St().albumId,[B,w]=t.useState(null),O=t.useRef(null),{notifTypes:G,addNotification:L}=We(),[P,K]=t.useState(!1),[D,ce]=t.useState(!1),[X,re]=t.useState(!1);t.useEffect(()=>{ue()},[$,D]),t.useEffect(()=>{y({id:$,type:n?"playlist":"album",favPlaylist:P},ue)},[P]);const ue=()=>{fetch(`${v}/read-write/${n?"playlist":"album"}/${$}`,{method:"GET",credentials:"include"}).then(F=>{if(!F.ok)throw new Error("Network response was not ok");return F.json()}).then(F=>{a(Math.floor(Math.random()*3));const te=F.tracks.filter(ye=>(!X&&ye.is_favorite===1&&re(!0),D?ye.is_favorite===1:!0));if(n){c(F.playlistInfos),o(te),p([F.owner,...F.collaborators]),K(F.isFavPlaylist);return}c(F.albumInfos);let ge=0;for(let ye=0;ye<te.length;ye++){const Ne=te[ye];Ne.disc>ge&&(te.splice(ye,0,{disc:Ne.disc,type:"disc"}),ge=Ne.disc)}o(te),l(F.genres),p(F.artists),K(!1)})},ke=async()=>await m($,n?"playlist":"album",D),oe=async()=>{h($,n?"playlist":"album",D)},V=()=>{if(n){S($);return}x($)},j={TRACK:"track",ALBUM:"album",ARTIST:"artist",PLAYLIST:"playlist",GENRE:"genre"},z=F=>{switch(F){case"track":return e.jsx(Ot,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add album"})," ",e.jsx(ft,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add artist's discography"})," ",e.jsx(dr,{className:"action-bar-entry-tooltip-logo"})]});case"playlist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire playlist"})," ",e.jsx(ur,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire genre"})," ",e.jsx(lr,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},ee=F=>{const te=F.target.value;if(te===""||te.trim().length===0){I([]);return}console.log(`${v}/read-write/search/${te}`),fetch(`${v}/read-write/search/${te}`,{method:"GET"}).then(ge=>{if(ge.ok)return ge.json();throw new Error("Error fetching search results")}).then(ge=>{var Ne,ze,_e,Be,M;const ye=[...(Ne=ge.tracks)==null?void 0:Ne.map(R=>({type:"track",...R})),...(ze=ge.albums)==null?void 0:ze.map(R=>({type:"album",...R})),...(_e=ge.artists)==null?void 0:_e.map(R=>({type:"artist",...R})),...(Be=ge.genres)==null?void 0:Be.map(R=>({type:"genre",...R})),...(M=ge.playlists)==null?void 0:M.map(R=>({type:"playlist",...R})).filter(({id:R})=>R!==$)].map(R=>{const T=R.path,{trackPath:W,...q}=R;return{icon:()=>T?e.jsx("img",{className:"action-bar-entry-logo",src:`${v}/${R.type==="artist"?"artist":"covers"}/${T}`,alt:R.name}):e.jsx(pe,{className:"action-bar-entry-logo"}),tooltip:z,code:R.type==="artist"?j.ARTIST:R.type==="album"?j.ALBUM:R.type==="genre"?j.GENRE:R.type==="playlist"?j.PLAYLIST:j.TRACK,fileName:T,...q}});console.log(ye),I(ye)})},Y=F=>{B||setTimeout(()=>{requestAnimationFrame(()=>{var te;(te=O.current)==null||te.focus()})},0)},de=F=>{const te=new FormData;te.append("addRequest",JSON.stringify({playlistId:$,endpoint:F.code,entryId:F.id,addAllToFavorite:P||!1})),fetch(`${v}/read-write/addToPlaylist`,{method:"POST",credentials:"include",body:te}).then(ge=>ge.json()).then(ge=>{ue(),ve(),L("Added to playlist",G.INFO)})};t.useEffect(()=>{const F=te=>{N.current&&!N.current.contains(te.target)&&ve()};return document.addEventListener("mousedown",F),document.addEventListener("touchstart",F),()=>{document.removeEventListener("mousedown",F),document.removeEventListener("touchstart",F)}},[]);const ve=()=>{w(!1),O.current.value="",I([])},Re=F=>{_(F,D)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton",onClick:b,children:e.jsx(He,{})}),(s==null?void 0:s.cover)&&e.jsx("img",{src:`${v}/covers/${s.cover}`,className:"background-image",alt:"background"}),s&&i?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:s.title}),e.jsx("div",{className:"album-artists",children:u?u.map(F=>e.jsx("span",{className:"artist-name",onClick:()=>{E(`/${n?"users":"artists"}/${F.id}`)},children:F.name},F.id)):e.jsxs("span",{className:"artist-name",children:["Unknown ",n?"Members":"Artist"]})}),e.jsxs("div",{className:"album-content",children:[e.jsx("div",{className:"album-cover-genres",children:e.jsxs("div",{className:"album-cover-wrapper",children:[s.cover?e.jsx("img",{src:`${v}/covers/${s.cover}`,alt:`${s.title} cover`,className:"cover-image"}):e.jsx(pe,{className:"cover-image"}),e.jsx("div",{className:"genres-album-div",children:r.map((F,te)=>e.jsx("span",{className:"genre-album",onClick:()=>{E(`/genres/${F.genreId}`)},children:F.genreName},te))}),s.description&&e.jsx("p",{children:s.description})]})}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(me,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:ke}),e.jsx(me,{text:"Random",icon:e.jsx(nt,{}),onClick:oe}),!P&&e.jsx("button",{className:"button-with-callback",onClick:V,children:e.jsx(is,{})}),!P&&X&&e.jsx("button",{className:"button-with-callback","data-is-active":D,onClick:()=>{ce(!D)},children:e.jsx(or,{})}),s.lossless===1&&e.jsxs("div",{className:"lossless",children:[e.jsx("span",{children:"Lossless"})," ",e.jsx(ir,{})]})]}),n&&e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:N,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",onClick:Y,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(rt,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:ee,placeholder:"Search for tracks, artists, genres, playlists to add.",ref:O,onFocus:()=>{w(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${B?"block":"none"}`},children:e.jsx(Le,{height:300,itemCount:C.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:F,style:te})=>e.jsx(gt,{entry:C[F],style:{...te,width:" calc(100% - 20px)",marginTop:"10px"},onClick:de},F)})})]})}),i.map((F,te)=>(F==null?void 0:F.type)==="disc"?e.jsx("span",{children:`Disc ${F.disc}`},`disc-${te}`):e.jsx(ys,{track:F,onClick:Re,playIconId:f,showCover:n},F.id))]})]})]}):e.jsx(mt,{text:"Loading album"})]})},ja=({artist:n})=>{const s=xe(),c=i=>{s(`/artists/${i}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>c(n.id),children:[n.picture?e.jsx("img",{src:`${v}/covers/artists/${n.picture}`,alt:`${n.name} cover`,className:"artist-card-cover"}):e.jsx(pe,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:n.name})]})},ya=()=>{const[n,s]=t.useState([]),c=()=>{fetch(`${v}/read-write/artists`,{method:"GET",credentials:"include"}).then(i=>{if(i.status!==200){console.error("Error fetching artists");return}return i.json()}).then(i=>{s(i)})};return t.useEffect(()=>{c();const i=o=>{console.log("Music uploaded:",o.detail),c()};return window.addEventListener("musicUploaded",i),()=>{window.removeEventListener("musicUploaded",i)}},[]),e.jsx("div",{className:"home album-displayer",children:(n==null?void 0:n.length)!==0?n.map(i=>e.jsx(ja,{artist:i},i.id)):e.jsx(Dt,{})})},ba=()=>{const[n,s]=t.useState(null),[c,i]=t.useState([]),{addArtistToQueue:o,shuffleArtistToQueue:r,editArtist:l,linkNewContainer:u,navigateBack:p}=le(),f=St().artistId;t.useEffect(()=>{a(),u({id:f,type:"artist"},a)},[f]);const a=()=>{fetch(`${v}/read-write/artist/${f}`,{method:"GET",credentials:"include"}).then(x=>{if(!x.ok)throw new Error("Network response was not ok");return x.json()}).then(x=>{s(x.artistInfos),i(x.albums),console.log(x.artistInfos)})},m=async()=>await o(f),h=async()=>{r(f,!1)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton",onClick:p,children:e.jsx(He,{})}),n&&c?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:n.name}),e.jsxs("div",{className:"album-content",children:[n.picture?e.jsx("img",{src:`${v}/covers/artists/${n.picture}`,alt:`${n.name} cover`,className:"cover-image"}):e.jsx(pe,{className:"cover-image"}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(me,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:m}),e.jsx(me,{text:"Random",icon:e.jsx(nt,{}),onClick:h}),e.jsx(me,{icon:e.jsx(is,{}),onClick:async()=>{l(n.id)}})]}),e.jsx("div",{className:"album-displayer",children:c.map(x=>e.jsx(Bt,{album:x,hideArtist:!0},x.id))})]})]})]}):e.jsx(mt,{text:"Loading artist"})]})},Na=()=>{const n=xe(),s=()=>{n("/home")};return e.jsxs("div",{className:"not-found",children:[e.jsx("h1",{children:"Where did you land..?"}),e.jsx("p",{children:"The adress you gave is not defined, but you can go back to library:"}),e.jsx("button",{className:"btn",onClick:s,children:"Go back to library"})]})},Sa=()=>{const[n,s]=t.useState("");t.useEffect(()=>{s(localStorage.getItem("username"))},[]);const c=xe();return e.jsxs("div",{className:"account-page",children:[e.jsx(Tt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>c("/home"),children:e.jsx(He,{})}),e.jsxs("div",{className:"account-container",children:[e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:n}),e.jsx("p",{children:"Account information will be displayed here."})]}),e.jsx(pe,{})]})]})]})},ka=({active:n,setActive:s})=>e.jsx("div",{className:"toggle-button","data-is-active":n,onClick:c=>{c.stopPropagation(),s(!n)},children:e.jsx("div",{className:"toggle-button-active","data-is-active":n})}),Me=({stateChanged:n,min:s=0,max:c=0,ref:i})=>{const o=s===c&&c===0,r=u=>{const p=u.target.value;n(p)},l=u=>{console.log("blur");let p=parseFloat(u.target.value);isNaN(p)&&(p=s),o||(p=Math.min(c,Math.max(s,p))),u.target.value=p,n(p)};return o?e.jsx("input",{ref:i,type:"number",onBlur:l,onChange:r}):e.jsx("input",{min:s,ref:i,max:c,type:"number",onBlur:l,onChange:r})},wa=()=>{var S;const n=t.useRef(null),s=t.useRef(null),c=t.useRef(null),i=t.useRef(null),o=t.useRef(null),{FFTUserSetingsRef:r,fftConfigRef:l}=le(),u=y=>{r.current.bars=Math.floor(y),h()},p=y=>{r.current.cutoff=parseFloat(y),h()},f=y=>{r.current.scale=parseFloat(y),h()},a=y=>{r.current.contrast=parseFloat(y),h()},m=y=>{r.current.FPS=parseFloat(y),h()},h=()=>{const y=new FormData;y.append("FFT",JSON.stringify(r.current)),fetch(`${v}/config/user/send/FFT`,{method:"POST",credentials:"include",body:y})},x=async()=>{await fetch(`${v}/config/user/FFT`,{method:"GET",credentials:"include"}).then(y=>y.json()).then(y=>{r.current=y,n.current.value=r.current.bars,i.current.value=r.current.contrast,s.current.value=r.current.scale,o.current.value=r.current.cutoff,c.current.value=r.current.FPS})};return t.useEffect(()=>{x()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Number of bars"}),e.jsx(Me,{ref:n,stateChanged:u,min:1,max:(S=l.current)==null?void 0:S.fftSize})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"FPS (High number may cause strong battery usage)"}),e.jsx(Me,{ref:c,stateChanged:m})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Scale"}),e.jsx(Me,{ref:s,stateChanged:f})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Contrast"}),e.jsx(Me,{ref:i,stateChanged:a})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Cutoff"}),e.jsx(Me,{ref:o,stateChanged:p})]})]})},Ta={FFT:wa},Ea=({entryName:n,entryIcon:s,linkedSettingKey:c})=>{const[i,o]=t.useState(!1),r=t.useMemo(()=>Ta[c]||null,[c]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":i,onClick:l=>{l.stopPropagation(),o(!i)},children:[s,e.jsx("span",{children:n})]}),e.jsx("div",{className:"admin-setting-content",children:r&&i&&e.jsx(r,{})})]})},Ca=()=>{const[n,s]=t.useState(!1);t.useEffect(()=>{pt(()=>{fetch(`${v}/auth/is-admin`,{method:"POST",credentials:"include"}).then(o=>o.json()).then(o=>{s(o)})})()},[]);const c=xe();return e.jsxs("div",{className:"account-page",children:[e.jsx(Tt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>c("/home"),children:e.jsx(He,{})}),e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:"Settings page"}),e.jsx("p",{children:"A shinny list of fancy settings."}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Ea,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(ls,{})})})]})]})]})},Ra=({user:n,totalStorage:s})=>{const[c,i]=t.useState(0);return t.useEffect(()=>{fetch(`${v}/read-write/user-data-usage/${n.id}`,{method:"GET",credentials:"include"}).then(o=>o.json()).then(o=>{i(o)}).catch(o=>{console.error("Error fetching user storage data: ",o)})},[]),e.jsxs("div",{className:"user-account-infos-entry",children:[e.jsx("p",{children:n.username}),e.jsx("p",{children:n.email}),e.jsx("p",{children:n.role}),e.jsx(at,{percent:Number(c/s*100).toFixed(2),fillColor:"var(--cool-green)",showPercent:!0,style:{maxWidth:"200px"}})]})},Ve={PENDING:"pending",RUNNING:"running",PAUSED:"paused",INACTIVE:"inactive"},ts=({jobName:n,description:s,jobKey:c,payload:i={},doneTotalView:o=null})=>{const[r,l]=t.useState(!1),[u,p]=t.useState(!0),[f,a]=t.useState(0),[m,h]=t.useState(!1),[x,S]=t.useState(null),y=t.useRef(null),_=(w=!0,O="",G=0)=>{var L=w;fetch(`${v}/jobs/status/${c}`,{method:"GET",credentials:"include"}).then(P=>P.json()).then(P=>{h(!1);let K=1e3;switch(P.status){case Ve.PENDING:h(!0),l(!0),p(!1),K=500;break;case Ve.INACTIVE:if(O===Ve.RUNNING||O===Ve.PENDING){setTimeout(()=>{l(!1),a(0),S(null),_(!1,P.status)},2e3),a(100),S({done:G,total:G,working:0}),L=!1,console.log("Stop fast fetch job");return}l(!1);break;case Ve.PAUSED:p(!0),l(!0),K=500;break;case Ve.RUNNING:p(!1),l(!0),K=10;break}y.current&&(clearTimeout(y.current),y.current=null),L&&(y.current=setTimeout(()=>{var D;if(P.progress){const ce=P.progress.done/P.progress.total*100;a(ce),S(P.progress)}else S(null);_(!0,P.status,((D=P.progress)==null?void 0:D.total)??0)},K))})},b=()=>{fetch(`${v}/jobs/status/${c}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{_(w.status===Ve.RUNNING)})},N=()=>{const w=new FormData;w.append("payload",JSON.stringify(i)),fetch(`${v}/jobs/run/${c}`,{method:"POST",credentials:"include",body:w}).then(O=>O.json()).then(O=>{_(!0)})},E=()=>{fetch(`${v}/jobs/pause/${c}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{_(!1)})},C=()=>{fetch(`${v}/jobs/resume/${c}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{_(!0)})},I=()=>{fetch(`${v}/jobs/stop/${c}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{_(!1)})};t.useEffect(()=>(b(),()=>{y.current&&(console.log("Trying clearTimout"),clearTimeout(y.current),y.current=null)}),[]);const $=async()=>{if(r){u?C():E(),p(!u);return}N()},B=async()=>{I(),a(0)};return e.jsxs("div",{className:"backend-job",children:[e.jsx("h3",{children:n}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"baseline",flexWrap:"wrap"},children:[e.jsx(me,{text:r?u?"Resume":"Pause":"Run",icon:r?u?e.jsx(mr,{}):e.jsx(hr,{}):e.jsx(fr,{}),onClick:$}),e.jsx(me,{text:"Stop",icon:e.jsx(pr,{}),onClick:B}),e.jsx(at,{style:{height:"25px",filter:`grayscale(${u&&r?.8:0})`},minWidth:"200px",percent:f,showPercent:!1,text:x?o.current?`${x.done}/${x.total}`:`Working: ${x.working} | Left : ${x.total-x.done}`:null,fillColor:"linear-gradient(90deg, rgb(187, 251, 223) 0%, rgb(198, 203, 253) 50%, rgb(239, 201, 249) 100%)",initialising:m,initialisingColor:"violet"})]}),e.jsx("p",{children:s}),e.jsx("div",{className:"job-status","data-running":u?"false":"true",style:{backgroundColor:r?m?"purple":u?"red":"green":"grey"},children:e.jsx("span",{children:r?m?"Initlialising":u?"Paused":"Running":"Inactive"})})]})},Aa=()=>{const n=t.useRef(null),s=t.useRef(null),c=t.useRef(null),i=t.useRef(null),[o,r]=t.useState(!1),l=m=>{n.current.samples=Math.floor(m),f()},u=m=>{n.current.samplingInterval=1/Math.floor(m),f()},p=m=>{n.current.parallelCompute=Math.floor(m),f()},f=()=>{const m=new FormData;m.append("FFT",JSON.stringify(n.current)),fetch(`${v}/config/send/FFT`,{method:"POST",credentials:"include",body:m})},a=async()=>{await fetch(`${v}/config/FFT`,{method:"GET",credentials:"include"}).then(m=>m.json()).then(m=>{n.current=m}),r(n.current.useServerFFT),c.current.value=n.current.samples,s.current.value=Math.floor(1/n.current.samplingInterval),i.current.value=n.current.parallelCompute};return t.useEffect(()=>{a()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line",children:[e.jsx("span",{children:"Activate audio spectra computation"}),e.jsx(ka,{defaultValue:n.current,active:o,setActive:m=>{r(m),n.current&&(n.current.useServerFFT=m,f())}})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":o,children:[e.jsx("span",{children:"Frame definiton (power of 2)"}),e.jsx(Me,{ref:c,stateChanged:l,max:4096,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":o,children:[e.jsx("span",{children:"Frame per second"}),e.jsx(Me,{ref:s,stateChanged:u,max:120,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":o,children:[e.jsx("span",{children:"Number of parallel analyzed songs"}),e.jsx(Me,{ref:i,stateChanged:p,max:10,min:1})]})]})},Ia={FFT:Aa},Fa=({entryName:n,entryIcon:s,linkedSettingKey:c})=>{const[i,o]=t.useState(!1),r=t.useMemo(()=>Ia[c]||null,[c]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":i,onClick:l=>{l.stopPropagation(),o(!i)},children:[s,e.jsx("span",{children:n})]}),e.jsx("div",{className:"admin-setting-content",children:r&&i&&e.jsx(r,{})})]})},$a=()=>{const n=()=>localStorage.getItem("job-progress-view")?localStorage.getItem("job-progress-view")==="true":!0,[s,c]=t.useState(!1),[i,o]=t.useState([]),[r,l]=t.useState(0),u=t.useRef(n()),p=xe();t.useEffect(()=>{pt(()=>{fetch(`${v}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{c(x)})})()},[]),t.useEffect(()=>{s.error||fetch(`${v}/auth/init-admin-pannel`,{method:"POST",credentials:"include"}).then(h=>h.json()).then(h=>{o(h.users),l(h.totalStorage)})},[s]);const f=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You are not an admin."})]}),a=h=>{const x=h===0;u.current=x,localStorage.setItem("job-progress-view",x)},m=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Admin pannel"}),e.jsx("p",{children:"Only for the true admins."}),e.jsxs("div",{className:"admin-category",children:[e.jsx(gr,{}),e.jsx("h2",{children:"Users' storage usage"})]}),e.jsx("div",{className:"all-users-list",children:i.map(h=>e.jsx(Ra,{user:h,totalStorage:r},h.id))}),e.jsxs("div",{className:"admin-category",children:[e.jsx(xr,{}),e.jsx("h2",{children:"Backend processes"}),e.jsx(ps,{data:["Done/Total","Working/Remaining"],currentActive:n()?0:1,onClick:a})]}),e.jsxs("div",{className:"job-grid",children:[e.jsx(ts,{jobKey:"JOB_CD",jobName:"Recompute tracks number and CDs",description:"Reextract the metadatas of the songs to remap them to the correct CD or track number. Analyses lossless.",doneTotalView:u}),e.jsx(ts,{jobKey:"JOB_FFT",jobName:"Compute audio spectras",description:"Runs a fast Fourier transform on each audio files to extract the audio spectrum. The result is writen into .bin files. For a .flac audio of 41kHz, we expect 3Mb spectrum file.",payload:{completeLibrary:!0},doneTotalView:u})]}),e.jsxs("div",{className:"admin-category",children:[e.jsx(vr,{}),e.jsx("h2",{children:"Configuration"})]}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(Fa,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(ls,{})})})]});return e.jsxs("div",{className:"account-page",children:[e.jsx(Tt,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton",onClick:()=>p("/home"),children:e.jsx(He,{})}),e.jsx("div",{className:"account-info",children:s?e.jsx(m,{}):e.jsx(f,{})})]})]})},Pa=()=>{const[n,s]=t.useState(null),{genreId:c}=St(),{addContainerToQueue:i,playContainerSuffle:o,playContainer:r,navigateBack:l}=le();t.useEffect(()=>{fetch(`${v}/read-write/genre/${c}`,{method:"GET",credentials:"include"}).then(a=>{if(!a.ok)throw new Error("Network response was not ok");return a.json()}).then(a=>{s(a),console.log(a)})},[]);const u=async()=>{r(c,"genre")},p=async()=>{i(c,"genre")},f=async()=>{o(c,"genre")};return e.jsxs("div",{className:"genre-view",children:[e.jsx("button",{className:"roundButton",onClick:l,children:e.jsx(He,{})}),n?e.jsxs("div",{className:"genre-details",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"baseline",gap:"10px"},children:[e.jsx("h1",{style:{marginRight:"20px"},children:n.name}),e.jsx(me,{text:"Play",icon:e.jsx(Lt,{}),onClick:u}),e.jsx(me,{text:"Random",icon:e.jsx(nt,{}),onClick:f}),e.jsx(me,{text:"Add to queue",icon:e.jsx(Mt,{}),onClick:p})]}),e.jsx("div",{className:"genre-albums album-displayer",children:n.albums.map(a=>e.jsx(Bt,{album:a},a.id))})]}):e.jsx("p",{children:"Loading..."})]})},La=({genre:n})=>{const s=xe(),[c,i]=t.useState([]),[o,r]=t.useState([]),l=t.useRef([]),u=t.useRef(o),p=t.useRef([]),f=h=>{var S;if(console.log("changed on",h),!((S=u.current)!=null&&S.length)==0)return;const x=document.getElementById(`genre-${n.id}-img-${h}`);x==null||x.setAttribute("data-hidden","true"),setTimeout(()=>{x&&(x.src=`${v}/covers/${u==null?void 0:u.current[h]}`),x==null||x.removeAttribute("data-hidden")},500)};t.useEffect(()=>(a(i),m(),[2e3,2500,3e3].forEach((x,S)=>{setTimeout(()=>f(S),x);const y=setInterval(()=>f(S),7e3);p.current.push(y)}),()=>{l.current.forEach(clearTimeout),l.current=[],p.current.forEach(clearInterval),p.current=[],u.current=[]}),[]);const a=h=>{fetch(`${v}/read-write/trackCoversGenre/${n.id}`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{h(x)})};t.useEffect(()=>{u.current=o},[o]);const m=()=>{a(r),setTimeout(m,5500)};return e.jsxs("div",{className:"genre-card",onClick:()=>{s(`/genres/${n.id}`)},children:[c.map((h,x)=>e.jsx("div",{className:"img-pivot",style:{"--start-delay":`${3*(2-x)}`,"--start-angle":`${2-x}`,"--speed":"0.7","--scale":.4},children:e.jsx("img",{id:`genre-${n.id}-img-${x}`,className:"genre-img-cover",style:{"--scale":.7},src:`${v}/covers/${h}`})},x)),e.jsx("div",{className:"genre-name",children:e.jsx("p",{children:n.name})})]})},Oa=({})=>{const[n,s]=t.useState([]),c=()=>{fetch(`${v}/read-write/genres`,{method:"GET",credentials:"include"}).then(i=>i.json()).then(i=>{s(i)})};return t.useEffect(()=>{pt(()=>{c();const o=r=>{console.log("Music uploaded:",r.detail),c()};return window.addEventListener("musicUploaded",o),()=>{window.removeEventListener("musicUploaded",o)}})()},[]),e.jsx("div",{className:"home genre-displayer",children:(n==null?void 0:n.length)!==0?n.map(i=>e.jsx(La,{genre:i},i.id)):e.jsx(Dt,{})})},Ma=({playlist:n})=>{const s=xe(),c=i=>{s(`/playlists/${i}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>c(n.id),children:[n.cover?e.jsx("img",{src:`${v}/covers/${n.cover}`,alt:`${n.name} cover`,className:"artist-card-cover"}):e.jsx(pe,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:n.name})]})},Ua=()=>{const[n,s]=t.useState([]),{createNewPlaylist:c,setPlaylistAddedCallback:i}=le(),o=()=>{fetch(`${v}/read-write/playlists`,{method:"GET",credentials:"include"}).then(r=>r.json()).then(r=>s(r))};return t.useEffect(()=>{pt(()=>{o(),i(o)})()},[]),e.jsxs("div",{children:[e.jsx(me,{className:"buttonRound",onClick:c,style:{marginBottom:"40px"},icon:e.jsx(jr,{}),text:"Create a new playlist"}),e.jsx("div",{className:"album-displayer",children:n.map(r=>e.jsx(Ma,{playlist:r},r.id))})]})},_a=()=>{const n=t.useRef(null),s=t.useRef(null),[c,i]=t.useState(!1),[o,r]=t.useState([]),{playAudioSalad:l,setSaladContext:u,saladContext:p,openTagWindow:f}=le(),[a,m]=t.useState([]),[h,x]=t.useState([]),{addNotification:S,notifTypes:y}=We(),[_,b]=t.useState([]),[N,E]=t.useState(!1),[C,I]=t.useState(!1),$=t.useRef(null),B=t.useRef(null),[w,O]=t.useState("#aabbcc"),[G,L]=t.useState(!0);t.useEffect(()=>{pt(()=>{const j=z=>{n.current&&!n.current.contains(z.target)&&K()};return a.length===0&&m(p||[]),fetch(`${v}/read-write/mostUsedTags`,{method:"GET",credentials:"include"}).then(z=>z.json()).then(z=>{const ee=z.map(Y=>({...Y,type:Y.total,typeElem:"tag",icon:()=>e.jsx(kt,{color:Y.color}),tooltip:de=>e.jsx("span",{children:de})}));x(ee),r(ee)}),document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j)}})()},[]);const P=V=>{const j=V.target.value;if(j===""||j.trim().length===0){r(h);return}fetch(`${v}/read-write/search/${j}/tags,salads`,{method:"GET"}).then(z=>{if(z.ok)return z.json();throw new Error("Error fetching search results")}).then(z=>{var Y,de;const ee=[...(Y=z.tags)==null?void 0:Y.map(ve=>({...ve,typeElem:"tag",icon:()=>e.jsx(kt,{color:ve.color})})),...(de=z.salads)==null?void 0:de.map(ve=>({...ve,typeElem:"salad",icon:()=>e.jsx(et,{color:ve.color})}))];console.log(ee),r(ee)})},K=()=>{i(!1)},D=V=>{m(j=>j.filter(z=>z.id!==V))},ce=V=>{K(),console.log(V),!a.find(j=>j.id===V.id)&&m(j=>[...j,V])},X=async()=>{l(_.map(V=>V.id)),u(a)};t.useEffect(()=>{if(u(a),a.length===0){b([]),L(!0);return}L(a.findIndex(j=>j.typeElem==="salad")===-1);const V=new FormData;V.append("tags",JSON.stringify(a.filter(j=>j.typeElem==="tag").map(j=>j.id))),V.append("salads",JSON.stringify(a.filter(j=>j.typeElem==="salad").map(j=>j.id))),fetch(`${v}/read-write/getSalad`,{method:"POST",body:V}).then(j=>j.json()).then(j=>JSON.parse(j)).then(j=>{b(ut.shuffle(j)),console.log("New tracks received",j),j.length>0?S("Salad received! Enjoy..",y.SALAD):S("This salad is empty.. No tracks found.",y.SALAD)})},[a]);const re=async()=>{a.length!==0&&(E(!0),O(`${us(Math.random().toFixed(4)*360,100,70.8)}`))},ue=()=>{if(!B.current.value||(E(!1),a.find(j=>j.typeElem==="salad")))return;const V=new FormData;V.append("salad",JSON.stringify({name:B.current.value,color:w,tags:a.map(j=>j.id)})),fetch(`${v}/read-write/newSalad`,{method:"POST",credentials:"include",body:V}).then(j=>j.json()).then(j=>{S("Salad saved!",y.SUCCESS),m([j])})},ke=V=>{l(_.map(j=>j.id),V)},oe=()=>{i(!0),s.current.value};return e.jsxs("div",{className:"cooking-div",children:[e.jsx("h2",{children:"Here select some tags and play the music!"}),e.jsxs("div",{className:"cooking-header",children:[e.jsx("div",{className:"action-bar",style:{margin:"auto"},ref:n,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",style:{zIndex:"2"},children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(rt,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:P,placeholder:"Search some tags or salads..",ref:s,onFocus:oe}),e.jsx("div",{className:"action-bar-results",style:{display:`${c?"block":"none"}`},children:e.jsx(Le,{height:300,itemCount:o.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:V,style:j})=>e.jsx(gt,{entry:o[V],style:{...j,width:" calc(100% - 20px)",marginTop:"10px"},onClick:ce},V)})})]})}),e.jsx("button",{className:"open-tags-edit",onClick:f,children:e.jsx(yr,{})})]}),e.jsxs("div",{className:"cooking-selection",children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(me,{text:"Play the salad",icon:e.jsx(br,{}),onClick:X}),G&&e.jsx(me,{text:"Save this salad",icon:e.jsx(Nr,{}),onClick:re})]}),e.jsx("div",{className:"cooking-tags",style:{marginBottom:"30px"},children:a.map(V=>e.jsxs("div",{className:"small-tag","data-prefix":V.typeElem==="salad",style:{backgroundColor:V.color},children:[V.typeElem==="salad"&&e.jsx(et,{"data-prefix":"true"}),e.jsx("span",{children:V.name}),e.jsx(Ce,{onClick:()=>{D(V.id)}})]},V.id))}),e.jsx("div",{className:"track-list",children:_.map((V,j)=>e.jsx(ys,{index:j,isSalad:ke,track:V,playIconId:"salad",showCover:!0},V.id))})]}),N?e.jsxs("div",{className:"edit-tag",style:{left:"calc(50% - 170px)",margin:"auto"},children:[e.jsx(Ce,{style:{cursor:"pointer"},onClick:()=>{E(!1)}}),e.jsx("input",{type:"text",placeholder:"Name your new salad.",ref:B}),e.jsx(Sr,{style:{cursor:"pointer"},id:"color-button",color:w,onClick:()=>{I(!C)}}),C&&e.jsxs("div",{ref:$,className:"edit-tag-picker",children:[" ",e.jsx(Ut,{color:w,onChange:O})]}),e.jsx(tt,{onClick:ue,style:{cursor:"pointer"}})]}):null]})},Ba=({radio:n})=>{const{playRadio:s}=le();return e.jsxs("div",{className:"album-card",onClick:()=>s(n.id),children:[n.coverUrl?e.jsx("img",{src:`${n.coverUrl}`,alt:`${Ue(n.name,25)} cover`,className:"album-card-cover"}):e.jsx(pe,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Ue(n.name,40)})]})},Da=()=>{const[n,s]=t.useState(!1),[c,i]=t.useState([]),o=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});t.useEffect(()=>{},[]);const r=()=>{},l=()=>{},u=async()=>{window.open("https://www.radio-browser.info/tags","_blank").focus()};return e.jsxs("div",{className:"home",children:[e.jsx("h3",{children:"Recently heard"}),e.jsx("div",{className:"album-displayer","data-no-tracks":(c==null?void 0:c.length)==0&&n?"true":"false",children:n?(c==null?void 0:c.length)!==0?c.map(p=>e.jsx(Ba,{radio:p},p.id)):null:e.jsx(o,{})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx("h3",{style:{marginRight:"20px"},children:"Discover"}),e.jsx(me,{text:"Filters",icon:e.jsx(kr,{}),onClick:r}),e.jsx(me,{text:"Random",icon:e.jsx(nt,{}),onClick:l}),e.jsx(me,{text:"External search",icon:e.jsx(wr,{}),onClick:u})]})]})},Ga=()=>{const{playingTrack:n}=le();return e.jsxs("div",{className:"content-with-fft",children:[e.jsx(ss,{})," ",n?e.jsx(ma,{}):null]})},Va=()=>{const{fullScreenImage:n,requestNewFullScreenImage:s,playingTrack:c,toggleFullScreenView:i,colorOverride:o}=le(),r=t.useRef(null),l=t.useRef(null),u=t.useRef(null),p=t.useRef(null),f=t.useRef(null),a=t.useRef(!1),m=t.useRef(0),h=3,x=t.useRef(0),[S,y]=t.useState(!1),_=t.useRef([]),b=t.useRef(0),N=t.useRef(0),E=O=>{a.current?(r.current.src=URL.createObjectURL(O),l.current.src=URL.createObjectURL(O),f.current=r.current):(u.current.src=URL.createObjectURL(O),p.current.src=URL.createObjectURL(O),f.current=u.current),f.current.addEventListener("load",I)};t.useEffect(()=>{!c||!(r.current&&l.current)||((n==null?void 0:n.track)!==c?(a.current=!a.current,s().then(O=>{E(O.blob)})):E(n.blob))},[c]);const C=(O,G)=>{O?(r.current.setAttribute("data-hidden",G),l.current.setAttribute("data-hidden",G)):(u.current.setAttribute("data-hidden",G),p.current.setAttribute("data-hidden",G))},I=()=>{C(a.current,!1),C(!a.current,!0),clearTimeout(b.current),b.current=setTimeout(()=>{a.current?u.current&&(u.current.src=null,p.current.src=null):r.current&&(r.current.src=null,l.current.src=null)},1100),$()},$=()=>{f.current.removeEventListener("load",I);let O=new Ar;_.current=O.getPalette(f.current,10),B()},B=()=>{const O=ut.shuffle(_.current);clearTimeout(N.current);const G=O.slice(0,2);o.current.length===0?o.current=G:w(G,0)},w=(O,G)=>{o.current=o.current.map((L,P)=>L.map((K,D)=>parseInt(Ze(K,O[P][D],.1)))),!(G>150)&&(N.current=setTimeout(()=>{w(O,G+1)},1e3/60))};return t.useEffect(()=>{var P,K;const O=()=>{m.current=0,S&&y(!1)},G=()=>{m.current++,m.current>=h?+y(!0):y(!1)},L=["mousemove","keydown","mousedown","touchstart","scroll"];return L.forEach(D=>{window.addEventListener(D,O)}),x.current=setInterval(G,1e3),(P=f.current)!=null&&P.complete&&((K=f.current)!=null&&K.src)&&$(),()=>{L.forEach(D=>{window.removeEventListener(D,O)}),clearInterval(x.current),clearTimeout(N.current),o.current=[]}},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"full-screen-header",children:[e.jsx("button",{className:"roundButton full-screen-back","data-inactive":S,onClick:i,children:e.jsx(He,{})}),e.jsx("button",{className:"roundButton full-screen-back","data-inactive":S,onClick:B,children:e.jsx(Tr,{})})]}),e.jsx("div",{"data-inactive":S,className:"full-screen-audio-ctrl",children:e.jsx(Pt,{context:{mobile:!1}})}),c&&e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:l,crossOrigin:"anonymous",alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:r,crossOrigin:"anonymous",alt:"No tracks palying"})}),e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:p,crossOrigin:"anonymous",alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:u,crossOrigin:"anonymous",alt:"No tracks palying"})})]})]})};function Ha(){return e.jsx(Vr,{children:e.jsx(Lr,{children:e.jsxs(Wr,{children:[" ",e.jsx(ca,{children:e.jsxs(yn,{children:[e.jsx(fe,{path:"/",element:e.jsx(va,{})}),e.jsx(fe,{path:"register",element:e.jsx(ga,{})}),e.jsx(fe,{element:e.jsx(Ga,{}),children:e.jsx(fe,{path:"full-screen",element:e.jsx(Va,{})})}),e.jsxs(fe,{element:e.jsx(ha,{}),children:[e.jsx(fe,{path:"home",element:e.jsx(fa,{})}),e.jsx(fe,{path:"albums",element:e.jsx(pa,{})}),e.jsx(fe,{path:"albums/:albumId",element:e.jsx(es,{})}),e.jsx(fe,{path:"artists",element:e.jsx(ya,{})}),e.jsx(fe,{path:"artists/:artistId",element:e.jsx(ba,{})}),e.jsx(fe,{path:"genres",element:e.jsx(Oa,{})}),e.jsx(fe,{path:"genres/:genreId",element:e.jsx(Pa,{})}),e.jsx(fe,{path:"playlists",element:e.jsx(Ua,{})}),e.jsx(fe,{path:"playlists/:playlistId",element:e.jsx(es,{isPlaylist:!0})}),e.jsx(fe,{path:"cooking",element:e.jsx(_a,{})}),e.jsx(fe,{path:"radio",element:e.jsx(Da,{})})]}),e.jsx(fe,{path:"account",element:e.jsx(Sa,{})}),e.jsx(fe,{path:"settings",element:e.jsx(Ca,{})}),e.jsx(fe,{path:"admin-pannel",element:e.jsx($a,{})}),e.jsx(fe,{path:"*",element:e.jsx(Na,{})})]})})]})})})}jn.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(bn,{children:e.jsx(Ha,{})})}));
