import{r as n,j as e}from"./react-DmLYqgKm.js";import{c as Kn}from"./react-dom-DPPwivfB.js";import{u as me,a as Ke,L as tt,O as ks,b as Pt,R as Jn,c as ie,B as Qn}from"./react-router-C4BYJpcq.js";import{I as Yn,a as rt,b as qt,c as pe,d as at,e as Xn,f as yt,g as ot,h as Ss,i as Zn,j as er,k as tr,l as sr,m as nr,n as vt,o as Ht,p as ws,q as Je,r as Ts,s as Es,t as rr,u as Cs,v as ar,w as or,x as cr,y as ir,z as lr,A as ur,B as dr,C as mr,D as Wt,E as hr,F as fr,G as pr,H as gr,J as Rs,K as Kt,L as ct,M as xr,N as As,O as Is,P as Dt,Q as Jt,R as vr,S as jr,T as br,U as yr,V as Nr,W as Qt,X as kr,Y as Sr,Z as wr,_ as Tr,$ as Er,a0 as Cr,a1 as Rr,a2 as Ar,a3 as Ir,a4 as Fr,a5 as Qe,a6 as Yt,a7 as Pr,a8 as Lr,a9 as $r,aa as Or,ab as Mr,ac as Fs,ad as Ur,ae as _r,af as Br,ag as Gr,ah as Dr,ai as Vr,aj as Hr,ak as zr,al as qr,am as Wr,an as Kr,ao as Jr,ap as Qr,aq as Yr,ar as Xr,as as Zr}from"./@tabler-Cz0MyElH.js";import{F as Le}from"./react-window-Dlc0x0tK.js";import{v as jt}from"./uuid-C6aID195.js";import{Z as Xt}from"./react-colorful-0uAH5Wqu.js";import{_ as gt}from"./lodash-BhRqD2di.js";import{p as ea}from"./music-metadata-CvBiwAZp.js";import{a as ta}from"./axios-xsH4HHeE.js";import{F as Ps}from"./fuse.js-Ch1WBRTM.js";import"./content-type-kkloIWN6.js";import"./scheduler-SPyfQU6S.js";import"./cookie--_YQFYBD.js";import"./@babel-Cj2_JSWT.js";import"./memoize-one-CcMeOnPo.js";import"./strtok3-BXaumHbT.js";import"./peek-readable-BVp5v6zA.js";import"./file-type-BdA4k6lR.js";import"./token-types-D2R8hC8p.js";import"./ieee754-DcnkbHBT.js";import"./@tokenizer-Sx_RGPFW.js";import"./fflate-D0DoR3vL.js";import"./debug-Dqg9INeJ.js";import"./ms-CzQ2E3wO.js";import"./uint8array-extras-B1Dultle.js";import"./media-typer-Kaw9hxcp.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&u(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function u(l){if(l.ep)return;l.ep=!0;const r=o(l);fetch(l.href,r)}})();const sa=()=>{const s=window.location.hostname,t=window.location.port;return s==="localhost"||s.startsWith("127.0.0.1")?`http://localhost:${t}`:`http://${s}:${t}`},N=sa(),Ls=n.createContext(),fe=()=>n.useContext(Ls),na=({children:s})=>{const t=n.useRef(new Map),o=(l,r)=>(t.current.has(l)||t.current.set(l,new Set),t.current.get(l).add(r),()=>{var a;(a=t.current.get(l))==null||a.delete(r)}),u=(l,r)=>{t.current.has(l)&&t.current.get(l).forEach(a=>{a(r),console.log("called at",a)})};return e.jsx(Ls.Provider,{value:{emit:u,subscribe:o},children:s})},ra=()=>{const[s,t]=n.useState(!1),[o,u]=n.useState(!1),l=me(),r=n.useRef(null),{subscribe:a}=fe(),d=()=>{t(!s)},m=()=>{fetch(`${N}/auth/logout`,{method:"POST",credentials:"include"}).then(p=>{p.ok?l("/"):console.error("Logout failed")}).catch(p=>{console.error("Error:",p)})},h=()=>{l("/account")},c=()=>{l("/settings")};return n.useEffect(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{u(x)});const p=x=>{var j;if(r.current&&!r.current.contains(x.target)){if(((j=x.target.closest("svg"))==null?void 0:j.id)==="user-button")return;t(!1)}},f=a("action-bar-open",()=>{t(!1)});return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{f(),document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[]),e.jsxs("div",{className:"userDropdown",ref:r,children:[e.jsx(Yn,{id:"user-button",className:"userImage buttonRound",onClick:d}),s&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"userAccount dropdownEntry",onClick:h,children:"Account"}),e.jsx("button",{className:"userSetting dropdownEntry",onClick:c,children:"Settings"}),o&&e.jsx("button",{className:"userSetting dropdownEntry",onClick:()=>{l("/admin-pannel")},children:"Admin pannel"}),e.jsx("button",{className:"userLogout dropdownEntry",onClick:m,children:"Logout"})]})]})},Zt=s=>{var t=function(a){return("00"+a).slice(-2)};const o=Math.floor(s/3600),u=Math.floor(s%3600/60),l=t(Math.floor(s%60)),r=o>0?`${o}:${u}:${l}`:`${u}:${l}`;return{hours:o,minutes:u,seconds:l,readable:r}},Vt=s=>{const t=Math.floor(s/1024),o=Math.floor(t/1024),u=Math.floor(o/1024),l=Math.floor(u/1024),r=l>0?`${Number(s/1024/1024/1024/1024).toFixed(2)}TB`:u>0?`${Number(s/1024/1024/1024).toFixed(2)}GB`:o>0?`${Number(s/1024/1024).toFixed(2)}MB`:`${Number(s/1024).toFixed(2)}KB`;return{kb:t,mb:o,gb:u,tb:l,readable:r}},$s=(s,t,o)=>{t/=100,o/=100;let u=(1-Math.abs(2*o-1))*t,l=u*(1-Math.abs(s/60%2-1)),r=o-u/2,a=0,d=0,m=0;return 0<=s&&s<60?(a=u,d=l,m=0):60<=s&&s<120?(a=l,d=u,m=0):120<=s&&s<180?(a=0,d=u,m=l):180<=s&&s<240?(a=0,d=l,m=u):240<=s&&s<300?(a=l,d=0,m=u):300<=s&&s<360&&(a=u,d=0,m=l),a=Math.round((a+r)*255).toString(16),d=Math.round((d+r)*255).toString(16),m=Math.round((m+r)*255).toString(16),a.length==1&&(a="0"+a),d.length==1&&(d="0"+d),m.length==1&&(m="0"+m),"#"+a+d+m},ps=(s,t,o)=>(s=s.toString(16),t=t.toString(16),o=o.toString(16),s.length==1&&(s="0"+s),t.length==1&&(t="0"+t),o.length==1&&(o="0"+o),"#"+s+t+o),Me=s=>{let t=0,o=0,u=0;return s.length==4?(t="0x"+s[1]+s[1],o="0x"+s[2]+s[2],u="0x"+s[3]+s[3]):s.length==7&&(t="0x"+s[1]+s[2],o="0x"+s[3]+s[4],u="0x"+s[5]+s[6]),[parseInt(t),parseInt(o),parseInt(u)]},We=(s,t,o)=>s+(t-s)*o,aa=(s,t,o,u,l)=>We(u,l,(s-t)/(o-t)),Be=(s,t)=>{var o=s??"";return o.length>t?o.substring(0,t-2)+"..":o},oa=(s="")=>{const t=["/","/register"];return new Promise(async o=>{const u=await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"}).then(async l=>l.ok?!0:(t.includes(s)||await fetch(`${N}/auth/logout`,{method:"POST",credentials:"include"}).then(r=>{r.ok?window.location.href="/":console.error("Logout failed")}),!1));o(u)})},$e=(s,t="")=>async function(){await oa(t)&&s()},ca=s=>s.charAt(0).toUpperCase()+s.slice(1),gs=([s,t,o])=>{const u=[s,t,o].map(l=>(l/=255,l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4)));return .2126*u[0]+.7152*u[1]+.0722*u[2]},ia=(s,t)=>{const o=gs(s),u=gs(t);return(Math.max(o,u)+.05)/(Math.min(o,u)+.05)},te=({col1:s="#f9c58d",col2:t="#f492f0",className:o,style:u={},id:l=""})=>e.jsxs("svg",{id:l,viewBox:"0 0 512 512",style:{...u},className:o,xmlns:"http://www.w3.org/2000/svg",fill:"#000000",children:[e.jsxs("defs",{children:[e.jsx("mask",{id:"mask_logo",fill:"black",children:e.jsx("path",{fill:"white",d:"M116.215 17.404c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm64.326 12.87l-23.488 92.062h63.965l27.49-27.49-67.967-64.573zm228.147 25.958c0 20.214-20.216 40.428-40.43 40.428 20.214 0 40.43 20.214 40.43 40.428 0-20.214 20.213-40.428 40.427-40.428-20.214 0-40.428-20.214-40.428-40.428zm-150.022 53.913l-23.18 23.18L283.043 311h29.066l-53.443-200.855zm75.232 2.365l16.123 32.281 45.188 33.148-4.393-53.533-56.918-11.896zm-18.033 4.181l-26.685 38.121 10 37.586 33.38-42.283-16.695-33.424zm-160.672 23.645L172.42 206.4l21.988 12.623L239.043 311h25.365l-45.68-170.664h-63.535zm189.797 23.088l-40.03 50.703L330.737 311h.026l64.08-111.004-49.852-36.572zm122.352 5.834c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zm-374.22 12.375l11.308 76.129 48.834-6.356 19.322-24.154-79.465-45.62zm346.995 53.793l-52.547 13.172L351.547 311h25.77l19.16-19.48 43.64-56.094zm-255.21 5.244l-17.403 21.75 25.77 48.58h25.761l-34.129-70.33zm-33.84 29.174l-39.005 5.074L148.145 311h24.751l-21.83-41.156zm-91.37 11.396c0 16-16 32-32 32 16 0 32 16 32 32 0-16 16-32 32-32-16 0-32-16-32-32zM137 329v30h238v-30H137zm32 48v78h16v-78h-16zm34 0v78h106v-78H203zm124 0v78h16v-78h-16zm-164.758 96l-30.119 16h247.754l-30.12-16H162.243z"})}),e.jsxs("linearGradient",{id:"grad_logo",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:s}),e.jsx("stop",{offset:"100%",stopColor:t})]})]}),e.jsx("rect",{x:"0",y:"0",width:"512",height:"512",fill:"url(#grad_logo)",mask:"url(#mask_logo)"})]}),Nt=({entry:s,style:t,onClick:o})=>e.jsxs("div",{className:"action-bar-entry",style:t,onClick:()=>{o(s)},children:[s.icon(),e.jsxs("span",{style:{flex:"1"},children:[" ",s.name]}),s.tooltip?s.tooltip(s.type):null]}),Os=n.createContext(),ht={SUCCESS:"success",ERROR:"error",INFO:"info",SALAD:"salad"},la=({children:s})=>{const[t,o]=n.useState(null),[u,l]=n.useState(null),r=n.useRef(null),a=n.useRef([]),d=(h,c)=>{a.current.forEach(f=>clearTimeout(f)),a.current=[],l({message:h,state:c}),o(!0);const p=setTimeout(()=>{r.current&&(r.current.setAttribute("direction",""),r.current.offsetWidth,r.current.setAttribute("direction","hide"));const f=setTimeout(()=>{o(!1),l(null)},300);a.current.push(f)},2e3);a.current.push(p)};n.useEffect(()=>{u&&o(!0)},[u]),n.useEffect(()=>{!t||!r.current||r.current.setAttribute("direction","show")},[t]);const m=()=>{if(!t)return null;switch(u==null?void 0:u.state){case ht.SUCCESS:return e.jsx(at,{className:"notification-icon"});case ht.ERROR:return e.jsx(pe,{className:"notification-icon"});case ht.INFO:return e.jsx(qt,{className:"notification-icon"});case ht.SALAD:return e.jsx(rt,{className:"notification-icon"});default:return null}};return e.jsxs(Os.Provider,{value:{notifTypes:ht,addNotification:d},children:[s,u?e.jsx("div",{ref:r,className:"notification-parent",id:"notification-parent",children:e.jsxs("div",{className:"notification","is-open":u?"true":"false",children:[e.jsx(m,{}),e.jsx("span",{children:u.message})]})}):null]})},Oe=()=>n.useContext(Os),ua=({onClose:s,track:t})=>{const[o,u]=n.useState(!1),l=n.useRef(null),r=n.useRef(null),[a,d]=n.useState([]),[m,h]=n.useState(null),[c,p]=n.useState(""),{addNotification:f,notifTypes:x}=Oe(),j=I=>{if(I.preventDefault(),c==""&&!m){s(!1);return}fetch(`${N}/read-write/moveTrackToAlbum/${c?"true/"+c:"false/"+m.id}/${t.id}`).then(F=>F.json()).then(F=>{f(`Track ${t.title} moved to 
            ${c||m.name}.`,x.INFO),s(!0)})},b=I=>{h(null),p(I.target.value)},O=I=>{const{tooltip:F,...P}=I;k(),h(P),p("")};n.useEffect(()=>{const I=F=>{r.current&&!r.current.contains(F.target)&&k()};return document.addEventListener("mousedown",I),document.addEventListener("touchstart",I),()=>{document.removeEventListener("mousedown",I),document.removeEventListener("touchstart",I)}},[]);const k=()=>{u(!1),l.current.value="",d([])},C=()=>e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Move to album"})," "]}),M=I=>{const F=I.target.value;if(F===""||F.trim().length===0){d([]);return}console.log(`${N}/read-write/search/${F}/${["albums"]}`),fetch(`${N}/read-write/search/${F}/${["albums"]}`,{method:"GET"}).then(P=>P.json()).then(P=>{d([...P.albums].map(R=>{const S=R.path,{trackPath:V,...Q}=R;return{icon:()=>S?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/covers/${S}`,alt:R.name}):e.jsx(te,{className:"action-bar-entry-logo"}),tooltip:C,...Q}}))})};return e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:null,children:[e.jsx("h2",{children:"Move track to another album"}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:j,children:[e.jsx("label",{htmlFor:"newAlbum",style:c?{}:{opacity:"0.5"},children:"New album name"}),e.jsx("input",{type:"text",style:c?{}:{opacity:"0.5"},id:"newAlbum",placeholder:"Enter album name",onChange:b}),e.jsx("label",{htmlFor:"existingAlbum",style:c?{opacity:"0.5"}:{},children:"Existing album"}),e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:r,style:c?{opacity:"0.5"}:{},children:e.jsxs("div",{className:"action-bar-research",style:{transform:"translateX(15px)"},id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Xn,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:M,placeholder:"Search the album you want to move the track to.",ref:l,onFocus:()=>{u(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Le,{height:300,itemCount:a.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:I,style:F})=>e.jsx(Nt,{entry:a[I],style:{...F,width:" calc(100% - 20px)",marginTop:"10px"},onClick:O},I)})})]})}),m?e.jsxs("div",{style:{height:"90px",alignItems:"center",display:"flex",gap:"10px"},children:[m!=null&&m.icon?m.icon():null,m.name]}):null,e.jsx("input",{type:"submit",value:"Submit"})]})]})})},Ms=()=>e.jsxs("div",{className:"three-points-loader",children:[e.jsx("div",{className:"point point1"}),e.jsx("div",{className:"point point2"}),e.jsx("div",{className:"point point3"})]}),ne=({onClick:s,text:t,icon:o,style:u,id:l=""})=>{const[r,a]=n.useState(!1),d=()=>{a(!0),s().then(()=>{a(!1)})},m=()=>r?e.jsx(Ms,{}):e.jsxs(e.Fragment,{children:[o,t]});return e.jsx("button",{className:"button-with-callback",id:l,style:{...u},onClick:d,children:e.jsx(m,{})})},da=({applyCanges:s,albumClass:t})=>{var F,P;const[o,u]=n.useState({visible:!1}),[l,r]=n.useState(null),[a,d]=n.useState("2000-00-00"),[m,h]=n.useState(null),[c,p]=n.useState(!1),{deleteAlbum:f}=re(),{notifTypes:x,addNotification:j}=Oe();if(!t)return null;n.useEffect(()=>{t&&(r(t.coverURL),d(t.year))},[t]);const b=()=>{const R=document.getElementById("editAlbumInfos"),S=R.artistName.value.split(",").map(_=>_.trim()),V=R.genre.value.split(",").map(_=>_.trim()).map(_=>_.charAt(0).toUpperCase()+_.slice(1)).filter(_=>_!="");if(!(R.albumName.value!==t.name||t.artist.toString()!==S.toString()||t.year!==R.releaseDate.value||t.genre.toString()!==V.toString()||t.description!==R.description.value||m||c)){s(null);return}t.name=R.albumName.value,t.artist=S,t.year=R.releaseDate.value,t.genre=V,t.description=R.description.value;const{tracks:B,coverURL:w,...D}=t;console.log(D),s(D,m)},O=R=>{const S=R.target.files[0];S&&(t.ext=S.name.split(".").pop(),r(URL.createObjectURL(S)),h(S))},k=R=>{u({visible:!o.visible,...R})},C=R=>{console.log(R),!c&&R&&p(!0),u({visible:!1})},M=async()=>{j("Comming soon :)",x.INFO)},I=async()=>{f(!1,{name:t.name,id:t.id})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(te,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(yt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:O})]}),e.jsx("button",{className:"roundButton",onClick:()=>b(),children:"Apply"}),e.jsx(ne,{onClick:M,text:"Delete for me",icon:e.jsx(ot,{}),style:{marginTop:"auto"}}),e.jsx(ne,{onClick:I,text:"Remove from library",icon:e.jsx(ot,{})})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:t.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(F=t.artist)==null?void 0:F.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",value:a,onChange:R=>{d(R.target.value)}})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(P=t.genre)==null?void 0:P.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:t.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Le,{className:"albumTrackList",height:250,itemCount:t.tracks.length,itemSize:35,width:"100%",children:({index:R,style:S})=>e.jsxs("div",{style:S,className:"album-wrapping-track",children:[e.jsx("span",{children:t.tracks[R].title}),e.jsx(Ss,{className:"trackIcon",onClick:()=>{k(t.tracks[R])}})]},R)})})]}),o.visible&&e.jsx(ua,{onClose:C,track:{id:o.id,title:o.title}})]})})},xs=({closeOverlay:s,applyCanges:t,editPlaylistClass:o})=>{const[u,l]=n.useState(null),[r,a]=n.useState(null),[d,m]=n.useState(o||{id:jt()}),[h,c]=n.useState([]),[p,f]=n.useState([]);n.useEffect(()=>{d&&l(d.coverURL),d.collaborators&&f(d.collaborators)},[d]);const x=()=>{const k=document.getElementById("editAlbumInfos");if(!(k.playlistName.value!==d.name||d.description!==k.description.value||r||d.collaborators.map(P=>!p.includes(P)).filter(P=>P))){t(null);return}d.name=k.playlistName.value,d.description=k.description.value,d.collaborators=p.map(P=>P.id);const{tracks:M,coverURL:I,...F}=d;console.log(F),t(F,r)},j=k=>{const C=k.target.files[0];C&&(d.ext=C.name.split(".").pop(),l(URL.createObjectURL(C)),a(C))};n.useEffect(()=>{fetch(`${N}/auth/collaborators`,{method:"GET",credentials:"include"}).then(k=>k.json()).then(k=>{console.log(k),c(k)})},[]);const b=k=>{const C=k.target.value;p.includes(C)||C==="pickUsers"||(f(M=>[...M,h.find(I=>I.id==C)]),k.target.value="pickUsers")};n.useEffect(()=>{console.log(p)});const O=k=>{f(p.filter(C=>C.id!=k))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsx(pe,{className:"buttonRound closeOverlay",onClick:s}),e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[u?e.jsx("img",{id:"coverPicture",src:u,style:{width:"100%"}}):e.jsx(te,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(yt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:j})]}),e.jsx("button",{className:"roundButton",onClick:()=>x(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",children:[e.jsx("label",{htmlFor:"playlistName",children:"Playlist name"}),e.jsx("input",{type:"text",id:"playlistName",placeholder:"Enter playlist name",defaultValue:d==null?void 0:d.name}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",style:{height:"80px",paddingTop:"10px",paddingBottom:"10px"},placeholder:"Enter description",defaultValue:d==null?void 0:d.description})]}),e.jsx("label",{htmlFor:"new-collab",children:"Add collaborators"}),e.jsxs("select",{onChange:b,children:[e.jsx("option",{value:"pickUsers",children:"Pick users"},"root"),h.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),e.jsx("label",{children:"Collaborators:"}),e.jsx("div",{children:p==null?void 0:p.map(k=>e.jsxs("div",{children:[e.jsx("span",{children:k==null?void 0:k.name}),e.jsx(Zn,{className:"buttonRound",onClick:()=>{O(k.id)}})]},k==null?void 0:k.id))})]})]})})};function ma(){const{innerWidth:s,innerHeight:t}=window;return{width:s,height:t}}const ha=({trackY:s,track:t,isFav:o})=>{const[u,l]=n.useState(ma()),{onClicTrackActionEntry:r,trackActionTypes:a}=re(),[d,m]=n.useState(!1),h=n.useRef(null),[c,p]=n.useState(null),f=Ke(),[x,j]=n.useState(()=>window.innerWidth<714);return n.useEffect(()=>{const b=O=>{h.current&&!h.current.contains(O.target)&&r(a.NONE)};return document.addEventListener("mousedown",b),document.addEventListener("touchstart",b),m(f.pathname.includes("playlist")),()=>{document.removeEventListener("mousedown",b),document.removeEventListener("touchstart",b)}},[]),n.useEffect(()=>{const b=d?250:180;p(Math.min(s,u.height-b))},[d]),c&&e.jsxs("div",{className:"track-actions-div",ref:h,style:{height:"fit-content",top:c},children:[e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TOP_QUEUE,t)},children:[e.jsx("span",{children:"Front queue"})," ",e.jsx(er,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.END_QUEUE,t)},children:[e.jsx("span",{children:"Back queue"})," ",e.jsx(tr,{})]}),d&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.GOTO_ALBUM,t)},children:[e.jsx("span",{children:"View album"})," ",e.jsx(sr,{})]}),d&&!o&&e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_PLAYLIST,t)},children:[e.jsx("span",{children:"Delete from playlist"})," ",e.jsx(nr,{})]}),e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.TAGS,t)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(vt,{})]}),x&&t.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.REMOVE_FROM_FAVORITES,t)},children:[e.jsx("span",{children:"Remove from favorite"})," ",e.jsx(Ht,{})]}):null,x&&!t.is_favorite?e.jsxs("div",{className:"track-action-entry",onClick:()=>{r(a.ADD_TO_FAVORITES,t)},children:[e.jsx("span",{children:"Add to favorites"})," ",e.jsx(ws,{})]}):null]})},ft={name:"Create a new tag",icon:()=>e.jsx(Ts,{}),isAction:!0},fa=({track:s,apply:t})=>{const o=n.useRef(null),[u,l]=n.useState(!1),[r,a]=n.useState([ft]),[d,m]=n.useState("#aabbcc"),[h,c]=n.useState(!1),p=n.useRef(null),f=n.useRef(null),[x,j]=n.useState([]),[b,O]=n.useState(null),[k,C]=n.useState(null),[M,I]=n.useState([]),F=n.useRef(),P=B=>{const w=B.target.value;if(C(w),w===""||w.trim().length===0){a([ft]);return}fetch(`${N}/read-write/search/${w}/tags`,{method:"GET"}).then(D=>{if(D.ok)return D.json();throw new Error("Error fetching search results")}).then(D=>{var Z;const _=(Z=D.tags)==null?void 0:Z.map(ee=>({...ee,icon:()=>e.jsx(vt,{color:ee.color}),isAction:!1})),W={name:`${ft.name}: ${w}`,icon:ft.icon,isAction:ft.isAction};_.splice(0,0,W),a(_)})},R=()=>{l(!1)},S=B=>{if(R(),B.isAction){O("new"),m(`${$s(Math.random().toFixed(4)*360,100,70.8)}`);return}x.find(w=>w.id===B.id)||(I(w=>w.filter(D=>D!==B.id)),j(w=>[...w,B]))};n.useEffect(()=>{b==="new"&&(f.current.focus(),f.current.value=k||"",F.current.value="")},[b]),n.useEffect(()=>{const B=w=>{var D;if(p.current&&!p.current.contains(w.target)){if(((D=w.target.closest("svg"))==null?void 0:D.id)==="color-button")return;c(!1)}if(o.current&&!o.current.contains(w.target)){R();return}};return document.addEventListener("mousedown",B),document.addEventListener("touchstart",B),fetch(`${N}/read-write/trackTags/${s.id}`,{method:"GET"}).then(w=>w.json()).then(w=>{j(w)}),()=>{document.removeEventListener("mousedown",B),document.removeEventListener("touchstart",B)}},[]);const V=()=>{const B=f.current.value;B!==""&&b==="new"&&j(w=>[...w,{name:B,color:d,id:jt(),isNew:!0}]),O(null)},Q=(B,w)=>{const D=x.filter(_=>!(_.isNew===B&&_.id===w));j(D),B||I(_=>[..._,w])};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",style:{height:"500px",flexDirection:"column"},children:[e.jsx(pe,{className:"buttonRound closeOverlay",onClick:()=>{t(null)}}),e.jsxs("h3",{children:["Editing tags for track ",s.title]}),e.jsx("div",{className:"action-bar",style:{margin:"10px auto"},ref:o,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Je,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:P,placeholder:"Search some tags..",ref:F,onFocus:()=>{l(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${u?"block":"none"}`},children:e.jsx(Le,{height:300,itemCount:r.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:B,style:w})=>e.jsx(Nt,{entry:r[B],style:{...w,width:" calc(100% - 20px)",marginTop:"10px"},onClick:S},B)})})]})}),b?e.jsxs("div",{className:"edit-tag",children:[e.jsx(Ts,{style:{paddingRight:"30px"}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:f}),e.jsx(Es,{id:"color-button",color:d,onClick:()=>{c(!h)}}),h&&e.jsxs("div",{ref:p,className:"edit-tag-picker",children:[" ",e.jsx(Xt,{color:d,onChange:m})]}),e.jsx(at,{onClick:V})]}):null,e.jsx("div",{className:"track-tags-div",children:x.map((B,w)=>e.jsxs("div",{className:"small-tag",style:{backgroundColor:B.color},children:[e.jsx("span",{children:B.name})," ",e.jsx(pe,{onClick:()=>{Q(B.isNew,B.id)}})]},`${B.isNew}-${B.id}`))}),e.jsx("button",{style:{marginTop:"auto"},onClick:()=>{t({current:x,deleted:M},s.id)},children:"Apply"})]})})},pa=()=>{const{closeTagWindow:s}=re(),[t,o]=n.useState(0),[u,l]=n.useState([]),[r,a]=n.useState([]),[d,m]=n.useState(!1),[h,c]=n.useState("#aabbcc"),[p,f]=n.useState(null),x=n.useRef(null),j=n.useRef(null),{addNotification:b,notifTypes:O}=Oe(),[k,C]=n.useState(null);n.useEffect(()=>{M(),I()},[]);const M=()=>{fetch(`${N}/read-write/getAllUserTags`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{l(S)})},I=()=>{fetch(`${N}/read-write/getAllUserSalads`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{a(S)})},F=S=>{f(S),c(S.color)},P=()=>{const S={id:p.id,name:x.current.value,color:h},V=new FormData;V.append(t===0?"tag":"salad",JSON.stringify(S)),fetch(`${N}/read-write/${t===0?"applyTagModifications":"applySaladModifications"}`,{method:"POST",credentials:"include",body:V}).then(Q=>Q.json()).then(Q=>{t===0?M():I(),b("Tag updated.",O.SUCCESS)}),f(null)},R=()=>{fetch(`${N}/read-write/delete/${k.type}/${k.id}`,{method:"DELETE",credentials:"include"}).then(S=>S.json()).then(S=>{t===0?M():I(),f(null),C(null),b("Tag deleted.",O.SUCCESS)})};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"tag-edtior-container",children:[e.jsx(pe,{className:"buttonRound closeOverlay",onClick:s}),e.jsxs("div",{className:"cooking-selection",style:{marginTop:"40px"},children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(ne,{text:"Edit tags",icon:e.jsx(rr,{}),onClick:async()=>{o(0)}}),e.jsx(ne,{text:"Edit salads",icon:e.jsx(rt,{}),onClick:async()=>{o(1)}})]}),e.jsxs("div",{className:"edit-tags-content",children:[e.jsx(Le,{className:"albumTrackList",height:250,itemCount:t===0?u.length:r.length,itemSize:35,width:"100%",children:({index:S,style:V})=>e.jsxs("div",{style:V,className:"album-wrapping-track",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:t===0?u[S].color:r[S].color}}),e.jsx("span",{children:t===0?u[S].name:r[S].name}),e.jsx(Cs,{className:"trackIcon",onClick:()=>{F(t===0?{...u[S],type:"tag"}:{...r[S],type:"salad"})}})]},S)}),p?e.jsxs("div",{className:"edit-tag",style:{left:"-20px",margin:"auto"},children:[e.jsx(pe,{style:{cursor:"pointer"},onClick:()=>{f(null)}}),e.jsx("input",{type:"text",placeholder:"Name your new tag.",ref:x,defaultValue:p.name}),e.jsx(Es,{style:{cursor:"pointer"},id:"color-button",color:h,onClick:()=>{m(!d)}}),d&&e.jsxs("div",{ref:j,className:"edit-tag-picker",children:[" ",e.jsx(Xt,{color:h,onChange:c})]}),e.jsx(at,{onClick:P,style:{cursor:"pointer"}}),e.jsx(ot,{style:{cursor:"pointer"},onClick:()=>{C(p)}})]}):null,k?e.jsxs("div",{className:"deletion-confirmation",children:[e.jsx("div",{className:"tag-color",style:{backgroundColor:k.color,width:"50px"}}),e.jsxs("p",{children:["Confirm deletion of the ",k.type," ",k.name,"?"]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{C(null)},children:e.jsx(ar,{})}),e.jsx("button",{onClick:()=>{R()},children:e.jsx(at,{})})]})]}):null]})]})]})})},ga=({applyChanges:s,artist:t})=>{const[o,u]=n.useState(null),[l,r]=n.useState("2000-00-00"),[a,d]=n.useState(null);if(!t)return null;n.useEffect(()=>{t&&(u(t.picture),r(t.active_from))},[t]);const m=()=>{const c=document.getElementById("editArtistInfos"),p=t.active_from??"",f=c.activeFrom.value??"",x=t.name??"",j=c.artistName.value??"",b=t.bio??"",O=c.bio.value??"";if(!(x!=j||p!=f||b!=O||a)){s(null);return}t.name=c.artistName.value,t.active_from=c.activeFrom.value,t.bio=c.bio.value;const{picture:C,...M}=t;console.log(M,a),s(M,a)},h=c=>{const p=c.target.files[0];p&&(t.ext=p.name.split(".").pop(),u(URL.createObjectURL(p)),d(p))};return e.jsx("div",{className:"page-overlay-blur",children:e.jsxs("div",{className:"albumWrapping-library",children:[e.jsxs("div",{className:"albumCover",edit:"true",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[o?e.jsx("img",{id:"coverPicture",src:o,style:{width:"100%"}}):e.jsx(te,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(yt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:h})]}),e.jsx("button",{className:"roundButton",onClick:m,children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editArtistInfos",children:[e.jsx("label",{htmlFor:"artistName",children:"Artist name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter album name",defaultValue:t.name}),e.jsx("div",{className:"albumType",children:e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"activeFrom",children:"Active since"}),e.jsx("input",{type:"date",id:"activeFrom",value:l,onChange:c=>{r(c.target.value)}})]})}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",placeholder:"Enter biography",defaultValue:t.bio})]})]})]})})};var It=function(s,t){return s<t?-1:s>t?1:0},vs=function(s){return s.reduce(function(t,o){return t+o},0)},xa=function(){function s(o){this.colors=o}var t=s.prototype;return t.palette=function(){return this.colors},t.map=function(o){return o},s}(),va=function(){function s(r,a,d){return(r<<10)+(a<<5)+d}function t(r){var a=[],d=!1;function m(){a.sort(r),d=!0}return{push:function(h){a.push(h),d=!1},peek:function(h){return d||m(),h===void 0&&(h=a.length-1),a[h]},pop:function(){return d||m(),a.pop()},size:function(){return a.length},map:function(h){return a.map(h)},debug:function(){return d||m(),a}}}function o(r,a,d,m,h,c,p){var f=this;f.r1=r,f.r2=a,f.g1=d,f.g2=m,f.b1=h,f.b2=c,f.histo=p}function u(){this.vboxes=new t(function(r,a){return It(r.vbox.count()*r.vbox.volume(),a.vbox.count()*a.vbox.volume())})}function l(r,a){if(a.count()){var d=a.r2-a.r1+1,m=a.g2-a.g1+1,h=Math.max.apply(null,[d,m,a.b2-a.b1+1]);if(a.count()==1)return[a.copy()];var c,p,f,x,j=0,b=[],O=[];if(h==d)for(c=a.r1;c<=a.r2;c++){for(x=0,p=a.g1;p<=a.g2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[s(c,p,f)]||0;b[c]=j+=x}else if(h==m)for(c=a.g1;c<=a.g2;c++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.b1;f<=a.b2;f++)x+=r[s(p,c,f)]||0;b[c]=j+=x}else for(c=a.b1;c<=a.b2;c++){for(x=0,p=a.r1;p<=a.r2;p++)for(f=a.g1;f<=a.g2;f++)x+=r[s(p,f,c)]||0;b[c]=j+=x}return b.forEach(function(k,C){O[C]=j-k}),function(k){var C,M,I,F,P,R=k+"1",S=k+"2",V=0;for(c=a[R];c<=a[S];c++)if(b[c]>j/2){for(I=a.copy(),F=a.copy(),P=(C=c-a[R])<=(M=a[S]-c)?Math.min(a[S]-1,~~(c+M/2)):Math.max(a[R],~~(c-1-C/2));!b[P];)P++;for(V=O[P];!V&&b[P-1];)V=O[--P];return I[S]=P,F[R]=I[S]+1,[I,F]}}(h==d?"r":h==m?"g":"b")}}return o.prototype={volume:function(r){var a=this;return a._volume&&!r||(a._volume=(a.r2-a.r1+1)*(a.g2-a.g1+1)*(a.b2-a.b1+1)),a._volume},count:function(r){var a=this,d=a.histo;if(!a._count_set||r){var m,h,c,p=0;for(m=a.r1;m<=a.r2;m++)for(h=a.g1;h<=a.g2;h++)for(c=a.b1;c<=a.b2;c++)p+=d[s(m,h,c)]||0;a._count=p,a._count_set=!0}return a._count},copy:function(){var r=this;return new o(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(r){var a=this,d=a.histo;if(!a._avg||r){var m,h,c,p,f=0,x=0,j=0,b=0;if(a.r1===a.r2&&a.g1===a.g2&&a.b1===a.b2)a._avg=[a.r1<<3,a.g1<<3,a.b1<<3];else{for(h=a.r1;h<=a.r2;h++)for(c=a.g1;c<=a.g2;c++)for(p=a.b1;p<=a.b2;p++)f+=m=d[s(h,c,p)]||0,x+=m*(h+.5)*8,j+=m*(c+.5)*8,b+=m*(p+.5)*8;a._avg=f?[~~(x/f),~~(j/f),~~(b/f)]:[~~(8*(a.r1+a.r2+1)/2),~~(8*(a.g1+a.g2+1)/2),~~(8*(a.b1+a.b2+1)/2)]}}return a._avg},contains:function(r){var a=this,d=r[0]>>3;return gval=r[1]>>3,bval=r[2]>>3,d>=a.r1&&d<=a.r2&&gval>=a.g1&&gval<=a.g2&&bval>=a.b1&&bval<=a.b2}},u.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var a=this.vboxes,d=0;d<a.size();d++)if(a.peek(d).vbox.contains(r))return a.peek(d).color;return this.nearest(r)},nearest:function(r){for(var a,d,m,h=this.vboxes,c=0;c<h.size();c++)((d=Math.sqrt(Math.pow(r[0]-h.peek(c).color[0],2)+Math.pow(r[1]-h.peek(c).color[1],2)+Math.pow(r[2]-h.peek(c).color[2],2)))<a||a===void 0)&&(a=d,m=h.peek(c).color);return m},forcebw:function(){var r=this.vboxes;r.sort(function(h,c){return It(vs(h.color),vs(c.color))});var a=r[0].color;a[0]<5&&a[1]<5&&a[2]<5&&(r[0].color=[0,0,0]);var d=r.length-1,m=r[d].color;m[0]>251&&m[1]>251&&m[2]>251&&(r[d].color=[255,255,255])}},{quantize:function(r,a){if(!Number.isInteger(a)||a<1||a>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!r.length||a<2||a>256||!r.length||a<2||a>256)return!1;for(var d=[],m=new Set,h=0;h<r.length;h++){var c=r[h],p=c.join(",");m.has(p)||(m.add(p),d.push(c))}if(d.length<=a)return new xa(d);var f=function(C){var M,I=new Array(32768);return C.forEach(function(F){M=s(F[0]>>3,F[1]>>3,F[2]>>3),I[M]=(I[M]||0)+1}),I}(r);f.forEach(function(){});var x=function(C,M){var I,F,P,R=1e6,S=0,V=1e6,Q=0,B=1e6,w=0;return C.forEach(function(D){(I=D[0]>>3)<R?R=I:I>S&&(S=I),(F=D[1]>>3)<V?V=F:F>Q&&(Q=F),(P=D[2]>>3)<B?B=P:P>w&&(w=P)}),new o(R,S,V,Q,B,w,M)}(r,f),j=new t(function(C,M){return It(C.count(),M.count())});function b(C,M){for(var I,F=C.size(),P=0;P<1e3;){if(F>=M||P++>1e3)return;if((I=C.pop()).count()){var R=l(f,I),S=R[0],V=R[1];if(!S)return;C.push(S),V&&(C.push(V),F++)}else C.push(I),P++}}j.push(x),b(j,.75*a);for(var O=new t(function(C,M){return It(C.count()*C.volume(),M.count()*M.volume())});j.size();)O.push(j.pop());b(O,a);for(var k=new u;O.size();)k.push(O.pop());return k}}}().quantize,Us=function(s){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=s.naturalWidth,this.height=this.canvas.height=s.naturalHeight,this.context.drawImage(s,0,0,this.width,this.height)};Us.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var nt=function(){};nt.prototype.getColor=function(s,t){return t===void 0&&(t=10),this.getPalette(s,5,t)[0]},nt.prototype.getPalette=function(s,t,o){var u=function(d){var m=d.colorCount,h=d.quality;if(m!==void 0&&Number.isInteger(m)){if(m===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");m=Math.max(m,2),m=Math.min(m,20)}else m=10;return(h===void 0||!Number.isInteger(h)||h<1)&&(h=10),{colorCount:m,quality:h}}({colorCount:t,quality:o}),l=new Us(s),r=function(d,m,h){for(var c,p,f,x,j,b=d,O=[],k=0;k<m;k+=h)p=b[0+(c=4*k)],f=b[c+1],x=b[c+2],((j=b[c+3])===void 0||j>=125)&&(p>250&&f>250&&x>250||O.push([p,f,x]));return O}(l.getImageData().data,l.width*l.height,u.quality),a=va(r,u.colorCount);return a?a.palette():null},nt.prototype.getColorFromUrl=function(s,t,o){var u=this,l=document.createElement("img");l.addEventListener("load",function(){var r=u.getPalette(l,5,o);t(r[0],s)}),l.src=s},nt.prototype.getImageData=function(s,t){var o=new XMLHttpRequest;o.open("GET",s,!0),o.responseType="arraybuffer",o.onload=function(){if(this.status==200){var u=new Uint8Array(this.response);i=u.length;for(var l=new Array(i),r=0;r<u.length;r++)l[r]=String.fromCharCode(u[r]);var a=l.join(""),d=window.btoa(a);t("data:image/png;base64,"+d)}},o.send()},nt.prototype.getColorAsync=function(s,t,o){var u=this;this.getImageData(s,function(l){var r=document.createElement("img");r.addEventListener("load",function(){var a=u.getPalette(r,5,o);t(a[0],this)}),r.src=l})};const _s=n.createContext(void 0),Pe={TOP_QUEUE:"top_queue",END_QUEUE:"end_queue",TAGS:"tags",GOTO_ALBUM:"goto_album",REMOVE_FROM_PLAYLIST:"remove_from_playlist",ADD_TO_FAVORITES:"add_to_favs",REMOVE_FROM_FAVORITES:"remove_from_favs",NONE:"none"},ja=()=>{const s=Ke(),t=n.useRef({pointer:0,history:new Array(6).fill(null)});return n.useEffect(()=>{const{pointer:o,history:u}=t.current,l=(o-1+u.length)%u.length;u[l]!==s.pathname&&(u[o]=s.pathname,t.current.pointer=(o+1)%u.length)},[s]),t.current},ba=({children:s})=>{const[t,o]=n.useState(""),[u,l]=n.useState(!1),[r,a]=n.useState({}),[d,m]=n.useState(0),h=n.useRef(null),c=n.useRef(null),p=n.useRef(null),[f,x]=n.useState([]),[j,b]=n.useState("null"),O=g=>`${g}`!="null"?`${N}/read-write/music/${g}`:null,[k,C]=n.useState(-1),M=n.useRef(f),I=n.useRef(k),[F,P]=n.useState(null),[R,S]=n.useState(null),{emit:V,subscribe:Q}=fe(),B=n.useRef(null),[w,D]=n.useState(null),_=n.useRef(null),{addNotification:W,notifTypes:Z}=Oe(),ee=me(),[ae,de]=n.useState(null),[ge,je]=n.useState(null),[he,Te]=n.useState(null),H=n.useRef("A"),G=n.useRef(null),[oe,be]=n.useState(5),[le,A]=n.useState(!1),[K,y]=n.useState(()=>{const g=parseFloat(localStorage.getItem("volume"));return isNaN(g)?.5:Math.min(1,Math.max(0,g))}),[L,$]=n.useState(!1),[U,X]=n.useState(!1),ce=n.useRef(null),xe=n.useRef(null),z=n.useRef(null),ve=n.useRef(null),Ye=n.useRef(0),Ge=n.useRef(null),ue=n.useRef(null),St=n.useRef(0),lt=n.useRef(null),wt=n.useRef(0),Ot=n.useRef(0),De=5,Tt=n.useRef(""),rs=n.useRef(null),as=n.useRef(0),ut=n.useRef({lastAudioTime:0,lastPerformanceNow:0}),Xe=n.useRef(null),qs=.1,dt=n.useRef(!1),Mt=Ke(),Ze=n.useRef(""),Ws=n.useRef([]),mt=n.useRef({track:"",pairs:[]}),os=n.useRef(null),Ut=ja(),Ks=()=>{var g,v,T,E,q,Y,se,ye;c.current=new Audio,c.current.setAttribute("source","A"),c.current.addEventListener("error",Ne=>{if(c.current.src.includes("spoof"))return;const ke=c.current.error;if(ke&&(console.warn("Audio error occurred: code",ke.code),ke.code===4&&t)){const Ve=`${N}/radio/spoof/${encodeURIComponent(c.current.src)}`;c.current.src=Ve,W("Audio stream not reachable from browser. Streaming from backend..",Z.INFO),l(!0),c.current.play();const He=new EventSource(`${N}/radio/trackStream/${encodeURIComponent(c.current.src)}`);He.onmessage=Ee=>{console.log(Ee);const Ce=JSON.parse(Ee.data);console.log("Now playing:",Ce.metadata.StreamTitle);const Fe=Ce.metadata.adw_ad=="true"?`Advertisment - ${(Number(Ce.metadata.durationMilliseconds)/1e3).toFixed(1)}s`:Ce.metadata.StreamTitle;a(ze=>({...ze,title:Fe}))},He.addEventListener("error",Ee=>{console.warn("Metadata stream error",Ee)})}}),c.current.addEventListener("canplay",()=>{console.log("Stream is playable!")}),p.current=new Audio,p.current.setAttribute("source","B");for(const Ne of[c,p])Ne.current.crossOrigin="anonymous",Ne.current.playsInline=!0,Ne.current.setAttribute("webkit-playsinline",""),Ne.current.volume=parseFloat(localStorage.getItem("volume"))*.75||.5;(g=c.current)==null||g.addEventListener("timeupdate",Ct),(v=p.current)==null||v.addEventListener("timeupdate",Ct),(T=c.current)==null||T.addEventListener("playing",Et),(E=p.current)==null||E.addEventListener("playing",Et),(q=c.current)==null||q.addEventListener("play",et),(Y=c.current)==null||Y.addEventListener("pause",is),(se=p.current)==null||se.addEventListener("play",et),(ye=p.current)==null||ye.addEventListener("pause",is),_t(),console.log("Audio graph setted up")},Js=()=>{var g,v,T,E,q,Y,se,ye,Ne,ke,Ve,He,Ee,Ce,Fe,ze;console.log("Audio graph destructed"),(g=c.current)==null||g.pause(),c.current=null,(v=p.current)==null||v.pause(),p.current=null,(T=c.current)==null||T.removeEventListener("timeupdate",Ae),(E=c.current)==null||E.removeEventListener("ended",Ie),(q=c.current)==null||q.removeEventListener("error"),(Y=c.current)==null||Y.removeEventListener("canplay"),(se=p.current)==null||se.removeEventListener("timeupdate",Ae),(ye=p.current)==null||ye.removeEventListener("ended",Ie),(Ne=c.current)==null||Ne.removeEventListener("timeupdate",Ct),(ke=p.current)==null||ke.removeEventListener("timeupdate",Ct),(Ve=c.current)==null||Ve.removeEventListener("playing",Et),(He=p.current)==null||He.removeEventListener("playing",Et),(Ee=c.current)==null||Ee.removeEventListener("play",et),(Ce=c.current)==null||Ce.removeEventListener("pause",et),(Fe=p.current)==null||Fe.removeEventListener("play",et),(ze=p.current)==null||ze.removeEventListener("pause",et)},_t=()=>{var g,v;(g=c.current)==null||g.pause(),c.current.src=null,c.current.currentTime=0,(v=p.current)==null||v.pause(),p.current.src=null,p.current.currentTime=0,h.current=null,H.current="A",c.current.removeEventListener("timeupdate",Ae),c.current.removeEventListener("ended",Ie),p.current.removeEventListener("timeupdate",Ae),p.current.removeEventListener("ended",Ie)},Et=()=>{ue.current&&(console.log("Record start playing",h.current.currentTime),ut.current.lastAudioTime=h.current.currentTime,ut.current.lastPerformanceNow=performance.now())},cs=()=>{const g=h.current;!g||g.paused||Math.abs(g.currentTime-ms())>qs&&ds()},Qs=()=>(setTimeout(cs,200),setInterval(cs,5e3)),et=()=>{ue.current&&(ds(),Xe.current&&clearInterval(Xe.current),Xe.current=Qs())},is=()=>{Xe.current&&(clearInterval(Xe.current),Xe.current=null)},Ct=()=>{if(!ue.current||!h.current)return;const g=h.current.currentTime;if(Math.abs(g-as.current)>1){const v=Math.round(1/ue.current.interval),T=De*v,E=Math.floor(g*v);console.log("Seeking chunk",E,T,v,De),St.current=0,Ot.current=E,us(Tt.current,E,E+T)}else Xs(Tt.current,g);as.current=g};n.useEffect(()=>{r&&r.type!=="radio"&&Rt()},[r]);const Rt=()=>{const g=f.length<=k+1;G.current&&clearTimeout(G.current),!(g||!h.current)&&(console.log("Transition rescheduled, timesout in ",r.rawDuration,h.current.currentTime,oe,r.rawDuration-h.current.currentTime-oe),G.current=setTimeout(()=>{H.current=H.current==="A"?"B":"A",ls(k+1)},Math.min(r.rawDuration-h.current.currentTime-oe)*1e3,0))},ls=async g=>{const v=f.length<=g;if(C(g),h.current=H.current==="A"?c.current:p.current,f[g].startsWith("radio-")){let E={};if(f[g].startsWith("radio-id")){const Y=f[g].split("radio-id:")[1];E=await fetch(`${N}/radio/${Y}`).then(se=>se.json()),console.log(E),Ge.current=null,a({type:"radio",artist:E.name,...E,duration:"0-",uuid:Y})}else{E.url=f[g].split("radio-url:")[1],console.log(Ge.current);const{name:Y,...se}=Ge.current,ye={artist:Y,...se};a({type:"radio",...ye,duration:"0-"})}h.current.src=E.url;const q=new EventSource(`${N}/radio/trackStream/${encodeURIComponent(E.url)}`);q.onmessage=Y=>{console.log(Y);const se=JSON.parse(Y.data);console.log("Now playing:",se.metadata.StreamTitle),a(ye=>({...ye,title:se.metadata.StreamTitle}))},o(""),q.addEventListener("error",Y=>{console.warn("Metadata stream error",Y)}),hs(),p.current.removeEventListener("timeupdate",Ae),p.current.removeEventListener("ended",Ie),l(!0),h.current.play();return}Ge.current=null;const T=f[g];if(await fetch(`${N}/read-write/trackInfos/${T}`,{method:"GET"}).then(E=>E.json()).then(E=>{E.duration=Zt(E.rawDuration),a(E)}),h.current.currentTime=0,await fetch(`${N}/read-write/fftConfig/${T}`,{method:"GET",credentials:"include"}).then(async E=>{if(St.current=0,Ot.current=0,wt.current=0,!E.ok){ue.current=null;return}const q=await E.json();ue.current=JSON.parse(q),console.log(ue.current);const Y=ue.current.fftSize*1,se=De/ue.current.interval;lt.current=new Int16Array(se*Y),console.log("New buffer!")}),h.current.src!==O(T))h.current.src=O(T);else{m(0);return}h.current.play(),clearTimeout(z.current),o(T),Tt.current=T,l(!0),hn(T),console.log("Fading in",h.current),H.current==="A"?(v?At(p,null):(At(p,c),c.current.addEventListener("timeupdate",Ae),c.current.addEventListener("ended",Ie)),p.current.removeEventListener("timeupdate",Ae),p.current.removeEventListener("ended",Ie)):H.current==="B"&&(v?At(c,null):(At(c,p),p.current.addEventListener("timeupdate",Ae),p.current.addEventListener("ended",Ie)),c.current.removeEventListener("timeupdate",Ae),c.current.removeEventListener("ended",Ie))},us=async(g,v,T)=>{if(!ue.current)return lt.current=null,null;const E=ue.current.fftSize*1*2,q=E*v,Y=E*T,se=await fetch(`${N}/read-write/fft/${g}`,{headers:{Range:`bytes=${q}-${Y-1}`}});if(!se.ok&&se.status!==206){console.error("Failed to stream FFT data");return}wt.current=Math.floor(T);const ye=await se.arrayBuffer(),Ne=new Int16Array(ye),ke=ue.current.fftSize*1,Ve=Ne.length/ke,He=ue.current.interval,Ee=De/He;let Ce=St.current;for(let Fe=0;Fe<Ve;Fe++){const ze=Fe*ke,Wn=(Ce+Fe)%Ee;lt.current.set(Ne.subarray(ze,ze+ke),Wn*ke)}St.current=(Ce+Ve)%Ee},ds=()=>{ut.current.lastAudioTime=h.current.currentTime,ut.current.lastPerformanceNow=performance.now()},Ys=()=>{const{lastAudioTime:g,lastPerformanceNow:v}=ut.current,T=(performance.now()-v)/1e3;return g+T},ms=()=>h.current.paused?h.current.currentTime:Ys(),Xs=(g,v)=>{const T=Math.round(1/ue.current.interval),E=Math.floor(v*T),q=Math.floor(wt.current)-E,Y=T*De;Y-q<1||us(g,Math.floor(wt.current),Y+E)},Zs=()=>{const g=Math.round(1/ue.current.interval),T=Math.floor(ms()*g)-Ot.current,E=De*g;return T%E},en=()=>{if(!ue.current||!lt.current)return null;const g=ue.current.fftSize*1,v=Zs();if(v===null)return null;const E=Math.floor(De/ue.current.interval)*g,q=v*g,Y=q+g;return Y>E?null:lt.current.slice(q,Y)},hs=()=>{z!=null&&z.current&&clearInterval(z.current)};n.useEffect(()=>{console.log("Changed inteval ref:",z.current)},[z.current]);const At=(g,v)=>{z.current&&clearInterval(z.current);const T=150;let E=0;console.log("Init fadeout for:",v.current),z.current=setInterval(()=>{const q=Math.min(1,Math.max(0,E*T/(oe*1e3)));v.current.volume=q*Ye.current,g.current&&(g.current.volume=(1-q)*Ye.current),q>=1&&(clearInterval(z.current),z.current=null,v.current&&(g.current.pause(),g.current.src=null)),E++},T)},Ae=()=>{var g;return m((g=h.current)==null?void 0:g.currentTime)},Ie=()=>{f.length>0&&f.length<=k+1&&Bt()};n.useEffect(()=>{!le||k===-1||f.length===0||(_t(),console.log("init Autoplay",f,k,le,c.current,p.current),ls(k),A(!1))},[f,k,le]),n.useEffect(()=>{I.current=k},[k]),n.useEffect(()=>{M.current=f},[f]);const tn=()=>{var g,v;if(!h.current&&M.current.length>0){C(0),A(!0);return}if(u)(g=h.current)==null||g.pause(),l(!1),clearTimeout(G.current),clearInterval(z.current);else{if(l(!0),k===-1&&f.length!==0){C(0);return}(v=h.current)==null||v.play(),Rt()}},sn=(g,v=!1)=>{fetch(`${N}/read-write/nextSongs/${ae.type}/${ae.id}/${v}`,{method:"GET",credentials:"include"}).then(T=>T.json()).then(T=>{x(T),console.log(T),C(T.findIndex(E=>E===g)),A(!0)})},nn=g=>{x([g]),C(0),A(!0)},rn=()=>{if(h.current.currentTime>5||k===0){h.current.currentTime=0,Rt();return}C(k-1),A(!0)},an=(g,v,T=!1)=>{A(!1),fetch(`${N}/read-write/nextSongs/${v}/${g}/${T}`,{method:"GET",credentials:"include"}).then(E=>E.json()).then(E=>{x(E),C(0),A(!0)})},on=(g,v,T=!1)=>{A(!1),fetch(`${N}/read-write/nextSongs/${v}/${g}/${T}`,{method:"GET",credentials:"include"}).then(E=>E.json()).then(E=>{x(q=>[...q,...E])})},cn=(g,v,T=!1)=>{console.log(`${N}/read-write/nextSongs/${v}/${g}/${T}`),fetch(`${N}/read-write/nextSongs/${v}/${g}/${T}`,{method:"GET",credentials:"include"}).then(E=>E.json()).then(E=>{x(gt.shuffle(E)),A(!0),C(0)})},ln=(g=!1)=>{const v=g?M.current:f,T=g?I.current:k;v.length<=T+1&&(Bt(),console.log("stop")),C(T+1),A(!0)},Bt=()=>{_t(),m(0),l(!1),a(null),A(!1),C(-1),b("null"),x([]),o(""),Tt.current="",console.log("No more songs in the queue"),clearInterval(z.current),clearTimeout(G.current),hs()},un=g=>{if(g<0||g>100)return;const v=g/100*h.current.duration;h.current.currentTime=v,m(v),Rt()},dn=g=>{h.current.currentTime+g>h.current.duration?h.current.currentTime=h.current.duration:h.current.currentTime+g<0?h.current.currentTime=0:h.current.currentTime+=g,m(h.current.currentTime)},mn=g=>{g<0||g>=f.length||(A(!0),C(g))},hn=g=>{fetch(`${N}/read-write/trackCover/${g}`,{method:"GET"}).then(v=>v.json()).then(v=>{b(`${N}/covers/${v}`)})},fn=()=>{Bt(),x([]),C(-1)},Gt=()=>{fetch(`${N}/config/user/FFT`,{method:"GET",credentials:"include"}).then(g=>g.json()).then(g=>{rs.current=g})};n.useEffect(()=>{y(parseFloat(localStorage.getItem("volume"))||.5),Ks(),Mt.pathname==="/full-screen"&&(Ze.current="",dt.current=!0),Gt();const g=Q("login",Gt);return()=>{Js(),g()}},[]);const pn=async g=>{const v=await fetch(`${N}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!v.ok)throw new Error("Network response was not ok");const E=(await v.json()).map(q=>q.id);x(q=>[...q,...E])},gn=async g=>{const v=await fetch(`${N}/read-write/artist-all-tracks/${g}`,{method:"GET",credentials:"include"});if(!v.ok)throw new Error("Network response was not ok");const E=(await v.json()).map(q=>q.id);x(gt.shuffle(E)),A(!0),C(0)},xn=async()=>{fetch(`${N}/read-write/all-songs`,{method:"GET"}).then(g=>g.json()).then(g=>{x(gt.shuffle(g)),A(!0),C(0)})},vn=g=>{console.log("Editing album",g),fetch(`${N}/read-write/album/${g}`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{const{albumInfos:T,genres:E,tracks:q,artists:Y}=v;P({id:g,coverURL:`${N}/covers/${T.cover}`,tracks:q,type:"album",name:T.title,artist:Y.map(se=>se.name),year:T.release_date,description:T.description,genre:E.map(se=>se.genreName)})})},jn=g=>{fetch(`${N}/read-write/playlist/${g}/true`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{const{playlistInfos:T,collaborators:E}=v;P({id:T.id,type:"playlist",coverURL:`${N}/covers/${T.cover}`,name:T.title,description:T.description,collaborators:E})})};n.useEffect(()=>{const g=Math.min(1,Math.max(0,K));z.current||bn(g.toFixed(4)*.75),Ye.current=g.toFixed(4)*.75,localStorage.setItem("volume",g)},[K]);const bn=g=>{ve.current&&clearInterval(ve.current);let v=0;const T=16,E=c.current.volume;ve.current=setInterval(()=>{const q=We(E,g,v*T/300);c.current.volume=q,p.current.volume=q,(g-E>0?q>=g:q<=g)&&(clearInterval(ve.current),ve.current=null),v++},T)},yn=(g,v=null)=>{if(!g){console.log("No changes made"),S(null);return}const T=new FormData;T.append("artist",JSON.stringify(g)),v&&T.append("coverArtist",v),fetch(`${N}/read-write/editContainer/artist`,{method:"POST",credentials:"include",body:T}).then(()=>{S(null),B.current()})},Nn=g=>{fetch(`${N}/read-write/artist/${g}/true`,{method:"GET",credentials:"include"}).then(v=>v.json()).then(v=>{S({id:v.id,picture:`${N}/covers/artists/${v.picture}`,name:v.name,bio:v.bio,active_from:v.active_from})})},fs=(g,v=null)=>{if(!g){console.log("No changes made"),P(null);return}const T=new FormData;T.append(`${g.type}`,JSON.stringify(g)),v&&T.append("cover",v),fetch(`${N}/read-write/editContainer/${g.type}`,{method:"POST",credentials:"include",body:T}).then(()=>{P(null),B.current()})},kn=async(g,v)=>{const T=g?"/forMe":"";(await fetch(`${N}/read-write/delete/album/${v.id}${T}`,{method:"DELETE",credentials:"include"}).then(q=>q.json())).success&&(W(`Album ${v.name} deleted.`,Z.SUCCESS),P(null),ee("/home"))},Sn=async()=>{$(!0)},wn=(g,v)=>{console.log("sending playlist",g);const T=new FormData;T.append("playlist",JSON.stringify(g)),v&&(T.append("cover",v),console.log(v)),fetch(`${N}/read-write/newPlaylist`,{method:"POST",credentials:"include",body:T}).then(()=>{$(!1),ce.current()})},Tn=g=>{C(0),x([g]),A(!0)},En=()=>{$(!1)},Cn=(g,v,T,E)=>{D({track:v,position:g}),_.current&&_.current(),_.current=T,xe.current=E},Rn=()=>{D(null),_.current&&_.current()},An=(g,v,T=null)=>{switch(Rn(),g){case Pe.NONE:return;case Pe.TOP_QUEUE:Fn(v);break;case Pe.END_QUEUE:Pn(v);break;case Pe.GOTO_ALBUM:In(v);break;case Pe.REMOVE_FROM_PLAYLIST:Ln(v);break;case Pe.TAGS:je(v),W("Avaliable soon :)",Z.INFO);break;case Pe.ADD_TO_FAVORITES:fetch(`${N}/read-write/toggleFavorite/${v.id}/true`,{method:"GET",credentials:"include"}).then(E=>E.json()).then(E=>{xe.current(E)});break;case Pe.REMOVE_FROM_FAVORITES:fetch(`${N}/read-write/toggleFavorite/${v.id}/false`,{method:"GET",credentials:"include"}).then(E=>E.json()).then(E=>{xe.current(E)});break}},In=g=>{fetch(`${N}/read-write/trackAlbumId/${g.id}`,{method:"GET"}).then(v=>v.json()).then(v=>{ee(`albums/${v}`)})},Fn=g=>{const v=f;v.splice(k+1,0,g.id),x(v),W(`${g.title} playing next.`,Z.SUCCESS)},Pn=g=>{const v=f;v.push(g.id),x(v),W(`${g.title} playing at the end.`,Z.INFO)},Ln=g=>{fetch(`${N}/read-write/deleteTrackFromPlaylist/${ae.id}/${g.id}`,{method:"DELETE",credentials:"include"}).then(v=>v.json()).then(v=>{B.current(),W(`${g.title} removed.`,Z.SUCCESS)})},$n=(g,v)=>{B.current=v,de(g)},On=(g,v)=>{if(je(null),!g)return;const T=new FormData;T.append("current",JSON.stringify(g.current)),T.append("deleted",JSON.stringify(g.deleted)),fetch(`${N}/read-write/changeTrackTags/${v}`,{method:"POST",credentials:"include",body:T}).then(E=>E.json()).then(E=>{W("Tags upated!",Z.SUCCESS)})},Mn=async(g=[],v)=>{g.length!==0&&(x(g),C(v||0),A(!0))},Un=()=>{X(!0)},_n=()=>{X(!1)},Bn=()=>{dt.current=!dt.current,dt.current&&(Ze.current=Mt.pathname),console.log(Ze.current),ee(dt.current?"/full-screen":Ze.current&&Ze.current!=="/full-screen"?Ze.current:"/home")},Gn=()=>new Promise(g=>{fetch(`${N}/read-write/getSongMetaDataCover/${t}`,{method:"GET",credentials:"include"}).then(v=>v.blob()).then(v=>{os.current={track:t,blob:v},g({track:t,blob:v})})}),Dn=g=>{h.current&&(h.current.currentTime+=(g?1:-1)*10)},Vn=()=>{const{history:g,pointer:v}=Ut;if(g.every(Y=>Y===null)){ee("/home");return}let T=(v-2+g.length)%g.length,E=g[T],q=0;for(;(!E||E==="/full-screen")&&q<g.length||E===Mt.pathname;)T=(T-1+g.length)%g.length,E=g[T],q++;Ut.pointer=T,ee(E||"/home")},Hn=()=>{(r==null?void 0:r.type)==="radio"&&fetch(`${N}/radio/addToFavs/${r.uuid}`,{method:"POST",credentials:"include"}).then(async g=>({json:await g.json(),ok:g.ok})).then(g=>{W(g.json.message,Z.INFO),console.log(g),g.ok&&V("refetch-known-radios")}).catch(g=>{W("An error occured, you may check server logs."+g.code,Z.ERROR)})},zn=(g,v)=>{var q,Y;if(((q=mt.current)==null?void 0:q.track)===t&&((Y=mt.current)==null?void 0:Y.pairs.length)>0){v();return}const E=new nt().getPalette(g.current,10);qn(E),console.log("recomputed"),console.log(mt.current),v()},qn=g=>{const v=[];for(let T=0;T<g.length;T++)for(let E=T+1;E<g.length;E++)v.push({c1:g[T],c2:g[E],contrast:ia(g[T],g[E])});mt.current={track:t,pairs:v.sort((T,E)=>T.contrast-E.contrast)}};return e.jsxs(_s.Provider,{value:{recomputeColors:zn,songPalette:mt,skipAudioSeconds:Dn,toggleCurrentRadioToFavorites:Hn,externalRadioInfos:Ge,playRadio:Tn,navigateBack:Vn,history:Ut,colorOverride:Ws,requestNewFullScreenImage:Gn,fullScreenImage:os.current,toggleFullScreenView:Bn,fetchFFTUserSettings:Gt,FFTUserSetingsRef:rs,fftConfigRef:ue,getFFTAtCurrentTime:en,deleteAlbum:kn,editArtist:Nn,playContainer:an,closeTagWindow:_n,openTagWindow:Un,saladContext:he,setSaladContext:Te,playAudioSalad:Mn,linkNewContainer:$n,trackActionTypes:Pe,onClicTrackActionEntry:An,openTrackActions:Cn,getNextSongsFromAlbum:sn,currentTrackData:r,currentTime:d,isPlaying:u,toggleTrackPaused:tn,playNextSong:ln,trackCoverUrl:j,playPreviousSong:rn,playingTrack:t,jumpTrackSeconds:dn,jumpToPercent:un,addContainerToQueue:on,playContainerSuffle:cn,playQueue:f,queuePointer:k,jumpToQueueTrack:mn,deleteQueue:fn,addArtistToQueue:pn,shuffleArtistToQueue:gn,playTrackNoQueue:nn,playLibraryShuffle:xn,setVolume:y,volume:K,editAlbum:vn,editPlaylist:jn,createNewPlaylist:Sn,globalAudioRef:h,setPlaylistAddedCallback:g=>{ce.current=g}},children:[s,F?F.type==="album"?e.jsx(da,{applyCanges:fs,albumClass:F}):F.type==="playlist"?e.jsx(xs,{editPlaylistClass:F,applyCanges:fs}):null:null,R&&e.jsx(ga,{applyChanges:yn,artist:R}),L&&e.jsx(xs,{closeOverlay:En,applyCanges:wn}),w?e.jsx(ha,{isFav:ae.favPlaylist,trackY:w.position.y,track:w.track}):null,ge&&e.jsx(fa,{apply:On,track:ge}),U&&e.jsx(pa,{})]})},re=()=>{const s=n.useContext(_s);if(s===void 0)throw new Error("useAudioPlayer must be used within an AudioPlayerProvider");return s},it=n.memo(({percent:s,text:t=null,showPercent:o=!1,isMarquee:u=!1,fillColor:l="#fffdff",style:r={},initialising:a=!1,initialisingColor:d="white",onClickPercentage:m=null,minWidth:h=0})=>{const c=n.useRef(null),p=f=>{if(a||!m)return;const x=f.currentTarget,j=x.getBoundingClientRect().x,b=f.clientX;m((b-j)/x.clientWidth*100)};return n.useEffect(()=>{c.current&&c.current.style.setProperty("--progress",`${s}%`)},[s]),e.jsxs("div",{className:"progressBar",style:{...r,minWidth:h},onClick:p,children:[e.jsx("div",{className:"progressFill",ref:c,style:{background:l,...r}}),a&&e.jsx("div",{className:"progressFill",init:"init",style:{backgroundColor:d,opacity:.5,...r}}),o&&e.jsx("span",{className:"progressPercent",children:s+"%"}),t&&e.jsx("span",{className:"progressPercent",style:{margin:"auto"},children:t})]})},(s,t)=>s.text===t.text&&s.initialising===t.initialising&&s.percent===t.percent),ya=({})=>{const{currentTrackData:s,currentTime:t,jumpToPercent:o}=re();return!s||Object.keys(s).length===0?null:e.jsx("div",{className:"songProgress",children:e.jsxs("div",{children:[e.jsx("span",{children:Zt(t).readable}),e.jsx(it,{percent:t/s.rawDuration*100,showPercent:!1,fillColor:"var(--violet-web-color)",style:{height:"10px"},onClickPercentage:o}),e.jsx("span",{children:s.duration.readable})]})})},Na=n.memo(({id:s,isActive:t,setActive:o,contextName:u})=>e.jsx("div",{className:"index",id:`${u}-index_${s}`,onClick:()=>o(s),"data-active":t?"active":"","data-clickable":!!o}),(s,t)=>s.id===t.id&&s.isActive===t.isActive&&s.contextName===t.contextName),es=({context:s,active:t,setActive:o})=>e.jsx("div",{className:`activeIndex-container ${s.name}`,children:Array.from({length:s.length},(u,l)=>e.jsx(Na,{id:l,isActive:t===l,setActive:o,contextName:s.name},l))}),Bs=n.memo(function({currentActive:t,onClick:o,data:u}){const[l,r]=n.useState(t);n.useEffect(()=>{r(t)},[t]);const a=d=>{r(d),o==null||o(d)};return e.jsx("div",{className:"job-view-div",children:u.map((d,m)=>e.jsx("div",{className:"cornered-button","data-active":l===m,onClick:()=>{a(m)},children:d},m))})}),ka=({fromFile:s,setFromFile:t,tracksSelected:o,initMetadataFetching:u})=>{const[l,r]=n.useState(!1),[a,d]=n.useState(""),m=c=>{r(!0),c.target.files&&(console.log("New tracks"),o(Array.from(c.target.files)),c.target.files=null)},h=c=>{d(c.target.value)};return e.jsxs("div",{className:"addMusicSource",children:[e.jsxs("div",{className:"add-audio-source-selection",children:[e.jsx("p",{children:"Select the source: "}),e.jsx(Bs,{currentActive:s?0:1,onClick:c=>{t(c==0)},data:["From file","From URL"]})]}),s?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Select files from a local storage."}),e.jsxs("div",{className:"add-music-input",children:[e.jsxs("label",{htmlFor:"files",className:"file-select",children:[e.jsx(or,{}),e.jsx("span",{children:"Select file"})]}),e.jsx("input",{id:"files",multiple:!0,type:"file",accept:"audio/*",onChange:m})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Link to a radio steam."}),e.jsxs("div",{className:"add-music-input",children:[e.jsx("input",{type:"text",placeholder:"Enter URL",onChange:h}),e.jsx(ne,{onClick:async()=>{u(a)},text:"Resolve",icon:e.jsx(cr,{})})]})]}),l&&e.jsx("p",{children:"Hold a sec'.. The metadata fetch is about to beggin."})]})},bt=({text:s,progressBar:t={useProgressBar:!1}})=>e.jsxs("div",{className:"loading-container",children:[e.jsx("h3",{children:s}),t.useProgressBar?e.jsx(it,{percent:t.percent,showPercent:t.showPercent,isMarquee:t.isMarquee,fillColor:t.fillColor,style:{height:"25px"}}):e.jsx("p",{children:"Loading..."})]}),Sa=({addNewMusic:s})=>e.jsx("div",{className:"album-card",context:"add",children:e.jsx(ir,{strokeWidth:.7,className:"album-card-cover",onClick:s})}),wa=({album:s,deleteAlbum:t,editAlbum:o})=>e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(ot,{className:"album-card-overview-button",use:"delete",onClick:()=>t(s.uuid)}),e.jsx(Cs,{className:"album-card-overview-button",use:"edit",onClick:()=>o(s.uuid)}),e.jsxs("div",{className:"album-card-overview-button",use:"song-count",children:[e.jsx(lr,{className:"song-count-icon"}),e.jsx("span",{children:s.tracks.length})]}),e.jsx("img",{src:s.coverURL,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Be(s.name,25)}),e.jsx("p",{className:"album-artist",children:Be(s.artist.join(","),25)||"No artist"})]}),Ta=({radio:s,deleteRadio:t})=>(console.log(s),e.jsxs("div",{className:"album-card",context:"add",children:[e.jsx(ot,{className:"album-card-overview-button",use:"delete",onClick:()=>t(s[0])}),e.jsx("img",{src:s[1].favicon==""?null:s[1].favicon,className:"album-card-cover"}),e.jsx("h3",{className:"album-name",children:Be(s[1].name,25)})]})),Ea=({albums:s,radios:t,deleteRadio:o,addNewMusic:u,deleteAlbum:l,editAlbum:r,publish:a})=>{const d=s.map((c,p)=>e.jsx(wa,{album:c,deleteAlbum:l,editAlbum:r},`alb-${p}`)),m=[...t].map((c,p)=>e.jsx(Ta,{radio:c,deleteRadio:o},`rad-${p}`)),h=[...d,...m];return console.log("rerun"),h.push(e.jsx(Sa,{addNewMusic:u},-1)),e.jsxs("div",{className:"albums-overview",children:[e.jsx("div",{className:"album-overview-container",children:h.reverse()}),(s.length>0||t.size>0)&&e.jsx("button",{className:"roundButton",id:"publish-to-library",onClick:a,children:"Publish to library"})]})},Ca=({track:s,onClose:t})=>{const{albums:o,moveTrackToNewAlbum:u,moveTrackToAlbum:l,editingAlbum:r,setEditingAlbum:a}=Fa(),[d,m]=n.useState(""),[h,c]=n.useState(!1),p=n.useRef(null),f=j=>{j.preventDefault(),!d&&j.target.existingAlbum.value?l(s,j.target.existingAlbum.value):d!==""&&u(s,d),h&&a(null),t()},x=j=>{m(j.target.value)};return n.useEffect(()=>{o.find(({uuid:b})=>b===r).tracks.length===1?c(!0):c(!1);const j=b=>{var O;if(p.current&&!p.current.contains(b.target)){if(((O=b.target.closest("svg"))==null?void 0:O.id)==="volume-button")return;t()}};return document.addEventListener("mousedown",j),document.addEventListener("touchstart",j),()=>{document.removeEventListener("mousedown",j),document.removeEventListener("touchstart",j)}},[]),e.jsx("div",{className:"trackRemapAlbum-container",children:e.jsxs("div",{className:"trackRemapAlbum",ref:p,children:[e.jsx("h2",{children:"Move track to another album"}),h&&e.jsx("p",{className:"last-track-notify",children:"Last track of the album, if you move it, the current album will be deleted."}),e.jsxs("form",{className:"trackRemapAlbumForm",onSubmit:f,children:[e.jsx("label",{htmlFor:"newAlbum",children:"New album name"}),e.jsx("input",{type:"text",id:"newAlbum",placeholder:"Enter album name",onChange:x}),e.jsx("label",{htmlFor:"existingAlbum",children:"Existing album"}),e.jsx("select",{id:"existingAlbum",onChange:()=>m(""),children:o.map((j,b)=>j.uuid===r?null:e.jsx("option",{value:j.uuid,children:j.name},b))}),e.jsx("input",{type:"submit",value:"Submit"})]})]})})},Ra=({setEditUid:s,albumClass:t})=>{var c,p;const[o,u]=n.useState({visible:!1,track:null}),[l,r]=n.useState(null),a=n.useRef(null);if(!t)return null;n.useEffect(()=>{t&&r(t.coverURL)},[t]);const d=()=>{const f=a.current;t.name=f.albumName.value,t.artist=f.artistName.value.split(",").map(j=>j.trim()),t.year=f.releaseDate.value;const x=f.genre.value.split(",").map(j=>j.trim()).map(j=>j.charAt(0).toUpperCase()+j.slice(1));t.genre=x.filter(j=>j!=""),t.description=f.description.value,s(null)},m=f=>{const x=f.target.files[0];x&&r(t.setCoverFromFile(x))},h=f=>{u({visible:!o.visible,track:f})};return e.jsxs("div",{className:"albumWrapping",children:[e.jsxs("div",{className:"albumCover",children:[e.jsxs("div",{className:"albumCoverImageEdit",children:[l?e.jsx("img",{id:"coverPicture",src:l,style:{width:"100%"}}):e.jsx(te,{id:"coverPicture",style:{width:"100%"}}),e.jsx("label",{htmlFor:"coverInput",children:e.jsx(yt,{})}),e.jsx("input",{type:"file",id:"coverInput",style:{display:"none"},accept:"image/*",onChange:m})]}),e.jsx("button",{className:"roundButton go-back",onClick:()=>d(),children:"Apply"})]}),e.jsxs("form",{className:"albumDetails",id:"editAlbumInfos",ref:a,children:[e.jsx("label",{htmlFor:"albumName",children:"Album name"}),e.jsx("input",{type:"text",id:"albumName",placeholder:"Enter album name",defaultValue:t.name}),e.jsx("label",{htmlFor:"artistName",children:"Artists name"}),e.jsx("input",{type:"text",id:"artistName",placeholder:"Enter artist name",defaultValue:(c=t.artist)==null?void 0:c.toString().replace(/,/g,", ")}),e.jsxs("div",{className:"albumType",children:[e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"releaseDate",children:"Release date"}),e.jsx("input",{type:"date",id:"releaseDate",defaultValue:t.year})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"genre",children:"Genres"}),e.jsx("input",{type:"text",id:"genre",placeholder:"Enter genres: G1, G2,...",defaultValue:(p=t.genre)==null?void 0:p.toString().replace(/,/g,", ")})]}),e.jsxs("div",{className:"albumTypeOption",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter description",defaultValue:t.description})]})]}),e.jsx("div",{className:"albumTracks",children:e.jsx(Le,{className:"albumTrackList",height:250,itemCount:t.tracks.length,itemSize:35,width:"100%",children:({index:f,style:x})=>e.jsxs("div",{style:x,className:"album-wrapping-track",children:[e.jsx("span",{children:t.tracks[f].title}),e.jsx(Ss,{className:"trackIcon",onClick:()=>{h(t.tracks[f])}})]},f)})})]}),o.visible&&e.jsx(Ca,{onClose:()=>{u({visible:!1})},track:o.track})]})};class js{constructor(t,o,u,l,r){this.name=t,this.artist=o,this.year=u,this.tracks=[],this.setCover(l),this.uuid=r}setCover(t){!t||this.coverURL||(this.coverData=t.data,this.coverMime=t.format,this.coverURL=URL.createObjectURL(new Blob([this.coverData],{type:this.coverMime})),this.ext=this.coverMime.split("/")[1],this.sourceIsBinary=!0)}setCoverFromFile(t){return this.coverURL=URL.createObjectURL(t),this.coverFile=t,console.log("Setting cover from file: ",t),this.ext=t.type.split("/")[1],this.coverURL}addTrack(t){t&&(this.tracks.push(t),t.album=this)}removeTrack(t){t&&(this.tracks=this.tracks.filter(o=>o.id!==t.id),t.album=null)}getPuredData(){return{name:this.name,artists:this.artist,year:this.year,uuid:this.uuid,ext:this.ext}}getPuredCover(){if(!this.sourceIsBinary)return this.coverFile?(console.log("Using file reference for cover: "+album.coverFile),this.coverFile):null;if(console.log("Using binary reference for cover: ",this.uuid),!this.coverData||this.coverData.length===0)return console.log("returned no cover at",this.uuid),null;const t=new Uint8Array(this.coverData),o=new Blob([t],{type:this.coverMime});return new File([o],`${this.uuid}.${this.coverMime.split("/").pop()}`,{type:this.coverMime})}}class Aa{constructor(t){this.id=jt(),this.file=t,this.album=null,this.albumName="",this.artists=[],this.title=t.name,this.no=1,this.duration=0,this.year=2003,this.picture=null}setPicture(t){this.picture=t}setAdditionalData(t="",o="",u=1,l=0,r=2e3,a=[]){this.title=o,this.no=u,this.duration=l,this.year=r,this.artists=a,this.albumName=t}setAlbum(t){this.album=t}getUrl(){return URL.createObjectURL(this.file)}getArtists(){return this.artists?this.artists.map(t=>t.trim()):["Unknown artist"]}getPuredTrackMeta(){return{albumUuid:this.album.uuid,duration:this.duration,no:this.no,year:this.year,title:this.title,id:this.id}}}const Gs=n.createContext(),Ia=({closeOverlay:s,uploadPercent:t,uploadProgress:o,uploadFinished:u,isMinimize:l,setMinimized:r})=>{const[a,d]=n.useState(!0),[m,h]=n.useState(0),[c,p]=n.useState(0),[f,x]=n.useState(0),[j,b]=n.useState([]),[O,k]=n.useState(!1),[C,M]=n.useState(null),[I,F]=n.useState(0),[P,R]=n.useState(0),[S,V]=n.useState(""),{addNotification:Q,notifTypes:B}=Oe(),[w,D]=n.useState(new Map),_=n.useRef([]),W=n.useRef([]),{emit:Z}=fe(),ee=n.useRef(null),ae=async y=>{if(y.length===0)return;x(y.length);const L=y.map($=>new Aa($));ee.current=L,de()},de=async()=>{const y=await he(),L=y.length>0?ee.current.filter($=>!y.includes($.id)):ee.current;console.log("Valid new tracks",L),_.current=[..._.current,...L],ee.current=null,je()},ge=()=>{W.current=W.current.filter(y=>y.tracks.length>0),k(!0),b(W.current)};n.useEffect(()=>{console.log("New albums ",j),!O&&(p(0),h(2))},[j]);const je=()=>{function y(L){return W.current.find($=>$.name===L)}for(const L of _.current){const $=y(L.albumName);if($)$.addTrack(L);else{const U=jt(),X=new js(L.albumName,L.getArtists(),L.year,L.picture,U);W.current.push(X),X.addTrack(L)}}b(W.current)},he=async(y="")=>{if(!a){if(!y)return;console.log("Fetching meta at source",y);const $=await fetch(`${N}/radio/metadata/${encodeURIComponent(y)}`,{method:"GET"}).then(ce=>ce.json());if($)Q("Radio found! "+$[0].name,B.INFO);else{Q("No radio found..",B.ERROR);return}const U=$[0];console.log(U);const X=w;X.set(U.stationuuid,{url:U.url_resolved,favicon:U.favicon,name:U.name}),D(X),h(2);return}h(1);const L=[];return await Promise.all(ee.current.map(async $=>{var X,ce,xe;const U=await ea($.file).catch(z=>{console.error("error at",file,z),Q(`Track ${$.title} seems corrupted, retry without it.`,B.ERROR)});if(!U){L.push($.id);return}$.setAdditionalData(U.common.album||U.common.title,U.common.title||$.file.name,((X=U.common.track)==null?void 0:X.no)||0,U.format.duration||0,U.common.year,U.common.artists.map(z=>z.split(",")).flat(1).map(z=>z.trim())),$.setPicture((xe=(ce=U.common)==null?void 0:ce.picture)==null?void 0:xe[0]),p(z=>z+1)})),L},Te=y=>{const L=new Map([...w].filter(([$,U])=>$!=y));D(L)},H=y=>{_.current=_.current.filter(L=>L.album.uuid!==y),console.log("Deleted album, remaining tracks",_.current),W.current=W.current.filter(L=>L.uuid!==y),k(!1),b(W.current)},G=y=>{M(y)};n.useEffect(()=>{if(C===null||j.length===0){h(2);return}h(3)},[C]);const oe=(y,L)=>{const $=jt();console.log("Moving track: "+y.id+NaN+C+" to album: "+$),y.album.removeTrack(y);const U=new js(L,y.getArtists(),y.year,y.picture,L);W.current.push(U),U.addTrack(y),ge(),Q(`Track ${y.title.substring(0,60)} got moved to album ${L}.`,B.INFO)},be=(y,L)=>{console.log("Moving track: "+y.id+NaN+C+" to album: "+L),y.album.removeTrack(y);const $=W.current.find(U=>U.uuid===L);$.addTrack(y),ge(),Q(`Track ${y.title.substring(0,60)} got moved to album ${$.name}.`,B.INFO)},le=async()=>{if(console.log("Publishing tracks: ",_.current),console.log("Publishing radios: ",w),w.keys().forEach(async y=>{const L=new FormData;console.log(w.get(y)),L.append("radioData",JSON.stringify({uuid:y,...w.get(y)}));const $=await fetch(`${N}/radio/newRadio`,{method:"POST",credentials:"include",body:L}).then(U=>U.json());console.log($)}),_.current.length>0){h(4);for(const $ of W.current){let U=new FormData;U.append("album",JSON.stringify($.getPuredData()));const X=$.getPuredCover();X&&U.append("cover",X);const ce=await fetch(`${N}/read-write/upload`,{method:"POST",body:U,credentials:"include"});if(!ce.ok)throw console.error("Error uploading albums:",ce.statusText),new Error("Error uploading albums");U=null,console.log("Album uploaded: "+$.name)}W.current.forEach($=>{$.coverURL&&(URL.revokeObjectURL($.coverURL),$.coverURL=null)});let y=_.current.reduce(($,U)=>$+U.file.size,0);F((y/1024/1024).toFixed(1));let L=0;for(const $ of _.current){let U=new FormData;U.append("trackMeta",JSON.stringify($.getPuredTrackMeta())),U.append("music",$.file),V($.title),o({done:L,total:_.current.length}),await ta({method:"POST",data:U,withCredentials:!0,url:"/upload",baseURL:`${N}/read-write`,onUploadProgress:X=>{const{total:ce,loaded:xe}=X,z=ce/1e6,ve=xe/1e6;t(ve/z);const Ye=ve/z*100;R(Ye.toFixed(2))}}).catch(X=>{console.error("Error uploading track:",X)}).finally(()=>{L++}),U=null}}console.log("Upload finished"),u(),setTimeout(()=>{W.current=null,_.current=null,p(0),b([]);const y=w;y.clear(),D(y),h(0),M(null),R(0),console.log("Closing overlay"),Z("musicUploaded"),s()},750)},A=()=>{if(m!==4){s();return}r(!0)},K=()=>{switch(m){case 0:return e.jsx(ka,{fromFile:a,setFromFile:d,tracksSelected:ae,initMetadataFetching:he});case 1:return e.jsx(bt,{text:`Fetching metadatas.. ${f?c+"/"+f:"-/-"}`});case 2:return e.jsx(Ea,{albums:j,addNewMusic:()=>h(0),deleteAlbum:H,editAlbum:G,publish:le,radios:w,deleteRadio:Te});case 3:return e.jsx(Ra,{setEditUid:M,albumClass:j.find(y=>y.uuid===C)});case 4:return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(bt,{text:`Publishing ${S} ${I}Mb..`,progressBar:{useProgressBar:!0,showPercent:!0,isMarquee:!1,percent:Number(P),fillColor:"var(--cool-green)"}}),e.jsx("p",{children:"You can close this overlay, the upload will continue. :)"})]});default:return e.jsx("div",{className:"addMusicSource",children:e.jsx("p",{children:"Not implemented yet"})})}};return e.jsx("div",{className:"addMusicRoot",children:e.jsx("div",{className:"addMusicContainer",style:l?{display:"none"}:{},children:e.jsxs(Gs.Provider,{value:{albums:j,moveTrackToNewAlbum:oe,editingAlbum:C,moveTrackToAlbum:be,setEditingAlbum:M},children:[e.jsx(pe,{className:"buttonRound closeOverlay",onClick:A}),e.jsx("h2",{children:"Add Music"}),e.jsx(es,{context:{name:"AddMusic",length:5},active:m,setActive:h}),e.jsx(K,{})]})})})},Fa=()=>n.useContext(Gs),xt=({iconHovered:s,iconDefault:t,onClick:o=null,className:u="",id:l=""})=>{const[r,a]=n.useState(!1);return e.jsx("div",{style:o?{background:"rgba(0,0,0,0)"}:{},className:u,id:l,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:o,children:r?e.jsx(s,{}):e.jsx(t,{})})},zt=({context:s})=>{const{isPlaying:t,toggleTrackPaused:o,playNextSong:u,playPreviousSong:l,jumpTrackSeconds:r}=re();return e.jsxs("div",{className:"audio-controls",context:s,children:[s.mobile?null:e.jsx(xt,{iconHovered:dr,iconDefault:ur,onClick:l}),e.jsx(xt,{iconHovered:t?hr:fr,iconDefault:t?mr:Wt,onClick:o}),e.jsx(xt,{iconHovered:gr,iconDefault:pr,onClick:u})]})},Pa=n.memo(({index:s,style:t,data:o})=>{const{playQueue:u,cacheRef:l,jumpToQueueTrack:r,queuePointer:a}=o,d=u[s],[m,h]=n.useState(!!l.current[d]);let c=l.current[d];c||(c={title:"Loading...",cover:"loading"}),n.useEffect(()=>{m||(l.current[d]=c,fetch(`${N}/read-write/shortTrackInfos/${d}`,{credentials:"include"}).then(f=>f.json()).then(f=>{l.current[d]=f,h(!0)}))},[m,d]);const p={...t,width:"calc(100% - 15px)",height:"47.5px"};return e.jsxs("div",{className:"music-queue-entry",style:p,"is-passed":`${s<a}`,"is-selected":`${s===a}`,onClick:()=>r(s),children:[c.cover?e.jsx("img",{src:`${N}/covers/${c.cover}`,className:"track-image-small"}):e.jsx(te,{className:"track-image-small"}),e.jsx("p",{className:"track-title",children:c.title})]})},(s,t)=>s.data.playQueue[s.data.queuePointer]===t.data.playQueue[t.data.queuePointer]),La=50,$a=600,Oa=({hideComponent:s})=>{const{playQueue:t,deleteQueue:o,jumpToQueueTrack:u,queuePointer:l}=re(),r=n.useRef(null),{subscribe:a}=fe(),d=n.useRef(new Map);return n.useEffect(()=>{const m=c=>{var p;if(r.current&&!r.current.contains(c.target)){if(((p=c.target.closest("svg"))==null?void 0:p.id)==="playlist-button")return;s()}},h=a("action-bar-open",()=>{s()});return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),()=>{h(),document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m)}},[]),e.jsxs("div",{className:"music-queue",ref:r,children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Music Queue"}),t.length>0&&e.jsx(ot,{className:"buttonRound",id:"queue-trash",onClick:o})]}),t.length>0?e.jsx(Le,{height:$a,itemCount:t.length,itemSize:La,width:"100%",itemData:{playQueue:t,cacheRef:d,jumpToQueueTrack:u,queuePointer:l},children:Pa}):e.jsx("p",{children:"No items in the queue"})]})},Ma=n.memo(({payload:s})=>{const[t,o]=n.useState(!1);return e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Open a song's dropdown"}),e.jsxs("div",{id:"tuto-0-cooking-container",children:[e.jsx(te,{className:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-cooking-songs-container",children:[e.jsxs("div",{className:"tuto-cooking-0-song-skeleton","data-target":!0,children:[e.jsx(Rs,{id:"tuto-cooking-dots",onClick:()=>{o(!t)}}),t&&e.jsxs("div",{id:"tuto-0-cooking-dropdown",children:[e.jsxs("div",{className:"tuto-cooking-0-action-skeleton track-action-entry","data-target":"true",onClick:()=>{s(1)},children:[e.jsx("span",{children:"Edit tags"})," ",e.jsx(vt,{})]}),e.jsx("div",{className:"tuto-cooking-0-action-skeleton"})]})]}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"}),e.jsx("div",{className:"tuto-cooking-0-song-skeleton"})]})]})]})}),Ua=n.memo(({payload:s})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Here you can remove and add tags:"}),e.jsxs("div",{id:"tuto-tags-1",children:[e.jsxs("div",{className:"tuto-search-skeleton",children:[e.jsx(Je,{}),e.jsx("span",{id:"animated-write-span",children:"140BPM, roses, gaming, 2010s"}),e.jsx("div",{className:"blinking-cursor"})]}),e.jsxs("div",{id:"tuto-tags",children:[e.jsxs("div",{className:"small-tag",children:["Evening",e.jsx(pe,{})]}),e.jsxs("div",{className:"small-tag",children:["Chill",e.jsx(pe,{})]}),e.jsxs("div",{className:"small-tag",children:["Friends",e.jsx(pe,{})]}),e.jsx("button",{className:"tuto-target",onClick:()=>{s(2)},children:"Got it!"})]})]})]})),_a=n.memo(({payload:s})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Cooking lets you play all the tracks mataching the tags:"}),e.jsx("div",{id:"tuto-tags-salad",children:e.jsxs("div",{id:"tuto-tags",children:[e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag",style:{"--color":"#a79cf5"}})]})}),e.jsxs("div",{id:"tuto-song-list",children:[e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}})}),e.jsx("div",{className:"tuto-tag-song-skeleton",children:e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})}),e.jsxs("div",{className:"tuto-tag-song-skeleton",children:[e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#3c9eff"}}),e.jsx("div",{className:"placeholder-tuto-tag-circle",style:{"--color":"#a79cf5"}})]})]}),e.jsx("button",{className:"tuto-target",onClick:s,children:"Got it!"})]})),Ba=[Ma,Ua,_a],Ga=n.memo(()=>{const{onTutoialFinished:s}=kt(),[t,o]=n.useState(0),u=Ba[t]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{s(we.COOKING)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Manage tags and cook salads"}),e.jsx(es,{context:{name:"tutorial",length:3},active:t,setActive:o}),e.jsx(u,{payload:r[t]})]})}),Da=n.memo(({payload:s})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Pick an album:"}),e.jsxs("div",{id:"tuto-genre-albums-container",children:[e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{s(1)},children:[e.jsx(te,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]}),e.jsxs("div",{className:"tuto-genre-0-album album-card",onClick:()=>{s(1)},children:[e.jsx(te,{className:"tuto-genre-logo"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton","data-type":"artist"})]})]})]})),Va=n.memo(({payload:s})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Edit the desired album:"}),e.jsxs("div",{id:"tuto-genre-0-lib",children:[e.jsx(te,{id:"tuto-genre-logo"}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsxs("div",{id:"tuto-genre-0-header",children:[e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"placeholder-tuto-genre-btn"}),e.jsx("button",{className:"tuto-target",onClick:()=>{s(2)},children:e.jsx(Kt,{})})]}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"}),e.jsx("div",{className:"tuto-genre-0-song-skeleton"})]})]})]})),Ha=n.memo(({payload:s})=>e.jsxs("div",{className:"tutorial-content",children:[e.jsx("span",{children:"Change the genre:"}),e.jsxs("div",{id:"tuto-genre-1-lib",children:[e.jsxs("div",{id:"tuto-genre-1-logo-btn",children:[e.jsx(te,{id:"tuto-genre-logo"}),e.jsx("button",{className:"tuto-target",onClick:s,children:"Got it!"})]}),e.jsxs("div",{id:"tuto-genre-0-btn-song",children:[e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton"}),e.jsx("div",{className:"tuto-genre-1-input-skeleton"}),e.jsx("div",{className:"tuto-genre-1-title-skeleton","data-target":!0,children:e.jsx("span",{children:"Genre"})}),e.jsxs("div",{className:"tuto-genre-1-input-skeleton tuto-target","data-target":!0,children:[e.jsx("span",{id:"animated-write-span",children:"Rock, Breakcore, Soundtrack, .."}),e.jsx("div",{className:"blinking-cursor"})]})]})]})]})),za=[Da,Va,Ha],qa=n.memo(()=>{const{onTutoialFinished:s}=kt(),[t,o]=n.useState(0),u=za[t]||(()=>e.jsx("div",{children:"This tutorial page does not exisit."})),r=[o,o,()=>{s(we.GENRES)}];return e.jsxs("div",{className:"tutorial-page",children:[e.jsx("h3",{children:"Add genre to albums"}),e.jsx(es,{context:{name:"tutorial",length:3},active:t,setActive:o}),e.jsx(u,{payload:r[t]})]})}),we={GENRES:"genres",COOKING:"cooking"},ts=new Map;ts.set(we.GENRES,qa);ts.set(we.COOKING,Ga);const Ds=({tutorialKey:s=we.GENRES})=>{const t=ts.get(s)??(()=>e.jsx("div",{children:"Not found"}));return e.jsx("div",{className:"page-overlay-blur",children:e.jsx(t,{})})},Vs=n.createContext(),J={SEARCH:"search",OPEN_ACTION_BAR:"open_action_bar",CLOSE_ACTION_BAR:"close_action_bar",PLAY_SONG:"play_song",OPEN_ALBUM:"open_album",OPEN_ARTIST:"open_artist",PLAY_LIBRARY_RANDOM:"play_library_random",TOGGLE_PLAY_PAUSE:"toggle_play_pause",OPEN_SETTINGS:"open_settings",VOLUME_UP:"volume_up",VOLUME_DOWN:"volume_down",OPEN_GENRE:"open_genre",TOGGLE_FULL_SCREEN:"toggle_full_screen",SKIP_PLUS:"skip_plus",SKIP_MINUS:"skip_minus"},Ue=[{name:"Search",code:J.SEARCH,description:"Search for a song, an album, a genra, an artist",key:"k",modifier:"ctrl",keywords:["search","find","look for","seek","search for","find for","look for for","seek for"],icon:()=>e.jsx(Je,{className:"action-bar-current-logo"})},{name:"open action bar",code:J.OPEN_ACTION_BAR,description:"Give a command",key:" ",modifier:"ctrl",keywords:[]},{name:"Play the library in shuffle",code:J.PLAY_LIBRARY_RANDOM,description:"",key:"r",modifier:"ctrl",keywords:["play","shuffle","random","library","all","all songs","all albums","all artists"],icon:()=>e.jsx(ct,{className:"action-bar-current-logo"})},{name:"Toggle Play pause",code:J.TOGGLE_PLAY_PAUSE,description:"",key:" ",modifier:"",icon:()=>e.jsx(ct,{className:"action-bar-current-logo"})},{name:"Open settings",code:J.OPEN_SETTINGS,description:"",key:"p",modifier:"ctrl",keywords:["settings","configuration","config","preferences","options"],icon:()=>e.jsx(xr,{className:"action-bar-current-logo"})},{name:"Volume up",code:J.VOLUME_UP,description:"",key:"ArrowUp",modifier:"",keywords:[],icon:()=>{}},{name:"Volume down",code:J.VOLUME_DOWN,description:"",key:"ArrowDown",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:J.SKIP_PLUS,description:"",key:"ArrowRight",modifier:"",keywords:[],icon:()=>{}},{name:"Skip positive",code:J.SKIP_MINUS,description:"",key:"ArrowLeft",modifier:"",keywords:[],icon:()=>{}},{name:"Toggle color theme",code:J.TOGGLE_THEME,description:"Toggles the app dark or light theme.",key:"t",modifier:"ctrl",keywords:["dark","light","color","theme","color-theme","toggle"],icon:()=>e.jsx(As,{className:"action-bar-current-logo"})},{name:"Toggle full screen",code:J.TOGGLE_FULL_SCREEN,description:"Toggles the full screen mode.",key:"",modifier:"",keywords:["bars","wallpaper","full-screen","fft","spectrum","toggle"],icon:()=>e.jsx(Is,{className:"action-bar-current-logo"})}],Wa=new Ps(Ue,{keys:["keywords"],threshold:.3}),Se={DARK:"dark",LIGHT:"light"},Ka=({children:s})=>{const t=n.useRef([]),[o,u]=n.useState(!1),l=n.useRef(o),[r,a]=n.useState(null),[d,m]=n.useState(!1),[h,c]=n.useState(null),[p,f]=n.useState([]),[x,j]=n.useState(null),{playTrackNoQueue:b,playLibraryShuffle:O,toggleTrackPaused:k,setVolume:C,volume:M,toggleFullScreenView:I,skipAudioSeconds:F}=re(),P=n.useRef(M),R=me(),S=Ke(),V=n.useRef(null),Q=n.useRef(null),{addNotification:B,notifTypes:w}=Oe(),[D,_]=n.useState(()=>{const y=localStorage.getItem("CML_theme");return y?y===Se.LIGHT?(document.documentElement.classList.remove("dark"),Se.LIGHT):(document.documentElement.classList.add("dark"),Se.DARK):(localStorage.setItem("CML_theme",Se.LIGHT),Se.LIGHT)}),{emit:W,subscribe:Z}=fe();n.useEffect(()=>{window.addEventListener("keydown",ae),he();const y=L=>{V.current&&!V.current.contains(L.target)&&A()};return document.addEventListener("mousedown",y),document.addEventListener("touchstart",y),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("touchstart",y),window.removeEventListener("keydown",ae),t.current=[]}},[]);const ee=y=>{const L=localStorage.getItem("CML_FinishedTutorials"),$=L?JSON.parse(L):{state:{}};$.state[y]=!0,localStorage.setItem("CML_FinishedTutorials",JSON.stringify($)),W(`safe-finished-tutorial-${y}`)},ae=y=>{if(y.key=="Escape"&&l.current){A();return}if(y.key=="Escape"&&S.pathname==="/full-screen"){I();return}if(y.key=="Control"||h||!(y.ctrlKey||y.altKey||y.metaKey)&&(document.activeElement.nodeName==="INPUT"||document.activeElement.nodeName==="TEXTAREA"))return;const L=Ue.find($=>y.key===$.key?!$.modifier||$.modifier===""?!0:{ctrl:y.ctrlKey,shift:y.shiftKey,alt:y.altKey,meta:y.metaKey}[$.modifier]:!1);L&&(c(L),t.current.forEach($=>{$.code===L.code&&($.callback(y),y.preventDefault())}))},de=(y,L)=>{const $={callback:y,code:L};t.current.push($)},ge=n.useRef(k);ge.current=k;const je=()=>{$e(()=>{u(!0),a(null),f(Te()),Q.current="command",c(Ue[1])},S.pathname)()};n.useEffect(()=>{P.current=M,B(`Volume : ${(M*100).toFixed(0)} %`,w.INFO)},[M]);const he=()=>{de(()=>{if(Q.current==="command"){A();return}je()},J.OPEN_ACTION_BAR),de(()=>{A()},J.CLOSE_ACTION_BAR),de(()=>{if(Q.current==="search"){A();return}u(!0),a(J.SEARCH),Q.current="search"},J.SEARCH),de(()=>{ge.current()},J.TOGGLE_PLAY_PAUSE),de(()=>{R("/settings")},J.OPEN_SETTINGS),de(()=>{C(Math.min(Math.max(P.current+.1,0),1))},J.VOLUME_UP),de(()=>{C(Math.min(Math.max(P.current-.1,0),1))},J.VOLUME_DOWN),de(()=>{F(!0)},J.SKIP_PLUS),de(()=>{F(!1)},J.SKIP_MINUS)};n.useEffect(()=>{o&&document.getElementById("actionbar-searchbar").focus(),l.current=o},[o]),n.useEffect(()=>{switch(r){case J.SEARCH:m(!0),j(()=>e.jsx("div",{className:"action-bar-logo-container",children:e.jsx(Je,{className:"action-bar-current-logo"})}));break;default:m(!0),j(null)}},[r]);const Te=()=>[Ue[0],Ue[2],Ue[4]],H=y=>{var U;const L=y.target.value;if(L===""){f(Te());return}if(r===J.SEARCH){oe(L);return}const $=(U=Wa.search(L))==null?void 0:U.map(X=>X.item).filter(X=>{var ce;return((ce=X.keywords)==null?void 0:ce.length)>0});f($)},G=y=>{switch(y){case"track":return e.jsx(Wt,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View album"})," ",e.jsx(Dt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View artist"})," ",e.jsx(Dt,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"View genre"})," ",e.jsx(Dt,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},oe=async y=>{y===""||y.trim().length===0||fetch(`${N}/read-write/search/${y}`,{method:"GET"}).then(L=>{if(L.ok)return L.json();throw new Error("Error fetching search results")}).then(L=>{const $=[...L.tracks.map(U=>({type:"track",...U})),...L.albums.map(U=>({type:"album",...U})),...L.artists.map(U=>({type:"artist",...U})),...L.genres.map(U=>({type:"genre",...U}))].map(U=>{const X=U.path,ce=U.id,{trackPath:xe,...z}=U;return{icon:()=>X?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${U.type==="artist"?"artist":"covers"}/${X}`,alt:U.name}):e.jsx(te,{className:"action-bar-entry-logo"}),tooltip:G,code:U.type==="artist"?J.OPEN_ARTIST:U.type==="album"?J.OPEN_ALBUM:U.type==="genre"?J.OPEN_GENRE:J.PLAY_SONG,fileName:X,trackName:ce,...z}});f($)})},be=y=>{switch(y.code){case J.SEARCH:u(!0),a(J.SEARCH),c(Ue[0]),Q.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),f([]);break;case J.CLOSE_ACTION_BAR:A();break;case J.PLAY_SONG:console.log("Playing song",y),b(y.trackName),A();break;case J.OPEN_ALBUM:A(),R(`/albums/${y.id}`);break;case J.OPEN_ARTIST:A(),R(`/artists/${y.id}`);break;case J.OPEN_GENRE:console.log("Opening genre",y),A(),R(`/genres/${y.id}`);break;case J.PLAY_LIBRARY_RANDOM:B("Playing the library in shuffle",w.INFO),O(),A();break;case J.OPEN_SETTINGS:A(),R("/settings");break;case J.TOGGLE_THEME:le(),A();break;case J.TOGGLE_FULL_SCREEN:I(),A();break}},le=()=>{D===Se.DARK?(document.documentElement.classList.remove("dark"),localStorage.setItem("CML_theme",Se.LIGHT)):(document.documentElement.classList.add("dark"),localStorage.setItem("CML_theme",Se.DARK)),_(D===Se.DARK?Se.LIGHT:Se.DARK)},A=()=>{u(!1),a(null),Q.current=null,f([])},K=()=>{u(!0),a(J.SEARCH),c(Ue[0]),Q.current="search",document.getElementById("actionbar-searchbar").value="",document.getElementById("actionbar-searchbar").focus(),f([])};return n.useEffect(()=>{o&&W("action-bar-open")},[o]),e.jsx(Vs.Provider,{value:{commandCodes:J,openCommandBar:je,openSearchBar:K,colorTheme:D,toggleColorTheme:le,onTutoialFinished:ee},children:e.jsxs("div",{className:"action-bar-app-parent",children:[s,o&&e.jsx("div",{className:"global-action-bar",children:e.jsx("div",{className:"action-bar",ref:V,children:e.jsxs("div",{className:"action-bar-research",children:[x||null,e.jsx("input",{type:"text",id:"actionbar-searchbar",className:"searchbar",onChange:H,placeholder:`${h.description}`}),e.jsx("div",{className:"action-bar-results",children:e.jsx(Le,{height:300,itemCount:p.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:y,style:L})=>e.jsx(Nt,{entry:p[y],style:{...L,width:" calc(100% - 20px)",marginTop:"10px"},onClick:be},y)})})]})})})]})})},kt=()=>{const s=n.useContext(Vs);if(!s)throw new Error("useGlobalActionBar must be used within a GlobalActionBar provider");return s},Ja=({onClosed:s,hideComponent:t})=>{const{setVolume:o,volume:u}=re(),l=n.useRef(null),{subscribe:r}=fe();return n.useEffect(()=>{const a=m=>{var h;if(l.current&&!l.current.contains(m.target)){if(((h=m.target.closest("svg"))==null?void 0:h.id)==="volume-button")return;t()}},d=r("action-bar-open",()=>{t()});return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),()=>{d(),document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}},[]),e.jsx("div",{ref:l,className:"volume-bar",children:e.jsx(it,{onClickPercentage:a=>{console.log("change volume"),o(a/100)},style:{height:"10px"},fillColor:"rgb(118, 173, 206)",percent:u*100})})},Qa=({percent:s,size:t=120,strokeWidth:o=10,useText:u=!0,style:l,color:r="rgb(130, 119, 196)"})=>{const a=(t-o)/2,d=2*Math.PI*a,m=d*(1-s);return e.jsxs("div",{className:"radial-container",style:{width:t,height:t,...l},children:[e.jsxs("svg",{width:t,height:t,children:[e.jsx("circle",{className:"radial-bg",stroke:"#e6e6e6",strokeWidth:o,fill:"none",cx:t/2,cy:t/2,r:a}),e.jsx("circle",{className:"radial-progress",stroke:r,strokeWidth:o,fill:"none",cx:t/2,cy:t/2,r:a,strokeDasharray:d,strokeDashoffset:m})]}),e.jsx("div",{className:"radial-label",children:u&&e.jsxs("span",{children:[Math.round(s),"%"]})})]})},Ya=({fps:s=45})=>{const t=n.useRef(),o=n.useRef(null),{getFFTAtCurrentTime:u,fftConfigRef:l,globalAudioRef:r,FFTUserSetingsRef:a,fetchFFTUserSettings:d,colorOverride:m,currentTrackData:h}=re(),c=n.useRef(0),p=n.useRef(!1),f=x=>{var b;if((h==null?void 0:h.type)=="radio"||p.current){cancelAnimationFrame(t.current);return}if(!o.current){t.current=requestAnimationFrame(f);return}const j=o.current.getContext("2d");if(j&&a.current){if(x-c.current<1e3/s){t.current=requestAnimationFrame(f);return}c.current=x;const O=5;j.clearRect(0,0,o.current.width,o.current.height);const k=u();if(!k){t.current=requestAnimationFrame(f);return}let C=k.subarray(Math.floor(k.length*.3),Math.floor(k.length*.6));const M=Math.max(1,C.length/O),I=new Array(O);I.fill(0);for(let R=0;R<C.length;R++)I[Math.floor(R/M)]+=Number(k[R]);let F=o.current.width/O-5,P=0;j.strokeStyle="#ffffff",j.fillStyle="#ffffff";for(let R=0;R<I.length;R++){const S=aa(Math.log2(I[R])*(O/5),5,25,0,1),V=Math.max(10,Math.min(80*S*((b=r.current)==null?void 0:b.volume),o.current.height-10));j.beginPath(),j.roundRect(2+P,(o.current.height-V)/2,F,V,7),j.fill(),j.stroke(),P+=F+5}}t.current=requestAnimationFrame(f)};return n.useEffect(()=>{if(!l.current){cancelAnimationFrame(t.current),console.log("No FFT data to display, releasing anim frame.");return}t.current=requestAnimationFrame(f),console.log("FFT found, requested animation frame.")},[l.current]),n.useEffect(()=>{const x=window.matchMedia("(max-width: 714px)"),j=b=>{p.current=b.matches,t.current=requestAnimationFrame(f),console.log("Canvas hidden?",p.current)};return j(x),x.addEventListener("change",j),()=>{x.removeEventListener("change",j)}},[]),e.jsx("canvas",{ref:o,id:"fft-canvas-small",className:"in-song-header",width:50,height:50})},Lt=({useText:s=!1,style:t={},className:o=""})=>{const u=n.useRef(null),{colorTheme:l,toggleColorTheme:r}=kt();return n.useEffect(()=>{u.current.setAttribute("data-color-theme",l)},[l]),e.jsxs("div",{style:t,className:`color-theme-btn ${o}`,children:[e.jsx(As,{id:"color-theme-svg",ref:u,className:"buttonRound",onClick:r}),s&&e.jsx("span",{children:ca(l.toString())})]})},$t=()=>{const[s,t]=n.useState(!1),[o,u]=n.useState(!1),[l,r]=n.useState(!1),[a,d]=n.useState(!1),[m,h]=n.useState(!1),[c,p]=n.useState({col1:"#000",col2:"#000"}),{currentTrackData:f,trackCoverUrl:x,volume:j,toggleFullScreenView:b,toggleCurrentRadioToFavorites:O}=re(),{openSearchBar:k}=kt(),[C,M]=n.useState(!1),[I,F]=n.useState(null),[P,R]=n.useState(null),S=me(),{subscribe:V}=fe();n.useRef(null);const[Q,B]=n.useState(Ke().pathname==="/admin-pannel"),w=()=>{r(!0)};n.useEffect(()=>{const ae=V("openAddMusic",w);return()=>{ae()}},[]);const D=()=>{r(!1),R(null),F(null)};function _(){d(!a)}function W(){h(!m)}n.useEffect(()=>{const ae=[{col1:"#ffa585",col2:"#ffeda0"},{col1:"#9bf8f4",col2:"#6f7bf7"}];p(ae[Math.floor(Math.random()*ae.length)])},[]);const Z=()=>{},ee=()=>{if(!I){l?(D(),console.log("deactivate")):(w(),console.log("activate"));return}M(document.getElementsByClassName("addMusicContainer")[0]==null),console.log("toggle")};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header__logo",onClick:()=>S("/home"),children:[e.jsx(te,{col1:c.col1,col2:c.col2}),e.jsx("h1",{children:"CML"})]}),e.jsx(zt,{context:"desktop"}),e.jsxs("div",{className:"musicPlayer",children:[e.jsxs("div",{className:"playPauseContainer",children:[(f==null?void 0:f.type)=="radio"?f.coverUrl==""?e.jsx(te,{className:"trackImage"}):e.jsx("img",{src:f.coverUrl,className:"trackImage"}):x.split("/").pop()==="null"?e.jsx(te,{className:"trackImage"}):e.jsx("img",{src:x,className:"trackImage"}),e.jsx("div",{className:"playPauseButtons",onClick:b,children:e.jsx(Is,{style:{padding:"0px"}})})]}),!f||Object.keys(f).length===0?null:e.jsxs("div",{className:"trackinfos-parent",children:[e.jsxs("div",{className:"trackinfo-desktop",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx("span",{id:"songArtist",className:"artist-name",style:{fontSize:"13px"},onClick:()=>{(f==null?void 0:f.type)!="radio"&&S(`/artists/${f.artistId}`)},children:f.artist}),e.jsx(ya,{})]}),(f==null?void 0:f.type)==="radio"?e.jsx(xt,{id:"add-radio-fav",iconHovered:vr,iconDefault:Jt,onClick:O}):e.jsx(Ya,{}),e.jsxs("div",{className:"trackinfo-mobile",children:[e.jsx("span",{id:"songTitle",children:f.title}),e.jsx(zt,{context:"mobile"})]})]})]}),e.jsxs("div",{className:"mobile-gost",children:[e.jsx(jr,{id:"playlist-button",className:"buttonRound",onClick:()=>_()}),a&&e.jsx(Oa,{hideComponent:()=>d(!1)}),j<=1e-5?e.jsx(br,{className:"buttonRound",onClick:()=>W()}):j<.5?e.jsx(yr,{className:"buttonRound",onClick:()=>W()}):e.jsx(Nr,{id:"volume-button",className:"buttonRound",onClick:()=>W()}),m&&e.jsx(Ja,{hideComponent:()=>h(!1)}),e.jsx(Lt,{})]}),e.jsxs("div",{className:"headerRight",children:[e.jsx(Lt,{className:"desktop-ghost"}),!Q&&e.jsxs("div",{className:"serach-button-div",onClick:k,children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"K"})}),e.jsx(Je,{})]}),e.jsxs("div",{style:{position:"relative",padding:"5px",display:"flex",justifyContent:"center"},className:"upload-music-header",children:[P&&e.jsx(Qa,{percent:P,size:44,useText:!1,style:{position:"absolute",transform:"translate(-1px, -5.5px)"}}),e.jsx(Qt,{style:{zIndex:"10",position:"relative"},className:"addMusicButton buttonRound",onClick:ee}),I&&e.jsxs("span",{style:{position:"absolute",bottom:"-30px",padding:"2px 7px",borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 0.7)",textAlign:"center"},children:[I.done,"/",I.total]})]}),e.jsx(ra,{})]}),l&&e.jsx(Ia,{uploadPercent:R,uploadFinished:Z,uploadProgress:F,isMinimize:C,setMinimized:M,closeOverlay:D})]})},Xa=()=>{const[s,t]=n.useState(null),[o,u]=n.useState(null),[l,r]=n.useState(null),[a,d]=n.useState(null);n.useEffect(()=>{const c=setInterval(m,5e3);return m(),()=>clearInterval(c)},[]);const m=()=>{try{fetch(`${N}/isResponding`).then(c=>{c.status===200?(a===!1&&h(),d(!0)):d(!1)}).catch(c=>{console.error("Fetch failed (e.g., CORS error):",c),d(!1)})}catch(c){console.error("Unexpected error:",c),d(!1)}},h=()=>{fetch(`${N}/read-write/stats`,{method:"GET"}).then(c=>c.json()).then(c=>{t(c)}).catch(c=>console.error("Error fetching stats:",c)),fetch(`${N}/read-write/serverStats`,{method:"GET"}).then(c=>c.json()).then(c=>{u(Vt(c.coversByteUsage+c.tracksByteUsage).readable),r({perent:(1-c.free/c.size)*100,total:Vt(c.size).readable,free:Vt(c.free).readable})}).catch(c=>console.error("Error fetching server stats:",c))};return n.useEffect(()=>{h()},[]),e.jsxs("div",{className:"stat-short",children:[e.jsxs("div",{className:"stat-short-category",children:[e.jsxs("p",{children:["Library size: ",o]}),e.jsxs("p",{children:["Free ",l==null?void 0:l.free," of ",l==null?void 0:l.total]}),e.jsx(it,{percent:(l==null?void 0:l.perent)||0,total:l==null?void 0:l.total,style:{height:"10px"},fillColor:"var(--chill-purple)",initialising:!o})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"5px"},children:[e.jsx("div",{className:"server-status-sprite",style:{width:"10px",height:"10px",borderRadius:"10px",backgroundColor:a?"lightgreen":"red"}}),e.jsxs("p",{children:["Server is ",a?"online":"offline"]})]})]})},Za=()=>{const{openCommandBar:s}=kt();return e.jsxs("div",{className:"sidebar",children:[e.jsxs("nav",{children:[e.jsxs(tt,{id:"nav-recent",to:"/home",children:[e.jsx(kr,{}),"Recent"]}),e.jsxs(tt,{to:"/playlists",children:[e.jsx(Sr,{}),"Playlists"]}),e.jsxs(tt,{to:"/artists",children:[e.jsx(wr,{}),"Artists"]}),e.jsxs(tt,{to:"/genres",children:[e.jsx(Tr,{}),"Genres"]}),e.jsxs(tt,{to:"/cooking",children:[e.jsx(rt,{}),"Cooking"]}),e.jsxs(tt,{to:"/radio",children:[e.jsx(Er,{}),"Radio"]})]}),e.jsx(Xa,{}),e.jsxs("div",{className:"serach-button-div",onClick:s,style:{margin:"auto",marginBottom:"20px"},children:[e.jsx("div",{className:"keyboard-key",children:e.jsx("span",{children:"CTRL"})}),e.jsx("span",{children:"+"}),e.jsx("div",{className:"keyboard-key",style:{marginRight:"auto"},children:e.jsx("span",{children:"SPACE"})}),e.jsx(Cr,{})]})]})},eo=()=>{const s=me(),[t,o]=n.useState(!1);if(n.useEffect(()=>{(async()=>{if((await(await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"})).json()).success){o(!1);return}s("/")})()},[s]),t)return e.jsx(bt,{});const l=Ke().pathname,r=["/home"];return e.jsxs("div",{className:"app-container",children:[e.jsx($t,{}),e.jsxs("div",{className:"content-container",page:r.includes(l)?l:"inside",children:[e.jsx(Za,{}),e.jsxs("div",{className:"content",children:[e.jsx(ks,{})," "]})]})]})},ss=({album:s,hideArtist:t=!1})=>{const o=me(),[u,l]=n.useState([]),r=a=>{o(`/albums/${a}`)};return n.useEffect(()=>{s.artists&&l(JSON.parse(s.artists).map(a=>a.name))},[s]),e.jsxs("div",{className:"album-card",onClick:()=>r(s.id),children:[s.cover?e.jsx("img",{src:`${N}/covers/${s.cover}`,alt:`${Be(s.title,25)} cover`,className:"album-card-cover"}):e.jsx(te,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Be(s.title,40)}),!t&&e.jsx("p",{className:"album-artist",children:Be(u.toString().replace(/,/g,", "),25)||"No artist"})]})},ns=()=>{const{emit:s}=fe(),t=()=>{s("openAddMusic")};return e.jsxs("div",{className:"add-music-shortcut",children:[e.jsx("h2",{children:"Welcome to the Crystal Music Library !"}),e.jsxs("button",{onClick:t,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"15px",margin:"auto"},children:[e.jsx(Qt,{}),e.jsx("h3",{style:{margin:"2px"},children:"Add music"})]})]})},to=({})=>{const[s,t]=n.useState([]),[o,u]=n.useState(!1),{subscribe:l}=fe(),r=()=>{fetch(`${N}/read-write/albums`,{method:"GET",credentials:"include"}).then(d=>{if(d.status!==200){console.error("Error fetching albums");return}return d.json()}).then(d=>{t(d),u(!0)})};n.useEffect(()=>{$e(()=>{r()})();const m=l("musicUploaded",r);return()=>{m()}},[]);const a=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]});return e.jsx("div",{className:"home album-displayer","data-no-tracks":(s==null?void 0:s.length)==0&&o?"true":"false",children:o?(s==null?void 0:s.length)!==0?s.map(d=>e.jsx(ss,{album:d},d.id)):e.jsx(ns,{}):e.jsx(a,{})})},so=()=>e.jsx("p",{children:" Your albums"}),Re={FETCHING:"fetching",SUCCESS:"success",REJECTED:"rejected",NONE:"none"},no=()=>{const s=n.useRef(Re.NONE),[t,o]=n.useState(Re.NONE),u=me(),{emit:l}=fe(),r=async m=>{if(m.preventDefault(),!m.target.email.value||!m.target.password.value){alert("Please fill in all fields");return}const h=new FormData(m.target),c=await fetch(`${N}/auth/login`,{method:"POST",credentials:"include",body:h}),p=await c.json();c.ok?(localStorage.setItem("username",p.username),s.current=Re.SUCCESS):s.current=Re.REJECTED,d()},a=()=>{switch(t){case Re.FETCHING:return e.jsx(Ms,{});case Re.SUCCESS:return e.jsxs("div",{className:"loginFeedback",sucess:"true",children:[e.jsx(at,{className:"successIcon"}),e.jsx("span",{children:"Logged in"})]});case Re.REJECTED:return e.jsxs("div",{className:"loginFeedback",sucess:"false",children:[e.jsx(pe,{className:"failIcon"}),e.jsx("span",{children:"Wrong credentials"})]});default:return null}},d=()=>{switch(o(s.current),s.current){case Re.REJECTED:setTimeout(()=>{o(Re.NONE)},1e3);break;case Re.SUCCESS:setTimeout(()=>{l("login"),u("/home")},1e3);break}};return e.jsxs("div",{className:"authDiv",children:[e.jsx(Lt,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(te,{}),e.jsx("h2",{children:"Login"}),e.jsx("p",{children:"We were not able to connect you, please login."}),e.jsxs("form",{onSubmit:r,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"password"}),e.jsx("button",{type:"submit",children:"Login "}),e.jsx("p",{children:"Don't have an account?"}),e.jsx("button",{onClick:()=>{u("/register")},children:"Register"})]}),e.jsx(a,{})]})},ro=[Me("#f8be99"),Me("#f495e9"),Me("#bbfbdf"),Me("#c4d3f8"),Me("#edc9f9"),Me("#909ef8"),Me("#96ebf4")],Ft=60,pt=Me("#242424"),Hs=()=>{const[s,t]=n.useState([pt,pt]),o=n.useRef([]),u=n.useRef([pt,pt]),l=n.useRef(ro),r=n.useRef(0),a=n.useRef(0);n.useEffect(()=>(a.current=setInterval(m,1e3/Ft),()=>{clearInterval(a.current)}),[]);const d=()=>{const h=gt.sample(l.current);return l.current.filter(c=>c.join(",")!=h.join(",")),h},m=()=>{r.current%Ft===0&&(o.current[0]&&o.current[0]!==pt&&l.current.push(...o.current),o.current=u.current,u.current=[d(),d()]),t(o.current.map((h,c)=>u.current[c].map((p,f)=>parseInt(We(h[f],p,r.current%Ft/Ft))))),r.current+=1};return e.jsx("div",{id:"background-img",style:{"--col1":ps(...s[0]),"--col2":ps(...s[1])}})},st=Object.freeze({LOGIN:"login",REGISTER:"register",ANY_USER:"any_user",VERIF_TOKEN:"verif_token"}),ao=()=>{const s=me(),[t,o]=n.useState([]),[u,l]=n.useState(null),[r,a]=n.useState(!0);return n.useRef(null),n.useEffect(()=>{(async()=>{l(st.ANY_USER);const h=await(await fetch(`${N}/auth/any-user`,{method:"GET"})).json();if(console.log("Parsed users",h),o(h),console.log(h),h===0){a(!1),l(st.REGISTER);return}l(st.VERIF_TOKEN);const p=await(await fetch(`${N}/auth/verifyToken`,{method:"POST",credentials:"include"})).json();if(a(!1),p.success){console.log("Token is valid"),s("/home");return}l(st.LOGIN)})()},[s]),u===st.REGISTER&&!r&&s("/register"),e.jsxs(e.Fragment,{children:[e.jsx(Hs,{}),!r&&u===st.LOGIN?e.jsx(no,{}):null]})},zs=({index:s,track:t,playIconId:o,isSalad:u=null,onClick:l,showCover:r=!1})=>{const{title:a,track_number:d,rawDuration:m}=t,{playingTrack:h,openTrackActions:c}=re(),p=t.id,[f,x]=n.useState("null"),[j,b]=n.useState(!1),[O,k]=n.useState(!1),C=()=>{if(u){u(s);return}l(t.id)},M=()=>{switch(o){case 0:return e.jsx(Fr,{className:"track-number",playing:"piano","data-show-cover":r});case 1:return e.jsx(Ir,{className:"track-number",playing:"vinyl","data-show-cover":r});case 2:return e.jsx(Ar,{className:"track-number",playing:"piano","data-show-cover":r});case"salad":return e.jsx(rt,{className:"track-number",playing:"piano","data-show-cover":r})}};n.useEffect(()=>{b(t.is_favorite===1),r&&fetch(`${N}/read-write/trackCover/${t.id}`,{method:"GET"}).then(S=>S.json()).then(S=>{x(`${N}/covers/${S}`)})},[]);const I=S=>{S.stopPropagation(),fetch(`${N}/read-write/toggleFavorite/${t.id}/${!j}`,{method:"GET",credentials:"include"}).then(V=>V.json()).then(V=>{b(V)})},F=()=>{k(!1)},P=S=>{S.stopPropagation(),k(!0),c({x:S.clientX,y:S.clientY},t,F,R)},R=S=>{b(S)};return e.jsxs("div",{className:"track-view","action-bar":O?"open":"",onClick:C,children:[j&&e.jsx(Jt,{className:"track-favorite"}),e.jsx(xt,{className:"track-toggle-favorite",iconHovered:j?Ht:Rr,iconDefault:j?Ht:ws,onClick:I}),r?f.split("/").pop()==="null"?null:e.jsx("img",{src:f,className:"track-mini-thumbnail"}):null,h===p?M():r?null:e.jsx("p",{className:"track-number",children:d}),e.jsx("p",{className:"track-name",style:{"--margin":r?"45px":"35px"},children:a}),e.jsx(Rs,{className:"track-actions-dots",onClick:P}),e.jsx("p",{className:"track-length",children:Zt(m).readable})]})},bs=({isPlaylist:s=!1})=>{const[t,o]=n.useState(null),[u,l]=n.useState([]),[r,a]=n.useState([]),[d,m]=n.useState([]),[h,c]=n.useState(0),{addContainerToQueue:p,playContainerSuffle:f,editAlbum:x,editPlaylist:j,linkNewContainer:b,getNextSongsFromAlbum:O,navigateBack:k}=re(),C=n.useRef(null),M=me(),[I,F]=n.useState([]),P=s?Pt().playlistId:Pt().albumId,[R,S]=n.useState(null),V=n.useRef(null),{notifTypes:Q,addNotification:B}=Oe(),[w,D]=n.useState(!1),[_,W]=n.useState(!1),[Z,ee]=n.useState(!1);n.useEffect(()=>{ae()},[P,_]),n.useEffect(()=>{b({id:P,type:s?"playlist":"album",favPlaylist:w},ae)},[w]);const ae=()=>{fetch(`${N}/read-write/${s?"playlist":"album"}/${P}`,{method:"GET",credentials:"include"}).then(A=>{if(!A.ok)throw new Error("Network response was not ok");return A.json()}).then(A=>{c(Math.floor(Math.random()*3));const K=A.tracks.filter(L=>(!Z&&L.is_favorite===1&&ee(!0),_?L.is_favorite===1:!0));if(s){o(A.playlistInfos),l(K),m([A.owner,...A.collaborators]),D(A.isFavPlaylist);return}o(A.albumInfos);let y=0;for(let L=0;L<K.length;L++){const $=K[L];$.disc>y&&(K.splice(L,0,{disc:$.disc,type:"disc"}),y=$.disc)}l(K),a(A.genres),m(A.artists),D(!1)})},de=async()=>await p(P,s?"playlist":"album",_),ge=async()=>{f(P,s?"playlist":"album",_)},je=()=>{if(s){j(P);return}x(P)},he={TRACK:"track",ALBUM:"album",ARTIST:"artist",PLAYLIST:"playlist",GENRE:"genre"},Te=A=>{switch(A){case"track":return e.jsx(Qt,{className:"action-bar-entry-tooltip-logo"});case"album":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add album"})," ",e.jsx(yt,{className:"action-bar-entry-tooltip-logo"})]});case"artist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add artist's discography"})," ",e.jsx(Mr,{className:"action-bar-entry-tooltip-logo"})]});case"playlist":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire playlist"})," ",e.jsx(Or,{className:"action-bar-entry-tooltip-logo"})]});case"genre":return e.jsxs("div",{className:"action-tooltip-div",children:[" ",e.jsx("span",{style:{margin:"0"},children:"Add entire genre"})," ",e.jsx($r,{className:"action-bar-entry-tooltip-logo"})]});default:return null}},H=A=>{const K=A.target.value;if(K===""||K.trim().length===0){F([]);return}console.log(`${N}/read-write/search/${K}`),fetch(`${N}/read-write/search/${K}`,{method:"GET"}).then(y=>{if(y.ok)return y.json();throw new Error("Error fetching search results")}).then(y=>{var $,U,X,ce,xe;const L=[...($=y.tracks)==null?void 0:$.map(z=>({type:"track",...z})),...(U=y.albums)==null?void 0:U.map(z=>({type:"album",...z})),...(X=y.artists)==null?void 0:X.map(z=>({type:"artist",...z})),...(ce=y.genres)==null?void 0:ce.map(z=>({type:"genre",...z})),...(xe=y.playlists)==null?void 0:xe.map(z=>({type:"playlist",...z})).filter(({id:z})=>z!==P)].map(z=>{const ve=z.path,{trackPath:Ye,...Ge}=z;return{icon:()=>ve?e.jsx("img",{className:"action-bar-entry-logo",src:`${N}/${z.type==="artist"?"artist":"covers"}/${ve}`,alt:z.name}):e.jsx(te,{className:"action-bar-entry-logo"}),tooltip:Te,code:z.type==="artist"?he.ARTIST:z.type==="album"?he.ALBUM:z.type==="genre"?he.GENRE:z.type==="playlist"?he.PLAYLIST:he.TRACK,fileName:ve,...Ge}});console.log(L),F(L)})},G=A=>{R||setTimeout(()=>{requestAnimationFrame(()=>{var K;(K=V.current)==null||K.focus()})},0)},oe=A=>{const K=new FormData;K.append("addRequest",JSON.stringify({playlistId:P,endpoint:A.code,entryId:A.id,addAllToFavorite:w||!1})),fetch(`${N}/read-write/addToPlaylist`,{method:"POST",credentials:"include",body:K}).then(y=>y.json()).then(y=>{ae(),be(),B("Added to playlist",Q.INFO)})};n.useEffect(()=>{const A=K=>{C.current&&!C.current.contains(K.target)&&be()};return document.addEventListener("mousedown",A),document.addEventListener("touchstart",A),()=>{document.removeEventListener("mousedown",A),document.removeEventListener("touchstart",A)}},[]);const be=()=>{S(!1),V.current.value="",F([])},le=A=>{O(A,_)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:k,children:e.jsx(Qe,{})}),(t==null?void 0:t.cover)&&e.jsx("img",{src:`${N}/covers/${t.cover}`,className:"background-image",alt:"background"}),t&&u?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:t.title}),e.jsx("div",{className:"album-artists",children:d?d.map(A=>e.jsx("span",{className:"artist-name",onClick:()=>{M(`/${s?"users":"artists"}/${A.id}`)},children:A.name},A.id)):e.jsxs("span",{className:"artist-name",children:["Unknown ",s?"Members":"Artist"]})}),e.jsxs("div",{className:"album-content",children:[e.jsx("div",{className:"album-cover-genres",children:e.jsxs("div",{className:"album-cover-wrapper",children:[t.cover?e.jsx("img",{src:`${N}/covers/${t.cover}`,alt:`${t.title} cover`,className:"cover-image"}):e.jsx(te,{className:"cover-image"}),e.jsx("div",{className:"genres-album-div",children:r.map((A,K)=>e.jsx("span",{className:"genre-album",onClick:()=>{M(`/genres/${A.genreId}`)},children:A.genreName},K))}),t.description&&e.jsx("p",{children:t.description})]})}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(ne,{text:"Add to queue",icon:e.jsx(Yt,{}),onClick:de}),e.jsx(ne,{text:"Random",icon:e.jsx(ct,{}),onClick:ge}),!w&&e.jsx("button",{className:"button-with-callback",onClick:je,children:e.jsx(Kt,{})}),!w&&Z&&e.jsx("button",{className:"button-with-callback","data-is-active":_,onClick:()=>{W(!_)},children:e.jsx(Pr,{})}),t.lossless===1&&e.jsxs("div",{className:"lossless",children:[e.jsx("span",{children:"Lossless"})," ",e.jsx(Lr,{})]})]}),s&&e.jsx("div",{className:"action-bar","is-playlist-add":"true",ref:C,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",onClick:G,children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Je,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:H,placeholder:"Search for tracks, artists, genres, playlists to add.",ref:V,onFocus:()=>{S(!0)}}),e.jsx("div",{className:"action-bar-results",style:{display:`${R?"block":"none"}`},children:e.jsx(Le,{height:300,itemCount:I.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:A,style:K})=>e.jsx(Nt,{entry:I[A],style:{...K,width:" calc(100% - 20px)",marginTop:"10px"},onClick:oe},A)})})]})}),u.map((A,K)=>(A==null?void 0:A.type)==="disc"?e.jsx("span",{children:`Disc ${A.disc}`},`disc-${K}`):e.jsx(zs,{track:A,onClick:le,playIconId:h,showCover:s},A.id))]})]})]}):e.jsx(bt,{text:"Loading album"})]})},oo=({artist:s})=>{const t=me(),o=u=>{t(`/artists/${u}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>o(s.id),children:[s.picture?e.jsx("img",{src:`${N}/covers/artists/${s.picture}`,alt:`${s.name} cover`,className:"artist-card-cover"}):e.jsx(te,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:s.name})]})},co=()=>{const[s,t]=n.useState([]),{subscribe:o}=fe(),u=()=>{fetch(`${N}/read-write/artists`,{method:"GET",credentials:"include"}).then(l=>{if(l.status!==200){console.error("Error fetching artists");return}return l.json()}).then(l=>{t(l)})};return n.useEffect(()=>{$e(()=>{u()})();const r=o("musicUploaded",u);return()=>{r()}},[]),e.jsx("div",{className:`home ${(s==null?void 0:s.length)!==0?"album-displayer":""}`,children:(s==null?void 0:s.length)!==0?s.map(l=>e.jsx(oo,{artist:l},l.id)):e.jsx(ns,{})})},io=()=>{const[s,t]=n.useState(null),[o,u]=n.useState([]),{addArtistToQueue:l,shuffleArtistToQueue:r,editArtist:a,linkNewContainer:d,navigateBack:m}=re(),h=Pt().artistId;n.useEffect(()=>{c(),d({id:h,type:"artist"},c)},[h]);const c=()=>{fetch(`${N}/read-write/artist/${h}`,{method:"GET",credentials:"include"}).then(x=>{if(!x.ok)throw new Error("Network response was not ok");return x.json()}).then(x=>{t(x.artistInfos),u(x.albums),console.log(x.artistInfos)})},p=async()=>await l(h),f=async()=>{r(h,!1)};return e.jsxs("div",{className:"album-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:m,children:e.jsx(Qe,{})}),s&&o?e.jsxs("div",{className:"album-details",children:[e.jsx("h1",{children:s.name}),e.jsxs("div",{className:"album-content",children:[s.picture?e.jsx("img",{src:`${N}/covers/artists/${s.picture}`,alt:`${s.name} cover`,className:"cover-image"}):e.jsx(te,{className:"cover-image"}),e.jsxs("div",{className:"track-list",children:[e.jsxs("div",{className:"track-list-header",children:[e.jsx(ne,{text:"Add to queue",icon:e.jsx(Yt,{}),onClick:p}),e.jsx(ne,{text:"Random",icon:e.jsx(ct,{}),onClick:f}),e.jsx(ne,{icon:e.jsx(Kt,{}),onClick:async()=>{a(s.id)}})]}),e.jsx("div",{className:"album-displayer",children:o.map(x=>e.jsx(ss,{album:x,hideArtist:!0},x.id))})]})]})]}):e.jsx(bt,{text:"Loading artist"})]})},lo=()=>{const s=me(),t=()=>{s("/home")};return e.jsxs("div",{className:"not-found",children:[e.jsx("h1",{children:"Where did you land..?"}),e.jsx("p",{children:"The adress you gave is not defined, but you can go back to library:"}),e.jsx("button",{className:"btn",onClick:t,children:"Go back to library"})]})},uo=()=>{const[s,t]=n.useState("");n.useEffect(()=>{t(localStorage.getItem("username"))},[]);const o=me();return e.jsxs("div",{className:"account-page",children:[e.jsx($t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Qe,{})}),e.jsxs("div",{className:"account-container",children:[e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:s}),e.jsx("p",{children:"Account information will be displayed here."})]}),e.jsx(te,{})]})]})]})},mo=({active:s,setActive:t})=>e.jsx("div",{className:"toggle-button","data-is-active":s,onClick:o=>{o.stopPropagation(),t(!s)},children:e.jsx("div",{className:"toggle-button-active","data-is-active":s})}),_e=({stateChanged:s,min:t=0,max:o=0,ref:u})=>{const l=t===o&&o===0,r=d=>{const m=d.target.value;s(m)},a=d=>{console.log("blur");let m=parseFloat(d.target.value);isNaN(m)&&(m=t),l||(m=Math.min(o,Math.max(t,m))),d.target.value=m,s(m)};return l?e.jsx("input",{ref:u,type:"number",onBlur:a,onChange:r}):e.jsx("input",{min:t,ref:u,max:o,type:"number",onBlur:a,onChange:r})},ho=()=>{var j;const s=n.useRef(null),t=n.useRef(null),o=n.useRef(null),u=n.useRef(null),l=n.useRef(null),{FFTUserSetingsRef:r,fftConfigRef:a}=re(),d=b=>{r.current.bars=Math.floor(b),f()},m=b=>{r.current.cutoff=parseFloat(b),f()},h=b=>{r.current.scale=parseFloat(b),f()},c=b=>{r.current.contrast=parseFloat(b),f()},p=b=>{r.current.FPS=parseFloat(b),f()},f=()=>{const b=new FormData;b.append("FFT",JSON.stringify(r.current)),fetch(`${N}/config/user/send/FFT`,{method:"POST",credentials:"include",body:b})},x=async()=>{await fetch(`${N}/config/user/FFT`,{method:"GET",credentials:"include"}).then(b=>b.json()).then(b=>{r.current=b,s.current.value=r.current.bars,u.current.value=r.current.contrast,t.current.value=r.current.scale,l.current.value=r.current.cutoff,o.current.value=r.current.FPS})};return n.useEffect(()=>{x()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Number of bars"}),e.jsx(_e,{ref:s,stateChanged:d,min:1,max:(j=a.current)==null?void 0:j.fftSize})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"FPS (High number may cause strong battery usage)"}),e.jsx(_e,{ref:o,stateChanged:p})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Scale"}),e.jsx(_e,{ref:t,stateChanged:h})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Contrast"}),e.jsx(_e,{ref:u,stateChanged:c})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":!0,children:[e.jsx("span",{children:"Cutoff"}),e.jsx(_e,{ref:l,stateChanged:m})]})]})},fo={FFT:ho},po=({entryName:s,entryIcon:t,linkedSettingKey:o})=>{const[u,l]=n.useState(!1),r=n.useMemo(()=>fo[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":u,onClick:a=>{a.stopPropagation(),l(!u)},children:[t,e.jsx("span",{children:s})]}),e.jsx("div",{className:"admin-setting-content",children:r&&u&&e.jsx(r,{})})]})},go=()=>{const[s,t]=n.useState(!1);n.useEffect(()=>{$e(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(l=>l.json()).then(l=>{t(l)})})()},[]);const o=me();return e.jsxs("div",{className:"account-page",children:[e.jsx($t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>o("/home"),children:e.jsx(Qe,{})}),e.jsxs("div",{className:"account-info",children:[e.jsx("h1",{children:"Settings page"}),e.jsx("p",{children:"A shinny list of fancy settings."}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(po,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Fs,{})})})]})]})]})},xo=({user:s,totalStorage:t})=>{const[o,u]=n.useState(0);return n.useEffect(()=>{fetch(`${N}/read-write/user-data-usage/${s.id}`,{method:"GET",credentials:"include"}).then(l=>l.json()).then(l=>{u(l)}).catch(l=>{console.error("Error fetching user storage data: ",l)})},[]),e.jsxs("div",{className:"user-account-infos-entry",children:[e.jsx("p",{children:s.username}),e.jsx("p",{children:s.email}),e.jsx("p",{children:s.role}),e.jsx(it,{percent:Number(o/t*100).toFixed(2),fillColor:"var(--cool-green)",showPercent:!0,style:{maxWidth:"200px"}})]})},qe={PENDING:"pending",RUNNING:"running",PAUSED:"paused",INACTIVE:"inactive"},ys=({jobName:s,description:t,jobKey:o,payload:u={},doneTotalView:l=null})=>{const[r,a]=n.useState(!1),[d,m]=n.useState(!0),[h,c]=n.useState(0),[p,f]=n.useState(!1),[x,j]=n.useState(null),b=n.useRef(null),O=(S=!0,V="",Q=0)=>{var B=S;fetch(`${N}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(w=>w.json()).then(w=>{f(!1);let D=1e3;switch(w.status){case qe.PENDING:f(!0),a(!0),m(!1),D=500;break;case qe.INACTIVE:if(V===qe.RUNNING||V===qe.PENDING){setTimeout(()=>{a(!1),c(0),j(null),O(!1,w.status)},2e3),c(100),j({done:Q,total:Q,working:0}),B=!1,console.log("Stop fast fetch job");return}a(!1);break;case qe.PAUSED:m(!0),a(!0),D=500;break;case qe.RUNNING:m(!1),a(!0),D=10;break}b.current&&(clearTimeout(b.current),b.current=null),B&&(b.current=setTimeout(()=>{var _;if(w.progress){const W=w.progress.done/w.progress.total*100;c(W),j(w.progress)}else j(null);O(!0,w.status,((_=w.progress)==null?void 0:_.total)??0)},D))})},k=()=>{fetch(`${N}/jobs/status/${o}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{O(S.status===qe.RUNNING)})},C=()=>{const S=new FormData;S.append("payload",JSON.stringify(u)),fetch(`${N}/jobs/run/${o}`,{method:"POST",credentials:"include",body:S}).then(V=>V.json()).then(V=>{O(!0)})},M=()=>{fetch(`${N}/jobs/pause/${o}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{O(!1)})},I=()=>{fetch(`${N}/jobs/resume/${o}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{O(!0)})},F=()=>{fetch(`${N}/jobs/stop/${o}`,{method:"GET",credentials:"include"}).then(S=>S.json()).then(S=>{O(!1)})};n.useEffect(()=>(k(),()=>{b.current&&(console.log("Trying clearTimout"),clearTimeout(b.current),b.current=null)}),[]);const P=async()=>{if(r){d?I():M(),m(!d);return}C()},R=async()=>{F(),c(0)};return e.jsxs("div",{className:"backend-job",children:[e.jsx("h3",{children:s}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"baseline",flexWrap:"wrap"},children:[e.jsx(ne,{text:r?d?"Resume":"Pause":"Run",icon:r?d?e.jsx(Ur,{}):e.jsx(_r,{}):e.jsx(Br,{}),onClick:P}),e.jsx(ne,{text:"Stop",icon:e.jsx(Gr,{}),onClick:R}),e.jsx(it,{style:{height:"25px",filter:`grayscale(${d&&r?.8:0})`},minWidth:"200px",percent:h,showPercent:!1,text:x?l.current?`${x.done}/${x.total}`:`Working: ${x.working} | Left : ${x.total-x.done}`:null,fillColor:"linear-gradient(90deg, rgb(187, 251, 223) 0%, rgb(198, 203, 253) 50%, rgb(239, 201, 249) 100%)",initialising:p,initialisingColor:"violet"})]}),e.jsx("p",{children:t}),e.jsx("div",{className:"job-status","data-running":d?"false":"true","data-status":r?p?"init":d?"stop":"run":"inactive",children:e.jsx("span",{children:r?p?"Initlialising":d?"Paused":"Running":"Inactive"})})]})},vo=()=>{const s=n.useRef(null),t=n.useRef(null),o=n.useRef(null),u=n.useRef(null),[l,r]=n.useState(!1),a=p=>{s.current.samples=Math.floor(p),h()},d=p=>{s.current.samplingInterval=1/Math.floor(p),h()},m=p=>{s.current.parallelCompute=Math.floor(p),h()},h=()=>{const p=new FormData;p.append("FFT",JSON.stringify(s.current)),fetch(`${N}/config/send/FFT`,{method:"POST",credentials:"include",body:p})},c=async()=>{await fetch(`${N}/config/FFT`,{method:"GET",credentials:"include"}).then(p=>p.json()).then(p=>{s.current=p}),r(s.current.useServerFFT),o.current.value=s.current.samples,t.current.value=Math.floor(1/s.current.samplingInterval),u.current.value=s.current.parallelCompute};return n.useEffect(()=>{c()},[]),e.jsxs("div",{className:"admin-setting-entry-content",children:[e.jsxs("div",{className:"admin-setting-entry-line",children:[e.jsx("span",{children:"Activate audio spectra computation"}),e.jsx(mo,{defaultValue:s.current,active:l,setActive:p=>{r(p),s.current&&(s.current.useServerFFT=p,h())}})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame definiton (power of 2)"}),e.jsx(_e,{ref:o,stateChanged:a,max:4096,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Frame per second"}),e.jsx(_e,{ref:t,stateChanged:d,max:120,min:0})]}),e.jsxs("div",{className:"admin-setting-entry-line","data-is-enabled":l,children:[e.jsx("span",{children:"Number of parallel analyzed songs"}),e.jsx(_e,{ref:u,stateChanged:m,max:10,min:1})]})]})},jo={FFT:vo},bo=({entryName:s,entryIcon:t,linkedSettingKey:o})=>{const[u,l]=n.useState(!1),r=n.useMemo(()=>jo[o]||null,[o]);return e.jsxs("div",{className:"admin-setting-entry",children:[e.jsxs("div",{className:"admin-setting-entry-header","data-extended":u,onClick:a=>{a.stopPropagation(),l(!u)},children:[t,e.jsx("span",{children:s})]}),e.jsx("div",{className:"admin-setting-content",children:r&&u&&e.jsx(r,{})})]})},yo=()=>{const s=()=>localStorage.getItem("job-progress-view")?localStorage.getItem("job-progress-view")==="true":!0,[t,o]=n.useState(!1),[u,l]=n.useState([]),[r,a]=n.useState(0),d=n.useRef(s()),m=me();n.useEffect(()=>{$e(()=>{fetch(`${N}/auth/is-admin`,{method:"POST",credentials:"include"}).then(x=>x.json()).then(x=>{o(x)})})()},[]),n.useEffect(()=>{t.error||fetch(`${N}/auth/init-admin-pannel`,{method:"POST",credentials:"include"}).then(f=>f.json()).then(f=>{l(f.users),a(f.totalStorage)})},[t]);const h=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You are not an admin."})]}),c=f=>{const x=f===0;d.current=x,localStorage.setItem("job-progress-view",x)},p=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Admin pannel"}),e.jsx("p",{children:"Only for the true admins."}),e.jsxs("div",{className:"admin-category",children:[e.jsx(Dr,{}),e.jsx("h2",{children:"Users' storage usage"})]}),e.jsx("div",{className:"all-users-list",children:u.map(f=>e.jsx(xo,{user:f,totalStorage:r},f.id))}),e.jsxs("div",{className:"admin-category",children:[e.jsx(Vr,{}),e.jsx("h2",{children:"Backend processes"}),e.jsx(Bs,{data:["Done/Total","Working/Remaining"],currentActive:s()?0:1,onClick:c})]}),e.jsxs("div",{className:"job-grid",children:[e.jsx(ys,{jobKey:"JOB_CD",jobName:"Recompute tracks number and CDs",description:"Reextract the metadatas of the songs to remap them to the correct CD or track number. Analyses lossless.",doneTotalView:d}),e.jsx(ys,{jobKey:"JOB_FFT",jobName:"Compute audio spectras",description:"Runs a fast Fourier transform on each audio files to extract the audio spectrum. The result is writen into .bin files. For a .flac audio of 41kHz, we expect 3Mb spectrum file.",payload:{completeLibrary:!0},doneTotalView:d})]}),e.jsxs("div",{className:"admin-category",children:[e.jsx(Hr,{}),e.jsx("h2",{children:"Configuration"})]}),e.jsx("div",{className:"admin-settings-list",children:e.jsx(bo,{linkedSettingKey:"FFT",entryName:"Audio spectra",entryIcon:e.jsx(Fs,{})})})]});return e.jsxs("div",{className:"account-page",children:[e.jsx($t,{}),e.jsxs("div",{className:"account-content",children:[e.jsx("button",{className:"roundButton go-back",onClick:()=>m("/home"),children:e.jsx(Qe,{})}),e.jsx("div",{className:"account-info",children:t?e.jsx(p,{}):e.jsx(h,{})})]})]})},No=()=>{const[s,t]=n.useState(!0),o=me(),u=async r=>{if(r.preventDefault(),!r.target.email.value||!r.target.password.value||!r.target.repeat_password.value||!r.target.name.value){alert("Please fill in all fields");return}if(r.target.password.value!==r.target.repeat_password.value){alert("Passwords do not match");return}const a=new FormData(r.target),d=await fetch(`${N}/auth/register`,{method:"POST",credentials:"include",body:a}),m=await d.json();d.ok?(alert("User registered successfully"),o("/home")):alert(m.error)};n.useEffect(()=>{fetch(`${N}/auth/any-user`,{method:"GET"}).then(r=>r.json()).then(r=>{t(r===0)})},[]);const l=()=>e.jsxs("div",{style:{marginBottom:"30px",display:"flex",flexDirection:"row",alignItems:"center",margin:"auto",gap:"20px"},children:[e.jsx("p",{style:{textWrap:"nowrap"},children:"Already an account?"}),e.jsx("button",{style:{width:"100%"},onClick:r=>{r.stopPropagation(),o("/")},children:"Login"})]});return e.jsxs("div",{className:"authDiv",children:[e.jsx(Lt,{useText:!0,style:{position:"absolute",left:"10px"}}),e.jsx(Hs,{}),e.jsx(te,{}),e.jsx("h2",{children:"Register"}),e.jsx("p",{children:s?`Welcome to the Crystal Music Library! Since you are the first 
            to show up here, we would like you to create the admin account.`:"Please fill the form to register as a new user."}),!s&&e.jsx(l,{}),e.jsxs("form",{onSubmit:u,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",name:"email",placeholder:"Username",autoComplete:"email"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password",autoComplete:"new-password"}),e.jsx("label",{htmlFor:"repeat_password",children:"Confirm Password"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",name:"repeat_password",autoComplete:"password"}),e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",autoComplete:"name"}),e.jsx("button",{type:"submit",children:"Register"})]})]})},ko=()=>{const[s,t]=n.useState(null),{genreId:o}=Pt(),{addContainerToQueue:u,playContainerSuffle:l,playContainer:r,navigateBack:a}=re();n.useEffect(()=>{fetch(`${N}/read-write/genre/${o}`,{method:"GET",credentials:"include"}).then(c=>{if(!c.ok)throw new Error("Network response was not ok");return c.json()}).then(c=>{t(c),console.log(c)})},[]);const d=async()=>{r(o,"genre")},m=async()=>{u(o,"genre")},h=async()=>{l(o,"genre")};return e.jsxs("div",{className:"genre-view",children:[e.jsx("button",{className:"roundButton go-back",onClick:a,children:e.jsx(Qe,{})}),s?e.jsxs("div",{className:"genre-details",children:[e.jsx("h1",{children:s.name}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(ne,{text:"Play",icon:e.jsx(Wt,{}),onClick:d}),e.jsx(ne,{text:"Random",icon:e.jsx(ct,{}),onClick:h}),e.jsx(ne,{text:"Add to queue",icon:e.jsx(Yt,{}),onClick:m})]}),e.jsx("div",{className:"genre-albums album-displayer",children:s.albums.map(c=>e.jsx(ss,{album:c},c.id))})]}):e.jsx("p",{children:"Loading..."})]})},So=({genre:s})=>{const t=me(),[o,u]=n.useState([]),[l,r]=n.useState([]),a=n.useRef([]),d=n.useRef(l),m=n.useRef([]),h=f=>{var j;if(console.log("changed on",f),!((j=d.current)!=null&&j.length)==0)return;const x=document.getElementById(`genre-${s.id}-img-${f}`);x==null||x.setAttribute("data-hidden","true"),setTimeout(()=>{x&&(x.src=`${N}/covers/${d==null?void 0:d.current[f]}`),x==null||x.removeAttribute("data-hidden")},500)};n.useEffect(()=>(c(u),p(),[2e3,2500,3e3].forEach((x,j)=>{setTimeout(()=>h(j),x);const b=setInterval(()=>h(j),7e3);m.current.push(b)}),()=>{a.current.forEach(clearTimeout),a.current=[],m.current.forEach(clearInterval),m.current=[],d.current=[]}),[]);const c=f=>{fetch(`${N}/read-write/trackCoversGenre/${s.id}`,{method:"GET",credentials:"include"}).then(x=>x.json()).then(x=>{f(x)})};n.useEffect(()=>{d.current=l},[l]);const p=()=>{c(r),setTimeout(p,5500)};return e.jsxs("div",{className:`genre-card ${s==null?void 0:s.puredName}`,onClick:()=>{t(`/genres/${s.id}`)},children:[e.jsx("div",{className:"card-pivot-origin",children:o.map((f,x)=>e.jsx("div",{className:"img-pivot",style:{"--start-delay":`${3*(2-x)}`,"--start-angle":`${2-x}`,"--speed":"0.7","--scale":.4},children:e.jsx("img",{id:`genre-${s.id}-img-${x}`,className:"genre-img-cover",style:{"--scale":.7},src:`${N}/covers/${f}`})},x))}),e.jsx("div",{className:"genre-name",children:e.jsx("p",{children:s.name})})]})},wo=[{name:"rock"},{name:"hiphop"},{name:"jazz"},{name:"edm"},{name:"house"},{name:"techno"},{name:"trance"},{name:"dubstep"},{name:"reggae"},{name:"ska"},{name:"country"},{name:"folk"},{name:"acoustic"},{name:"singer"},{name:"songwriter"},{name:"latin"},{name:"salsa"},{name:"reggaeton"},{name:"afrobeat"},{name:"jpop"},{name:"jpop"},{name:"lofi"},{name:"electronic"},{name:"indie"},{name:"alternative"},{name:"punk"},{name:"metal"},{name:"opera"},{name:"classical"},{name:"funk"},{name:"blues"},{name:"soul"},{name:"rnb"},{name:"chillhop"},{name:"ambiant"},{name:"soundtrack"},{name:"art-rock"},{name:"pop-rock"},{name:"breakcore"},{name:"worldwide"},{name:"rnb-soul"},{name:"hard-rock"},{name:"shoegaze"},{name:"indie-rock"},{name:"traditional"},{name:"anime"},{name:"pop"}],To=new Ps(wo,{keys:["name"],threshold:.4}),Eo=s=>{const t=s.replace(/[^a-zA-Z ]/g," "),o=To.search(t);return"genre-"+(o.length>0?o[0].item.name:"default")},Co=({})=>{var a,d;const{subscribe:s}=fe(),[t,o]=n.useState([]),[u,l]=n.useState(()=>{const m=localStorage.getItem("CML_FinishedTutorials");return m&&JSON.parse(m).state[we.GENRES]||!1}),r=()=>{fetch(`${N}/read-write/genres`,{method:"GET",credentials:"include"}).then(m=>m.json()).then(m=>{m.genres=m.genres.map(h=>({...h,puredName:Eo(h.name)})),o(m)})};return n.useEffect(()=>{const m=s(`safe-finished-tutorial-${we.GENRES}`,()=>{l(!0)}),h=s("musicUploaded",r);return $e(()=>{r()})(),()=>{h(),m()}},[]),e.jsx(e.Fragment,{children:((a=t==null?void 0:t.genres)==null?void 0:a.length)!==0?e.jsx("div",{className:"home genre-displayer",children:(d=t==null?void 0:t.genres)==null?void 0:d.map(m=>e.jsx(So,{genre:m},m.id))}):(t==null?void 0:t.trackNum)>0?u?e.jsxs("div",{className:"info-line",id:"text-no-genre",children:[e.jsx("span",{children:"No genres found in the library."}),e.jsx(qt,{className:"info-button",onClick:()=>{l(!1)}})]}):e.jsx(Ds,{tutorialKey:we.GENRES}):e.jsx(ns,{})})},Ro=({playlist:s})=>{const t=me(),o=u=>{t(`/playlists/${u}`)};return e.jsxs("div",{className:"artist-card",onClick:()=>o(s.id),children:[s.cover?e.jsx("img",{src:`${N}/covers/${s.cover}`,alt:`${s.name} cover`,className:"artist-card-cover"}):e.jsx(te,{className:"cover-image"}),e.jsx("h3",{className:"artist-name",children:s.name})]})},Ao=()=>{const[s,t]=n.useState([]),{createNewPlaylist:o,setPlaylistAddedCallback:u}=re(),l=()=>{fetch(`${N}/read-write/playlists`,{method:"GET",credentials:"include"}).then(r=>r.json()).then(r=>t(r))};return n.useEffect(()=>{$e(()=>{l(),u(l)})()},[]),e.jsxs("div",{children:[e.jsx(ne,{className:"buttonRound",id:"new-playlist",onClick:o,icon:e.jsx(zr,{}),text:"Create a new playlist"}),e.jsx("div",{className:"album-displayer",children:s.map(r=>e.jsx(Ro,{playlist:r},r.id))})]})},Io=()=>{const s=n.useRef(null),t=n.useRef(null),[o,u]=n.useState(!1),[l,r]=n.useState([]),{playAudioSalad:a,setSaladContext:d,saladContext:m,openTagWindow:h}=re(),[c,p]=n.useState([]),[f,x]=n.useState([]),{addNotification:j,notifTypes:b}=Oe(),[O,k]=n.useState([]),[C,M]=n.useState(!1),[I,F]=n.useState(!1),P=n.useRef(null),R=n.useRef(null),[S,V]=n.useState("#aabbcc"),[Q,B]=n.useState(!0),{subscribe:w}=fe(),[D,_]=n.useState(()=>{const H=localStorage.getItem("CML_FinishedTutorials");return H&&JSON.parse(H).state[we.COOKING]||!1});n.useEffect(()=>{const H=le=>{s.current&&!s.current.contains(le.target)&&Z()},G=()=>{_(!0)};let oe=w(`safe-finished-tutorial-${we.COOKING}`,G);return $e(()=>{c.length===0&&p(m||[]),fetch(`${N}/read-write/mostUsedTags`,{method:"GET",credentials:"include"}).then(le=>le.json()).then(le=>{const A=le.map(K=>({...K,type:K.total,typeElem:"tag",icon:()=>e.jsx(vt,{color:K.color}),tooltip:y=>e.jsx("span",{children:y})}));x(A),r(A)}),document.addEventListener("mousedown",H),document.addEventListener("touchstart",H)})(),()=>{oe(),document.removeEventListener("mousedown",H),document.removeEventListener("touchstart",H)}},[]);const W=H=>{const G=H.target.value;if(G===""||G.trim().length===0){r(f);return}fetch(`${N}/read-write/search/${G}/tags,salads`,{method:"GET"}).then(oe=>{if(oe.ok)return oe.json();throw new Error("Error fetching search results")}).then(oe=>{var le,A;const be=[...(le=oe.tags)==null?void 0:le.map(K=>({...K,typeElem:"tag",icon:()=>e.jsx(vt,{color:K.color})})),...(A=oe.salads)==null?void 0:A.map(K=>({...K,typeElem:"salad",icon:()=>e.jsx(rt,{color:K.color})}))];console.log(be),r(be)})},Z=()=>{u(!1)},ee=H=>{p(G=>G.filter(oe=>oe.id!==H))},ae=H=>{Z(),console.log(H),!c.find(G=>G.id===H.id)&&p(G=>[...G,H])},de=async()=>{a(O.map(H=>H.id)),d(c)};n.useEffect(()=>{if(d(c),c.length===0){k([]),B(!0);return}B(c.findIndex(G=>G.typeElem==="salad")===-1);const H=new FormData;H.append("tags",JSON.stringify(c.filter(G=>G.typeElem==="tag").map(G=>G.id))),H.append("salads",JSON.stringify(c.filter(G=>G.typeElem==="salad").map(G=>G.id))),fetch(`${N}/read-write/getSalad`,{method:"POST",body:H}).then(G=>G.json()).then(G=>JSON.parse(G)).then(G=>{k(gt.shuffle(G)),console.log("New tracks received",G),G.length>0?j("Salad received! Enjoy..",b.SALAD):j("This salad is empty.. No tracks found.",b.SALAD)})},[c]);const ge=async()=>{c.length!==0&&(M(!0),V(`${$s(Math.random().toFixed(4)*360,100,70.8)}`))},je=()=>{if(!R.current.value||(M(!1),c.find(G=>G.typeElem==="salad")))return;const H=new FormData;H.append("salad",JSON.stringify({name:R.current.value,color:S,tags:c.map(G=>G.id)})),fetch(`${N}/read-write/newSalad`,{method:"POST",credentials:"include",body:H}).then(G=>G.json()).then(G=>{j("Salad saved!",b.SUCCESS),p([G])})},he=H=>{a(O.map(G=>G.id),H)},Te=()=>{u(!0),t.current.value};return e.jsxs(e.Fragment,{children:[e.jsx(qt,{className:"info-button",id:"cooking-info",onClick:()=>{_(!1)}}),D?e.jsxs("div",{className:"cooking-div",children:[e.jsx("h2",{children:"Here select some tags and play the music!"}),e.jsxs("div",{className:"cooking-header",children:[e.jsx("div",{className:"action-bar",style:{margin:"auto"},ref:s,children:e.jsxs("div",{className:"action-bar-research",id:"playlist-researchbar",style:{zIndex:"2"},children:[e.jsxs("div",{className:"action-bar-logo-container",children:[e.jsx(Je,{className:"action-bar-current-logo"})," "]}),e.jsx("input",{className:"searchbar",type:"text",id:"playlist-searchbar",onChange:W,placeholder:"Search some tags or salads..",ref:t,onFocus:Te}),e.jsx("div",{className:"action-bar-results",style:{display:`${o?"block":"none"}`},children:e.jsx(Le,{height:300,itemCount:l.length,itemSize:50,width:"calc(100% - 0px)",style:{overflowY:"auto",marginBottom:"20px"},children:({index:H,style:G})=>e.jsx(Nt,{entry:l[H],style:{...G,width:" calc(100% - 20px)",marginTop:"10px"},onClick:ae},H)})})]})}),e.jsx("button",{className:"open-tags-edit",onClick:h,children:e.jsx(qr,{})})]}),e.jsxs("div",{className:"cooking-selection",children:[e.jsxs("div",{className:"cooking-actions",children:[e.jsx(ne,{text:"Play salad",icon:e.jsx(Wr,{}),onClick:de}),Q&&e.jsx(ne,{text:"Save salad",icon:e.jsx(Kr,{}),onClick:ge})]}),e.jsx("div",{className:"cooking-tags",style:{marginBottom:"30px"},children:c.map(H=>e.jsxs("div",{className:"small-tag","data-prefix":H.typeElem==="salad",style:{backgroundColor:H.color},children:[H.typeElem==="salad"&&e.jsx(rt,{"data-prefix":"true"}),e.jsx("span",{children:H.name}),e.jsx(pe,{onClick:()=>{ee(H.id)}})]},H.id))}),e.jsx("div",{className:"track-list",children:O.map((H,G)=>e.jsx(zs,{index:G,isSalad:he,track:H,playIconId:"salad",showCover:!0},H.id))})]}),C?e.jsxs("div",{className:"edit-tag",style:{left:"calc(50% - 170px)",margin:"auto"},children:[e.jsx(pe,{style:{cursor:"pointer"},onClick:()=>{M(!1)}}),e.jsx("input",{type:"text",placeholder:"Name your new salad.",ref:R}),e.jsx(Jr,{style:{cursor:"pointer"},id:"color-button",color:S,onClick:()=>{F(!I)}}),I&&e.jsxs("div",{ref:P,className:"edit-tag-picker",children:[" ",e.jsx(Xt,{color:S,onChange:V})]}),e.jsx(at,{onClick:je,style:{cursor:"pointer"}})]}):null]}):e.jsx(Ds,{tutorialKey:we.COOKING})]})},Ns=({radio:s})=>{const{playRadio:t,externalRadioInfos:o}=re();return e.jsxs("div",{className:"album-card",onClick:()=>{s.id?o.current=null:o.current=s,t(s.id?`radio-id:${s.id}`:`radio-url:${s.url}`)},children:[s.coverUrl?e.jsx("img",{src:`${N}/radio/favicon-proxy?url=${encodeURIComponent(s.coverUrl)}`,alt:`${Be(s.name,25)} cover`,className:"album-card-cover"}):e.jsx(te,{className:"cover-image"}),e.jsx("h3",{className:"album-name",children:Be(s.name,40)})]})},Fo=()=>e.jsxs("div",{className:"album-card-loader loader-div",children:[e.jsx("div",{className:"album-card-loader loader-img"}),e.jsx("div",{className:"album-card-loader loader-text title"}),e.jsx("div",{className:"album-card-loader loader-text "})]}),Po=()=>{const[s,t]=n.useState(!1),[o,u]=n.useState([]),[l,r]=n.useState([]),{subscribe:a}=fe(),{addNotification:d,notifTypes:m}=Oe();n.useEffect(()=>{const x=a("refetch-known-radios",h);return $e(()=>{h()})(),()=>{x()}},[]);const h=async()=>{const x=await fetch(`${N}/radio/radios`,{method:"GET",credentials:"include"}).then(b=>b.json());t(!0);const j=(x==null?void 0:x.length)>0?x.map(b=>({...b,uuid:b.id})):[];u(j)},c=async()=>{d("Comming soon! :)",m.INFO)},p=async()=>{const j=(await fetch(`${N}/radio/stations`).then(b=>b.json()).then(b=>JSON.parse(b))).map(b=>({coverUrl:b.favicon,name:b.name,url:b.url_resolved,uuid:b.stationuuid}));r(j)},f=async()=>{window.open("https://www.radio-browser.info/tags","_blank").focus()};return e.jsxs("div",{className:"home",id:"radio-page",children:[e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(Jt,{}),e.jsx("h3",{children:"Favorite radios"})]}),e.jsx("div",{className:"album-displayer",id:"fav-radios","data-flat":"true","data-no-tracks":(o==null?void 0:o.length)==0&&s?"true":"false",children:s?(o==null?void 0:o.length)>0?o.map(x=>e.jsx(Ns,{radio:x},x.id)):null:e.jsx(Fo,{})}),e.jsxs("div",{className:"alligned-title-logo",children:[e.jsx(Qr,{}),e.jsx("h3",{style:{marginRight:"20px"},children:"Discover"})]}),e.jsxs("div",{className:"track-list-header",children:[e.jsx(ne,{text:"Filters",icon:e.jsx(Yr,{}),onClick:c}),e.jsx(ne,{text:"Random",icon:e.jsx(ct,{}),onClick:p}),e.jsx(ne,{text:"External search",icon:e.jsx(Xr,{}),onClick:f})]}),e.jsx("div",{className:"album-displayer",children:(l==null?void 0:l.length)!==0?l.map((x,j)=>e.jsx(Ns,{radio:x},j)):null})]})},Lo=()=>{const s=n.useRef(),t=n.useRef(null),{getFFTAtCurrentTime:o,fftConfigRef:u,globalAudioRef:l,FFTUserSetingsRef:r,fetchFFTUserSettings:a,colorOverride:d,currentTrackData:m}=re(),h=n.useRef(0),c=p=>{var x,j;if((m==null?void 0:m.type)=="radio"){cancelAnimationFrame(s.current);return}if(!t.current){s.current=requestAnimationFrame(c);return}const f=t.current.getContext("2d");if(f&&r.current&&d.current){if(p-h.current<1e3/r.current.FPS){s.current=requestAnimationFrame(c);return}h.current=p;const b=r.current.bars;f.clearRect(0,0,t.current.width,t.current.height);const O=o();if(!O){s.current=requestAnimationFrame(c);return}u.current.sampleRate/O.length;const k=Math.max(1,O.length/b),C=new Array(b);C.fill(0);for(let F=0;F<O.length;F++)C[Math.floor(F/k)]+=Number(O[F]);let M=t.current.width/b-1,I=0;for(let F=0;F<C.length;F++){const P=r.current.scale*Math.log2(C[F])*(b/5)*((x=l.current)==null?void 0:x.volume);if(((j=d.current)==null?void 0:j.length)>0){const R=Math.min(1,Math.max(0,P/r.current.scale/r.current.contrast/300));f.fillStyle=`rgb(
						${We(d.current[0][0],d.current[1][0],R)} 
						${We(d.current[0][1],d.current[1][1],R)}
						${We(d.current[0][2],d.current[1][2],R)}
						)`}else f.fillStyle=`rgb(${P/r.current.scale/r.current.contrast} 137 255)`;f.fillRect(I,t.current.height-P,M,P),I+=M+1}}s.current=requestAnimationFrame(c)};return n.useEffect(()=>{if(!u.current){cancelAnimationFrame(s.current),console.log("No FFT data to display, releasing anim frame.");return}s.current=requestAnimationFrame(c),console.log("FFT found, requested animation frame.")},[u.current]),n.useEffect(()=>(s.current=requestAnimationFrame(c),()=>{cancelAnimationFrame(s.current)}),[]),e.jsx("canvas",{ref:t,id:"fft-canvas",width:1900,height:1e3})},$o=()=>{const{playingTrack:s}=re();return e.jsxs("div",{className:"content-with-fft",children:[e.jsx(ks,{})," ",s?e.jsx(Lo,{}):null]})},Oo=()=>{const{fullScreenImage:s,currentTrackData:t,requestNewFullScreenImage:o,playingTrack:u,toggleFullScreenView:l,colorOverride:r,recomputeColors:a,songPalette:d}=re(),m=n.useRef(null),h=n.useRef(null),c=n.useRef(null),p=n.useRef(null),f=n.useRef(null),x=n.useRef(!1),j=n.useRef(0),b=3,O=n.useRef(0),[k,C]=n.useState(!1);n.useRef([]);const M=n.useRef(0),I=n.useRef(0),F=n.useRef(0),P=w=>{x.current?(m.current.src=URL.createObjectURL(w),h.current.src=URL.createObjectURL(w),f.current=m.current):(c.current.src=URL.createObjectURL(w),p.current.src=URL.createObjectURL(w),f.current=c.current),f.current.addEventListener("load",V)};n.useEffect(()=>{if(m.current&&h.current){if((t==null?void 0:t.type)=="radio"){if(t.coverUrl){const w=`${N}/radio/favicon-proxy?url=${encodeURIComponent(t.coverUrl)}`;x.current?(m.current.src=w,h.current.src=w,f.current=m.current):(c.current.src=w,p.current.src=w,f.current=c.current)}return}u&&((s==null?void 0:s.track)!==u?(x.current=!x.current,o().then(w=>{P(w.blob)})):P(s.blob))}},[t,u]);const R=(w,D)=>{w?(m.current.setAttribute("data-hidden",D),h.current.setAttribute("data-hidden",D)):(c.current.setAttribute("data-hidden",D),p.current.setAttribute("data-hidden",D))},S=()=>{m.current.removeEventListener("load",V),Q()},V=()=>{var w;(w=f.current)!=null&&w.src&&(R(x.current,!1),R(!x.current,!0),clearTimeout(M.current),M.current=setTimeout(()=>{x.current?c.current&&(c.current.src=null,p.current.src=null):m.current&&(m.current.src=null,h.current.src=null)},1100),a(f,S))},Q=()=>{const w=d.current.pairs.length||0;if(w===0)return;const D=d.current.pairs[w-1-F.current%w],_=[D.c1,D.c2];F.current+=1,clearTimeout(I.current),r.current.length===0?r.current=_:B(_,0)},B=(w,D)=>{r.current=r.current.map((_,W)=>_.map((Z,ee)=>parseInt(We(Z,w[W][ee],.1)))),!(D>150)&&(I.current=setTimeout(()=>{B(w,D+1)},1e3/60))};return n.useEffect(()=>{var W,Z;const w=()=>{j.current=0,C(!1)},D=()=>{j.current++,j.current>=b?+C(!0):C(!1)},_=["mousemove","keydown","mousedown","touchstart","scroll"];return _.forEach(ee=>{window.addEventListener(ee,w)}),O.current=setInterval(D,1e3),(W=f.current)!=null&&W.complete&&((Z=f.current)!=null&&Z.src)&&a(m,S),()=>{_.forEach(ee=>{window.removeEventListener(ee,w)}),clearInterval(O.current),clearTimeout(I.current),r.current=[]}},[]),e.jsxs("div",{id:"full-screen-page",children:[e.jsxs("div",{className:"full-screen-header",children:[e.jsx("button",{className:"roundButton full-screen-back go-back","data-inactive":k,onClick:l,children:e.jsx(Qe,{})}),e.jsx("button",{className:"roundButton full-screen-back","data-inactive":k,onClick:Q,children:e.jsx(Zr,{})})]}),e.jsx("div",{"data-inactive":k,className:"full-screen-audio-ctrl",children:e.jsx(zt,{context:""})}),(u||(t==null?void 0:t.type)=="radio")&&e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:h,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:m,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"})}),e.jsx("img",{className:"full-screen-image-back full-screen-fadable",ref:p,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"}),e.jsx("div",{className:"full-screen",children:e.jsx("img",{className:"full-screen-image full-screen-fadable",ref:c,crossOrigin:"anonymous","data-inactive":k,alt:"No tracks palying"})})]})]})};function Mo(s=[]){const t=Ke();n.useEffect(()=>{s.includes(t.pathname)?(document.documentElement.classList.add("scroll-enabled"),document.body.classList.add("scroll-enabled")):(document.documentElement.classList.remove("scroll-enabled"),document.body.classList.remove("scroll-enabled"))},[t,s])}const Uo=()=>(Mo(["/","/register","/settings","/admin-pannel"]),e.jsx(na,{children:e.jsx(la,{children:e.jsxs(ba,{children:[" ",e.jsx(Ka,{children:e.jsxs(Jn,{children:[e.jsx(ie,{path:"/",element:e.jsx(ao,{})}),e.jsx(ie,{path:"register",element:e.jsx(No,{})}),e.jsx(ie,{element:e.jsx($o,{}),children:e.jsx(ie,{path:"full-screen",element:e.jsx(Oo,{})})}),e.jsxs(ie,{element:e.jsx(eo,{}),children:[e.jsx(ie,{path:"home",element:e.jsx(to,{})}),e.jsx(ie,{path:"albums",element:e.jsx(so,{})}),e.jsx(ie,{path:"albums/:albumId",element:e.jsx(bs,{})}),e.jsx(ie,{path:"artists",element:e.jsx(co,{})}),e.jsx(ie,{path:"artists/:artistId",element:e.jsx(io,{})}),e.jsx(ie,{path:"genres",element:e.jsx(Co,{})}),e.jsx(ie,{path:"genres/:genreId",element:e.jsx(ko,{})}),e.jsx(ie,{path:"playlists",element:e.jsx(Ao,{})}),e.jsx(ie,{path:"playlists/:playlistId",element:e.jsx(bs,{isPlaylist:!0})}),e.jsx(ie,{path:"cooking",element:e.jsx(Io,{})}),e.jsx(ie,{path:"radio",element:e.jsx(Po,{})})]}),e.jsx(ie,{path:"account",element:e.jsx(uo,{})}),e.jsx(ie,{path:"settings",element:e.jsx(go,{})}),e.jsx(ie,{path:"admin-pannel",element:e.jsx(yo,{})}),e.jsx(ie,{path:"*",element:e.jsx(lo,{})})]})})]})})}));Kn.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(Qn,{children:e.jsx(Uo,{})})}));
